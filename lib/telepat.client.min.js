!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Telepat",[],e):"object"==typeof exports?exports.Telepat=e():t.Telepat=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){(function(r){"use strict";function o(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(2),c=o(a),u=n(3),f=o(u),l=n(19),d=o(l),h=n(27),p=o(h),v=n(29),y=o(v),g=n(30),m=o(g),_=n(31),b=o(_),w=n(68),k=o(w),E=n(69),x=o(E),A=":deviceId",S=function(){function t(){function e(){return r.env["win32"===r.platform?"USERPROFILE":"HOME"]}function n(){var t=e()+"/.telepat-cli";return c["default"].existsSync(t)||c["default"].mkdirSync(t,744),t}var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;i(this,t),this.name=o&&o.name?o.name:"",A+=this.name,o&&o.name&&(delete o.name,o&&0===Object.keys(o).length&&o.constructor===Object&&(o=null)),this._db=new f["default"]("undefined"!=typeof window?"/_telepat":n()),this._event=new m["default"](p["default"]),this._monitor=new b["default"],this._socketEndpoint=null,this._socket=null,this._persistentConnectionOptions=null,this.connected=!1,this.connecting=!1,this.configured=!1,this.currentAppId=null,this.collections={},this.subscriptions={},this.admin=null,this.user=null,this.collectionEvent=new m["default"](p["default"]),o&&this.connect(o)}return s(t,[{key:"onReady",value:function(t){return this.on("ready",t)}},{key:"getCollections",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};d["default"].get("context/all","",function(n,r){if(n){var o=(0,y["default"])("Error retrieving collections "+n);t.callback(o,null)}else{t._monitor.remove({channel:{model:"context"}}),t.collections={};for(var i in r.body.content)t.collections[r.body.content[i].id]=r.body.content[i];t._monitor.add({channel:{model:"context"}},t.collections,t.collectionEvent,t._addCollection.bind(t),t._deleteCollection.bind(t),t._updateCollection.bind(t)),t.collectionEvent.on("update",function(e,n,r,o){t._event.emit("collections_update")}),e(null,t.collections),t._event.emit("collections_update")}})}},{key:"_addCollection",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.admin?this.admin.addCollection(t,e):p["default"].warn("Editing collection data as non-admin user. Changes will not be remotely persisted.")}},{key:"_updateCollection",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this.admin?this.admin.updateCollection(t,e,n):p["default"].warn("Editing collection data as non-admin user. Changes will not be remotely persisted.")}},{key:"_deleteCollection",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.admin?this.admin.deleteCollection(t,e):p["default"].warn("Editing collection data as non-admin user. Changes will not be remotely persisted.")}},{key:"_updateUser",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.user?n(null):this.user=new x["default"](this._db,this._event,this._monitor,function(e){t.admin=e},this.name,function(){e?t.user.reauth(n):n(null)})}},{key:"_getSavedUDID",value:function(t){this._db.get(A).then(function(e){e[d["default"].appId]?t(null,e[d["default"].appId]):(p["default"].warn("Could not retrieve saved UDID"),t(new Error("Could not retrieve saved UDID")))})["catch"](function(e){p["default"].warn("Could not retrieve saved UDID",e),t(e)})}},{key:"_saveUDID",value:function(t,e){var n=this;this._db.get(A).then(function(r){r[d["default"].appId]=t,n._db.put(r).then(function(){p["default"].info("Replaced existing UDID"),e(null)})["catch"](function(t){p["default"].warn("Could not persist UDID. Error: "+t),e(t)})})["catch"](function(){var t={_id:A};t[d["default"].appId]=d["default"].UDID,n._db.put(t).then(function(){p["default"].info("Saved new UDID"),e(null)})["catch"](function(t){p["default"].warn("Could not persist UDID. Error: "+t),e(t)})})}},{key:"_rebindVolatileTransport",value:function(t){var e=this;if(this._socket){var n=setTimeout(function(){t((0,y["default"])("Socket transport connection timeout"))},5e3);this._socket.emit("bind_device",{device_id:d["default"].UDID,application_id:d["default"].appId}),this._socket.on("ready",function(){e._socket.removeAllListeners("ready"),clearTimeout(n),n=null;for(var r in e.subscriptions)e.subscriptions[r].subscribe();t(null)})}}},{key:"configure",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};"undefined"!=typeof e.apiEndpoint?d["default"].apiEndpoint=e.apiEndpoint+"/":n((0,y["default"])("Configure options must provide an apiEndpoint property")),"undefined"!=typeof e.socketEndpoint?this._socketEndpoint=e.socketEndpoint:n((0,y["default"])("Configure options must provide an socketEndpoint property")),this._updateUser(e.reauth,function(){t._event.emit("configure"),t.configured=!0,n(null,t)})}},{key:"registerDevice",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=function(n,r){n?e(n):(r.body.content.identifier&&(d["default"].UDID=r.body.content.identifier,p["default"].info("Received new UDID: "+d["default"].UDID),t._saveUDID(d["default"].UDID,function(){})),e(null,r))},r={info:{os:"web",userAgent:"undefined"!=typeof navigator?navigator.userAgent:"node"},"volatile":{type:"sockets",active:1}};this._persistentConnectionOptions&&(r.persistent=this._persistentConnectionOptions,1===r.persistent.active&&(r["volatile"].active=0)),d["default"].call("device/register",r,function(t,e){t&&d["default"].UDID?(d["default"].UDID=null,d["default"].call("device/register",r,function(t,e){n(t,e)})):n(null,e)})}},{key:"connectVolatileTransport",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.disconnectVolatileTransport(),this._socket=n(71)(this._socketEndpoint,e),p["default"].info("Connecting to socket service "+this._socketEndpoint),this._socket.on("error",function(t){r(t)}),this._socket.on("connect",function(){t._rebindVolatileTransport(function(t){r(t)})}),this._socket.on("message",function(e){t.processMessage(e)}),this._socket.on("context-update",function(){t.getCollections()}),this._socket.on("disconnect",function(){p["default"].warn("Sockets disconnected"),t._event.emit("volatile_disconnect")}),this._socket.on("reconnect",function(){t._rebindVolatileTransport(function(e){e?t._event.emit("reconnect_failed"):t._event.emit("reconnect")})}),this._socket.on("reconnect_failed",function(){p["default"].warn("Sockets reconnect failed"),t._event.emit("reconnect_failed")})}},{key:"disconnectVolatileTransport",value:function(){this._socket&&(this._socket.removeAllListeners(),this._socket.close(),this._socket=null)}},{key:"connect",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if("undefined"==typeof e)return n((0,y["default"])("Options object not provided to the connect function"));if("undefined"==typeof e.apiKey)return n((0,y["default"])("Connect options must provide an apiKey property"));if("undefined"==typeof e.appId)return n((0,y["default"])("Connect options must provide an appId property"));if("undefined"!=typeof e.apiEndpoint)d["default"].apiEndpoint=e.apiEndpoint+"/";else if(!d["default"].apiEndpoint)return n((0,y["default"])("Connect options must provide an apiEndpoint property, or you must run `configure` first"));if("undefined"!=typeof e.socketEndpoint)this._socketEndpoint=e.socketEndpoint;else if(!this._socketEndpoint)return n((0,y["default"])("Connect options must provide an socketEndpoint property, or you must run `configure` first"));"undefined"!=typeof e.timerInterval&&(this._monitor.timerInterval=e.timerInterval);var r=function(e){t.connected=!1,t.connecting=!1,t.currentAppId=null,n((0,y["default"])("Device registration failed with error: "+e)),t._event.emit("connect_error",e)},o=function(){t.connected=!0,t.connecting=!1,t.currentAppId=d["default"].appId,n(null),t._event.emit("connect"),t._event.emit("ready")},i=function(){t.getCollections(function(n){n?r(n):t._updateUser(e.reauth,function(){o()})})},s=function(e,n){e?r(e):t._persistentConnectionOptions&&1===t._persistentConnectionOptions.active?i():t.connectVolatileTransport({},function(t){t?r(t):i()})};return this.connected&&(this.connected=!1,this.disconnect()),this.connecting=!0,d["default"].apiKey=e.apiKey,d["default"].appId=e.appId,this.admin&&this.admin.apps&&(this.admin.app=this.admin.apps[d["default"].appId]),this._persistentConnectionOptions=e.persistentConnection||this._persistentConnectionOptions,e.updateUDID?this.registerDevice(s):this._getSavedUDID(function(e,n){e||(d["default"].UDID=n),t.registerDevice(s)}),this}},{key:"disconnect",value:function(){var t=this;this.disconnectVolatileTransport(),this.collections=null,this._monitor.remove({channel:{model:"context"}});for(var e in this.subscriptions)this.subscriptions[e].unsubscribe();this.subscriptions={},this.user.isAdmin||this.user.logout(function(){t.admin.unhook(),t.admin=null,t.user=null}),d["default"].apiKey=null,d["default"].appId=null,d["default"].UDID=null,this._event.emit("disconnect"),this.currentAppId=null,this.connected=!1}},{key:"processMessage",value:function(t){this._monitor.processMessage(t)}},{key:"setLogLevel",value:function(t){return p["default"].setLevel(t),this}},{key:"on",value:function(t,e){return"connect"!==t&&"ready"!==t||!this.connected||setTimeout(e,0),this._event.on(t,e)}},{key:"removeCallback",value:function(t,e){return this._event.removeCallback(t,e)}},{key:"subscribe",value:function(t,e){var n=this,r=new k["default"](this._monitor,t),o=b["default"].subscriptionKeyForOptions(t);return this.subscriptions[o]=r,r.subscribe(),void 0!==e&&r.on("subscribe",e),r.on("_unsubscribe",function(){delete n.subscriptions[o]}),r}},{key:"getChannel",value:function(t){var e=b["default"].subscriptionKeyForOptions(t);return this.subscriptions[e]?this.subscriptions[e]:new k["default"](this._monitor,t)}},{key:"sendEmail",value:function(t,e,n,r,o,i){d["default"].call("/email",{recipients:n,from:t,from_name:e,subject:r,body:o},function(t,e){t?i((0,y["default"])("Send email failed with error: "+t),null):i(null,e.body.content)})}},{key:"get",value:function(t,e){t.no_subscribe=!0,d["default"].call("object/subscribe",t,function(t,n){t?e((0,y["default"])("Get objects failed with error: "+t),null):e(null,n.body.content)})}}]),t}();e["default"]=S,t.exports=e["default"]}).call(e,n(1))},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(f===setTimeout)return setTimeout(t,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(t,0);try{return f(t,0)}catch(e){try{return f.call(null,t,0)}catch(e){return f.call(this,t,0)}}}function i(t){if(l===clearTimeout)return clearTimeout(t);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function s(){v&&h&&(v=!1,h.length?p=h.concat(p):y=-1,p.length&&a())}function a(){if(!v){var t=o(s);v=!0;for(var e=p.length;e;){for(h=p,p=[];++y<e;)h&&h[y].run();y=-1,e=p.length}h=null,v=!1,i(t)}}function c(t,e){this.fun=t,this.array=e}function u(){}var f,l,d=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(t){f=n}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(t){l=r}}();var h,p=[],v=!1,y=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new c(t,e)),1!==p.length||v||o(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.prependListener=u,d.prependOnceListener=u,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(t,e){console.log("I'm `fs` modules")},function(t,e,n){(function(e){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t["default"]:t}function o(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer||"undefined"!=typeof Blob&&t instanceof Blob}function i(t){if("function"==typeof t.slice)return t.slice(0);var e=new ArrayBuffer(t.byteLength),n=new Uint8Array(e),r=new Uint8Array(t);return n.set(r),e}function s(t){if(t instanceof ArrayBuffer)return i(t);var e=t.size,n=t.type;return"function"==typeof t.slice?t.slice(0,e,n):t.webkitSlice(0,e,n)}function a(t){var e=Object.getPrototypeOf(t);if(null===e)return!0;var n=e.constructor;return"function"==typeof n&&n instanceof n&&bo.call(n)==wo}function c(t){var e,n,r;if(!t||"object"!=typeof t)return t;if(Array.isArray(t)){for(e=[],n=0,r=t.length;n<r;n++)e[n]=c(t[n]);return e}if(t instanceof Date)return t.toISOString();if(o(t))return s(t);if(!a(t))return t;e={};for(n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=c(t[n]);"undefined"!=typeof i&&(e[n]=i)}return e}function u(t){var e=!1;return lo(function(n){if(e)throw new Error("once called more than once");e=!0,t.apply(this,n)})}function f(t){return lo(function(e){e=c(e);var n=this,r="function"==typeof e[e.length-1]&&e.pop(),o=new _o(function(r,o){var i;try{var s=u(function(t,e){t?o(t):r(e)});e.push(s),i=t.apply(n,e),i&&"function"==typeof i.then&&r(i)}catch(a){o(a)}});return r&&o.then(function(t){r(null,t)},r),o})}function l(t,e,n){if(t.constructor.listeners("debug").length){for(var r=["api",t.name,e],o=0;o<n.length-1;o++)r.push(n[o]);t.constructor.emit("debug",r);var i=n[n.length-1];n[n.length-1]=function(n,r){var o=["api",t.name,e];o=o.concat(n?["error",n]:["success",r]),t.constructor.emit("debug",o),i(n,r)}}}function d(t,e){return f(lo(function(n){if(this._closed)return _o.reject(new Error("database is closed"));if(this._destroyed)return _o.reject(new Error("database is destroyed"));var r=this;return l(r,t,n),this.taskqueue.isReady?e.apply(this,n):new _o(function(e,o){r.taskqueue.addTask(function(i){i?o(i):e(r[t].apply(r,n))})})}))}function h(t){return"$"+t}function p(t){return t.substring(1)}function v(){this._store={}}function y(t){if(this._store=new v,t&&Array.isArray(t))for(var e=0,n=t.length;e<n;e++)this.add(t[e])}function g(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var t=Object.getOwnPropertyDescriptor(Map,Symbol.species);return t&&"get"in t&&Map[Symbol.species]===Map}function m(t,e){for(var n={},r=0,o=e.length;r<o;r++){var i=e[r];i in t&&(n[i]=t[i])}return n}function _(t){return t}function b(t){return[{ok:t}]}function w(t,e,n){function r(){var t=[];d.forEach(function(e){e.docs.forEach(function(n){t.push({id:e.id,docs:[n]})})}),n(null,{results:t})}function o(){++l===f&&r()}function i(t,e,n){d[t]={id:e,docs:n},o()}function s(){if(!(p>=h.length)){var t=Math.min(p+Ao,h.length),e=h.slice(p,t);a(e,p),p+=e.length}}function a(n,r){n.forEach(function(n,o){var a=r+o,c=u.get(n),f=m(c[0],["atts_since","attachments"]);f.open_revs=c.map(function(t){return t.rev}),f.open_revs=f.open_revs.filter(_);var l=_;0===f.open_revs.length&&(delete f.open_revs,l=b),["revs","attachments","binary","ajax","latest"].forEach(function(t){t in e&&(f[t]=e[t])}),t.get(n,f,function(t,e){var r;r=t?[{error:t}]:l(e),i(a,n,r),s()})})}var c=e.docs,u=new Eo;c.forEach(function(t){u.has(t.id)?u.get(t.id).push(t):u.set(t.id,[t])});var f=u.size,l=0,d=new Array(f),h=[];u.forEach(function(t,e){h.push(e)});var p=0;s()}function k(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function E(){return xo}function x(t){k()?chrome.storage.onChanged.addListener(function(e){null!=e.db_name&&t.emit(e.dbName.newValue)}):E()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(e){t.emit(e.key)}):window.attachEvent("storage",function(e){t.emit(e.key)}))}function A(){ho.EventEmitter.call(this),this._listeners={},x(this)}function S(t){if("undefined"!==console&&t in console){var e=Array.prototype.slice.call(arguments,1);console[t].apply(console,e)}}function j(t,e){var n=6e5;t=parseInt(t,10)||0,e=parseInt(e,10),e!==e||e<=t?e=(t||1)<<1:e+=1,e>n&&(t=n>>1,e=n);var r=Math.random(),o=e-t;return~~(o*r+t)}function C(t){var e=0;return t||(e=2e3),j(t,e)}function T(t,e){S("info","The above "+t+" is totally normal. "+e)}function O(t,e,n){Error.call(this,n),this.status=t,this.name=e,this.message=n,this.error=!0}function R(t,e){function n(e){for(var n in t)"function"!=typeof t[n]&&(this[n]=t[n]);void 0!==e&&(this.reason=e)}return n.prototype=O.prototype,new n(e)}function q(t){if("object"!=typeof t){var e=t;t=No,t.data=e}return"error"in t&&"conflict"===t.error&&(t.name="conflict",t.status=409),"name"in t||(t.name=t.error||"unknown"),"status"in t||(t.status=500),"message"in t||(t.message=t.message||t.reason),t}function D(t,e,n){try{return!t(e,n)}catch(r){var o="Filter function threw: "+r.toString();return R(Mo,o)}}function I(t){var e={},n=t.filter&&"function"==typeof t.filter;return e.query=t.query_params,function(r){r.doc||(r.doc={});var o=n&&D(t.filter,r.doc,e);if("object"==typeof o)return o;if(o)return!1;if(t.include_docs){if(!t.attachments)for(var i in r.doc._attachments)r.doc._attachments.hasOwnProperty(i)&&(r.doc._attachments[i].stub=!0)}else delete r.doc;return!0}}function B(t){for(var e=[],n=0,r=t.length;n<r;n++)e=e.concat(t[n]);return e}function N(){}function L(t){var e;if(t?"string"!=typeof t?e=R(Do):/^_/.test(t)&&!/^_(design|local)/.test(t)&&(e=R(Bo)):e=R(Io),e)throw e}function P(t){return"boolean"==typeof t._remote?t._remote:"function"==typeof t.type&&(S("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===t.type())}function U(t,e){return"listenerCount"in t?t.listenerCount(e):ho.EventEmitter.listenerCount(t,e)}function M(t){if(!t)return null;var e=t.split("/");return 2===e.length?e:1===e.length?[t,t]:null}function F(t){var e=M(t);return e?e.join("/"):null}function $(t){for(var e=Wo.exec(t),n={},r=14;r--;){var o=Xo[r],i=e[r]||"",s=["user","password"].indexOf(o)!==-1;n[o]=s?decodeURIComponent(i):i}return n[Vo]={},n[Xo[12]].replace(Ko,function(t,e,r){e&&(n[Vo][e]=r)}),n}function H(t,e){var n=[],r=[];for(var o in e)e.hasOwnProperty(o)&&(n.push(o),r.push(e[o]));return n.push(t),Function.apply(null,n).apply(null,r)}function z(t,e,n){return new _o(function(r,o){t.get(e,function(i,s){if(i){if(404!==i.status)return o(i);s={}}var a=s._rev,c=n(s);return c?(c._id=e,c._rev=a,void r(J(t,c,n))):r({updated:!1,rev:a})})})}function J(t,e,n){return t.put(e).then(function(t){return{updated:!0,rev:t.rev}},function(r){if(409!==r.status)throw r;return z(t,e._id,n)})}function Y(){return uo.v4().replace(/-/g,"").toLowerCase()}function X(t){for(var e,n,r,o,i=t.rev_tree.slice();o=i.pop();){var s=o.ids,a=s[2],c=o.pos;if(a.length)for(var u=0,f=a.length;u<f;u++)i.push({pos:c+1,ids:a[u]});else{var l=!!s[1].deleted,d=s[0];e&&!(r!==l?r:n!==c?n<c:e<d)||(e=d,n=c,r=l)}}return n+"-"+e}function V(t,e){for(var n,r=t.slice();n=r.pop();)for(var o=n.pos,i=n.ids,s=i[2],a=e(0===s.length,o,i[0],n.ctx,i[1]),c=0,u=s.length;c<u;c++)r.push({pos:o+1,ids:s[c],ctx:a})}function K(t,e){return t.pos-e.pos}function W(t){var e=[];V(t,function(t,n,r,o,i){t&&e.push({rev:n+"-"+r,pos:n,opts:i})}),e.sort(K).reverse();for(var n=0,r=e.length;n<r;n++)delete e[n].pos;return e}function G(t){for(var e=X(t),n=W(t.rev_tree),r=[],o=0,i=n.length;o<i;o++){var s=n[o];s.rev===e||s.opts.deleted||r.push(s.rev)}return r}function Q(t){var e=[];return V(t.rev_tree,function(t,n,r,o,i){"available"!==i.status||t||(e.push(n+"-"+r),i.status="missing")}),e}function Z(t){for(var e,n=[],r=t.slice();e=r.pop();){var o=e.pos,i=e.ids,s=i[0],a=i[1],c=i[2],u=0===c.length,f=e.history?e.history.slice():[];f.push({id:s,opts:a}),u&&n.push({pos:o+1-f.length,ids:f});for(var l=0,d=c.length;l<d;l++)r.push({pos:o+1,ids:c[l],history:f})}return n.reverse()}function tt(t,e){return t.pos-e.pos}function et(t,e,n){for(var r,o=0,i=t.length;o<i;)r=o+i>>>1,n(t[r],e)<0?o=r+1:i=r;return o}function nt(t,e,n){var r=et(t,e,n);t.splice(r,0,e)}function rt(t,e){for(var n,r,o=e,i=t.length;o<i;o++){var s=t[o],a=[s.id,s.opts,[]];r?(r[2].push(a),r=a):n=r=a}return n}function ot(t,e){return t[0]<e[0]?-1:1}function it(t,e){for(var n=[{tree1:t,tree2:e}],r=!1;n.length>0;){var o=n.pop(),i=o.tree1,s=o.tree2;(i[1].status||s[1].status)&&(i[1].status="available"===i[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(i[2][0]){for(var c=!1,u=0;u<i[2].length;u++)i[2][u][0]===s[2][a][0]&&(n.push({tree1:i[2][u],tree2:s[2][a]}),c=!0);c||(r="new_branch",nt(i[2],s[2][a],ot))}else r="new_leaf",i[2][0]=s[2][a]}return{conflicts:r,tree:t}}function st(t,e,n){var r,o=[],i=!1,s=!1;if(!t.length)return{tree:[e],conflicts:"new_leaf"};for(var a=0,c=t.length;a<c;a++){var u=t[a];if(u.pos===e.pos&&u.ids[0]===e.ids[0])r=it(u.ids,e.ids),o.push({pos:u.pos,ids:r.tree}),i=i||r.conflicts,s=!0;else if(n!==!0){var f=u.pos<e.pos?u:e,l=u.pos<e.pos?e:u,d=l.pos-f.pos,h=[],p=[];for(p.push({ids:f.ids,diff:d,parent:null,parentIdx:null});p.length>0;){var v=p.pop();if(0!==v.diff)for(var y=v.ids[2],g=0,m=y.length;g<m;g++)p.push({ids:y[g],diff:v.diff-1,parent:v.ids,parentIdx:g});else v.ids[0]===l.ids[0]&&h.push(v)}var _=h[0];_?(r=it(_.ids,l.ids),_.parent[2][_.parentIdx]=r.tree,o.push({pos:f.pos,ids:f.ids}),i=i||r.conflicts,s=!0):o.push(u)}else o.push(u)}return s||o.push(e),o.sort(tt),{tree:o,conflicts:i||"internal_node"}}function at(t,e){for(var n,r,o=Z(t),i=0,s=o.length;i<s;i++){var a,c=o[i],u=c.ids;if(u.length>e){n||(n={});var f=u.length-e;a={pos:c.pos+f,ids:rt(u,f)};for(var l=0;l<f;l++){var d=c.pos+l+"-"+u[l].id;n[d]=!0}}else a={pos:c.pos,ids:rt(u,0)};r=r?st(r,a,!0).tree:[a]}return n&&V(r,function(t,e,r){delete n[e+"-"+r]}),{tree:r,revs:n?Object.keys(n):[]}}function ct(t,e,n){var r=st(t,e),o=at(r.tree,n);return{tree:o.tree,stemmedRevs:o.revs,conflicts:r.conflicts}}function ut(t,e){for(var n,r=t.slice(),o=e.split("-"),i=parseInt(o[0],10),s=o[1];n=r.pop();){if(n.pos===i&&n.ids[0]===s)return!0;for(var a=n.ids[2],c=0,u=a.length;c<u;c++)r.push({pos:n.pos+1,ids:a[c]})}return!1}function ft(t){return t.ids}function lt(t,e){e||(e=X(t));for(var n,r=e.substring(e.indexOf("-")+1),o=t.rev_tree.map(ft);n=o.pop();){if(n[0]===r)return!!n[1].deleted;o=o.concat(n[2])}}function dt(t){return/^_local/.test(t)}function ht(t,e){for(var n,r=e.rev_tree.slice();n=r.pop();){var o=n.pos,i=n.ids,s=i[0],a=i[1],c=i[2],u=0===c.length,f=n.history?n.history.slice():[];if(f.push({id:s,pos:o,opts:a}),u)for(var l=0,d=f.length;l<d;l++){var h=f[l],p=h.pos+"-"+h.id;if(p===t)return o+"-"+s}for(var v=0,y=c.length;v<y;v++)r.push({pos:o+1,ids:c[v],history:f})}throw new Error("Unable to resolve latest revision for id "+e.id+", rev "+t)}function pt(t,e){try{t.emit("change",e)}catch(n){S("error",'Error in .on("change", function):',n)}}function vt(t,e,n){function r(){o.cancel()}ho.EventEmitter.call(this);var o=this;this.db=t,e=e?c(e):{};var i=e.complete=u(function(e,n){e?U(o,"error")>0&&o.emit("error",e):o.emit("complete",n),o.removeAllListeners(),t.removeListener("destroyed",r)});n&&(o.on("complete",function(t){n(null,t)}),o.on("error",n)),t.once("destroyed",r),e.onChange=function(t){o.isCancelled||pt(o,t)};var s=new _o(function(t,n){e.complete=function(e,r){e?n(e):t(r)}});o.once("cancel",function(){t.removeListener("destroyed",r),e.complete(null,{status:"cancelled"})}),this.then=s.then.bind(s),this["catch"]=s["catch"].bind(s),this.then(function(t){i(null,t)},i),t.taskqueue.isReady?o.validateChanges(e):t.taskqueue.addTask(function(t){t?e.complete(t):o.isCancelled?o.emit("cancel"):o.validateChanges(e)})}function yt(t,e,n){var r=[{rev:t._rev}];"all_docs"===n.style&&(r=W(e.rev_tree).map(function(t){return{rev:t.rev}}));var o={id:e.id,changes:r,doc:t};return lt(e,t._rev)&&(o.deleted=!0),n.conflicts&&(o.doc._conflicts=G(e),o.doc._conflicts.length||delete o.doc._conflicts),o}function gt(t,e){return t<e?-1:t>e?1:0}function mt(t,e){return function(n,r){n||r[0]&&r[0].error?(n=n||r[0],n.docId=e,t(n)):t(null,r.length?r[0]:r)}}function _t(t){for(var e=0;e<t.length;e++){var n=t[e];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),o=0;o<r.length;o++){var i=r[o];n._attachments[i]=m(n._attachments[i],["data","digest","content_type","length","revpos","stub"])}}}function bt(t,e){var n=gt(t._id,e._id);if(0!==n)return n;var r=t._revisions?t._revisions.start:0,o=e._revisions?e._revisions.start:0;return gt(r,o)}function wt(t){var e={},n=[];return V(t,function(t,r,o,i){var s=r+"-"+o;return t&&(e[s]=0),void 0!==i&&n.push({from:i,to:s}),s}),n.reverse(),n.forEach(function(t){void 0===e[t.from]?e[t.from]=1+e[t.to]:e[t.from]=Math.min(e[t.from],1+e[t.to])}),e}function kt(t,e,n){var r="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;if(e.descending&&r.reverse(),!r.length)return t._allDocs({limit:0},n);var o={offset:e.skip};return _o.all(r.map(function(n){var r=Co({key:n,deleted:"ok"},e);return["limit","skip","keys"].forEach(function(t){delete r[t]}),new _o(function(e,i){t._allDocs(r,function(t,r){return t?i(t):(o.total_rows=r.total_rows,void e(r.rows[0]||{key:n,error:"not_found"}))})})})).then(function(t){return o.rows=t,o})}function Et(t){var e=t._compactionQueue[0],n=e.opts,r=e.callback;t.get("_local/compaction")["catch"](function(){return!1}).then(function(e){e&&e.last_seq&&(n.last_seq=e.last_seq),t._compact(n,function(e,n){e?r(e):r(null,n),vo(function(){t._compactionQueue.shift(),t._compactionQueue.length&&Et(t)})})})}function xt(t){return"_"===t.charAt(0)&&t+" is not a valid attachment name, attachment names cannot start with '_'"}function At(){ho.EventEmitter.call(this)}function St(){this.isReady=!1,this.failed=!1,this.queue=[]}function jt(t,e){var n=t.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=Tt.adapters,o=Tt.preferredAdapters,i=Tt.prefix,s=e.adapter;if(!s)for(var a=0;a<o.length;++a){s=o[a];{if(!("idb"===s&&"websql"in r&&E()&&localStorage["_pouch__websqldb_"+i+t]))break;S("log",'PouchDB is downgrading "'+t+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.')}}var c=r[s],u=!(c&&"use_prefix"in c)||c.use_prefix;return{name:u?i+t:t,adapter:s}}function Ct(t){function e(e){t.removeListener("closed",n),e||t.constructor.emit("destroyed",t.name)}function n(){t.removeListener("destroyed",e),t.constructor.emit("unref",t)}t.once("destroyed",e),t.once("closed",n),t.constructor.emit("ref",t)}function Tt(t,e){if(!(this instanceof Tt))return new Tt(t,e);var n=this;if(e=e||{},t&&"object"==typeof t&&(e=t,t=e.name,delete e.name),this.__opts=e=c(e),n.auto_compaction=e.auto_compaction,n.prefix=Tt.prefix,"string"!=typeof t)throw new Error("Missing/invalid DB name");var r=(e.prefix||"")+t,o=jt(r,e);if(e.name=o.name,e.adapter=e.adapter||o.adapter,n.name=t,n._adapter=e.adapter,Tt.emit("debug",["adapter","Picked adapter: ",e.adapter]),!Tt.adapters[e.adapter]||!Tt.adapters[e.adapter].valid())throw new Error("Invalid Adapter: "+e.adapter);At.call(n),n.taskqueue=new St,n.adapter=e.adapter,Tt.adapters[e.adapter].call(n,e,function(t){return t?n.taskqueue.fail(t):(Ct(n),n.emit("created",n),Tt.emit("created",n.name),void n.taskqueue.ready(n))})}function Ot(t){Object.keys(ho.EventEmitter.prototype).forEach(function(e){"function"==typeof ho.EventEmitter.prototype[e]&&(t[e]=Qo[e].bind(Qo))});var e=t._destructionListeners=new Eo;t.on("ref",function(t){e.has(t.name)||e.set(t.name,[]),e.get(t.name).push(t)}),t.on("unref",function(t){if(e.has(t.name)){var n=e.get(t.name),r=n.indexOf(t);r<0||(n.splice(r,1),n.length>1?e.set(t.name,n):e["delete"](t.name))}}),t.on("destroyed",function(t){if(e.has(t)){var n=e.get(t);e["delete"](t),n.forEach(function(t){t.emit("destroyed",!0)})}})}function Rt(t){t.debug=yo;var e={};t.on("debug",function(t){var n=t[0],r=t.slice(1);e[n]||(e[n]=yo("pouchdb:"+n)),e[n].apply(null,r)})}function qt(t,e){for(var n=t,r=0,o=e.length;r<o;r++){var i=e[r];if(n=n[i],!n)break}return n}function Dt(t,e){return t<e?-1:t>e?1:0}function It(t){for(var e=[],n="",r=0,o=t.length;r<o;r++){var i=t[r];"."===i?r>0&&"\\"===t[r-1]?n=n.substring(0,n.length-1)+".":(e.push(n),n=""):n+=i}return e.push(n),e}function Bt(t){return ti.indexOf(t)>-1}function Nt(t){return Object.keys(t)[0]}function Lt(t){return t[Nt(t)]}function Pt(t){var e={};return t.forEach(function(t){Object.keys(t).forEach(function(n){var r=t[n];if("object"!=typeof r&&(r={$eq:r}),Bt(n))r instanceof Array?e[n]=r.map(function(t){return Pt([t])}):e[n]=Pt([r]);else{var o=e[n]=e[n]||{};Object.keys(r).forEach(function(t){var e=r[t];return"$gt"===t||"$gte"===t?Ut(t,e,o):"$lt"===t||"$lte"===t?Mt(t,e,o):"$ne"===t?Ft(e,o):"$eq"===t?$t(e,o):void(o[t]=e)})}})}),e}function Ut(t,e,n){"undefined"==typeof n.$eq&&("undefined"!=typeof n.$gte?"$gte"===t?e>n.$gte&&(n.$gte=e):e>=n.$gte&&(delete n.$gte,n.$gt=e):"undefined"!=typeof n.$gt?"$gte"===t?e>n.$gt&&(delete n.$gt,n.$gte=e):e>n.$gt&&(n.$gt=e):n[t]=e)}function Mt(t,e,n){"undefined"==typeof n.$eq&&("undefined"!=typeof n.$lte?"$lte"===t?e<n.$lte&&(n.$lte=e):e<=n.$lte&&(delete n.$lte,n.$lt=e):"undefined"!=typeof n.$lt?"$lte"===t?e<n.$lt&&(delete n.$lt,n.$lte=e):e<n.$lt&&(n.$lt=e):n[t]=e)}function Ft(t,e){"$ne"in e?e.$ne.push(t):e.$ne=[t]}function $t(t,e){delete e.$gt,delete e.$gte,delete e.$lt,delete e.$lte,delete e.$ne,e.$eq=t}function Ht(t){var e=c(t),n=!1;"$and"in e&&(e=Pt(e.$and),n=!0),["$or","$nor"].forEach(function(t){t in e&&e[t].forEach(function(t){for(var e=Object.keys(t),n=0;n<e.length;n++){var r=e[n],o=t[r];"object"==typeof o&&null!==o||(t[r]={$eq:o})}})}),"$not"in e&&(e.$not=Pt([e.$not]));for(var r=Object.keys(e),o=0;o<r.length;o++){var i=r[o],s=e[i];"object"!=typeof s||null===s?s={$eq:s}:"$ne"in s&&!n&&(s.$ne=[s.$ne]),e[i]=s}return e}function zt(t,e,n){for(var r="",o=n-t.length;r.length<o;)r+=e;return r}function Jt(t,e,n){var r=zt(t,e,n);return r+t}function Yt(t,e){if(t===e)return 0;t=Xt(t),e=Xt(e);var n=ne(t),r=ne(e);if(n-r!==0)return n-r;switch(typeof t){case"number":return t-e;case"boolean":return t<e?-1:1;case"string":return te(t,e)}return Array.isArray(t)?Zt(t,e):ee(t,e)}function Xt(t){switch(typeof t){case"undefined":return null;case"number":return t===1/0||t===-(1/0)||isNaN(t)?null:t;case"object":var e=t;if(Array.isArray(t)){var n=t.length;t=new Array(n);for(var r=0;r<n;r++)t[r]=Xt(e[r])}else{if(t instanceof Date)return t.toJSON();if(null!==t){t={};for(var o in e)if(e.hasOwnProperty(o)){var i=e[o];"undefined"!=typeof i&&(t[o]=Xt(i))}}}}return t}function Vt(t){if(null!==t)switch(typeof t){case"boolean":return t?1:0;case"number":return re(t);case"string":return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var e=Array.isArray(t),n=e?t:Object.keys(t),r=-1,o=n.length,i="";if(e)for(;++r<o;)i+=Kt(n[r]);else for(;++r<o;){var s=n[r];i+=Kt(s)+Kt(t[s])}return i}return""}function Kt(t){var e="\0";
return t=Xt(t),ne(t)+ri+Vt(t)+e}function Wt(t,e){var n,r=e,o="1"===t[e];if(o)n=0,e++;else{var i="0"===t[e];e++;var s="",a=t.substring(e,e+ni),c=parseInt(a,10)+ei;for(i&&(c=-c),e+=ni;;){var u=t[e];if("\0"===u)break;s+=u,e++}s=s.split("."),n=1===s.length?parseInt(s,10):parseFloat(s[0]+"."+s[1]),i&&(n-=10),0!==c&&(n=parseFloat(n+"e"+c))}return{num:n,length:e-r}}function Gt(t,e){var n=t.pop();if(e.length){var r=e[e.length-1];n===r.element&&(e.pop(),r=e[e.length-1]);var o=r.element,i=r.index;if(Array.isArray(o))o.push(n);else if(i===t.length-2){var s=t.pop();o[s]=n}else t.push(n)}}function Qt(t){for(var e=[],n=[],r=0;;){var o=t[r++];if("\0"!==o)switch(o){case"1":e.push(null);break;case"2":e.push("1"===t[r]),r++;break;case"3":var i=Wt(t,r);e.push(i.num),r+=i.length;break;case"4":for(var s="";;){var a=t[r];if("\0"===a)break;s+=a,r++}s=s.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(s);break;case"5":var c={element:[],index:e.length};e.push(c.element),n.push(c);break;case"6":var u={element:{},index:e.length};e.push(u.element),n.push(u);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+o)}else{if(1===e.length)return e.pop();Gt(e,n)}}}function Zt(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var o=Yt(t[r],e[r]);if(0!==o)return o}return t.length===e.length?0:t.length>e.length?1:-1}function te(t,e){return t===e?0:t>e?1:-1}function ee(t,e){for(var n=Object.keys(t),r=Object.keys(e),o=Math.min(n.length,r.length),i=0;i<o;i++){var s=Yt(n[i],r[i]);if(0!==s)return s;if(s=Yt(t[n[i]],e[r[i]]),0!==s)return s}return n.length===r.length?0:n.length>r.length?1:-1}function ne(t){var e=["boolean","number","string","object"],n=e.indexOf(typeof t);return~n?null===t?1:Array.isArray(t)?5:n<3?n+2:n+3:Array.isArray(t)?5:void 0}function re(t){if(0===t)return"1";var e=t.toExponential().split(/e\+?/),n=parseInt(e[1],10),r=t<0,o=r?"0":"2",i=(r?-n:n)-ei,s=Jt(i.toString(),"0",ni);o+=ri+s;var a=Math.abs(parseFloat(e[0]));r&&(a=10-a);var c=a.toFixed(20);return c=c.replace(/\.?0+$/,""),o+=ri+c}function oe(t){function e(e){return t.map(function(t){var n=Nt(t),r=It(n),o=qt(e,r);return o})}return function(t,n){var r=e(t.doc),o=e(n.doc),i=Yt(r,o);return 0!==i?i:Dt(t.doc._id,n.doc._id)}}function ie(t,e,n){if(t=t.filter(function(t){return se(t.doc,e.selector,n)}),e.sort){var r=oe(e.sort);t=t.sort(r),"string"!=typeof e.sort[0]&&"desc"===Lt(e.sort[0])&&(t=t.reverse())}if("limit"in e||"skip"in e){var o=e.skip||0,i=("limit"in e?e.limit:t.length)+o;t=t.slice(o,i)}return t}function se(t,e,n){return n.every(function(n){var r=e[n],o=It(n),i=qt(t,o);return Bt(n)?ce(n,r,t):ae(r,t,o,i)})}function ae(t,e,n,r){return!t||Object.keys(t).every(function(o){var i=t[o];return ue(o,e,i,n,r)})}function ce(t,e,n){return"$or"===t?e.some(function(t){return se(n,t,Object.keys(t))}):"$not"===t?!se(n,e,Object.keys(e)):!e.find(function(t){return se(n,t,Object.keys(t))})}function ue(t,e,n,r,o){if(!oi[t])throw new Error('unknown operator "'+t+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return oi[t](e,n,r,o)}function fe(t){return"undefined"!=typeof t&&null!==t}function le(t){return"undefined"!=typeof t}function de(t,e){var n=e[0],r=e[1];if(0===n)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(n,10)!==n)throw new Error("Divisor is not an integer");if(parseInt(r,10)!==r)throw new Error("Modulus is not an integer");return parseInt(t,10)===t&&t%n===r}function he(t,e){return e.some(function(e){return t instanceof Array?t.indexOf(e)>-1:t===e})}function pe(t,e){return e.every(function(e){return t.indexOf(e)>-1})}function ve(t,e){return t.length===e}function ye(t,e){var n=new RegExp(e);return n.test(t)}function ge(t,e){switch(e){case"null":return null===t;case"boolean":return"boolean"==typeof t;case"number":return"number"==typeof t;case"string":return"string"==typeof t;case"array":return t instanceof Array;case"object":return"[object Object]"==={}.toString.call(t)}throw new Error(e+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}function me(t,e){if("object"!=typeof e)throw new Error("Selector error: expected a JSON object");e=Ht(e);var n={doc:t},r=ie([n],{selector:e},Object.keys(e));return r&&1===r.length}function _e(t){return H('"use strict";\nreturn '+t+";",{})}function be(t){var e=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+t+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n");return H(e,{})}function we(t,e){if(t.selector&&t.filter&&"_selector"!==t.filter){var n="string"==typeof t.filter?t.filter:"function";return e(new Error('selector invalid for filter "'+n+'"'))}e()}function ke(t){t.view&&!t.filter&&(t.filter="_view"),t.selector&&!t.filter&&(t.filter="_selector"),t.filter&&"string"==typeof t.filter&&("_view"===t.filter?t.view=F(t.view):t.filter=F(t.filter))}function Ee(t,e){return e.filter&&"string"==typeof e.filter&&!e.doc_ids&&!P(t.db)}function xe(t,e){var n=e.complete;if("_view"===e.filter){if(!e.view||"string"!=typeof e.view){var r=R(Mo,"`view` filter parameter not found or invalid.");return n(r)}var o=M(e.view);t.db.get("_design/"+o[0],function(r,i){if(t.isCancelled)return n(null,{status:"cancelled"});if(r)return n(q(r));var s=i&&i.views&&i.views[o[1]]&&i.views[o[1]].map;return s?(e.filter=be(s),void t.doChanges(e)):n(R(Ro,i.views?"missing json key: "+o[1]:"missing json key: views"))})}else if(e.selector)e.filter=function(t){return me(t,e.selector)},t.doChanges(e);else{var i=M(e.filter);t.db.get("_design/"+i[0],function(r,o){if(t.isCancelled)return n(null,{status:"cancelled"});if(r)return n(q(r));var s=o&&o.filters&&o.filters[i[1]];return s?(e.filter=_e(s),void t.doChanges(e)):n(R(Ro,o&&o.filters?"missing json key: "+i[1]:"missing json key: filters"))})}}function Ae(t){t._changesFilterPlugin={validate:we,normalize:ke,shouldFilter:Ee,filter:xe}}function Se(t){return t.reduce(function(t,e){return t[e]=!0,t},{})}function je(t){if(!/^\d+-./.test(t))return R(zo);var e=t.indexOf("-"),n=t.substring(0,e),r=t.substring(e+1);return{prefix:parseInt(n,10),id:r}}function Ce(t,e){for(var n=t.start-t.ids.length+1,r=t.ids,o=[r[0],e,[]],i=1,s=r.length;i<s;i++)o=[r[i],{status:"missing"},[o]];return[{pos:n,ids:o}]}function Te(t,e){var n,r,o,i={status:"available"};if(t._deleted&&(i.deleted=!0),e)if(t._id||(t._id=Go()),r=Y(),t._rev){if(o=je(t._rev),o.error)return o;t._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[r,i,[]]]]}],n=o.prefix+1}else t._rev_tree=[{pos:1,ids:[r,i,[]]}],n=1;else if(t._revisions&&(t._rev_tree=Ce(t._revisions,i),n=t._revisions.start,r=t._revisions.ids[0]),!t._rev_tree){if(o=je(t._rev),o.error)return o;n=o.prefix,r=o.id,t._rev_tree=[{pos:n,ids:[r,i,[]]}]}L(t._id),t._rev=n+"-"+r;var s={metadata:{},data:{}};for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var c="_"===a[0];if(c&&!si[a]){var u=R(Uo,a);throw u.message=Uo.message+": "+a,u}c&&!ai[a]?s.metadata[a.slice(1)]=t[a]:s.data[a]=t[a]}return s}function Oe(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(n){if("TypeError"!==n.name)throw n;for(var r="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,o=new r,i=0;i<t.length;i+=1)o.append(t[i]);return o.getBlob(e.type)}}function Re(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),o=0;o<e;o++)r[o]=t.charCodeAt(o);return n}function qe(t,e){return Oe([Re(t)],{type:e})}function De(t,e){return qe(ci(t),e)}function Ie(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,o=0;o<r;o++)e+=String.fromCharCode(n[o]);return e}function Be(t,e){if("undefined"==typeof FileReader)return e(Ie((new FileReaderSync).readAsArrayBuffer(t)));var n=new FileReader,r="function"==typeof n.readAsBinaryString;n.onloadend=function(t){var n=t.target.result||"";return r?e(n):void e(Ie(n))},r?n.readAsBinaryString(t):n.readAsArrayBuffer(t)}function Ne(t,e){Be(t,function(t){e(t)})}function Le(t,e){Ne(t,function(t){e(ui(t))})}function Pe(t,e){if("undefined"==typeof FileReader)return e((new FileReaderSync).readAsArrayBuffer(t));var n=new FileReader;n.onloadend=function(t){var n=t.target.result||new ArrayBuffer(0);e(n)},n.readAsArrayBuffer(t)}function Ue(t){return ui(t)}function Me(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.slice(e,n)}function Fe(t,e,n,r,o){(n>0||r<e.size)&&(e=Me(e,n,r)),Pe(e,function(e){t.append(e),o()})}function $e(t,e,n,r,o){(n>0||r<e.length)&&(e=e.substring(n,r)),t.appendBinary(e),o()}function He(t,e){function n(){fi(o)}function r(){var t=f.end(!0),n=Ue(t);e(n),f.destroy()}function o(){var e=u*a,o=e+a;u++,u<c?l(f,t,e,o,n):l(f,t,e,o,r)}var i="string"==typeof t,s=i?t.length:t.size,a=Math.min(li,s),c=Math.ceil(s/a),u=0,f=i?new go:new go.ArrayBuffer,l=i?$e:Fe;o()}function ze(t){return go.hash(t)}function Je(t){try{return ci(t)}catch(e){var n=R(Lo,"Attachment is not a valid base64 string");return{error:n}}}function Ye(t,e,n){var r=Je(t.data);return r.error?n(r.error):(t.length=r.length,"blob"===e?t.data=qe(r,t.content_type):"base64"===e?t.data=ui(r):t.data=r,void He(r,function(e){t.digest="md5-"+e,n()}))}function Xe(t,e,n){He(t.data,function(r){t.digest="md5-"+r,t.length=t.data.size||t.data.length||0,"binary"===e?Ne(t.data,function(e){t.data=e,n()}):"base64"===e?Le(t.data,function(e){t.data=e,n()}):n()})}function Ve(t,e,n){return t.stub?n():void("string"==typeof t.data?Ye(t,e,n):Xe(t,e,n))}function Ke(t,e,n){function r(){i++,t.length===i&&(o?n(o):n())}if(!t.length)return n();var o,i=0;t.forEach(function(t){function n(t){o=t,s++,s===i.length&&r()}var i=t.data&&t.data._attachments?Object.keys(t.data._attachments):[],s=0;if(!i.length)return r();for(var a in t.data._attachments)t.data._attachments.hasOwnProperty(a)&&Ve(t.data._attachments[a],e,n)})}function We(t,e,n,r,o,i,s,a){if(ut(e.rev_tree,n.metadata.rev))return r[o]=n,i();var c=e.winningRev||X(e),u="deleted"in e?e.deleted:lt(e,c),f="deleted"in n.metadata?n.metadata.deleted:lt(n.metadata),l=/^1-/.test(n.metadata.rev);if(u&&!f&&a&&l){var d=n.data;d._rev=c,d._id=n.metadata.id,n=Te(d,a)}var h=ct(e.rev_tree,n.metadata.rev_tree[0],t),p=a&&(u&&f&&"new_leaf"!==h.conflicts||!u&&"new_leaf"!==h.conflicts||u&&!f&&"new_branch"===h.conflicts);if(p){var v=R(qo);return r[o]=v,i()}var y=n.metadata.rev;n.metadata.rev_tree=h.tree,n.stemmedRevs=h.stemmedRevs||[],e.rev_map&&(n.metadata.rev_map=e.rev_map);var g,m=X(n.metadata),_=lt(n.metadata,m),b=u===_?0:u<_?-1:1;g=y===m?_:lt(n.metadata,y),s(n,m,_,g,!0,b,o,i)}function Ge(t){return"missing"===t.metadata.rev_tree[0].ids[1].status}function Qe(t,e,n,r,o,i,s,a,c){function u(t,e,n){var r=X(t.metadata),o=lt(t.metadata,r);if("was_delete"in a&&o)return i[e]=R(Ro,"deleted"),n();var c=l&&Ge(t);if(c){var u=R(qo);return i[e]=u,n()}var f=o?0:1;s(t,r,o,o,!1,f,e,n)}function f(){++h===p&&c&&c()}t=t||1e3;var l=a.new_edits,d=new Eo,h=0,p=e.length;e.forEach(function(t,e){if(t._id&&dt(t._id)){var r=t._deleted?"_removeLocal":"_putLocal";return void n[r](t,{ctx:o},function(t,n){i[e]=t||n,f()})}var s=t.metadata.id;d.has(s)?(p--,d.get(s).push([t,e])):d.set(s,[[t,e]])}),d.forEach(function(e,n){function o(){++c<e.length?a():f()}function a(){var a=e[c],f=a[0],d=a[1];if(r.has(n))We(t,r.get(n),f,i,d,o,s,l);else{var h=ct([],f.metadata.rev_tree[0],t);f.metadata.rev_tree=h.tree,f.stemmedRevs=h.stemmedRevs||[],u(f,d,o)}}var c=0;a()})}function Ze(t){try{return JSON.parse(t)}catch(e){return mo.parse(t)}}function tn(t){try{return JSON.stringify(t)}catch(e){return mo.stringify(t)}}function en(t){return function(e){var n="unknown_error";e.target&&e.target.error&&(n=e.target.error.name||e.target.error.message),t(R($o,n,e.type))}}function nn(t,e,n){return{data:tn(t),winningRev:e,deletedOrLocal:n?"1":"0",seq:t.seq,id:t.id}}function rn(t){if(!t)return null;var e=Ze(t.data);return e.winningRev=t.winningRev,e.deleted="1"===t.deletedOrLocal,e.seq=t.seq,e}function on(t){if(!t)return t;var e=t._doc_id_rev.lastIndexOf(":");return t._id=t._doc_id_rev.substring(0,e-1),t._rev=t._doc_id_rev.substring(e+1),delete t._doc_id_rev,t}function sn(t,e,n,r){n?r(t?"string"!=typeof t?t:De(t,e):Oe([""],{type:e})):t?"string"!=typeof t?Be(t,function(t){r(ui(t))}):r(t):r("")}function an(t,e,n,r){function o(){++a===s.length&&r&&r()}function i(t,e){var r=t._attachments[e],i=r.digest,s=n.objectStore(vi).get(i);s.onsuccess=function(t){r.body=t.target.result.body,o()}}var s=Object.keys(t._attachments||{});if(!s.length)return r&&r();var a=0;s.forEach(function(n){e.attachments&&e.include_docs?i(t,n):(t._attachments[n].stub=!0,o())})}function cn(t,e){return _o.all(t.map(function(t){if(t.doc&&t.doc._attachments){var n=Object.keys(t.doc._attachments);return _o.all(n.map(function(n){var r=t.doc._attachments[n];if("body"in r){var o=r.body,i=r.content_type;return new _o(function(s){sn(o,i,e,function(e){t.doc._attachments[n]=Co(m(r,["digest","content_type"]),{data:e}),s()})})}}))}}))}function un(t,e,n){function r(){u--,u||o()}function o(){i.length&&i.forEach(function(t){var e=c.index("digestSeq").count(IDBKeyRange.bound(t+"::",t+"::￿",!1,!1));e.onsuccess=function(e){var n=e.target.result;n||a["delete"](t)}})}var i=[],s=n.objectStore(pi),a=n.objectStore(vi),c=n.objectStore(yi),u=t.length;t.forEach(function(t){var n=s.index("_doc_id_rev"),o=e+"::"+t;n.getKey(o).onsuccess=function(t){var e=t.target.result;if("number"!=typeof e)return r();s["delete"](e);var n=c.index("seq").openCursor(IDBKeyRange.only(e));n.onsuccess=function(t){var e=t.target.result;if(e){var n=e.value.digestSeq.split("::")[0];i.push(n),c["delete"](e.primaryKey),e["continue"]()}else r()}}})}function fn(t,e,n){try{return{txn:t.transaction(e,n)}}catch(r){return{error:r}}}function ln(t,e,n,r,o,i){function s(){var t=[hi,pi,vi,mi,yi,gi],e=fn(o,t,"readwrite");return e.error?i(e.error):(_=e.txn,_.onabort=en(i),_.ontimeout=en(i),_.oncomplete=l,b=_.objectStore(hi),w=_.objectStore(pi),k=_.objectStore(vi),E=_.objectStore(yi),x=_.objectStore(gi),x.get(gi).onsuccess=function(t){S=t.target.result,u()},void h(function(t){return t?(N=!0,i(t)):void f()}))}function a(){q=!0,u()}function c(){Qe(t.revs_limit,j,r,B,_,I,p,n,a)}function u(){S&&q&&(S.docCount+=D,x.put(S))}function f(){function t(){++n===j.length&&c()}function e(e){var n=rn(e.target.result);n&&B.set(n.id,n),t()}if(j.length)for(var n=0,r=0,o=j.length;r<o;r++){var i=j[r];if(i._id&&dt(i._id))t();else{var s=b.get(i.metadata.id);s.onsuccess=e}}}function l(){N||(bi.notify(r._meta.name),i(null,I))}function d(t,e){var n=k.get(t);n.onsuccess=function(n){if(n.target.result)e();else{var r=R(Jo,"unknown stub attachment with digest "+t);r.status=412,e(r)}}}function h(t){function e(){++o===n.length&&t(r)}var n=[];if(j.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(e){var r=t.data._attachments[e];r.stub&&n.push(r.digest)})}),!n.length)return t();var r,o=0;n.forEach(function(t){d(t,function(t){t&&!r&&(r=t),e()})})}function p(t,e,n,r,o,i,s,a){t.metadata.winningRev=e,t.metadata.deleted=n;var c=t.data;c._id=t.metadata.id,c._rev=t.metadata.rev,r&&(c._deleted=!0);var f=c._attachments&&Object.keys(c._attachments).length;return f?y(t,e,n,o,s,a):(D+=i,u(),void v(t,e,n,o,s,a))}function v(t,e,n,o,i,s){function a(i){var s=t.stemmedRevs||[];o&&r.auto_compaction&&(s=s.concat(Q(t.metadata))),s&&s.length&&un(s,t.metadata.id,_),l.seq=i.target.result;var a=nn(l,e,n),c=b.put(a);c.onsuccess=u}function c(t){t.preventDefault(),t.stopPropagation();var e=w.index("_doc_id_rev"),n=e.getKey(f._doc_id_rev);n.onsuccess=function(t){var e=w.put(f,t.target.result);e.onsuccess=a}}function u(){I[i]={ok:!0,id:l.id,rev:l.rev},B.set(t.metadata.id,t.metadata),g(t,l.seq,s)}var f=t.data,l=t.metadata;f._doc_id_rev=l.id+"::"+l.rev,delete f._id,delete f._rev;var d=w.put(f);d.onsuccess=a,d.onerror=c}function y(t,e,n,r,o,i){function s(){u===f.length&&v(t,e,n,r,o,i)}function a(){u++,s()}var c=t.data,u=0,f=Object.keys(c._attachments);f.forEach(function(n){var r=t.data._attachments[n];if(r.stub)u++,s();else{var o=r.data;delete r.data,r.revpos=parseInt(e,10);var i=r.digest;m(i,o,a)}})}function g(t,e,n){function r(){++i===s.length&&n()}function o(n){var o=t.data._attachments[n].digest,i=E.put({seq:e,digestSeq:o+"::"+e});i.onsuccess=r,i.onerror=function(t){t.preventDefault(),t.stopPropagation(),r()}}var i=0,s=Object.keys(t.data._attachments||{});if(!s.length)return n();for(var a=0;a<s.length;a++)o(s[a])}function m(t,e,n){var r=k.count(t);r.onsuccess=function(r){var o=r.target.result;if(o)return n();var i={digest:t,body:e},s=k.put(i);s.onsuccess=n}}for(var _,b,w,k,E,x,A,S,j=e.docs,C=0,T=j.length;C<T;C++){var O=j[C];O._id&&dt(O._id)||(O=j[C]=Te(O,n.new_edits),O.error&&!A&&(A=O))}if(A)return i(A);var q=!1,D=0,I=new Array(j.length),B=new Eo,N=!1,L=r._meta.blobSupport?"blob":"base64";Ke(j,L,function(t){return t?i(t):void s()})}function dn(t,e,n,r,o){function i(t){f=t.target.result,u&&o(u,f,l)}function s(t){u=t.target.result,f&&o(u,f,l)}function a(){if(!u.length)return o();var n,a=u[u.length-1];if(e&&e.upper)try{n=IDBKeyRange.bound(a,e.upper,!0,e.upperOpen)}catch(c){if("DataError"===c.name&&0===c.code)return o()}else n=IDBKeyRange.lowerBound(a,!0);e=n,u=null,f=null,t.getAll(e,r).onsuccess=i,t.getAllKeys(e,r).onsuccess=s}function c(t){var e=t.target.result;return e?void o([e.key],[e.value],e):o()}var u,f,l,d="function"==typeof t.getAll&&"function"==typeof t.getAllKeys&&r>1&&!n;d?(l={"continue":a},t.getAll(e,r).onsuccess=i,t.getAllKeys(e,r).onsuccess=s):n?t.openCursor(e,"prev").onsuccess=c:t.openCursor(e).onsuccess=c}function hn(t,e,n){function r(t){var e=t.target.result;e?(o.push(e.value),e["continue"]()):n({target:{result:o}})}if("function"==typeof t.getAll)return void(t.getAll(e).onsuccess=n);var o=[];t.openCursor(e).onsuccess=r}function pn(t,e,n,r,o){try{if(t&&e)return o?IDBKeyRange.bound(e,t,!n,!1):IDBKeyRange.bound(t,e,!1,!n);if(t)return o?IDBKeyRange.upperBound(t):IDBKeyRange.lowerBound(t);if(e)return o?IDBKeyRange.lowerBound(e,!n):IDBKeyRange.upperBound(e,!n);if(r)return IDBKeyRange.only(r)}catch(i){return{error:i}}return null}function vn(t,e,n){function r(e,n,r){var o=e.id+"::"+r;A.get(o).onsuccess=function(r){if(n.doc=on(r.target.result),t.conflicts){var o=G(e);o.length&&(n.doc._conflicts=o)}an(n.doc,t,b)}}function o(e,n){var o={id:n.id,key:n.id,value:{rev:e}},i=n.deleted;"ok"===t.deleted?(S.push(o),i?(o.value.deleted=!0,o.doc=null):t.include_docs&&r(n,o,e)):!i&&h--<=0&&(S.push(o),t.include_docs&&r(n,o,e))}function i(t){for(var e=0,n=t.length;e<n&&S.length!==p;e++){var r=t[e],i=rn(r),s=i.winningRev;o(s,i)}}function s(t,e,n){n&&(i(e),S.length<p&&n["continue"]())}function a(e){var n=e.target.result;t.descending&&(n=n.reverse()),i(n)}function c(){n(null,{total_rows:w,offset:t.skip,rows:S})}function u(){t.attachments?cn(S,t.binary).then(c):c()}var f="startkey"in t&&t.startkey,l="endkey"in t&&t.endkey,d="key"in t&&t.key,h=t.skip||0,p="number"==typeof t.limit?t.limit:-1,v=t.inclusive_end!==!1,y=pn(f,l,v,d,t.descending),g=y&&y.error;if(g&&("DataError"!==g.name||0!==g.code))return n(R($o,g.name,g.message));var m=[hi,pi,gi];t.attachments&&m.push(vi);var _=fn(e,m,"readonly");if(_.error)return n(_.error);var b=_.txn;b.oncomplete=u,b.onabort=en(n);var w,k=b.objectStore(hi),E=b.objectStore(pi),x=b.objectStore(gi),A=E.index("_doc_id_rev"),S=[];return x.get(gi).onsuccess=function(t){w=t.target.result.docCount},g||0===p?void 0:p===-1?hn(k,y,a):void dn(k,y,t.descending,p+h,s)}function yn(t){return new _o(function(e){var n=Oe([""]),r=t.objectStore(_i).put(n,"key");r.onsuccess=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);e(n||!t||parseInt(t[1],10)>=43)},t.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)}})["catch"](function(){return!1})}function gn(t,e){var n=t.objectStore(hi).index("deletedOrLocal");n.count(IDBKeyRange.only("0")).onsuccess=function(t){e(t.target.result)}}function mn(t,e,n,r){try{t(e,n)}catch(e){r.emit("error",e)}}function _n(){!wi&&ki.length&&(wi=!0,ki.shift()())}function bn(t,e,n){ki.push(function(){t(function(t,r){mn(e,t,r,n),wi=!1,vo(function(){_n(n)})})}),_n()}function wn(t,e,n,r){function o(e,n,r){function o(e,n){var r=t.processChange(n,e,t);d=r.seq=e.seq;var o=w(r);return"object"==typeof o?t.complete(o):void(o&&(b++,p&&_.push(r),t.attachments&&t.include_docs?an(n,t,v,function(){cn([r],t.binary).then(function(){t.onChange(r)})}):t.onChange(r)))}function i(){for(var t=0,e=a.length;t<e&&b!==h;t++){var n=a[t];if(n){var i=c[t];o(i,n)}}b!==h&&r["continue"]()}if(r&&e.length){var a=new Array(e.length),c=new Array(e.length),u=0;n.forEach(function(t,n){var r=on(t),o=e[n];s(r,o,function(t,r){c[n]=t,a[n]=r,++u===e.length&&i()})})}}function i(t,e,n,r){if(n.seq!==e)return r();if(n.winningRev===t._rev)return r(n,t);var o=t._id+"::"+n.winningRev,i=m.get(o);i.onsuccess=function(t){r(n,on(t.target.result))}}function s(t,e,n){if(l&&!l.has(t._id))return n();var r=k.get(t._id);return r?i(t,e,r,n):void(g.get(t._id).onsuccess=function(o){r=rn(o.target.result),k.set(t._id,r),i(t,e,r,n)})}function a(){t.complete(null,{results:_,last_seq:d})}function u(){!t.continuous&&t.attachments?cn(_).then(a):a()}if(t=c(t),t.continuous){var f=n+":"+Go();return bi.addListener(n,f,e,t),bi.notify(n),{cancel:function(){bi.removeListener(n,f)}}}var l=t.doc_ids&&new ko(t.doc_ids);t.since=t.since||0;var d=t.since,h="limit"in t?t.limit:-1;0===h&&(h=1);var p;p="return_docs"in t?t.return_docs:!("returnDocs"in t)||t.returnDocs;var v,y,g,m,_=[],b=0,w=I(t),k=new Eo,E=[hi,pi];t.attachments&&E.push(vi);var x=fn(r,E,"readonly");if(x.error)return t.complete(x.error);v=x.txn,v.onabort=en(t.complete),v.oncomplete=u,y=v.objectStore(pi),g=v.objectStore(hi),m=y.index("_doc_id_rev");var A=t.since&&!t.descending?IDBKeyRange.lowerBound(t.since,!0):null;dn(y,A,t.descending,h,o)}function kn(t,e){var n=this;bn(function(e){En(n,t,e)},e,n.constructor)}function En(t,e,n){function r(t){var e=t.createObjectStore(hi,{keyPath:"id"});t.createObjectStore(pi,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),t.createObjectStore(vi,{keyPath:"digest"}),t.createObjectStore(gi,{keyPath:"id",autoIncrement:!1}),t.createObjectStore(_i),e.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),t.createObjectStore(mi,{keyPath:"_id"});var n=t.createObjectStore(yi,{autoIncrement:!0});n.createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0})}function o(t,e){var n=t.objectStore(hi);n.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),n.openCursor().onsuccess=function(t){var r=t.target.result;if(r){var o=r.value,i=lt(o);o.deletedOrLocal=i?"1":"0",n.put(o),r["continue"]()}else e()}}function i(t){t.createObjectStore(mi,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function s(t,e){var n=t.objectStore(mi),r=t.objectStore(hi),o=t.objectStore(pi),i=r.openCursor();i.onsuccess=function(t){var i=t.target.result;if(i){var s=i.value,a=s.id,c=dt(a),u=X(s);if(c){var f=a+"::"+u,l=a+"::",d=a+"::~",h=o.index("_doc_id_rev"),p=IDBKeyRange.bound(l,d,!1,!1),v=h.openCursor(p);v.onsuccess=function(t){if(v=t.target.result){var e=v.value;e._doc_id_rev===f&&n.put(e),o["delete"](v.primaryKey),v["continue"]()}else r["delete"](i.primaryKey),i["continue"]()}}else i["continue"]()}else e&&e()}}function a(t){var e=t.createObjectStore(yi,{autoIncrement:!0});e.createIndex("seq","seq"),e.createIndex("digestSeq","digestSeq",{unique:!0})}function c(t,e){var n=t.objectStore(pi),r=t.objectStore(vi),o=t.objectStore(yi),i=r.count();i.onsuccess=function(t){var r=t.target.result;return r?void(n.openCursor().onsuccess=function(t){var n=t.target.result;if(!n)return e();for(var r=n.value,i=n.primaryKey,s=Object.keys(r._attachments||{}),a={},c=0;c<s.length;c++){var u=r._attachments[s[c]];a[u.digest]=!0}var f=Object.keys(a);for(c=0;c<f.length;c++){var l=f[c];o.put({seq:i,digestSeq:l+"::"+i})}n["continue"]()}):e()}}function u(t){function e(t){return t.data?rn(t):(t.deleted="1"===t.deletedOrLocal,t)}var n=t.objectStore(pi),r=t.objectStore(hi),o=r.openCursor();o.onsuccess=function(t){function o(){var t=a.id+"::",e=a.id+"::￿",r=n.index("_doc_id_rev").openCursor(IDBKeyRange.bound(t,e)),o=0;r.onsuccess=function(t){var e=t.target.result;if(!e)return a.seq=o,i();var n=e.primaryKey;n>o&&(o=n),e["continue"]()}}function i(){var t=nn(a,a.winningRev,a.deleted),e=r.put(t);e.onsuccess=function(){s["continue"]()}}var s=t.target.result;if(s){var a=e(s.value);return a.winningRev=a.winningRev||X(a),a.seq?i():void o()}}}var l=e.name,d=null;t._meta=null,t._remote=!1,t.type=function(){return"idb"},t._id=f(function(e){e(null,t._meta.instanceId)}),t._bulkDocs=function(n,r,o){ln(e,n,r,t,d,o)},t._get=function(t,e,n){function r(){n(s,{doc:o,metadata:i,ctx:a})}var o,i,s,a=e.ctx;if(!a){var c=fn(d,[hi,pi,vi],"readonly");if(c.error)return n(c.error);a=c.txn}a.objectStore(hi).get(t).onsuccess=function(t){if(i=rn(t.target.result),!i)return s=R(Ro,"missing"),r();var n;if(e.rev)n=e.latest?ht(e.rev,i):e.rev;else{n=i.winningRev;var c=lt(i);if(c)return s=R(Ro,"deleted"),r()}var u=a.objectStore(pi),f=i.id+"::"+n;u.index("_doc_id_rev").get(f).onsuccess=function(t){return o=t.target.result,o&&(o=on(o)),o?void r():(s=R(Ro,"missing"),r())}}},t._getAttachment=function(t,e,n,r,o){var i;if(r.ctx)i=r.ctx;else{var s=fn(d,[hi,pi,vi],"readonly");if(s.error)return o(s.error);i=s.txn}var a=n.digest,c=n.content_type;i.objectStore(vi).get(a).onsuccess=function(t){var e=t.target.result.body;sn(e,c,r.binary,function(t){o(null,t)})}},t._info=function(e){var n,r,o=fn(d,[gi,pi],"readonly");if(o.error)return e(o.error);var i=o.txn;i.objectStore(gi).get(gi).onsuccess=function(t){r=t.target.result.docCount},i.objectStore(pi).openCursor(null,"prev").onsuccess=function(t){var e=t.target.result;n=e?e.key:0},i.oncomplete=function(){e(null,{doc_count:r,update_seq:n,idb_attachment_format:t._meta.blobSupport?"binary":"base64"})}},t._allDocs=function(t,e){vn(t,d,e)},t._changes=function(e){return wn(e,t,l,d)},t._close=function(t){d.close(),Ei["delete"](l),t()},t._getRevisionTree=function(t,e){var n=fn(d,[hi],"readonly");if(n.error)return e(n.error);var r=n.txn,o=r.objectStore(hi).get(t);o.onsuccess=function(t){var n=rn(t.target.result);n?e(null,n.rev_tree):e(R(Ro))}},t._doCompaction=function(t,e,n){var r=[hi,pi,vi,yi],o=fn(d,r,"readwrite");if(o.error)return n(o.error);var i=o.txn,s=i.objectStore(hi);s.get(t).onsuccess=function(n){var r=rn(n.target.result);V(r.rev_tree,function(t,n,r,o,i){var s=n+"-"+r;e.indexOf(s)!==-1&&(i.status="missing")}),un(e,t,i);var o=r.winningRev,s=r.deleted;i.objectStore(hi).put(nn(r,o,s))},i.onabort=en(n),i.oncomplete=function(){n()}},t._getLocal=function(t,e){var n=fn(d,[mi],"readonly");if(n.error)return e(n.error);var r=n.txn,o=r.objectStore(mi).get(t);o.onerror=en(e),o.onsuccess=function(t){var n=t.target.result;n?(delete n._doc_id_rev,e(null,n)):e(R(Ro))}},t._putLocal=function(t,e,n){"function"==typeof e&&(n=e,e={}),delete t._revisions;var r=t._rev,o=t._id;r?t._rev="0-"+(parseInt(r.split("-")[1],10)+1):t._rev="0-1";var i,s=e.ctx;if(!s){var a=fn(d,[mi],"readwrite");if(a.error)return n(a.error);s=a.txn,s.onerror=en(n),s.oncomplete=function(){i&&n(null,i)}}var c,u=s.objectStore(mi);r?(c=u.get(o),c.onsuccess=function(o){var s=o.target.result;if(s&&s._rev===r){var a=u.put(t);a.onsuccess=function(){i={ok:!0,id:t._id,rev:t._rev},e.ctx&&n(null,i)}}else n(R(qo))}):(c=u.add(t),c.onerror=function(t){n(R(qo)),t.preventDefault(),t.stopPropagation()},c.onsuccess=function(){i={ok:!0,id:t._id,rev:t._rev},e.ctx&&n(null,i)})},t._removeLocal=function(t,e,n){"function"==typeof e&&(n=e,e={});var r=e.ctx;if(!r){var o=fn(d,[mi],"readwrite");if(o.error)return n(o.error);r=o.txn,r.oncomplete=function(){i&&n(null,i)}}var i,s=t._id,a=r.objectStore(mi),c=a.get(s);c.onerror=en(n),c.onsuccess=function(r){var o=r.target.result;o&&o._rev===t._rev?(a["delete"](s),i={ok:!0,id:s,rev:"0-0"},e.ctx&&n(null,i)):n(R(Ro))}},t._destroy=function(t,e){bi.removeAllListeners(l);var n=xi.get(l);n&&n.result&&(n.result.close(),Ei["delete"](l));var r=indexedDB.deleteDatabase(l);r.onsuccess=function(){xi["delete"](l),E()&&l in localStorage&&delete localStorage[l],e(null,{ok:!0})},r.onerror=en(e)};var h=Ei.get(l);if(h)return d=h.idb,t._meta=h.global,vo(function(){n(null,t)});var p;p=e.storage?xn(l,e.storage):indexedDB.open(l,di),xi.set(l,p),p.onupgradeneeded=function(t){function e(){var t=l[d-1];d++,t&&t(f,e)}var n=t.target.result;if(t.oldVersion<1)return r(n);var f=t.currentTarget.transaction;t.oldVersion<3&&i(n),t.oldVersion<4&&a(n);var l=[o,s,c,u],d=t.oldVersion;e()},p.onsuccess=function(e){function r(){"undefined"!=typeof a&&f&&(t._meta={name:l,instanceId:c,blobSupport:a},Ei.set(l,{idb:d,global:t._meta}),n(null,t))}function o(){if("undefined"!=typeof s&&"undefined"!=typeof i){var t=l+"_id";t in i?c=i[t]:i[t]=c=Go(),i.docCount=s,u.objectStore(gi).put(i)}}d=e.target.result,d.onversionchange=function(){d.close(),Ei["delete"](l)},d.onabort=function(t){S("error","Database has a global failure",t.target.error),d.close(),Ei["delete"](l)};var i,s,a,c,u=d.transaction([gi,_i,hi],"readwrite"),f=!1;u.objectStore(gi).get(gi).onsuccess=function(t){i=t.target.result||{id:gi},o()},gn(u,function(t){s=t,o()}),ii||(ii=yn(u)),ii.then(function(t){a=t,r()}),u.oncomplete=function(){f=!0,r()}},p.onerror=function(){var t="Failed to open indexedDB, are you in private browsing mode?";S("error",t),n(R($o,t))}}function xn(t,e){try{return indexedDB.open(t,{version:di,storage:e})}catch(n){return indexedDB.open(t,di)}}function An(t){return decodeURIComponent(escape(t))}function Sn(t){return t<65?t-48:t-55}function jn(t,e,n){for(var r="";e<n;)r+=String.fromCharCode(Sn(t.charCodeAt(e++))<<4|Sn(t.charCodeAt(e++)));return r}function Cn(t,e,n){for(var r="";e<n;)r+=String.fromCharCode(Sn(t.charCodeAt(e+2))<<12|Sn(t.charCodeAt(e+3))<<8|Sn(t.charCodeAt(e))<<4|Sn(t.charCodeAt(e+1))),e+=4;return r}function Tn(t,e){return"UTF-8"===e?An(jn(t,0,t.length)):Cn(t,0,t.length)}function On(t){return"'"+t+"'"}function Rn(t){return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function qn(t){return t.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function Dn(t){return delete t._id,delete t._rev,JSON.stringify(t)}function In(t,e,n){return t=JSON.parse(t),t._id=e,t._rev=n,t}function Bn(t){for(var e="(";t--;)e+="?",t&&(e+=",");return e+")"}function Nn(t,e,n,r,o){return"SELECT "+t+" FROM "+("string"==typeof e?e:e.join(" JOIN "))+(n?" ON "+n:"")+(r?" WHERE "+("string"==typeof r?r:r.join(" AND ")):"")+(o?" ORDER BY "+o:"")}function Ln(t,e,n){function r(){++i===t.length&&o()}function o(){if(s.length){var t="SELECT DISTINCT digest AS digest FROM "+qi+" WHERE seq IN "+Bn(s.length);n.executeSql(t,s,function(t,e){for(var n=[],r=0;r<e.rows.length;r++)n.push(e.rows.item(r).digest);if(n.length){var o="DELETE FROM "+qi+" WHERE seq IN ("+s.map(function(){return"?"}).join(",")+")";t.executeSql(o,s,function(t){var e="SELECT digest FROM "+qi+" WHERE digest IN ("+n.map(function(){return"?"}).join(",")+")";t.executeSql(e,n,function(t,e){for(var r=new ko,o=0;o<e.rows.length;o++)r.add(e.rows.item(o).digest);n.forEach(function(e){r.has(e)||(t.executeSql("DELETE FROM "+qi+" WHERE digest=?",[e]),t.executeSql("DELETE FROM "+Ti+" WHERE digest=?",[e]))})})})}})}}if(t.length){var i=0,s=[];t.forEach(function(t){var o="SELECT seq FROM "+Ci+" WHERE doc_id=? AND rev=?";n.executeSql(o,[e,t],function(t,e){if(!e.rows.length)return r();var n=e.rows.item(0).seq;s.push(n),t.executeSql("DELETE FROM "+Ci+" WHERE seq=?",[n],r)})})}}function Pn(t){return function(e){S("error","WebSQL threw an error",e);var n=e&&e.constructor.toString().match(/function ([^(]+)/),r=n&&n[1]||e.type,o=e.target||e.message;t(R(Ho,o,r))}}function Un(t){if("size"in t)return 1e6*t.size;var e="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return e?5e6:1}function Mn(t,e,n,r,o,i,s){
function a(){return _?s(_):(i.notify(r._name),void s(null,b))}function c(t,e){var n="SELECT count(*) as cnt FROM "+Ti+" WHERE digest=?";m.executeSql(n,[t],function(n,r){if(0===r.rows.item(0).cnt){var o=R(Jo,"unknown stub attachment with digest "+t);e(o)}else e()})}function u(t){function e(){++o===n.length&&t(r)}var n=[];if(y.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(e){var r=t.data._attachments[e];r.stub&&n.push(r.digest)})}),!n.length)return t();var r,o=0;n.forEach(function(t){c(t,function(t){t&&!r&&(r=t),e()})})}function f(t,e,n,o,i,s,a,c){function u(){function e(t,e){function r(){return++i===s.length&&e(),!1}function o(e){var o="INSERT INTO "+qi+" (digest, seq) VALUES (?,?)",i=[n._attachments[e].digest,t];m.executeSql(o,i,r,r)}var i=0,s=Object.keys(n._attachments||{});if(!s.length)return e();for(var a=0;a<s.length;a++)o(s[a])}var n=t.data,r=o?1:0,i=n._id,s=n._rev,a=Dn(n),c="INSERT INTO "+Ci+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",u=[i,s,a,r];m.executeSql(c,u,function(t,n){var r=n.insertId;e(r,function(){d(t,r)})},function(){var t=Nn("seq",Ci,null,"doc_id=? AND rev=?");return m.executeSql(t,[i,s],function(t,n){var o=n.rows.item(0).seq,c="UPDATE "+Ci+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",u=[a,r,i,s];t.executeSql(c,u,function(t){e(o,function(){d(t,o)})})}),!1})}function f(t){p||(t?(p=t,c(p)):v===y.length&&u())}function l(t){v++,f(t)}function d(n,o){var s=t.metadata.id,u=t.stemmedRevs||[];i&&r.auto_compaction&&(u=Q(t.metadata).concat(u)),u.length&&Ln(u,s,n),t.metadata.seq=o;var f=t.metadata.rev;delete t.metadata.rev;var l=i?"UPDATE "+ji+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+Ci+" WHERE doc_id="+ji+".id AND rev=?) WHERE id=?":"INSERT INTO "+ji+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",d=tn(t.metadata),h=i?[d,o,e,s]:[s,o,o,d];n.executeSql(l,h,function(){b[a]={ok:!0,id:t.metadata.id,rev:f},w.set(s,t.metadata),c()})}var p=null,v=0;t.data._id=t.metadata.id,t.data._rev=t.metadata.rev;var y=Object.keys(t.data._attachments||{});o&&(t.data._deleted=!0),y.forEach(function(n){var r=t.data._attachments[n];if(r.stub)v++,f();else{var o=r.data;delete r.data,r.revpos=parseInt(e,10);var i=r.digest;h(i,o,l)}}),y.length||u()}function l(){Qe(t.revs_limit,y,r,w,m,b,f,n)}function d(t){function e(){++n===y.length&&t()}if(!y.length)return t();var n=0;y.forEach(function(t){if(t._id&&dt(t._id))return e();var n=t.metadata.id;m.executeSql("SELECT json FROM "+ji+" WHERE id = ?",[n],function(t,r){if(r.rows.length){var o=Ze(r.rows.item(0).json);w.set(n,o)}e()})})}function h(t,e,n){var r="SELECT digest FROM "+Ti+" WHERE digest=?";m.executeSql(r,[t],function(o,i){return i.rows.length?n():(r="INSERT INTO "+Ti+" (digest, body, escaped) VALUES (?,?,1)",void o.executeSql(r,[t,Rn(e)],function(){n()},function(){return n(),!1}))})}var p=n.new_edits,v=e.docs,y=v.map(function(t){if(t._id&&dt(t._id))return t;var e=Te(t,p);return e}),g=y.filter(function(t){return t.error});if(g.length)return s(g[0]);var m,_,b=new Array(y.length),w=new Eo;Ke(y,"binary",function(t){return t?s(t):void o.transaction(function(t){m=t,u(function(t){t?_=t:d(l)})},Pn(s),a)})}function Fn(t){return t.websql(t.name,t.version,t.description,t.size)}function $n(t){try{return{db:Fn(t)}}catch(e){return{error:e}}}function Hn(t){var e=Di.get(t.name);return e||(e=$n(t),Di.set(t.name,e)),e}function zn(t,e,n,r,o){function i(){++c===a.length&&o&&o()}function s(t,o){var s=t._attachments[o],a={binary:e.binary,ctx:r};n._getAttachment(t._id,o,s,a,function(e,n){t._attachments[o]=Co(m(s,["digest","content_type"]),{data:n}),i()})}var a=Object.keys(t._attachments||{});if(!a.length)return o&&o();var c=0;a.forEach(function(n){e.attachments&&e.include_docs?s(t,n):(t._attachments[n].stub=!0,i())})}function Jn(t,e){function n(){E()&&(window.localStorage["_pouch__websqldb_"+b._name]=!0),e(null,b)}function r(t,e){t.executeSql(Pi),t.executeSql("ALTER TABLE "+Ci+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){t.executeSql(Ni),t.executeSql("ALTER TABLE "+ji+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){t.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+ji+" (local, id)");var n="SELECT "+ji+".winningseq AS seq, "+ji+".json AS metadata FROM "+Ci+" JOIN "+ji+" ON "+Ci+".seq = "+ji+".winningseq";t.executeSql(n,[],function(t,n){for(var r=[],o=[],i=0;i<n.rows.length;i++){var s=n.rows.item(i),a=s.seq,c=JSON.parse(s.metadata);lt(c)&&r.push(a),dt(c.id)&&o.push(c.id)}t.executeSql("UPDATE "+ji+"SET local = 1 WHERE id IN "+Bn(o.length),o,function(){t.executeSql("UPDATE "+Ci+" SET deleted = 1 WHERE seq IN "+Bn(r.length),r,e)})})})})}function o(t,e){var n="CREATE TABLE IF NOT EXISTS "+Oi+" (id UNIQUE, rev, json)";t.executeSql(n,[],function(){var n="SELECT "+ji+".id AS id, "+Ci+".json AS data FROM "+Ci+" JOIN "+ji+" ON "+Ci+".seq = "+ji+".winningseq WHERE local = 1";t.executeSql(n,[],function(t,n){function r(){if(!o.length)return e(t);var n=o.shift(),i=JSON.parse(n.data)._rev;t.executeSql("INSERT INTO "+Oi+" (id, rev, json) VALUES (?,?,?)",[n.id,i,n.data],function(t){t.executeSql("DELETE FROM "+ji+" WHERE id=?",[n.id],function(t){t.executeSql("DELETE FROM "+Ci+" WHERE seq=?",[n.seq],function(){r()})})})}for(var o=[],i=0;i<n.rows.length;i++)o.push(n.rows.item(i));r()})})}function i(t,e){function n(n){function r(){if(!n.length)return e(t);var o=n.shift(),i=Tn(o.hex,_),s=i.lastIndexOf("::"),a=i.substring(0,s),c=i.substring(s+2),u="UPDATE "+Ci+" SET doc_id=?, rev=? WHERE doc_id_rev=?";t.executeSql(u,[a,c,i],function(){r()})}r()}var r="ALTER TABLE "+Ci+" ADD COLUMN doc_id";t.executeSql(r,[],function(t){var e="ALTER TABLE "+Ci+" ADD COLUMN rev";t.executeSql(e,[],function(t){t.executeSql(Li,[],function(t){var e="SELECT hex(doc_id_rev) as hex FROM "+Ci;t.executeSql(e,[],function(t,e){for(var r=[],o=0;o<e.rows.length;o++)r.push(e.rows.item(o));n(r)})})})})}function s(t,e){function n(t){var n="SELECT COUNT(*) AS cnt FROM "+Ti;t.executeSql(n,[],function(t,n){function r(){var n=Nn($i+", "+ji+".id AS id",[ji,Ci],Fi,null,ji+".id ");n+=" LIMIT "+s+" OFFSET "+i,i+=s,t.executeSql(n,[],function(t,n){function o(t,e){var n=i[t]=i[t]||[];n.indexOf(e)===-1&&n.push(e)}if(!n.rows.length)return e(t);for(var i={},s=0;s<n.rows.length;s++)for(var a=n.rows.item(s),c=In(a.data,a.id,a.rev),u=Object.keys(c._attachments||{}),f=0;f<u.length;f++){var l=c._attachments[u[f]];o(l.digest,a.seq)}var d=[];if(Object.keys(i).forEach(function(t){var e=i[t];e.forEach(function(e){d.push([t,e])})}),!d.length)return r();var h=0;d.forEach(function(e){var n="INSERT INTO "+qi+" (digest, seq) VALUES (?,?)";t.executeSql(n,e,function(){++h===d.length&&r()})})})}var o=n.rows.item(0).cnt;if(!o)return e(t);var i=0,s=10;r()})}var r="CREATE TABLE IF NOT EXISTS "+qi+" (digest, seq INTEGER)";t.executeSql(r,[],function(t){t.executeSql(Mi,[],function(t){t.executeSql(Ui,[],n)})})}function a(t,e){var n="ALTER TABLE "+Ti+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";t.executeSql(n,[],e)}function u(t,e){var n="ALTER TABLE "+ji+" ADD COLUMN max_seq INTEGER";t.executeSql(n,[],function(t){var n="UPDATE "+ji+" SET max_seq=(SELECT MAX(seq) FROM "+Ci+" WHERE doc_id=id)";t.executeSql(n,[],function(t){var n="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+ji+" (max_seq)";t.executeSql(n,[],e)})})}function l(t,e){t.executeSql('SELECT HEX("a") AS hex',[],function(t,n){var r=n.rows.item(0).hex;_=2===r.length?"UTF-8":"UTF-16",e()})}function d(){for(;x.length>0;){var t=x.pop();t(null,w)}}function h(t,e){if(0===e){var n="CREATE TABLE IF NOT EXISTS "+Ri+" (dbid, db_version INTEGER)",c="CREATE TABLE IF NOT EXISTS "+Ti+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",f="CREATE TABLE IF NOT EXISTS "+qi+" (digest, seq INTEGER)",l="CREATE TABLE IF NOT EXISTS "+ji+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",h="CREATE TABLE IF NOT EXISTS "+Ci+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",p="CREATE TABLE IF NOT EXISTS "+Oi+" (id UNIQUE, rev, json)";t.executeSql(c),t.executeSql(p),t.executeSql(f,[],function(){t.executeSql(Ui),t.executeSql(Mi)}),t.executeSql(l,[],function(){t.executeSql(Pi),t.executeSql(h,[],function(){t.executeSql(Ni),t.executeSql(Li),t.executeSql(n,[],function(){var e="INSERT INTO "+Ri+" (db_version, dbid) VALUES (?,?)";w=Go();var n=[Si,w];t.executeSql(e,n,function(){d()})})})})}else{var v=function(){var n=e<Si;n&&t.executeSql("UPDATE "+Ri+" SET db_version = "+Si);var r="SELECT dbid FROM "+Ri;t.executeSql(r,[],function(t,e){w=e.rows.item(0).dbid,d()})},y=[r,o,i,s,a,u,v],g=e,m=function(t){y[g-1](t,m),g++};m(t)}}function p(){j.transaction(function(t){l(t,function(){v(t)})},Pn(e),n)}function v(t){var e="SELECT sql FROM sqlite_master WHERE tbl_name = "+Ri;t.executeSql(e,[],function(t,e){e.rows.length?/db_version/.test(e.rows.item(0).sql)?t.executeSql("SELECT db_version FROM "+Ri,[],function(t,e){var n=e.rows.item(0).db_version;h(t,n)}):t.executeSql("ALTER TABLE "+Ri+" ADD COLUMN db_version INTEGER",[],function(){h(t,1)}):h(t,0)})}function y(t,e){var n="SELECT MAX(seq) AS seq FROM "+Ci;t.executeSql(n,[],function(t,n){var r=n.rows.item(0).seq||0;e(r)})}function g(t,e){var n=Nn("COUNT("+ji+".id) AS 'num'",[ji,Ci],Fi,Ci+".deleted=0");t.executeSql(n,[],function(t,n){e(n.rows.item(0).num)})}function m(t,e,n,r,o){var i=Nn($i,[ji,Ci],Fi,ji+".id=?"),s=[e];t.executeSql(i,s,function(t,e){if(!e.rows.length){var i=R(Ro,"missing");return o(i)}var s=e.rows.item(0),a=Ze(s.metadata);r(ht(n,a))})}var _,b=this,w=null,k=Un(t),x=[];b._name=t.name;var A=Co({},t,{version:Bi,description:t.name,size:k}),S=Hn(A);if(S.error)return Pn(e)(S.error);var j=S.db;"function"!=typeof j.readTransaction&&(j.readTransaction=j.transaction),p(),b._remote=!1,b.type=function(){return"websql"},b._id=f(function(t){t(null,w)}),b._info=function(t){var e,n;j.readTransaction(function(t){y(t,function(t){e=t}),g(t,function(t){n=t})},Pn(t),function(){t(null,{doc_count:n,update_seq:e,websql_encoding:_})})},b._bulkDocs=function(e,n,r){Mn(t,e,n,b,j,Ii,r)},b._get=function(t,e,n){function r(t){n(t,{doc:o,metadata:i,ctx:s})}var o,i,s=e.ctx;if(!s)return j.readTransaction(function(r){b._get(t,Co({ctx:r},e),n)});var a,c;if(e.rev){if(e.latest)return void m(s,t,e.rev,function(r){e.latest=!1,e.rev=r,b._get(t,e,n)},r);a=Nn($i,[ji,Ci],ji+".id="+Ci+".doc_id",[Ci+".doc_id=?",Ci+".rev=?"]),c=[t,e.rev]}else a=Nn($i,[ji,Ci],Fi,ji+".id=?"),c=[t];s.executeSql(a,c,function(t,n){if(!n.rows.length){var s=R(Ro,"missing");return r(s)}var a=n.rows.item(0);if(i=Ze(a.metadata),a.deleted&&!e.rev){var c=R(Ro,"deleted");return r(c)}o=In(a.data,i.id,a.rev),r()})},b._allDocs=function(t,e){var n,r=[],o="startkey"in t&&t.startkey,i="endkey"in t&&t.endkey,s="key"in t&&t.key,a="descending"in t&&t.descending,c="limit"in t?t.limit:-1,u="skip"in t?t.skip:0,f=t.inclusive_end!==!1,l=[],d=[];if(s!==!1)d.push(ji+".id = ?"),l.push(s);else if(o!==!1||i!==!1){if(o!==!1&&(d.push(ji+".id "+(a?"<=":">=")+" ?"),l.push(o)),i!==!1){var h=a?">":"<";f&&(h+="="),d.push(ji+".id "+h+" ?"),l.push(i)}s!==!1&&(d.push(ji+".id = ?"),l.push(s))}"ok"!==t.deleted&&d.push(Ci+".deleted = 0"),j.readTransaction(function(e){if(g(e,function(t){n=t}),0!==c){var o=Nn($i,[ji,Ci],Fi,d,ji+".id "+(a?"DESC":"ASC"));o+=" LIMIT "+c+" OFFSET "+u,e.executeSql(o,l,function(e,n){for(var o=0,i=n.rows.length;o<i;o++){var s=n.rows.item(o),a=Ze(s.metadata),c=a.id,u=In(s.data,c,s.rev),f=u._rev,l={id:c,key:c,value:{rev:f}};if(t.include_docs){if(l.doc=u,l.doc._rev=f,t.conflicts){var d=G(a);d.length&&(l.doc._conflicts=d)}zn(l.doc,t,b,e)}if(s.deleted){if("ok"!==t.deleted)continue;l.value.deleted=!0,l.doc=null}r.push(l)}})}},Pn(e),function(){e(null,{total_rows:n,offset:t.skip,rows:r})})},b._changes=function(t){function e(){var e=ji+".json AS metadata, "+ji+".max_seq AS maxSeq, "+Ci+".json AS winningDoc, "+Ci+".rev AS winningRev ",n=ji+" JOIN "+Ci,c=ji+".id="+Ci+".doc_id AND "+ji+".winningseq="+Ci+".seq",u=["maxSeq > ?"],f=[t.since];t.doc_ids&&(u.push(ji+".id IN "+Bn(t.doc_ids.length)),f=f.concat(t.doc_ids));var l="maxSeq "+(r?"DESC":"ASC"),d=Nn(e,n,c,u,l),h=I(t);t.view||t.filter||(d+=" LIMIT "+o);var p=t.since||0;j.readTransaction(function(e){e.executeSql(d,f,function(e,n){function r(e){return function(){t.onChange(e)}}for(var c=0,u=n.rows.length;c<u;c++){var f=n.rows.item(c),l=Ze(f.metadata);p=f.maxSeq;var d=In(f.winningDoc,l.id,f.winningRev),v=t.processChange(d,l,t);v.seq=f.maxSeq;var y=h(v);if("object"==typeof y)return t.complete(y);if(y&&(a++,i&&s.push(v),t.attachments&&t.include_docs?zn(d,t,b,e,r(v)):r(v)()),a===o)break}})},Pn(t.complete),function(){t.continuous||t.complete(null,{results:s,last_seq:p})})}if(t=c(t),t.continuous){var n=b._name+":"+Go();return Ii.addListener(b._name,n,b,t),Ii.notify(b._name),{cancel:function(){Ii.removeListener(b._name,n)}}}var r=t.descending;t.since=t.since&&!r?t.since:0;var o="limit"in t?t.limit:-1;0===o&&(o=1);var i;i="return_docs"in t?t.return_docs:!("returnDocs"in t)||t.returnDocs;var s=[],a=0;e()},b._close=function(t){t()},b._getAttachment=function(t,e,n,r,o){var i,s=r.ctx,a=n.digest,c=n.content_type,u="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+Ti+" WHERE digest=?";s.executeSql(u,[a],function(t,e){var n=e.rows.item(0),s=n.escaped?qn(n.body):Tn(n.body,_);i=r.binary?qe(s,c):ui(s),o(null,i)})},b._getRevisionTree=function(t,e){j.readTransaction(function(n){var r="SELECT json AS metadata FROM "+ji+" WHERE id = ?";n.executeSql(r,[t],function(t,n){if(n.rows.length){var r=Ze(n.rows.item(0).metadata);e(null,r.rev_tree)}else e(R(Ro))})})},b._doCompaction=function(t,e,n){return e.length?void j.transaction(function(n){var r="SELECT json AS metadata FROM "+ji+" WHERE id = ?";n.executeSql(r,[t],function(n,r){var o=Ze(r.rows.item(0).metadata);V(o.rev_tree,function(t,n,r,o,i){var s=n+"-"+r;e.indexOf(s)!==-1&&(i.status="missing")});var i="UPDATE "+ji+" SET json = ? WHERE id = ?";n.executeSql(i,[tn(o),t])}),Ln(e,t,n)},Pn(n),function(){n()}):n()},b._getLocal=function(t,e){j.readTransaction(function(n){var r="SELECT json, rev FROM "+Oi+" WHERE id=?";n.executeSql(r,[t],function(n,r){if(r.rows.length){var o=r.rows.item(0),i=In(o.json,t,o.rev);e(null,i)}else e(R(Ro))})})},b._putLocal=function(t,e,n){function r(t){var r,u;i?(r="UPDATE "+Oi+" SET rev=?, json=? WHERE id=? AND rev=?",u=[o,c,s,i]):(r="INSERT INTO "+Oi+" (id, rev, json) VALUES (?,?,?)",u=[s,o,c]),t.executeSql(r,u,function(t,r){r.rowsAffected?(a={ok:!0,id:s,rev:o},e.ctx&&n(null,a)):n(R(qo))},function(){return n(R(qo)),!1})}"function"==typeof e&&(n=e,e={}),delete t._revisions;var o,i=t._rev,s=t._id;o=i?t._rev="0-"+(parseInt(i.split("-")[1],10)+1):t._rev="0-1";var a,c=Dn(t);e.ctx?r(e.ctx):j.transaction(r,Pn(n),function(){a&&n(null,a)})},b._removeLocal=function(t,e,n){function r(r){var i="DELETE FROM "+Oi+" WHERE id=? AND rev=?",s=[t._id,t._rev];r.executeSql(i,s,function(r,i){return i.rowsAffected?(o={ok:!0,id:t._id,rev:"0-0"},void(e.ctx&&n(null,o))):n(R(Ro))})}"function"==typeof e&&(n=e,e={});var o;e.ctx?r(e.ctx):j.transaction(r,Pn(n),function(){o&&n(null,o)})},b._destroy=function(t,e){Ii.removeAllListeners(b._name),j.transaction(function(t){var e=[ji,Ci,Ti,Ri,Oi,qi];e.forEach(function(e){t.executeSql("DROP TABLE IF EXISTS "+e,[])})},Pn(e),function(){E()&&(delete window.localStorage["_pouch__websqldb_"+b._name],delete window.localStorage[b._name]),e(null,{ok:!0})})}}function Yn(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(t){return!1}}function Xn(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var t=E(),e="_pouch__websqldb_valid_"+navigator.userAgent;if(t&&localStorage[e])return"1"===localStorage[e];var n=Yn();return t&&(localStorage[e]=n?"1":"0"),n}function Vn(){return"function"==typeof openDatabase&&Xn()}function Kn(t,e,n,r){return openDatabase(t,e,n,r)}function Wn(t,e){var n=Co({websql:Kn},t);Jn.call(this,n,e)}function Gn(){for(var t={},e=new _o(function(e,n){t.resolve=e,t.reject=n}),n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return t.promise=e,_o.resolve().then(function(){return fetch.apply(null,n)}).then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)}),t}function Qn(t,e){var n,r,o,i=new Headers,s={method:t.method,credentials:"include",headers:i};return t.json&&(i.set("Accept","application/json"),i.set("Content-Type",t.headers["Content-Type"]||"application/json")),t.body&&t.processData&&"string"!=typeof t.body?s.body=JSON.stringify(t.body):"body"in t?s.body=t.body:s.body=null,Object.keys(t.headers).forEach(function(e){t.headers.hasOwnProperty(e)&&i.set(e,t.headers[e])}),n=Gn(t.url,s),t.timeout>0&&(r=setTimeout(function(){n.reject(new Error("Load timeout for resource: "+t.url))},t.timeout)),n.promise.then(function(e){return o={statusCode:e.status},t.timeout>0&&clearTimeout(r),o.statusCode>=200&&o.statusCode<300?t.binary?e.blob():e.text():e.json()}).then(function(t){o.statusCode>=200&&o.statusCode<300?e(null,o,t):(t.status=o.statusCode,e(t))})["catch"](function(t){t||(t=new Error("canceled")),e(t)}),{abort:n.reject}}function Zn(t,e){var n,r,o=!1,i=function(){n.abort(),c()},s=function(){o=!0,n.abort(),c()},a={abort:i},c=function(){clearTimeout(r),a.abort=function(){},n&&(n.onprogress=void 0,n.upload&&(n.upload.onprogress=void 0),n.onreadystatechange=void 0,n=void 0)};n=t.xhr?new t.xhr:new XMLHttpRequest;try{n.open(t.method,t.url)}catch(u){return e(new Error(u.name||"Url is invalid"))}n.withCredentials=!("withCredentials"in t)||t.withCredentials,"GET"===t.method?delete t.headers["Content-Type"]:t.json&&(t.headers.Accept="application/json",t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.body&&t.processData&&"string"!=typeof t.body&&(t.body=JSON.stringify(t.body))),t.binary&&(n.responseType="arraybuffer"),"body"in t||(t.body=null);for(var f in t.headers)t.headers.hasOwnProperty(f)&&n.setRequestHeader(f,t.headers[f]);return t.timeout>0&&(r=setTimeout(s,t.timeout),n.onprogress=function(){clearTimeout(r),4!==n.readyState&&(r=setTimeout(s,t.timeout))},"undefined"!=typeof n.upload&&(n.upload.onprogress=n.onprogress)),n.onreadystatechange=function(){if(4===n.readyState){var r={statusCode:n.status};if(n.status>=200&&n.status<300){var i;i=t.binary?Oe([n.response||""],{type:n.getResponseHeader("Content-Type")}):n.responseText,e(null,r,i)}else{var s={};if(o)s=new Error("ETIMEDOUT"),s.code="ETIMEDOUT";else if("string"==typeof n.response)try{s=JSON.parse(n.response)}catch(a){}s.status=n.status,e(s)}c()}},t.body&&t.body instanceof Blob?Pe(t.body,function(t){n.send(t)}):n.send(t.body),a}function tr(){try{return new XMLHttpRequest,!0}catch(t){return!1}}function er(t,e){return zi||t.xhr?Zn(t,e):Qn(t,e)}function nr(){return""}function rr(t,e){function n(e,n,r){if(!t.binary&&t.json&&"string"==typeof e)try{e=JSON.parse(e)}catch(o){return r(o)}Array.isArray(e)&&(e=e.map(function(t){return t.error||t.missing?q(t):t})),t.binary&&Ji(e,n),r(null,e,n)}t=c(t);var r={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};return t=Co(r,t),t.json&&(t.binary||(t.headers.Accept="application/json"),t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json"),t.binary&&(t.encoding=null,t.json=!1),t.processData||(t.json=!1),er(t,function(r,o,i){if(r)return e(q(r));var s,a=o.headers&&o.headers["content-type"],c=i||nr();if(!t.binary&&(t.json||!t.processData)&&"object"!=typeof c&&(/json/.test(a)||/^[\s]*\{/.test(c)&&/\}[\s]*$/.test(c)))try{c=JSON.parse(c.toString())}catch(u){}o.statusCode>=200&&o.statusCode<300?n(c,o,e):(s=q(c),s.status=o.statusCode,e(s))})}function or(t,e){var n=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",r=n.indexOf("safari")!==-1&&n.indexOf("chrome")===-1,o=n.indexOf("msie")!==-1,i=n.indexOf("edge")!==-1,s=r||(o||i)&&"GET"===t.method,a=!("cache"in t)||t.cache,c=/^blob:/.test(t.url);if(!c&&(s||!a)){var u=t.url.indexOf("?")!==-1;t.url+=(u?"&":"?")+"_nonce="+Date.now()}return rr(t,e)}function ir(t,e){return new _o(function(n,r){function o(){f++,t[l++]().then(s,a)}function i(){++d===h?u?r(u):n():c()}function s(){f--,i()}function a(t){f--,u=u||t,i()}function c(){for(;f<e&&l<h;)o()}var u,f=0,l=0,d=0,h=t.length;c()})}function sr(t){var e=t.doc&&t.doc._attachments;e&&Object.keys(e).forEach(function(t){var n=e[t];n.data=De(n.data,n.content_type)})}function ar(t){return/^_design/.test(t)?"_design/"+encodeURIComponent(t.slice(8)):/^_local/.test(t)?"_local/"+encodeURIComponent(t.slice(7)):encodeURIComponent(t)}function cr(t){return t._attachments&&Object.keys(t._attachments)?_o.all(Object.keys(t._attachments).map(function(e){var n=t._attachments[e];if(n.data&&"string"!=typeof n.data)return new _o(function(t){Le(n.data,t)}).then(function(t){n.data=t})})):_o.resolve()}function ur(t){if(!t.prefix)return!1;var e=$(t.prefix).protocol;return"http"===e||"https"===e}function fr(t,e){if(ur(e)){var n=e.name.substr(e.prefix.length);t=e.prefix+encodeURIComponent(n)}var r=$(t);(r.user||r.password)&&(r.auth={username:r.user,password:r.password});var o=r.path.replace(/(^\/|\/$)/g,"").split("/");return r.db=o.pop(),r.db.indexOf("%")===-1&&(r.db=encodeURIComponent(r.db)),r.path=o.join("/"),r}function lr(t,e){return dr(t,t.db+"/"+e)}function dr(t,e){var n=t.path?"/":"";return t.protocol+"://"+t.host+(t.port?":"+t.port:"")+"/"+t.path+n+e}function hr(t){return"?"+Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")}function pr(t,e){function n(t,e,n){var r=t.ajax||{},o=Co(c(l),r,e),i=c(l.headers||{});return o.headers=Co(i,r.headers,e.headers||{}),a.constructor.listeners("debug").length&&a.constructor.emit("debug",["http",o.method,o.url]),a._ajax(o,n)}function r(t,e){return new _o(function(r,o){n(t,e,function(t,e){return t?o(t):void r(e)})})}function o(t,e){return d(t,lo(function(t){i().then(function(){return e.apply(this,t)})["catch"](function(e){var n=t.pop();n(e)})}))}function i(){if(t.skipSetup||t.skip_setup)return _o.resolve();if(y)return y;var e={method:"GET",url:f};return y=r({},e)["catch"](function(t){return t&&t.status&&404===t.status?(T(404,"PouchDB is just detecting if the remote exists."),r({},{method:"PUT",url:f})):_o.reject(t)})["catch"](function(t){return!(!t||!t.status||412!==t.status)||_o.reject(t)}),y["catch"](function(){y=null}),y}function s(t){return t.split("/").map(encodeURIComponent).join("/")}var a=this,u=fr(t.name,t),f=lr(u,"");t=c(t);var l=t.ajax||{};if(t.auth||u.auth){var h=t.auth||u.auth,p=h.username+":"+h.password,v=ui(unescape(encodeURIComponent(p)));l.headers=l.headers||{},l.headers.Authorization="Basic "+v}a._ajax=or;var y;vo(function(){e(null,a)}),a._remote=!0,a.type=function(){return"http"},a.id=o("id",function(t){n({},{method:"GET",url:dr(u,"")},function(e,n){var r=n&&n.uuid?n.uuid+u.db:lr(u,"");t(null,r)})}),a.request=o("request",function(t,e){t.url=lr(u,t.url),n({},t,e)}),a.compact=o("compact",function(t,e){"function"==typeof t&&(e=t,t={}),t=c(t),n(t,{url:lr(u,"_compact"),method:"POST"},function(){function n(){a.info(function(r,o){o&&!o.compact_running?e(null,{ok:!0}):setTimeout(n,t.interval||200)})}n()})}),a.bulkGet=d("bulkGet",function(t,e){function r(e){var r={};t.revs&&(r.revs=!0),t.attachments&&(r.attachments=!0),t.latest&&(r.latest=!0),n(t,{url:lr(u,"_bulk_get"+hr(r)),method:"POST",body:{docs:t.docs}},e)}function o(){function n(t){return function(n,r){a[t]=r.results,++s===o&&e(null,{results:B(a)})}}for(var r=Xi,o=Math.ceil(t.docs.length/r),s=0,a=new Array(o),c=0;c<o;c++){var u=m(t,["revs","attachments","latest"]);u.ajax=l,u.docs=t.docs.slice(c*r,Math.min(t.docs.length,(c+1)*r)),w(i,u,n(c))}}var i=this,s=dr(u,""),a=Wi[s];"boolean"!=typeof a?r(function(t,n){t?(Wi[s]=!1,T(t.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),o()):(Wi[s]=!0,e(null,n))}):a?r(e):o()}),a._info=function(t){i().then(function(){n({},{method:"GET",url:lr(u,"")},function(e,n){return e?t(e):(n.host=lr(u,""),void t(null,n))})})["catch"](t)},a.get=o("get",function(t,e,n){function o(t){function n(n){var i=o[n],a=ar(t._id)+"/"+s(n)+"?rev="+t._rev;return r(e,{method:"GET",url:lr(u,a),binary:!0}).then(function(t){return e.binary?t:new _o(function(e){Le(t,e)})}).then(function(t){delete i.stub,delete i.length,i.data=t})}var o=t._attachments,i=o&&Object.keys(o);if(o&&i.length){var a=i.map(function(t){return function(){return n(t)}});return ir(a,5)}}function i(t){return Array.isArray(t)?_o.all(t.map(function(t){if(t.ok)return o(t.ok)})):o(t)}"function"==typeof e&&(n=e,e={}),e=c(e);var a={};e.revs&&(a.revs=!0),e.revs_info&&(a.revs_info=!0),e.latest&&(a.latest=!0),e.open_revs&&("all"!==e.open_revs&&(e.open_revs=JSON.stringify(e.open_revs)),a.open_revs=e.open_revs),e.rev&&(a.rev=e.rev),e.conflicts&&(a.conflicts=e.conflicts),t=ar(t);var f={method:"GET",url:lr(u,t+hr(a))};r(e,f).then(function(t){return _o.resolve().then(function(){if(e.attachments)return i(t)}).then(function(){n(null,t)})})["catch"](function(e){e.docId=t,n(e)})}),a.remove=o("remove",function(t,e,r,o){var i;"string"==typeof e?(i={_id:t,_rev:e},"function"==typeof r&&(o=r,r={})):(i=t,"function"==typeof e?(o=e,r={}):(o=r,r=e));var s=i._rev||r.rev;n(r,{method:"DELETE",url:lr(u,ar(i._id))+"?rev="+s},o)}),a.getAttachment=o("getAttachment",function(t,e,r,o){"function"==typeof r&&(o=r,r={});var i=r.rev?"?rev="+r.rev:"",a=lr(u,ar(t))+"/"+s(e)+i;n(r,{method:"GET",url:a,binary:!0},o)}),a.removeAttachment=o("removeAttachment",function(t,e,r,o){var i=lr(u,ar(t)+"/"+s(e))+"?rev="+r;n({},{method:"DELETE",url:i},o)}),a.putAttachment=o("putAttachment",function(t,e,r,o,i,a){"function"==typeof i&&(a=i,i=o,o=r,r=null);var c=ar(t)+"/"+s(e),f=lr(u,c);if(r&&(f+="?rev="+r),"string"==typeof o){var d;try{d=ci(o)}catch(h){return a(R(Lo,"Attachment is not a valid base64 string"))}o=d?qe(d,i):""}var p={headers:{"Content-Type":i},method:"PUT",url:f,processData:!1,body:o,timeout:l.timeout||6e4};n({},p,a)}),a._bulkDocs=function(t,e,r){t.new_edits=e.new_edits,i().then(function(){return _o.all(t.docs.map(cr))}).then(function(){n(e,{method:"POST",url:lr(u,"_bulk_docs"),timeout:e.timeout,body:t},function(t,e){return t?r(t):(e.forEach(function(t){t.ok=!0}),void r(null,e))})})["catch"](r)},a._put=function(t,e,r){i().then(function(){return cr(t)}).then(function(){n(e,{method:"PUT",url:lr(u,ar(t._id)),body:t},function(e,n){return e?(e.docId=t&&t._id,r(e)):void r(null,n)})})["catch"](r)},a.allDocs=o("allDocs",function(t,e){"function"==typeof t&&(e=t,t={}),t=c(t);var n,o={},i="GET";t.conflicts&&(o.conflicts=!0),t.descending&&(o.descending=!0),t.include_docs&&(o.include_docs=!0),t.attachments&&(o.attachments=!0),t.key&&(o.key=JSON.stringify(t.key)),t.start_key&&(t.startkey=t.start_key),t.startkey&&(o.startkey=JSON.stringify(t.startkey)),t.end_key&&(t.endkey=t.end_key),t.endkey&&(o.endkey=JSON.stringify(t.endkey)),"undefined"!=typeof t.inclusive_end&&(o.inclusive_end=!!t.inclusive_end),"undefined"!=typeof t.limit&&(o.limit=t.limit),"undefined"!=typeof t.skip&&(o.skip=t.skip);var s=hr(o);"undefined"!=typeof t.keys&&(i="POST",n={keys:t.keys}),r(t,{method:i,url:lr(u,"_all_docs"+s),body:n}).then(function(n){t.include_docs&&t.attachments&&t.binary&&n.rows.forEach(sr),e(null,n)})["catch"](e)}),a._changes=function(t){var e="batch_size"in t?t.batch_size:Yi;t=c(t),!t.continuous||"heartbeat"in t||(t.heartbeat=Ki);var r="timeout"in t?t.timeout:"timeout"in l?l.timeout:3e4;"timeout"in t&&t.timeout&&r-t.timeout<Vi&&(r=t.timeout+Vi),"heartbeat"in t&&t.heartbeat&&r-t.heartbeat<Vi&&(r=t.heartbeat+Vi);var o={};"timeout"in t&&t.timeout&&(o.timeout=t.timeout);var s,a="undefined"!=typeof t.limit&&t.limit;s="return_docs"in t?t.return_docs:!("returnDocs"in t)||t.returnDocs;var f=a;if(t.style&&(o.style=t.style),(t.include_docs||t.filter&&"function"==typeof t.filter)&&(o.include_docs=!0),t.attachments&&(o.attachments=!0),t.continuous&&(o.feed="longpoll"),t.conflicts&&(o.conflicts=!0),t.descending&&(o.descending=!0),"heartbeat"in t&&t.heartbeat&&(o.heartbeat=t.heartbeat),t.filter&&"string"==typeof t.filter&&(o.filter=t.filter),t.view&&"string"==typeof t.view&&(o.filter="_view",o.view=t.view),t.query_params&&"object"==typeof t.query_params)for(var d in t.query_params)t.query_params.hasOwnProperty(d)&&(o[d]=t.query_params[d]);var h,p="GET";t.doc_ids?(o.filter="_doc_ids",p="POST",h={doc_ids:t.doc_ids}):t.selector&&(o.filter="_selector",p="POST",h={selector:t.selector});var v,y,g=function(s,c){if(!t.aborted){o.since=s,"object"==typeof o.since&&(o.since=JSON.stringify(o.since)),t.descending?a&&(o.limit=f):o.limit=!a||f>e?e:f;var l={method:p,url:lr(u,"_changes"+hr(o)),timeout:r,body:h};y=s,t.aborted||i().then(function(){v=n(t,l,c)})["catch"](c)}},m={results:[]},_=function(n,r){if(!t.aborted){var o=0;if(r&&r.results){o=r.results.length,m.last_seq=r.last_seq;var i={};i.query=t.query_params,r.results=r.results.filter(function(e){f--;var n=I(t)(e);return n&&(t.include_docs&&t.attachments&&t.binary&&sr(e),s&&m.results.push(e),t.onChange(e)),n})}else if(n)return t.aborted=!0,void t.complete(n);r&&r.last_seq&&(y=r.last_seq);var c=a&&f<=0||r&&o<e||t.descending;(!t.continuous||a&&f<=0)&&c?t.complete(null,m):vo(function(){g(y,_)})}};return g(t.since||0,_),{cancel:function(){t.aborted=!0,v&&v.abort()}}},a.revsDiff=o("revsDiff",function(t,e,r){"function"==typeof e&&(r=e,e={}),n(e,{method:"POST",url:lr(u,"_revs_diff"),body:t},r)}),a._close=function(t){t()},a._destroy=function(t,e){n(t,{url:lr(u,""),method:"DELETE"},function(t,n){return t&&t.status&&404!==t.status?e(t):void e(null,n)})}}function vr(t){this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,vr)}catch(e){}}function yr(t){this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,yr)}catch(e){}}function gr(t){this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,gr)}catch(e){}}function mr(t,e){return e&&t.then(function(t){vo(function(){e(null,t)})},function(t){vo(function(){e(t)})}),t}function _r(t){return lo(function(e){var n=e.pop(),r=t.apply(this,e);return"function"==typeof n&&mr(r,n),r})}function br(t,e){return t.then(function(t){return e().then(function(){return t})},function(t){return e().then(function(){throw t})})}function wr(t,e){return function(){var n=arguments,r=this;return t.add(function(){return e.apply(r,n)})}}function kr(t){var e=new ko(t),n=new Array(e.size),r=-1;return e.forEach(function(t){n[++r]=t}),n}function Er(t){var e=new Array(t.size),n=-1;return t.forEach(function(t,r){e[++n]=r}),e}function xr(t){var e="builtin "+t+" function requires map values to be numbers or number arrays";return new gr(e)}function Ar(t){for(var e=0,n=0,r=t.length;n<r;n++){var o=t[n];if("number"!=typeof o){if(!Array.isArray(o))throw xr("_sum");e="number"==typeof e?[e]:e;for(var i=0,s=o.length;i<s;i++){var a=o[i];if("number"!=typeof a)throw xr("_sum");"undefined"==typeof e[i]?e.push(a):e[i]+=a}}else"number"==typeof e?e+=o:e[0]+=o}return e}function Sr(t,e){return H("return ("+t.replace(/;\s*$/,"")+");",{emit:e,sum:Ar,log:Qi,isArray:Zi,toJSON:ts})}function jr(){this.promise=new _o(function(t){t()})}function Cr(t){if(!t)return"undefined";switch(typeof t){case"function":return t.toString();case"string":return t.toString();default:return JSON.stringify(t)}}function Tr(t,e){return Cr(t)+Cr(e)+"undefined"}function Or(t,e,n,r,o,i){var s,a=Tr(n,r);if(!o&&(s=t._cachedViews=t._cachedViews||{},s[a]))return s[a];var c=t.info().then(function(c){function u(t){t.views=t.views||{};var n=e;n.indexOf("/")===-1&&(n=e+"/"+e);var r=t.views[n]=t.views[n]||{};if(!r[f])return r[f]=!0,t}var f=c.db_name+"-mrview-"+(o?"temp":ze(a));return z(t,"_local/"+i,u).then(function(){return t.registerDependentDatabase(f).then(function(e){var o=e.db;o.auto_compaction=!0;var i={name:f,db:o,sourceDB:t,adapter:t.adapter,mapFun:n,reduceFun:r};return i.db.get("_local/lastSeq")["catch"](function(t){if(404!==t.status)throw t}).then(function(t){return i.seq=t?t.seq:0,s&&i.db.once("destroyed",function(){delete s[a]}),i})})})});return s&&(s[a]=c),c}function Rr(t){return t.indexOf("/")===-1?[t,t]:t.split("/");
}function qr(t){return 1===t.length&&/^1-/.test(t[0].rev)}function Dr(t,e){try{t.emit("error",e)}catch(n){S("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),S("error",e)}}function Ir(t,e,n,r){function o(t,e,n){try{e(n)}catch(r){Dr(t,r)}}function i(t,e,n,r,o){try{return{output:e(n,r,o)}}catch(i){return Dr(t,i),{error:i}}}function s(t,e){var n=Yt(t.key,e.key);return 0!==n?n:Yt(t.value,e.value)}function a(t,e,n){return n=n||0,"number"==typeof e?t.slice(n,e+n):n>0?t.slice(n):t}function c(t){var e=t.value,n=e&&"object"==typeof e&&e._id||t.id;return n}function u(t){t.rows.forEach(function(t){var e=t.doc&&t.doc._attachments;e&&Object.keys(e).forEach(function(t){var n=e[t];e[t].data=De(n.data,n.content_type)})})}function f(t){return function(e){return t.include_docs&&t.attachments&&t.binary&&u(e),e}}function l(t,e,n,r){var o=e[t];"undefined"!=typeof o&&(r&&(o=encodeURIComponent(JSON.stringify(o))),n.push(t+"="+o))}function d(t){if("undefined"!=typeof t){var e=Number(t);return isNaN(e)||e!==parseInt(t,10)?t:e}}function h(t){return t.group_level=d(t.group_level),t.limit=d(t.limit),t.skip=d(t.skip),t}function p(t){if(t){if("number"!=typeof t)return new vr('Invalid value for integer: "'+t+'"');if(t<0)return new vr('Invalid value for positive integer: "'+t+'"')}}function v(t,e){var n=t.descending?"endkey":"startkey",r=t.descending?"startkey":"endkey";if("undefined"!=typeof t[n]&&"undefined"!=typeof t[r]&&Yt(t[n],t[r])>0)throw new vr("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(e.reduce&&t.reduce!==!1){if(t.include_docs)throw new vr("{include_docs:true} is invalid for reduce");if(t.keys&&t.keys.length>1&&!t.group&&!t.group_level)throw new vr("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(e){var n=p(t[e]);if(n)throw n})}function y(t,e,n){var r,o=[],i="GET";if(l("reduce",n,o),l("include_docs",n,o),l("attachments",n,o),l("limit",n,o),l("descending",n,o),l("group",n,o),l("group_level",n,o),l("skip",n,o),l("stale",n,o),l("conflicts",n,o),l("startkey",n,o,!0),l("start_key",n,o,!0),l("endkey",n,o,!0),l("end_key",n,o,!0),l("inclusive_end",n,o),l("key",n,o,!0),o=o.join("&"),o=""===o?"":"?"+o,"undefined"!=typeof n.keys){var s=2e3,a="keys="+encodeURIComponent(JSON.stringify(n.keys));a.length+o.length+1<=s?o+=("?"===o[0]?"&":"?")+a:(i="POST","string"==typeof e?r={keys:n.keys}:e.keys=n.keys)}if("string"==typeof e){var c=Rr(e);return t.request({method:i,url:"_design/"+c[0]+"/_view/"+c[1]+o,body:r}).then(function(t){return t.rows.forEach(function(t){if(t.value&&t.value.error&&"builtin_reduce_error"===t.value.error)throw new Error(t.reason)}),t}).then(f(n))}return r=r||{},Object.keys(e).forEach(function(t){Array.isArray(e[t])?r[t]=e[t]:r[t]=e[t].toString()}),t.request({method:"POST",url:"_temp_view"+o,body:r}).then(f(n))}function g(t,e,n){return new _o(function(r,o){t._query(e,n,function(t,e){return t?o(t):void r(e)})})}function m(t){return new _o(function(e,n){t._viewCleanup(function(t,r){return t?n(t):void e(r)})})}function _(t){return function(e){if(404===e.status)return t;throw e}}function b(t,e,n){function r(){return qr(f)?_o.resolve(a):e.db.get(s)["catch"](_(a))}function o(t){return t.keys.length?e.db.allDocs({keys:t.keys,include_docs:!0}):_o.resolve({rows:[]})}function i(t,e){for(var n=[],r=new ko,o=0,i=e.rows.length;o<i;o++){var s=e.rows[o],a=s.doc;if(a&&(n.push(a),r.add(a._id),a._deleted=!u.has(a._id),!a._deleted)){var c=u.get(a._id);"value"in c&&(a.value=c.value)}}var f=Er(u);return f.forEach(function(t){if(!r.has(t)){var e={_id:t},o=u.get(t);"value"in o&&(e.value=o.value),n.push(e)}}),t.keys=kr(f.concat(t.keys)),n.push(t),n}var s="_local/doc_"+t,a={_id:s,keys:[]},c=n.get(t),u=c[0],f=c[1];return r().then(function(t){return o(t).then(function(e){return i(t,e)})})}function w(t,e,n){var r="_local/lastSeq";return t.db.get(r)["catch"](_({_id:r,seq:0})).then(function(r){var o=Er(e);return _o.all(o.map(function(n){return b(n,t,e)})).then(function(e){var o=B(e);return r.seq=n,o.push(r),t.db.bulkDocs({docs:o})})})}function k(t){var e="string"==typeof t?t:t.name,n=es[e];return n||(n=es[e]=new jr),n}function E(t){return wr(k(t),function(){return x(t)})()}function x(t){function n(t,e){var n={id:l._id,key:Xt(t)};"undefined"!=typeof e&&null!==e&&(n.value=Xt(e)),f.push(n)}function r(e,n){return function(){return w(t,e,n)}}function i(){return t.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:h,limit:rs}).then(a)}function a(t){var e=t.results;if(e.length){var n=c(e);if(p.add(r(n,h)),!(e.length<rs))return i()}}function c(e){for(var n=new Eo,r=0,i=e.length;r<i;r++){var a=e[r];if("_"!==a.doc._id[0]){f=[],l=a.doc,l._deleted||o(t.sourceDB,d,l),f.sort(s);var c=u(f);n.set(a.doc._id,[c,a.changes])}h=a.seq}return n}function u(t){for(var e,n=new Eo,r=0,o=t.length;r<o;r++){var i=t[r],s=[i.key,i.id];r>0&&0===Yt(i.key,e)&&s.push(r),n.set(Kt(s),i),e=i.key}return n}var f,l,d=e(t.mapFun,n),h=t.seq||0,p=new jr;return i().then(function(){return p.finish()}).then(function(){t.seq=h})}function A(t,e,r){0===r.group_level&&delete r.group_level;var o=r.group||r.group_level,s=n(t.reduceFun),c=[],u=isNaN(r.group_level)?Number.POSITIVE_INFINITY:r.group_level;e.forEach(function(t){var e=c[c.length-1],n=o?t.key:null;return o&&Array.isArray(n)&&(n=n.slice(0,u)),e&&0===Yt(e.groupKey,n)?(e.keys.push([t.key,t.id]),void e.values.push(t.value)):void c.push({keys:[[t.key,t.id]],values:[t.value],groupKey:n})}),e=[];for(var f=0,l=c.length;f<l;f++){var d=c[f],h=i(t.sourceDB,s,d.keys,d.values,!1);if(h.error&&h.error instanceof gr)throw h.error;e.push({value:h.error?null:h.output,key:d.groupKey})}return{rows:a(e,r.limit,r.skip)}}function S(t,e){return wr(k(t),function(){return j(t,e)})()}function j(t,e){function n(e){return e.include_docs=!0,t.db.allDocs(e).then(function(t){return o=t.total_rows,t.rows.map(function(t){if("value"in t.doc&&"object"==typeof t.doc.value&&null!==t.doc.value){var e=Object.keys(t.doc.value).sort(),n=["id","key","value"];if(!(e<n||e>n))return t.doc.value}var r=Qt(t.doc._id);return{key:r[0],id:r[1],value:"value"in t.doc?t.doc.value:null}})})}function r(n){var r;if(r=i?A(t,n,e):{total_rows:o,offset:s,rows:n},e.include_docs){var a=kr(n.map(c));return t.sourceDB.allDocs({keys:a,include_docs:!0,conflicts:e.conflicts,attachments:e.attachments,binary:e.binary}).then(function(t){var e=new Eo;return t.rows.forEach(function(t){e.set(t.id,t.doc)}),n.forEach(function(t){var n=c(t),r=e.get(n);r&&(t.doc=r)}),r})}return r}var o,i=t.reduceFun&&e.reduce!==!1,s=e.skip||0;if("undefined"==typeof e.keys||e.keys.length||(e.limit=0,delete e.keys),"undefined"!=typeof e.keys){var a=e.keys,u=a.map(function(t){var e={startkey:Kt([t]),endkey:Kt([t,{}])};return n(e)});return _o.all(u).then(B).then(r)}var f,l,d={descending:e.descending};if("start_key"in e&&(f=e.start_key),"startkey"in e&&(f=e.startkey),"end_key"in e&&(l=e.end_key),"endkey"in e&&(l=e.endkey),"undefined"!=typeof f&&(d.startkey=Kt(e.descending?[f,{}]:[f])),"undefined"!=typeof l){var h=e.inclusive_end!==!1;e.descending&&(h=!h),d.endkey=Kt(h?[l,{}]:[l])}if("undefined"!=typeof e.key){var p=Kt([e.key]),v=Kt([e.key,{}]);d.descending?(d.endkey=p,d.startkey=v):(d.startkey=p,d.endkey=v)}return i||("number"==typeof e.limit&&(d.limit=e.limit),d.skip=s),n(d).then(r)}function C(t){return t.request({method:"POST",url:"_view_cleanup"})}function T(e){return e.get("_local/"+t).then(function(t){var n=new Eo;Object.keys(t.views).forEach(function(t){var e=Rr(t),r="_design/"+e[0],o=e[1],i=n.get(r);i||(i=new ko,n.set(r,i)),i.add(o)});var r={keys:Er(n),include_docs:!0};return e.allDocs(r).then(function(r){var o={};r.rows.forEach(function(e){var r=e.key.substring(8);n.get(e.key).forEach(function(n){var i=r+"/"+n;t.views[i]||(i=n);var s=Object.keys(t.views[i]),a=e.doc&&e.doc.views&&e.doc.views[n];s.forEach(function(t){o[t]=o[t]||a})})});var i=Object.keys(o).filter(function(t){return!o[t]}),s=i.map(function(t){return wr(k(t),function(){return new e.constructor(t,e.__opts).destroy()})()});return _o.all(s).then(function(){return{ok:!0}})})},_({ok:!0}))}function O(e,n,o){if("function"==typeof e._query)return g(e,n,o);if(P(e))return y(e,n,o);if("string"!=typeof n)return v(o,n),ns.add(function(){var r=Or(e,"temp_view/temp_view",n.map,n.reduce,!0,t);return r.then(function(t){return br(E(t).then(function(){return S(t,o)}),function(){return t.db.destroy()})})}),ns.finish();var i=n,s=Rr(i),a=s[0],c=s[1];return e.get("_design/"+a).then(function(n){var s=n.views&&n.views[c];if(!s)throw new yr("ddoc "+n._id+" has no view named "+c);r(n,c),v(o,s);var a=Or(e,i,s.map,s.reduce,!1,t);return a.then(function(t){return"ok"===o.stale||"update_after"===o.stale?("update_after"===o.stale&&vo(function(){E(t)}),S(t,o)):E(t).then(function(){return S(t,o)})})})}function R(t,e,n){var r=this;"function"==typeof e&&(n=e,e={}),e=e?h(e):{},"function"==typeof t&&(t={map:t});var o=_o.resolve().then(function(){return O(r,t,e)});return mr(o,n),o}var q=_r(function(){var t=this;return"function"==typeof t._viewCleanup?m(t):P(t)?C(t):T(t)});return{query:R,viewCleanup:q}}function Br(t){if(/^_sum/.test(t))return os._sum;if(/^_count/.test(t))return os._count;if(/^_stats/.test(t))return os._stats;if(/^_/.test(t))throw new Error(t+" is not a supported reduce function.")}function Nr(t,e){if("function"==typeof t&&2===t.length){var n=t;return function(t){return n(t,e)}}return Sr(t.toString(),e)}function Lr(t){var e=t.toString(),n=Br(e);return n?n:Sr(e)}function Pr(t,e){var n=t.views&&t.views[e];if("string"!=typeof n.map)throw new yr("ddoc "+t._id+" has no string view named "+e+", instead found object of type: "+typeof n.map)}function Ur(t,e,n){return ss.query.call(this,t,e,n)}function Mr(t){return ss.viewCleanup.call(this,t)}function Fr(t){return/^1-/.test(t)}function $r(t,e,n){return!t._attachments||!t._attachments[n]||t._attachments[n].digest!==e._attachments[n].digest}function Hr(t,e){var n=Object.keys(e._attachments);return _o.all(n.map(function(n){return t.getAttachment(e._id,n,{rev:e._rev})}))}function zr(t,e,n){var r=P(e)&&!P(t),o=Object.keys(n._attachments);return r?t.get(n._id).then(function(r){return _o.all(o.map(function(o){return $r(r,n,o)?e.getAttachment(n._id,o):t.getAttachment(r._id,o)}))})["catch"](function(t){if(404!==t.status)throw t;return Hr(e,n)}):Hr(e,n)}function Jr(t){var e=[];return Object.keys(t).forEach(function(n){var r=t[n].missing;r.forEach(function(t){e.push({id:n,rev:t})})}),{docs:e,revs:!0,latest:!0}}function Yr(t,e,n,r){function o(){var o=Jr(n);if(o.docs.length)return t.bulkGet(o).then(function(n){if(r.cancelled)throw new Error("cancelled");return _o.all(n.results.map(function(n){return _o.all(n.docs.map(function(n){var r=n.ok;return n.error&&(d=!1),r&&r._attachments?zr(e,t,r).then(function(t){var e=Object.keys(r._attachments);return t.forEach(function(t,n){var o=r._attachments[e[n]];delete o.stub,delete o.length,o.data=t}),r}):r}))})).then(function(t){l=l.concat(B(t).filter(Boolean))})})}function i(t){return t._attachments&&Object.keys(t._attachments).length>0}function s(t){return t._conflicts&&t._conflicts.length>0}function a(e){return t.allDocs({keys:e,include_docs:!0,conflicts:!0}).then(function(t){if(r.cancelled)throw new Error("cancelled");t.rows.forEach(function(t){t.deleted||!t.doc||!Fr(t.value.rev)||i(t.doc)||s(t.doc)||(t.doc._conflicts&&delete t.doc._conflicts,l.push(t.doc),delete n[t.id])})})}function u(){var t=Object.keys(n).filter(function(t){var e=n[t].missing;return 1===e.length&&Fr(e[0])});if(t.length>0)return a(t)}function f(){return{ok:d,docs:l}}n=c(n);var l=[],d=!0;return _o.resolve().then(u).then(o).then(f)}function Xr(t,e,n,r,o){return t.get(e)["catch"](function(n){if(404===n.status)return"http"!==t.adapter&&"https"!==t.adapter||T(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:e,history:[],replicator:us,version:cs};throw n}).then(function(i){if(!o.cancelled&&i.last_seq!==n)return i.history=(i.history||[]).filter(function(t){return t.session_id!==r}),i.history.unshift({last_seq:n,session_id:r}),i.history=i.history.slice(0,fs),i.version=cs,i.replicator=us,i.session_id=r,i.last_seq=n,t.put(i)["catch"](function(i){if(409===i.status)return Xr(t,e,n,r,o);throw i})})}function Vr(t,e,n,r,o){this.src=t,this.target=e,this.id=n,this.returnValue=r,this.opts=o}function Kr(t,e){return t.session_id===e.session_id?{last_seq:t.last_seq,history:t.history}:Wr(t.history,e.history)}function Wr(t,e){var n=t[0],r=t.slice(1),o=e[0],i=e.slice(1);if(!n||0===e.length)return{last_seq:ls,history:[]};var s=n.session_id;if(Gr(s,e))return{last_seq:n.last_seq,history:t};var a=o.session_id;return Gr(a,r)?{last_seq:o.last_seq,history:i}:Wr(r,i)}function Gr(t,e){var n=e[0],r=e.slice(1);return!(!t||0===e.length)&&(t===n.session_id||Gr(t,r))}function Qr(t){return"number"==typeof t.status&&4===Math.floor(t.status/100)}function Zr(t,e,n,r){if(t.retry===!1)return e.emit("error",n),void e.removeAllListeners();if("function"!=typeof t.back_off_function&&(t.back_off_function=C),e.emit("requestError",n),"active"===e.state||"pending"===e.state){e.emit("paused",n),e.state="stopped";var o=function(){t.current_back_off=hs},i=function(){e.removeListener("active",o)};e.once("paused",i),e.once("active",o)}t.current_back_off=t.current_back_off||hs,t.current_back_off=t.back_off_function(t.current_back_off),setTimeout(r,t.current_back_off)}function to(t){return Object.keys(t).sort(Yt).reduce(function(e,n){return e[n]=t[n],e},{})}function eo(t,e,n){var r=n.doc_ids?n.doc_ids.sort(Yt):"",o=n.filter?n.filter.toString():"",i="",s="",a="";return n.selector&&(a=JSON.stringify(n.selector)),n.filter&&n.query_params&&(i=JSON.stringify(to(n.query_params))),n.filter&&"_view"===n.filter&&(s=n.view.toString()),_o.all([t.id(),e.id()]).then(function(t){var e=t[0]+t[1]+o+s+i+r+a;return new _o(function(t){He(e,t)})}).then(function(t){return t=t.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+t})}function no(t,e,n,r,o){function i(){return E?_o.resolve():eo(t,e,n).then(function(o){k=o;var i={};i=n.checkpoint===!1?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===n.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},E=new Vr(t,e,k,r,i)})}function s(){if(P=[],0!==w.docs.length){var t=w.docs,i={timeout:n.timeout};return e.bulkDocs({docs:t,new_edits:!1},i).then(function(e){if(r.cancelled)throw p(),new Error("cancelled");var n=Object.create(null);e.forEach(function(t){t.error&&(n[t.id]=t)});var i=Object.keys(n).length;o.doc_write_failures+=i,o.docs_written+=t.length-i,t.forEach(function(t){var e=n[t._id];if(e){if(o.errors.push(e),"unauthorized"!==e.name&&"forbidden"!==e.name)throw e;r.emit("denied",c(e))}else P.push(t)})},function(e){throw o.doc_write_failures+=t.length,e})}}function a(){if(w.error)throw new Error("There was a problem getting docs.");o.last_seq=T=w.seq;var t=c(o);return P.length&&(t.docs=P,r.emit("change",t)),S=!0,E.writeCheckpoint(w.seq,U).then(function(){if(S=!1,r.cancelled)throw p(),new Error("cancelled");w=void 0,m()})["catch"](function(t){throw b(t),t})}function u(){var t={};return w.changes.forEach(function(e){"_user/"!==e.id&&(t[e.id]=e.changes.map(function(t){return t.rev}))}),e.revsDiff(t).then(function(t){if(r.cancelled)throw p(),new Error("cancelled");w.diffs=t})}function f(){return Yr(t,e,w.diffs,r).then(function(t){w.error=!t.ok,t.docs.forEach(function(t){delete w.diffs[t._id],o.docs_read++,w.docs.push(t)})})}function l(){if(!r.cancelled&&!w){if(0===x.length)return void d(!0);w=x.shift(),u().then(f).then(s).then(a).then(l)["catch"](function(t){h("batch processing terminated with error",t)})}}function d(t){return 0===A.changes.length?void(0!==x.length||w||((O&&M.live||j)&&(r.state="pending",r.emit("paused")),j&&p())):void((t||j||A.changes.length>=q)&&(x.push(A),A={seq:0,changes:[],docs:[]},"pending"!==r.state&&"stopped"!==r.state||(r.state="active",r.emit("active")),l()))}function h(t,e){C||(e.message||(e.message=t),o.ok=!1,o.status="aborting",x=[],A={seq:0,changes:[],docs:[]},p(e))}function p(i){C||r.cancelled&&(o.status="cancelled",S)||(o.status=o.status||"complete",o.end_time=new Date,o.last_seq=T,C=!0,i?(i=R(i),i.result=o,"unauthorized"===i.name||"forbidden"===i.name?(r.emit("error",i),r.removeAllListeners()):Zr(n,r,i,function(){no(t,e,n,r)})):(r.emit("complete",o),r.removeAllListeners()))}function v(t){if(r.cancelled)return p();var e=I(n)(t);e&&(A.seq=t.seq,A.changes.push(t),d(0===x.length&&M.live))}function y(t){if(B=!1,r.cancelled)return p();if(t.results.length>0)M.since=t.last_seq,m(),d(!0);else{var e=function(){O?(M.live=!0,m()):j=!0,d(!0)};w||0!==t.results.length?e():(S=!0,E.writeCheckpoint(t.last_seq,U).then(function(){S=!1,o.last_seq=T=t.last_seq,e()})["catch"](b))}}function g(t){return B=!1,r.cancelled?p():void h("changes rejected",t)}function m(){function e(){i.cancel()}function o(){r.removeListener("cancel",e)}if(!B&&!j&&x.length<D){B=!0,r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",e);var i=t.changes(M).on("change",v);i.then(o,o),i.then(y)["catch"](g),n.retry&&(r._changes=i,r._abortChanges=e)}}function _(){i().then(function(){return r.cancelled?void p():E.getCheckpoint().then(function(t){T=t,M={since:T,limit:q,batch_size:q,style:"all_docs",doc_ids:N,selector:L,return_docs:!0},n.filter&&("string"!=typeof n.filter?M.include_docs=!0:M.filter=n.filter),"heartbeat"in n&&(M.heartbeat=n.heartbeat),"timeout"in n&&(M.timeout=n.timeout),n.query_params&&(M.query_params=n.query_params),n.view&&(M.view=n.view),m()})})["catch"](function(t){h("getCheckpoint rejected with ",t)})}function b(t){S=!1,h("writeCheckpoint completed with error",t)}var w,k,E,x=[],A={seq:0,changes:[],docs:[]},S=!1,j=!1,C=!1,T=0,O=n.continuous||n.live||!1,q=n.batch_size||100,D=n.batches_limit||10,B=!1,N=n.doc_ids,L=n.selector,P=[],U=Go();o=o||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var M={};return r.ready(t,e),r.cancelled?void p():(r._addedListeners||(r.once("cancel",p),"function"==typeof n.complete&&(r.once("error",n.complete),r.once("complete",function(t){n.complete(null,t)})),r._addedListeners=!0),void("undefined"==typeof n.since?_():i().then(function(){return S=!0,E.writeCheckpoint(n.since,U)}).then(function(){return S=!1,r.cancelled?void p():(T=n.since,void _())})["catch"](b)))}function ro(){ho.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var t=this,e=new _o(function(e,n){t.once("complete",e),t.once("error",n)});t.then=function(t,n){return e.then(t,n)},t["catch"]=function(t){return e["catch"](t)},t["catch"](function(){})}function oo(t,e){var n=e.PouchConstructor;return"string"==typeof t?new n(t,e):t}function io(t,e,n,r){if("function"==typeof n&&(r=n,n={}),"undefined"==typeof n&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw R(Mo,"`doc_ids` filter parameter is not a list.");n.complete=r,n=c(n),n.continuous=n.continuous||n.live,n.retry="retry"in n&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var o=new ro(n),i=oo(t,n),s=oo(e,n);return no(i,s,n,o),o}function so(t,e,n,r){return"function"==typeof n&&(r=n,n={}),"undefined"==typeof n&&(n={}),n=c(n),n.PouchConstructor=n.PouchConstructor||this,t=oo(t,n),e=oo(e,n),new ao(t,e,n,r)}function ao(t,e,n,r){function o(t){p.emit("change",{direction:"pull",change:t})}function i(t){p.emit("change",{direction:"push",change:t})}function s(t){p.emit("denied",{direction:"push",doc:t})}function a(t){p.emit("denied",{direction:"pull",doc:t})}function c(){p.pushPaused=!0,p.pullPaused&&p.emit("paused")}function u(){p.pullPaused=!0,p.pushPaused&&p.emit("paused")}function f(){p.pushPaused=!1,p.pullPaused&&p.emit("active",{direction:"push"})}function l(){p.pullPaused=!1,p.pushPaused&&p.emit("active",{direction:"pull"})}function d(t){return function(e,n){var r="change"===e&&(n===o||n===i),d="denied"===e&&(n===a||n===s),h="paused"===e&&(n===u||n===c),v="active"===e&&(n===l||n===f);(r||d||h||v)&&(e in g||(g[e]={}),g[e][t]=!0,2===Object.keys(g[e]).length&&p.removeAllListeners(e))}}function h(t,e,n){t.listeners(e).indexOf(n)==-1&&t.on(e,n)}var p=this;this.canceled=!1;var v=n.push?Co({},n,n.push):n,y=n.pull?Co({},n,n.pull):n;this.push=io(t,e,v),this.pull=io(e,t,y),this.pushPaused=!0,this.pullPaused=!0;var g={};n.live&&(this.push.on("complete",p.pull.cancel.bind(p.pull)),this.pull.on("complete",p.push.cancel.bind(p.push))),this.on("newListener",function(t){"change"===t?(h(p.pull,"change",o),h(p.push,"change",i)):"denied"===t?(h(p.pull,"denied",a),h(p.push,"denied",s)):"active"===t?(h(p.pull,"active",l),h(p.push,"active",f)):"paused"===t&&(h(p.pull,"paused",u),h(p.push,"paused",c))}),this.on("removeListener",function(t){"change"===t?(p.pull.removeListener("change",o),p.push.removeListener("change",i)):"denied"===t?(p.pull.removeListener("denied",a),p.push.removeListener("denied",s)):"active"===t?(p.pull.removeListener("active",l),p.push.removeListener("active",f)):"paused"===t&&(p.pull.removeListener("paused",u),p.push.removeListener("paused",c))}),this.pull.on("removeListener",d("pull")),this.push.on("removeListener",d("push"));var m=_o.all([this.push,this.pull]).then(function(t){var e={push:t[0],pull:t[1]};return p.emit("complete",e),r&&r(null,e),p.removeAllListeners(),e},function(t){if(p.cancel(),r?r(t):p.emit("error",t),p.removeAllListeners(),r)throw t});this.then=function(t,e){return m.then(t,e)},this["catch"]=function(t){return m["catch"](t)}}function co(t){t.replicate=io,t.sync=so,Object.defineProperty(t.prototype,"replicate",{get:function(){var t=this;return{from:function(e,n,r){return t.constructor.replicate(e,t,n,r)},to:function(e,n,r){return t.constructor.replicate(t,e,n,r)}}}}),t.prototype.sync=function(t,e,n){return this.constructor.sync(this,t,e,n)}}var uo=r(n(4)),fo=r(n(9)),lo=r(n(11)),ho=n(12),po=r(n(13)),vo=r(n(10)),yo=r(n(14)),go=r(n(17)),mo=r(n(18)),_o="function"==typeof Promise?Promise:fo,bo=Function.prototype.toString,wo=bo.call(Object);v.prototype.get=function(t){var e=h(t);return this._store[e]},v.prototype.set=function(t,e){var n=h(t);return this._store[n]=e,!0},v.prototype.has=function(t){var e=h(t);return e in this._store},v.prototype["delete"]=function(t){var e=h(t),n=e in this._store;return delete this._store[e],n},v.prototype.forEach=function(t){for(var e=Object.keys(this._store),n=0,r=e.length;n<r;n++){var o=e[n],i=this._store[o];o=p(o),t(i,o)}},Object.defineProperty(v.prototype,"size",{get:function(){return Object.keys(this._store).length}}),y.prototype.add=function(t){return this._store.set(t,!0)},y.prototype.has=function(t){return this._store.has(t)},y.prototype.forEach=function(t){this._store.forEach(function(e,n){t(n)})},Object.defineProperty(y.prototype,"size",{get:function(){return this._store.size}});var ko,Eo;g()?(ko=Set,Eo=Map):(ko=y,Eo=v);var xo,Ao=6;if(k())xo=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),xo=!!localStorage.getItem("_pouch_check_localstorage")}catch(So){xo=!1}po(A,ho.EventEmitter),A.prototype.addListener=function(t,e,n,r){function o(){function t(){s=!1}if(i._listeners[e]){if(s)return void(s="waiting");s=!0;var a=m(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);n.changes(a).on("change",function(t){t.seq>r.since&&!r.cancelled&&(r.since=t.seq,r.onChange(t))}).on("complete",function(){"waiting"===s&&vo(o),s=!1}).on("error",t)}}if(!this._listeners[e]){var i=this,s=!1;this._listeners[e]=o,this.on(t,o)}},A.prototype.removeListener=function(t,e){e in this._listeners&&(ho.EventEmitter.prototype.removeListener.call(this,t,this._listeners[e]),delete this._listeners[e])},A.prototype.notifyLocalWindows=function(t){k()?chrome.storage.local.set({dbName:t}):E()&&(localStorage[t]="a"===localStorage[t]?"b":"a")},A.prototype.notify=function(t){this.emit(t),this.notifyLocalWindows(t)};var jo;jo="function"==typeof Object.assign?Object.assign:function(t){for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e};var Co=jo;po(O,Error),O.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var To,Oo=(new O(401,"unauthorized","Name or password is incorrect."),new O(400,"bad_request","Missing JSON list of 'docs'")),Ro=new O(404,"not_found","missing"),qo=new O(409,"conflict","Document update conflict"),Do=new O(400,"bad_request","_id field must contain a string"),Io=new O(412,"missing_id","_id is required for puts"),Bo=new O(400,"bad_request","Only reserved document ids may start with underscore."),No=(new O(412,"precondition_failed","Database not open"),new O(500,"unknown_error","Database encountered an unknown error")),Lo=new O(500,"badarg","Some query argument is invalid"),Po=(new O(400,"invalid_request","Request was invalid"),new O(400,"query_parse_error","Some query parameter is invalid")),Uo=new O(500,"doc_validation","Bad special document member"),Mo=new O(400,"bad_request","Something wrong with the request"),Fo=new O(400,"bad_request","Document must be a JSON object"),$o=(new O(404,"not_found","Database not found"),new O(500,"indexed_db_went_bad","unknown")),Ho=new O(500,"web_sql_went_bad","unknown"),zo=(new O(500,"levelDB_went_went_bad","unknown"),new O(403,"forbidden","Forbidden by design doc validate_doc_update function"),new O(400,"bad_request","Invalid rev format")),Jo=(new O(412,"file_exists","The database could not be created, the file already exists."),new O(412,"missing_stub","A pre-existing attachment stub wasn't found")),Yo=(new O(413,"invalid_url","Provided URL is invalid"),N.name);To=Yo?function(t){return t.name}:function(t){return t.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]};var Xo=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Vo="queryKey",Ko=/(?:^|&)([^&=]*)=?([^&]*)/g,Wo=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Go=uo.v4;po(vt,ho.EventEmitter),vt.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},vt.prototype.validateChanges=function(t){var e=t.complete,n=this;Tt._changesFilterPlugin?Tt._changesFilterPlugin.validate(t,function(r){return r?e(r):void n.doChanges(t)}):n.doChanges(t)},vt.prototype.doChanges=function(t){var e=this,n=t.complete;if(t=c(t),"live"in t&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=yt,"latest"===t.since&&(t.since="now"),t.since||(t.since=0),"now"===t.since)return void this.db.info().then(function(r){return e.isCancelled?void n(null,{status:"cancelled"}):(t.since=r.update_seq,void e.doChanges(t))},n);if(Tt._changesFilterPlugin){if(Tt._changesFilterPlugin.normalize(t),Tt._changesFilterPlugin.shouldFilter(this,t))return Tt._changesFilterPlugin.filter(this,t)}else["doc_ids","filter","selector","view"].forEach(function(e){e in t&&S("warn",'The "'+e+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in t||(t.descending=!1),t.limit=0===t.limit?1:t.limit,t.complete=n;var r=this.db._changes(t);if(r&&"function"==typeof r.cancel){var o=e.cancel;e.cancel=lo(function(t){r.cancel(),o.apply(this,t)})}},po(At,ho.EventEmitter),At.prototype.post=d("post",function(t,e,n){return"function"==typeof e&&(n=e,e={}),"object"!=typeof t||Array.isArray(t)?n(R(Fo)):void this.bulkDocs({docs:[t]},e,mt(n,t._id))}),At.prototype.put=d("put",function(t,e,n){function r(){var n=t._rev.split("-"),r=n[1],o=parseInt(n[0],10),i=o+1,s=Y();t._revisions={start:i,ids:[s,r]},t._rev=i+"-"+s,e.new_edits=!1}function o(n){"function"==typeof i._put&&e.new_edits!==!1?i._put(t,e,n):i.bulkDocs({docs:[t]},e,mt(n,t._id))}if("function"==typeof e&&(n=e,e={}),"object"!=typeof t||Array.isArray(t))return n(R(Fo));if(L(t._id),dt(t._id)&&"function"==typeof this._putLocal)return t._deleted?this._removeLocal(t,n):this._putLocal(t,n);var i=this;e.force&&t._rev?(r(),o(function(e){var r=e?null:{ok:!0,id:t._id,rev:t._rev};n(e,r)})):o(n)}),At.prototype.putAttachment=d("putAttachment",function(t,e,n,r,o){function i(t){var n="_rev"in t?parseInt(t._rev,10):0;return t._attachments=t._attachments||{},t._attachments[e]={content_type:o,data:r,revpos:++n},s.put(t)}var s=this;return"function"==typeof o&&(o=r,r=n,n=null),"undefined"==typeof o&&(o=r,r=n,n=null),o||S("warn","Attachment",e,"on document",t,"is missing content_type"),s.get(t).then(function(t){if(t._rev!==n)throw R(qo);return i(t)},function(e){if(e.reason===Ro.message)return i({_id:t});throw e})}),At.prototype.removeAttachment=d("removeAttachment",function(t,e,n,r){var o=this;o.get(t,function(t,i){return t?void r(t):i._rev!==n?void r(R(qo)):i._attachments?(delete i._attachments[e],0===Object.keys(i._attachments).length&&delete i._attachments,void o.put(i,r)):r()})}),At.prototype.remove=d("remove",function(t,e,n,r){var o;"string"==typeof e?(o={_id:t,_rev:e},"function"==typeof n&&(r=n,n={})):(o=t,"function"==typeof e?(r=e,n={}):(r=n,n=e)),n=n||{},n.was_delete=!0;var i={_id:o._id,_rev:o._rev||n.rev};return i._deleted=!0,dt(i._id)&&"function"==typeof this._removeLocal?this._removeLocal(o,r):void this.bulkDocs({docs:[i]},n,mt(r,i._id))}),At.prototype.revsDiff=d("revsDiff",function(t,e,n){function r(t,e){a.has(t)||a.set(t,{missing:[]}),a.get(t).missing.push(e)}function o(e,n){var o=t[e].slice(0);V(n,function(t,n,i,s,a){var c=n+"-"+i,u=o.indexOf(c);u!==-1&&(o.splice(u,1),"available"!==a.status&&r(e,c))}),o.forEach(function(t){r(e,t)})}"function"==typeof e&&(n=e,e={});var i=Object.keys(t);if(!i.length)return n(null,{});var s=0,a=new Eo;i.map(function(e){this._getRevisionTree(e,function(r,c){if(r&&404===r.status&&"missing"===r.message)a.set(e,{missing:t[e]});else{if(r)return n(r);o(e,c)}if(++s===i.length){var u={};return a.forEach(function(t,e){u[e]=t}),n(null,u)}})},this)}),At.prototype.bulkGet=d("bulkGet",function(t,e){w(this,t,e)}),At.prototype.compactDocument=d("compactDocument",function(t,e,n){var r=this;this._getRevisionTree(t,function(o,i){if(o)return n(o);var s=wt(i),a=[],c=[];Object.keys(s).forEach(function(t){s[t]>e&&a.push(t)}),V(i,function(t,e,n,r,o){var i=e+"-"+n;"available"===o.status&&a.indexOf(i)!==-1&&c.push(i)}),r._doCompaction(t,c,n)})}),At.prototype.compact=d("compact",function(t,e){"function"==typeof t&&(e=t,t={});var n=this;t=t||{},n._compactionQueue=n._compactionQueue||[],n._compactionQueue.push({opts:t,callback:e}),1===n._compactionQueue.length&&Et(n)}),At.prototype._compact=function(t,e){function n(t){s.push(o.compactDocument(t.id,0))}function r(t){var n=t.last_seq;_o.all(s).then(function(){return z(o,"_local/compaction",function(t){return(!t.last_seq||t.last_seq<n)&&(t.last_seq=n,t)})}).then(function(){e(null,{ok:!0})})["catch"](e)}var o=this,i={return_docs:!1,last_seq:t.last_seq||0},s=[];o.changes(i).on("change",n).on("complete",r).on("error",e)},At.prototype.get=d("get",function(t,e,n){function r(){var r=[],s=o.length;return s?void o.forEach(function(o){i.get(t,{rev:o,revs:e.revs,latest:e.latest,attachments:e.attachments},function(t,e){if(t)r.push({missing:o});else{for(var i,a=0,c=r.length;a<c;a++)if(r[a].ok&&r[a].ok._rev===e._rev){i=!0;break}i||r.push({ok:e})}s--,s||n(null,r)})}):n(null,r)}if("function"==typeof e&&(n=e,e={}),"string"!=typeof t)return n(R(Do));if(dt(t)&&"function"==typeof this._getLocal)return this._getLocal(t,n);var o=[],i=this;if(!e.open_revs)return this._get(t,e,function(r,o){if(r)return r.docId=t,n(r);var s=o.doc,a=o.metadata,c=o.ctx;if(e.conflicts){var u=G(a);u.length&&(s._conflicts=u)}if(lt(a,s._rev)&&(s._deleted=!0),
e.revs||e.revs_info){for(var f=s._rev.split("-"),l=parseInt(f[0],10),d=f[1],h=Z(a.rev_tree),p=null,v=0;v<h.length;v++){var y=h[v],g=y.ids.map(function(t){return t.id}).indexOf(d),m=g===l-1;(m||!p&&g!==-1)&&(p=y)}var _=p.ids.map(function(t){return t.id}).indexOf(s._rev.split("-")[1])+1,b=p.ids.length-_;if(p.ids.splice(_,b),p.ids.reverse(),e.revs&&(s._revisions={start:p.pos+p.ids.length-1,ids:p.ids.map(function(t){return t.id})}),e.revs_info){var w=p.pos+p.ids.length;s._revs_info=p.ids.map(function(t){return w--,{rev:w+"-"+t.id,status:t.opts.status}})}}if(e.attachments&&s._attachments){var k=s._attachments,E=Object.keys(k).length;if(0===E)return n(null,s);Object.keys(k).forEach(function(t){this._getAttachment(s._id,t,k[t],{rev:s._rev,binary:e.binary,ctx:c},function(e,r){var o=s._attachments[t];o.data=r,delete o.stub,delete o.length,--E||n(null,s)})},i)}else{if(s._attachments)for(var x in s._attachments)s._attachments.hasOwnProperty(x)&&(s._attachments[x].stub=!0);n(null,s)}});if("all"===e.open_revs)this._getRevisionTree(t,function(t,e){return t?n(t):(o=W(e).map(function(t){return t.rev}),void r())});else{if(!Array.isArray(e.open_revs))return n(R(No,"function_clause"));o=e.open_revs;for(var s=0;s<o.length;s++){var a=o[s];if("string"!=typeof a||!/^\d+-/.test(a))return n(R(zo))}r()}}),At.prototype.getAttachment=d("getAttachment",function(t,e,n,r){var o=this;n instanceof Function&&(r=n,n={}),this._get(t,n,function(i,s){return i?r(i):s.doc._attachments&&s.doc._attachments[e]?(n.ctx=s.ctx,n.binary=!0,o._getAttachment(t,e,s.doc._attachments[e],n,r),void 0):r(R(Ro))})}),At.prototype.allDocs=d("allDocs",function(t,e){if("function"==typeof t&&(e=t,t={}),t.skip="undefined"!=typeof t.skip?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return e(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(e){return e in t})[0];if(n)return void e(R(Po,"Query parameter `"+n+"` is not compatible with multi-get"));if(!P(this))return kt(this,t,e)}return this._allDocs(t,e)}),At.prototype.changes=function(t,e){return"function"==typeof t&&(e=t,t={}),new vt(this,t,e)},At.prototype.close=d("close",function(t){return this._closed=!0,this.emit("closed"),this._close(t)}),At.prototype.info=d("info",function(t){var e=this;this._info(function(n,r){return n?t(n):(r.db_name=r.db_name||e.name,r.auto_compaction=!(!e.auto_compaction||P(e)),r.adapter=e.adapter,void t(null,r))})}),At.prototype.id=d("id",function(t){return this._id(t)}),At.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},At.prototype.bulkDocs=d("bulkDocs",function(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e||{},Array.isArray(t)&&(t={docs:t}),!t||!t.docs||!Array.isArray(t.docs))return n(R(Oo));for(var r=0;r<t.docs.length;++r)if("object"!=typeof t.docs[r]||Array.isArray(t.docs[r]))return n(R(Fo));var o;if(t.docs.forEach(function(t){t._attachments&&Object.keys(t._attachments).forEach(function(e){o=o||xt(e),t._attachments[e].content_type||S("warn","Attachment",e,"on document",t._id,"is missing content_type")})}),o)return n(R(Mo,o));"new_edits"in e||("new_edits"in t?e.new_edits=t.new_edits:e.new_edits=!0);var i=this;e.new_edits||P(i)||t.docs.sort(bt),_t(t.docs);var s=t.docs.map(function(t){return t._id});return this._bulkDocs(t,e,function(t,r){if(t)return n(t);if(e.new_edits||(r=r.filter(function(t){return t.error})),!P(i))for(var o=0,a=r.length;o<a;o++)r[o].id=r[o].id||s[o];n(null,r)})}),At.prototype.registerDependentDatabase=d("registerDependentDatabase",function(t,e){function n(e){return e.dependentDbs=e.dependentDbs||{},!e.dependentDbs[t]&&(e.dependentDbs[t]=!0,e)}var r=new this.constructor(t,this.__opts);z(this,"_local/_pouch_dependentDbs",n).then(function(){e(null,{db:r})})["catch"](e)}),At.prototype.destroy=d("destroy",function(t,e){function n(){r._destroy(t,function(t,n){return t?e(t):(r._destroyed=!0,r.emit("destroyed"),void e(null,n||{ok:!0}))})}"function"==typeof t&&(e=t,t={});var r=this,o=!("use_prefix"in r)||r.use_prefix;return P(r)?n():void r.get("_local/_pouch_dependentDbs",function(t,i){if(t)return 404!==t.status?e(t):n();var s=i.dependentDbs,a=r.constructor,c=Object.keys(s).map(function(t){var e=o?t.replace(new RegExp("^"+a.prefix),""):t;return new a(e,r.__opts).destroy()});_o.all(c).then(n,e)})}),St.prototype.execute=function(){var t;if(this.failed)for(;t=this.queue.shift();)t(this.failed);else for(;t=this.queue.shift();)t()},St.prototype.fail=function(t){this.failed=t,this.execute()},St.prototype.ready=function(t){this.isReady=!0,this.db=t,this.execute()},St.prototype.addTask=function(t){this.queue.push(t),this.failed&&this.execute()},po(Tt,At),Tt.adapters={},Tt.preferredAdapters=[],Tt.prefix="_pouch_";var Qo=new ho.EventEmitter;Ot(Tt),Tt.adapter=function(t,e,n){e.valid()&&(Tt.adapters[t]=e,n&&Tt.preferredAdapters.push(t))},Tt.plugin=function(t){if("function"==typeof t)t(Tt);else{if("object"!=typeof t||0===Object.keys(t).length)throw new Error('Invalid plugin: got "'+t+'", expected an object or a function');Object.keys(t).forEach(function(e){Tt.prototype[e]=t[e]})}return this.__defaults&&(Tt.__defaults=Co({},this.__defaults)),Tt},Tt.defaults=function(t){function e(t,n){return this instanceof e?(n=n||{},t&&"object"==typeof t&&(n=t,t=n.name,delete n.name),n=Co({},e.__defaults,n),void Tt.call(this,t,n)):new e(t,n)}return po(e,Tt),e.preferredAdapters=Tt.preferredAdapters.slice(),Object.keys(Tt).forEach(function(t){t in e||(e[t]=Tt[t])}),e.__defaults=Co({},this.__defaults,t),e};var Zo="6.3.4",ti=["$or","$nor","$not"],ei=-324,ni=3,ri="",oi={$elemMatch:function(t,e,n,r){return!!Array.isArray(r)&&(0!==r.length&&("object"==typeof r[0]?r.some(function(t){return se(t,e,Object.keys(e))}):r.some(function(r){return ae(e,t,n,r)})))},$allMatch:function(t,e,n,r){return!!Array.isArray(r)&&(0!==r.length&&("object"==typeof r[0]?r.every(function(t){return se(t,e,Object.keys(e))}):r.every(function(r){return ae(e,t,n,r)})))},$eq:function(t,e,n,r){return le(r)&&0===Yt(r,e)},$gte:function(t,e,n,r){return le(r)&&Yt(r,e)>=0},$gt:function(t,e,n,r){return le(r)&&Yt(r,e)>0},$lte:function(t,e,n,r){return le(r)&&Yt(r,e)<=0},$lt:function(t,e,n,r){return le(r)&&Yt(r,e)<0},$exists:function(t,e,n,r){return e?le(r):!le(r)},$mod:function(t,e,n,r){return fe(r)&&de(r,e)},$ne:function(t,e,n,r){return e.every(function(t){return 0!==Yt(r,t)})},$in:function(t,e,n,r){return fe(r)&&he(r,e)},$nin:function(t,e,n,r){return fe(r)&&!he(r,e)},$size:function(t,e,n,r){return fe(r)&&ve(r,e)},$all:function(t,e,n,r){return Array.isArray(r)&&pe(r,e)},$regex:function(t,e,n,r){return fe(r)&&ye(r,e)},$type:function(t,e,n,r){return ge(r,e)}};Tt.plugin(Rt),Tt.plugin(Ae),Tt.version=Zo;var ii,si=Se(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),ai=Se(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),ci=function(t){return atob(t)},ui=function(t){return btoa(t)},fi=e.setImmediate||e.setTimeout,li=32768,di=5,hi="document-store",pi="by-sequence",vi="attach-store",yi="attach-seq-store",gi="meta-store",mi="local-store",_i="detect-blob-support",bi=new A,wi=!1,ki=[],Ei=new Eo,xi=new Eo;kn.valid=function(){var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return!t&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var Ai=function(t){t.adapter("idb",kn,!0)},Si=7,ji=On("document-store"),Ci=On("by-sequence"),Ti=On("attach-store"),Oi=On("local-store"),Ri=On("metadata-store"),qi=On("attach-seq-store"),Di=new Eo,Ii=new A,Bi=1,Ni="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+Ci+" (seq, deleted)",Li="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+Ci+" (doc_id, rev)",Pi="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+ji+" (winningseq)",Ui="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+qi+" (seq)",Mi="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+qi+" (digest, seq)",Fi=Ci+".seq = "+ji+".winningseq",$i=Ci+".seq AS seq, "+Ci+".deleted AS deleted, "+Ci+".json AS data, "+Ci+".rev AS rev, "+ji+".json AS metadata";Wn.valid=Vn,Wn.use_prefix=!0;var Hi=function(t){t.adapter("websql",Wn,!0)},zi=tr(),Ji=function(){},Yi=25,Xi=50,Vi=5e3,Ki=1e4,Wi={};pr.valid=function(){return!0};var Gi=function(t){t.adapter("http",pr,!1),t.adapter("https",pr,!1)};po(vr,Error),po(yr,Error),po(gr,Error);var Qi=S.bind(null,"log"),Zi=Array.isArray,ts=JSON.parse;jr.prototype.add=function(t){return this.promise=this.promise["catch"](function(){}).then(function(){return t()}),this.promise},jr.prototype.finish=function(){return this.promise};var es={},ns=new jr,rs=50,os={_sum:function(t,e){return Ar(e)},_count:function(t,e){return e.length},_stats:function(t,e){function n(t){for(var e=0,n=0,r=t.length;n<r;n++){var o=t[n];e+=o*o}return e}return{sum:Ar(e),min:Math.min.apply(null,e),max:Math.max.apply(null,e),count:e.length,sumsqr:n(e)}}},is="mrviews",ss=Ir(is,Nr,Lr,Pr),as={query:Ur,viewCleanup:Mr},cs=1,us="pouchdb",fs=5,ls=0;Vr.prototype.writeCheckpoint=function(t,e){var n=this;return this.updateTarget(t,e).then(function(){return n.updateSource(t,e)})},Vr.prototype.updateTarget=function(t,e){return this.opts.writeTargetCheckpoint?Xr(this.target,this.id,t,e,this.returnValue):_o.resolve(!0)},Vr.prototype.updateSource=function(t,e){if(this.opts.writeSourceCheckpoint){var n=this;return this.readOnlySource?_o.resolve(!0):Xr(this.src,this.id,t,e,this.returnValue)["catch"](function(t){if(Qr(t))return n.readOnlySource=!0,!0;throw t})}return _o.resolve(!0)};var ds={undefined:function(t,e){return 0===Yt(t.last_seq,e.last_seq)?e.last_seq:0},1:function(t,e){return Kr(e,t).last_seq}};Vr.prototype.getCheckpoint=function(){var t=this;return t.target.get(t.id).then(function(e){return t.readOnlySource?_o.resolve(e.last_seq):t.src.get(t.id).then(function(t){if(e.version!==t.version)return ls;var n;return n=e.version?e.version.toString():"undefined",n in ds?ds[n](e,t):ls},function(n){if(404===n.status&&e.last_seq)return t.src.put({_id:t.id,last_seq:ls}).then(function(){return ls},function(n){return Qr(n)?(t.readOnlySource=!0,e.last_seq):ls});throw n})})["catch"](function(t){if(404!==t.status)throw t;return ls})};var hs=0;po(ro,ho.EventEmitter),ro.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},ro.prototype.ready=function(t,e){function n(){o.cancel()}function r(){t.removeListener("destroyed",n),e.removeListener("destroyed",n)}var o=this;o._readyCalled||(o._readyCalled=!0,t.once("destroyed",n),e.once("destroyed",n),o.once("complete",r))},po(ao,ho.EventEmitter),ao.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},Tt.plugin(Ai).plugin(Hi).plugin(Gi).plugin(as).plugin(co),t.exports=Tt}).call(e,function(){return this}())},function(t,e,n){var r=n(5),o=n(8),i=o;i.v1=r,i.v4=o,t.exports=i},function(t,e,n){function r(t,e,n){var r=e&&n||0,o=e||[];t=t||{};var s=void 0!==t.clockseq?t.clockseq:c,l=void 0!==t.msecs?t.msecs:(new Date).getTime(),d=void 0!==t.nsecs?t.nsecs:f+1,h=l-u+(d-f)/1e4;if(h<0&&void 0===t.clockseq&&(s=s+1&16383),(h<0||l>u)&&void 0===t.nsecs&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=l,f=d,c=s,l+=122192928e5;var p=(1e4*(268435455&l)+d)%4294967296;o[r++]=p>>>24&255,o[r++]=p>>>16&255,o[r++]=p>>>8&255,o[r++]=255&p;var v=l/4294967296*1e4&268435455;o[r++]=v>>>8&255,o[r++]=255&v,o[r++]=v>>>24&15|16,o[r++]=v>>>16&255,o[r++]=s>>>8|128,o[r++]=255&s;for(var y=t.node||a,g=0;g<6;++g)o[r+g]=y[g];return e?e:i(o)}var o=n(6),i=n(7),s=o(),a=[1|s[0],s[1],s[2],s[3],s[4],s[5]],c=16383&(s[6]<<8|s[7]),u=0,f=0;t.exports=r},function(t,e){(function(e){var n,r=e.crypto||e.msCrypto;if(r&&r.getRandomValues){var o=new Uint8Array(16);n=function(){return r.getRandomValues(o),o}}if(!n){var i=new Array(16);n=function(){for(var t,e=0;e<16;e++)0===(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}t.exports=n}).call(e,function(){return this}())},function(t,e){function n(t,e){var n=e||0,o=r;return o[t[n++]]+o[t[n++]]+o[t[n++]]+o[t[n++]]+"-"+o[t[n++]]+o[t[n++]]+"-"+o[t[n++]]+o[t[n++]]+"-"+o[t[n++]]+o[t[n++]]+"-"+o[t[n++]]+o[t[n++]]+o[t[n++]]+o[t[n++]]+o[t[n++]]+o[t[n++]]}for(var r=[],o=0;o<256;++o)r[o]=(o+256).toString(16).substr(1);t.exports=n},function(t,e,n){function r(t,e,n){var r=e&&n||0;"string"==typeof t&&(e="binary"==t?new Array(16):null,t=null),t=t||{};var s=t.random||(t.rng||o)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e)for(var a=0;a<16;++a)e[r+a]=s[a];return e||i(s)}var o=n(6),i=n(7);t.exports=r},function(t,e,n){"use strict";function r(){}function o(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,t!==r&&c(this,t)}function i(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function s(t,e,n){p(function(){var r;try{r=e(n)}catch(o){return v.reject(t,o)}r===t?v.reject(t,new TypeError("Cannot resolve promise with itself")):v.resolve(t,r)})}function a(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function c(t,e){function n(e){i||(i=!0,v.reject(t,e))}function r(e){i||(i=!0,v.resolve(t,e))}function o(){e(r,n)}var i=!1,s=u(o);"error"===s.status&&n(s.value)}function u(t,e){var n={};try{n.value=t(e),n.status="success"}catch(r){n.status="error",n.value=r}return n}function f(t){return t instanceof this?t:v.resolve(new this(r),t)}function l(t){var e=new this(r);return v.reject(e,t)}function d(t){function e(t,e){function r(t){s[e]=t,++a!==o||i||(i=!0,v.resolve(u,s))}n.resolve(t).then(r,function(t){i||(i=!0,v.reject(u,t))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var o=t.length,i=!1;if(!o)return this.resolve([]);for(var s=new Array(o),a=0,c=-1,u=new this(r);++c<o;)e(t[c],c);return u}function h(t){function e(t){n.resolve(t).then(function(t){i||(i=!0,v.resolve(a,t))},function(t){i||(i=!0,v.reject(a,t))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var o=t.length,i=!1;if(!o)return this.resolve([]);for(var s=-1,a=new this(r);++s<o;)e(t[s]);return a}var p=n(10),v={},y=["REJECTED"],g=["FULFILLED"],m=["PENDING"];t.exports=o,o.prototype["catch"]=function(t){return this.then(null,t)},o.prototype.then=function(t,e){if("function"!=typeof t&&this.state===g||"function"!=typeof e&&this.state===y)return this;var n=new this.constructor(r);if(this.state!==m){var o=this.state===g?t:e;s(n,o,this.outcome)}else this.queue.push(new i(n,t,e));return n},i.prototype.callFulfilled=function(t){v.resolve(this.promise,t)},i.prototype.otherCallFulfilled=function(t){s(this.promise,this.onFulfilled,t)},i.prototype.callRejected=function(t){v.reject(this.promise,t)},i.prototype.otherCallRejected=function(t){s(this.promise,this.onRejected,t)},v.resolve=function(t,e){var n=u(a,e);if("error"===n.status)return v.reject(t,n.value);var r=n.value;if(r)c(t,r);else{t.state=g,t.outcome=e;for(var o=-1,i=t.queue.length;++o<i;)t.queue[o].callFulfilled(e)}return t},v.reject=function(t,e){t.state=y,t.outcome=e;for(var n=-1,r=t.queue.length;++n<r;)t.queue[n].callRejected(e);return t},o.resolve=f,o.reject=l,o.all=d,o.race=h},function(t,e){(function(e){"use strict";function n(){f=!0;for(var t,e,n=l.length;n;){for(e=l,l=[],t=-1;++t<n;)e[t]();n=l.length}f=!1}function r(t){1!==l.push(t)||f||o()}var o,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var s=0,a=new i(n),c=e.document.createTextNode("");a.observe(c,{characterData:!0}),o=function(){c.data=s=++s%2}}else if(e.setImmediate||"undefined"==typeof e.MessageChannel)o="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};else{var u=new e.MessageChannel;u.port1.onmessage=n,o=function(){u.port2.postMessage(0)}}var f,l=[];t.exports=r}).call(e,function(){return this}())},function(t,e){"use strict";function n(t){return function(){var e=arguments.length;if(e){for(var n=[],r=-1;++r<e;)n[r]=arguments[r];return t.call(this,n)}return t.call(this,[])}}t.exports=n},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function o(t){return"number"==typeof t}function i(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!o(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,o,a,c,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var f=new Error('Uncaught, unspecified "error" event. ('+e+")");throw f.context=e,f}if(n=this._events[t],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(i(n))for(a=Array.prototype.slice.call(arguments,1),u=n.slice(),o=u.length,c=0;c<o;c++)u[c].apply(this,a);return!0},n.prototype.addListener=function(t,e){var o;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(o=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[t].length>o&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),o||(o=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var o=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,o,s,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],s=n.length,o=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(n)){for(a=s;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){o=a;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e,n){(function(r){function o(){return!("undefined"==typeof window||!window||"undefined"==typeof window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document&&"WebkitAppearance"in document.documentElement.style||"undefined"!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function i(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),n){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var o=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(i=o))}),t.splice(i,0,r)}}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(n){}}function c(){var t;try{t=e.storage.debug}catch(n){}return!t&&"undefined"!=typeof r&&"env"in r&&(t=r.env.DEBUG),t}function u(){try{return window.localStorage}catch(t){}}e=t.exports=n(15),e.log=s,e.formatArgs=i,e.save=a,e.load=c,e.useColors=o,e.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:u(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},e.enable(c())}).call(e,n(1))},function(t,e,n){function r(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}function o(t){function n(){if(n.enabled){var t=n,r=+new Date,o=r-(u||r);t.diff=o,t.prev=u,t.curr=r,u=r;for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];i[0]=e.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var a=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;a++;var o=e.formatters[r];if("function"==typeof o){var s=i[a];n=o.call(t,s),i.splice(a,1),a--}return n}),e.formatArgs.call(t,i);var c=n.log||e.log||console.log.bind(console);c.apply(t,i)}}return n.namespace=t,n.enabled=e.enabled(t),n.useColors=e.useColors(),n.color=r(t),"function"==typeof e.init&&e.init(n),n}function i(t){e.save(t),e.names=[],e.skips=[];for(var n=("string"==typeof t?t:"").split(/[\s,]+/),r=n.length,o=0;o<r;o++)n[o]&&(t=n[o].replace(/\*/g,".*?"),"-"===t[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function s(){e.enable("")}function a(t){var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1}function c(t){return t instanceof Error?t.stack||t.message:t}e=t.exports=o.debug=o["default"]=o,e.coerce=c,e.disable=s,e.enable=i,e.enabled=a,e.humanize=n(16),e.names=[],e.skips=[],e.formatters={};var u},function(t,e){function n(t){if(t=String(t),!(t.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*f;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function r(t){return t>=u?Math.round(t/u)+"d":t>=c?Math.round(t/c)+"h":t>=a?Math.round(t/a)+"m":t>=s?Math.round(t/s)+"s":t+"ms"}function o(t){return i(t,u,"day")||i(t,c,"hour")||i(t,a,"minute")||i(t,s,"second")||t+" ms"}function i(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var s=1e3,a=60*s,c=60*a,u=24*c,f=365.25*u;t.exports=function(t,e){e=e||{};var i=typeof t;if("string"===i&&t.length>0)return n(t);if("number"===i&&isNaN(t)===!1)return e["long"]?o(t):r(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){!function(e){t.exports=e()}(function(t){"use strict";function e(t,e){var n=t[0],r=t[1],o=t[2],i=t[3];n+=(r&o|~r&i)+e[0]-680876936|0,n=(n<<7|n>>>25)+r|0,i+=(n&r|~n&o)+e[1]-389564586|0,i=(i<<12|i>>>20)+n|0,o+=(i&n|~i&r)+e[2]+606105819|0,o=(o<<17|o>>>15)+i|0,r+=(o&i|~o&n)+e[3]-1044525330|0,r=(r<<22|r>>>10)+o|0,n+=(r&o|~r&i)+e[4]-176418897|0,n=(n<<7|n>>>25)+r|0,i+=(n&r|~n&o)+e[5]+1200080426|0,i=(i<<12|i>>>20)+n|0,o+=(i&n|~i&r)+e[6]-1473231341|0,o=(o<<17|o>>>15)+i|0,r+=(o&i|~o&n)+e[7]-45705983|0,r=(r<<22|r>>>10)+o|0,n+=(r&o|~r&i)+e[8]+1770035416|0,n=(n<<7|n>>>25)+r|0,i+=(n&r|~n&o)+e[9]-1958414417|0,i=(i<<12|i>>>20)+n|0,o+=(i&n|~i&r)+e[10]-42063|0,o=(o<<17|o>>>15)+i|0,r+=(o&i|~o&n)+e[11]-1990404162|0,r=(r<<22|r>>>10)+o|0,n+=(r&o|~r&i)+e[12]+1804603682|0,n=(n<<7|n>>>25)+r|0,i+=(n&r|~n&o)+e[13]-40341101|0,i=(i<<12|i>>>20)+n|0,o+=(i&n|~i&r)+e[14]-1502002290|0,o=(o<<17|o>>>15)+i|0,r+=(o&i|~o&n)+e[15]+1236535329|0,r=(r<<22|r>>>10)+o|0,n+=(r&i|o&~i)+e[1]-165796510|0,n=(n<<5|n>>>27)+r|0,i+=(n&o|r&~o)+e[6]-1069501632|0,i=(i<<9|i>>>23)+n|0,o+=(i&r|n&~r)+e[11]+643717713|0,o=(o<<14|o>>>18)+i|0,r+=(o&n|i&~n)+e[0]-373897302|0,r=(r<<20|r>>>12)+o|0,n+=(r&i|o&~i)+e[5]-701558691|0,n=(n<<5|n>>>27)+r|0,i+=(n&o|r&~o)+e[10]+38016083|0,i=(i<<9|i>>>23)+n|0,o+=(i&r|n&~r)+e[15]-660478335|0,o=(o<<14|o>>>18)+i|0,r+=(o&n|i&~n)+e[4]-405537848|0,r=(r<<20|r>>>12)+o|0,n+=(r&i|o&~i)+e[9]+568446438|0,n=(n<<5|n>>>27)+r|0,i+=(n&o|r&~o)+e[14]-1019803690|0,i=(i<<9|i>>>23)+n|0,o+=(i&r|n&~r)+e[3]-187363961|0,o=(o<<14|o>>>18)+i|0,r+=(o&n|i&~n)+e[8]+1163531501|0,r=(r<<20|r>>>12)+o|0,n+=(r&i|o&~i)+e[13]-1444681467|0,n=(n<<5|n>>>27)+r|0,i+=(n&o|r&~o)+e[2]-51403784|0,i=(i<<9|i>>>23)+n|0,o+=(i&r|n&~r)+e[7]+1735328473|0,o=(o<<14|o>>>18)+i|0,r+=(o&n|i&~n)+e[12]-1926607734|0,r=(r<<20|r>>>12)+o|0,n+=(r^o^i)+e[5]-378558|0,n=(n<<4|n>>>28)+r|0,i+=(n^r^o)+e[8]-2022574463|0,i=(i<<11|i>>>21)+n|0,o+=(i^n^r)+e[11]+1839030562|0,o=(o<<16|o>>>16)+i|0,r+=(o^i^n)+e[14]-35309556|0,r=(r<<23|r>>>9)+o|0,n+=(r^o^i)+e[1]-1530992060|0,n=(n<<4|n>>>28)+r|0,i+=(n^r^o)+e[4]+1272893353|0,i=(i<<11|i>>>21)+n|0,o+=(i^n^r)+e[7]-155497632|0,o=(o<<16|o>>>16)+i|0,r+=(o^i^n)+e[10]-1094730640|0,r=(r<<23|r>>>9)+o|0,n+=(r^o^i)+e[13]+681279174|0,n=(n<<4|n>>>28)+r|0,i+=(n^r^o)+e[0]-358537222|0,i=(i<<11|i>>>21)+n|0,o+=(i^n^r)+e[3]-722521979|0,o=(o<<16|o>>>16)+i|0,r+=(o^i^n)+e[6]+76029189|0,r=(r<<23|r>>>9)+o|0,n+=(r^o^i)+e[9]-640364487|0,n=(n<<4|n>>>28)+r|0,i+=(n^r^o)+e[12]-421815835|0,i=(i<<11|i>>>21)+n|0,o+=(i^n^r)+e[15]+530742520|0,o=(o<<16|o>>>16)+i|0,r+=(o^i^n)+e[2]-995338651|0,r=(r<<23|r>>>9)+o|0,n+=(o^(r|~i))+e[0]-198630844|0,n=(n<<6|n>>>26)+r|0,i+=(r^(n|~o))+e[7]+1126891415|0,i=(i<<10|i>>>22)+n|0,o+=(n^(i|~r))+e[14]-1416354905|0,o=(o<<15|o>>>17)+i|0,r+=(i^(o|~n))+e[5]-57434055|0,r=(r<<21|r>>>11)+o|0,n+=(o^(r|~i))+e[12]+1700485571|0,n=(n<<6|n>>>26)+r|0,i+=(r^(n|~o))+e[3]-1894986606|0,i=(i<<10|i>>>22)+n|0,o+=(n^(i|~r))+e[10]-1051523|0,o=(o<<15|o>>>17)+i|0,r+=(i^(o|~n))+e[1]-2054922799|0,r=(r<<21|r>>>11)+o|0,n+=(o^(r|~i))+e[8]+1873313359|0,n=(n<<6|n>>>26)+r|0,i+=(r^(n|~o))+e[15]-30611744|0,i=(i<<10|i>>>22)+n|0,o+=(n^(i|~r))+e[6]-1560198380|0,o=(o<<15|o>>>17)+i|0,r+=(i^(o|~n))+e[13]+1309151649|0,r=(r<<21|r>>>11)+o|0,n+=(o^(r|~i))+e[4]-145523070|0,n=(n<<6|n>>>26)+r|0,i+=(r^(n|~o))+e[11]-1120210379|0,i=(i<<10|i>>>22)+n|0,o+=(n^(i|~r))+e[2]+718787259|0,o=(o<<15|o>>>17)+i|0,r+=(i^(o|~n))+e[9]-343485551|0,r=(r<<21|r>>>11)+o|0,t[0]=n+t[0]|0,t[1]=r+t[1]|0,t[2]=o+t[2]|0,t[3]=i+t[3]|0}function n(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}function r(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return n}function o(t){var r,o,i,s,a,c,u=t.length,f=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=u;r+=64)e(f,n(t.substring(r-64,r)));for(t=t.substring(r-64),o=t.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<o;r+=1)i[r>>2]|=t.charCodeAt(r)<<(r%4<<3);if(i[r>>2]|=128<<(r%4<<3),r>55)for(e(f,i),r=0;r<16;r+=1)i[r]=0;return s=8*u,s=s.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),c=parseInt(s[1],16)||0,i[14]=a,i[15]=c,e(f,i),f}function i(t){var n,o,i,s,a,c,u=t.length,f=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=u;n+=64)e(f,r(t.subarray(n-64,n)));for(t=n-64<u?t.subarray(n-64):new Uint8Array(0),o=t.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<o;n+=1)i[n>>2]|=t[n]<<(n%4<<3);if(i[n>>2]|=128<<(n%4<<3),n>55)for(e(f,i),n=0;n<16;n+=1)i[n]=0;return s=8*u,s=s.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),c=parseInt(s[1],16)||0,i[14]=a,i[15]=c,e(f,i),f}function s(t){var e,n="";for(e=0;e<4;e+=1)n+=v[t>>8*e+4&15]+v[t>>8*e&15];return n}function a(t){var e;for(e=0;e<t.length;e+=1)t[e]=s(t[e]);return t.join("")}function c(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function u(t,e){var n,r=t.length,o=new ArrayBuffer(r),i=new Uint8Array(o);for(n=0;n<r;n+=1)i[n]=t.charCodeAt(n);return e?i:o}function f(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function l(t,e,n){var r=new Uint8Array(t.byteLength+e.byteLength);return r.set(new Uint8Array(t)),r.set(new Uint8Array(e),t.byteLength),n?r:r.buffer}function d(t){var e,n=[],r=t.length;for(e=0;e<r-1;e+=2)n.push(parseInt(t.substr(e,2),16));return String.fromCharCode.apply(String,n)}function h(){this.reset()}var p=function(t,e){return t+e&4294967295},v=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==a(o("hello"))&&(p=function(t,e){var n=(65535&t)+(65535&e),r=(t>>16)+(e>>16)+(n>>16);return r<<16|65535&n}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function e(t,e){return t=0|t||0,t<0?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice=function(n,r){var o,i,s,a,c=this.byteLength,u=e(n,c),f=c;return r!==t&&(f=e(r,c)),u>f?new ArrayBuffer(0):(o=f-u,i=new ArrayBuffer(o),s=new Uint8Array(i),a=new Uint8Array(this,u,o),s.set(a),i)}}(),h.prototype.append=function(t){return this.appendBinary(c(t)),this},h.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var r,o=this._buff.length;for(r=64;r<=o;r+=64)e(this._hash,n(this._buff.substring(r-64,r)));return this._buff=this._buff.substring(r-64),this},h.prototype.end=function(t){var e,n,r=this._buff,o=r.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<o;e+=1)i[e>>2]|=r.charCodeAt(e)<<(e%4<<3);return this._finish(i,o),n=a(this._hash),t&&(n=d(n)),this.reset(),n},h.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},h.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},h.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},h.prototype._finish=function(t,n){var r,o,i,s=n;if(t[s>>2]|=128<<(s%4<<3),s>55)for(e(this._hash,t),s=0;s<16;s+=1)t[s]=0;
r=8*this._length,r=r.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(r[2],16),i=parseInt(r[1],16)||0,t[14]=o,t[15]=i,e(this._hash,t)},h.hash=function(t,e){return h.hashBinary(c(t),e)},h.hashBinary=function(t,e){var n=o(t),r=a(n);return e?d(r):r},h.ArrayBuffer=function(){this.reset()},h.ArrayBuffer.prototype.append=function(t){var n,o=l(this._buff.buffer,t,!0),i=o.length;for(this._length+=t.byteLength,n=64;n<=i;n+=64)e(this._hash,r(o.subarray(n-64,n)));return this._buff=n-64<i?new Uint8Array(o.buffer.slice(n-64)):new Uint8Array(0),this},h.ArrayBuffer.prototype.end=function(t){var e,n,r=this._buff,o=r.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<o;e+=1)i[e>>2]|=r[e]<<(e%4<<3);return this._finish(i,o),n=a(this._hash),t&&(n=d(n)),this.reset(),n},h.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.ArrayBuffer.prototype.getState=function(){var t=h.prototype.getState.call(this);return t.buff=f(t.buff),t},h.ArrayBuffer.prototype.setState=function(t){return t.buff=u(t.buff,!0),h.prototype.setState.call(this,t)},h.ArrayBuffer.prototype.destroy=h.prototype.destroy,h.ArrayBuffer.prototype._finish=h.prototype._finish,h.ArrayBuffer.hash=function(t,e){var n=i(new Uint8Array(t)),r=a(n);return e?d(r):r},h})},function(t,e){"use strict";function n(t,e,n){var r=n[n.length-1];t===r.element&&(n.pop(),r=n[n.length-1]);var o=r.element,i=r.index;if(Array.isArray(o))o.push(t);else if(i===e.length-2){var s=e.pop();o[s]=t}else e.push(t)}e.stringify=function(t){var e=[];e.push({obj:t});for(var n,r,o,i,s,a,c,u,f,l,d,h="";n=e.pop();)if(r=n.obj,o=n.prefix||"",i=n.val||"",h+=o,i)h+=i;else if("object"!=typeof r)h+="undefined"==typeof r?null:JSON.stringify(r);else if(null===r)h+="null";else if(Array.isArray(r)){for(e.push({val:"]"}),s=r.length-1;s>=0;s--)a=0===s?"":",",e.push({obj:r[s],prefix:a});e.push({val:"["})}else{c=[];for(u in r)r.hasOwnProperty(u)&&c.push(u);for(e.push({val:"}"}),s=c.length-1;s>=0;s--)f=c[s],l=r[f],d=s>0?",":"",d+=JSON.stringify(f)+":",e.push({obj:l,prefix:d});e.push({val:"{"})}return h},e.parse=function(t){for(var e,r,o,i,s,a,c,u,f,l=[],d=[],h=0;;)if(e=t[h++],"}"!==e&&"]"!==e&&"undefined"!=typeof e)switch(e){case" ":case"\t":case"\n":case":":case",":break;case"n":h+=3,n(null,l,d);break;case"t":h+=3,n(!0,l,d);break;case"f":h+=4,n(!1,l,d);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(r="",h--;;){if(o=t[h++],!/[\d\.\-e\+]/.test(o)){h--;break}r+=o}n(parseFloat(r),l,d);break;case'"':for(i="",s=void 0,a=0;;){if(c=t[h++],'"'===c&&("\\"!==s||a%2!==1))break;i+=c,s=c,"\\"===s?a++:a=0}n(JSON.parse('"'+i+'"'),l,d);break;case"[":u={element:[],index:l.length},l.push(u.element),d.push(u);break;case"{":f={element:{},index:l.length},l.push(f.element),d.push(f);break;default:throw new Error("unexpectedly reached end of input: "+e)}else{if(1===l.length)return l.pop();n(l.pop(),l,d)}}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(20),i=r(o),s=n(25),a=r(s),c={apiEndpoint:null,apiKey:null,appId:null,UDID:null,authenticationToken:null,tokenUpdateCallback:function(t){}};c.call=function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o=arguments[3];this.apiEndpoint||r(new Error("No API endpoint set - run Telepat.configure or Telepat.connect first"),null);var s;s="get"===o?i["default"].get(this.apiEndpoint+t+"?"+e):"delete"===o?i["default"].del(this.apiEndpoint+t):i["default"].post(this.apiEndpoint+t),"get"!==o&&s.send(e),s.set("Content-Type","application/json").set("X-BLGREQ-SIGN",(0,a["default"])(this.apiKey)).set("X-BLGREQ-APPID",this.appId).set("X-BLGREQ-UDID",this.UDID||"TP_EMPTY_UDID"),this.authenticationToken&&s.set("Authorization","Bearer "+this.authenticationToken),s.end(function(i,s){n.needsTokenUpdate(s)?n.updateToken(function(i,s){i?r(i,null):n.call(t,e,r,o)}):r(i,s)})},c.needsTokenUpdate=function(t){return this.authenticationToken&&401===t.status},c.updateToken=function(t){var e=this;this.get("user/refresh_token","",function(n,r){n?t(n,null):(e.authenticationToken=r.body.content.token,e.tokenUpdateCallback(e.authenticationToken),t(null,r))})},c.get=function(t,e,n){return this.call(t,e,n,"get")},c.del=function(t,e,n){return this.call(t,e,n,"delete")},e["default"]=c,t.exports=e["default"]},function(t,e,n){function r(){}function o(t){if(!g(t))return t;var e=[];for(var n in t)i(e,n,t[n]);return e.join("&")}function i(t,e,n){if(null!=n)if(Array.isArray(n))n.forEach(function(n){i(t,e,n)});else if(g(n))for(var r in n)i(t,e+"["+r+"]",n[r]);else t.push(encodeURIComponent(e)+"="+encodeURIComponent(n));else null===n&&t.push(encodeURIComponent(e))}function s(t){for(var e,n,r={},o=t.split("&"),i=0,s=o.length;i<s;++i)e=o[i],n=e.indexOf("="),n==-1?r[decodeURIComponent(e)]="":r[decodeURIComponent(e.slice(0,n))]=decodeURIComponent(e.slice(n+1));return r}function a(t){var e,n,r,o,i=t.split(/\r?\n/),s={};i.pop();for(var a=0,c=i.length;a<c;++a)n=i[a],e=n.indexOf(":"),r=n.slice(0,e).toLowerCase(),o=_(n.slice(e+1)),s[r]=o;return s}function c(t){return/[\/+]json\b/.test(t)}function u(t){return t.split(/ *; */).shift()}function f(t){return t.split(/ *; */).reduce(function(t,e){var n=e.split(/ *= */),r=n.shift(),o=n.shift();return r&&o&&(t[r]=o),t},{})}function l(t,e){e=e||{},this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this._setStatusProperties(this.xhr.status),this.header=this.headers=a(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function d(t,e){var n=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",function(){var t=null,e=null;try{e=new l(n)}catch(r){return t=new Error("Parser is unable to parse the response"),t.parse=!0,t.original=r,t.rawResponse=n.xhr&&n.xhr.responseText?n.xhr.responseText:null,t.statusCode=n.xhr&&n.xhr.status?n.xhr.status:null,n.callback(t)}n.emit("response",e);var o;try{(e.status<200||e.status>=300)&&(o=new Error(e.statusText||"Unsuccessful HTTP response"),o.original=t,o.response=e,o.status=e.status)}catch(r){o=r}o?n.callback(o,e):n.callback(null,e)})}function h(t,e){var n=m("DELETE",t);return e&&n.end(e),n}var p;"undefined"!=typeof window?p=window:"undefined"!=typeof self?p=self:(console.warn("Using browser-only version of superagent in non-browser environment"),p=this);var v=n(21),y=n(22),g=n(23),m=t.exports=n(24).bind(null,d);m.getXHR=function(){if(!(!p.XMLHttpRequest||p.location&&"file:"==p.location.protocol&&p.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw Error("Browser-only verison of superagent could not find XHR")};var _="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};m.serializeObject=o,m.parseString=s,m.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},m.serialize={"application/x-www-form-urlencoded":o,"application/json":JSON.stringify},m.parse={"application/x-www-form-urlencoded":s,"application/json":JSON.parse},l.prototype.get=function(t){return this.header[t.toLowerCase()]},l.prototype._setHeaderProperties=function(t){var e=this.header["content-type"]||"";this.type=u(e);var n=f(e);for(var r in n)this[r]=n[r]},l.prototype._parseBody=function(t){var e=m.parse[this.type];return!e&&c(this.type)&&(e=m.parse["application/json"]),e&&t&&(t.length||t instanceof Object)?e(t):null},l.prototype._setStatusProperties=function(t){1223===t&&(t=204);var e=t/100|0;this.status=this.statusCode=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.clientError=4==e,this.serverError=5==e,this.error=(4==e||5==e)&&this.toError(),this.accepted=202==t,this.noContent=204==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.notFound=404==t,this.forbidden=403==t},l.prototype.toError=function(){var t=this.req,e=t.method,n=t.url,r="cannot "+e+" "+n+" ("+this.status+")",o=new Error(r);return o.status=this.status,o.method=e,o.url=n,o},m.Response=l,v(d.prototype);for(var b in y)d.prototype[b]=y[b];d.prototype.type=function(t){return this.set("Content-Type",m.types[t]||t),this},d.prototype.responseType=function(t){return this._responseType=t,this},d.prototype.accept=function(t){return this.set("Accept",m.types[t]||t),this},d.prototype.auth=function(t,e,n){switch(n||(n={type:"basic"}),n.type){case"basic":var r=btoa(t+":"+e);this.set("Authorization","Basic "+r);break;case"auto":this.username=t,this.password=e}return this},d.prototype.query=function(t){return"string"!=typeof t&&(t=o(t)),t&&this._query.push(t),this},d.prototype.attach=function(t,e,n){return this._getFormData().append(t,e,n||e.name),this},d.prototype._getFormData=function(){return this._formData||(this._formData=new p.FormData),this._formData},d.prototype.callback=function(t,e){var n=this._callback;this.clearTimeout(),n(t,e)},d.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},d.prototype._timeoutError=function(){var t=this._timeout,e=new Error("timeout of "+t+"ms exceeded");e.timeout=t,this.callback(e)},d.prototype._appendQueryString=function(){var t=this._query.join("&");t&&(this.url+=~this.url.indexOf("?")?"&"+t:"?"+t)},d.prototype.end=function(t){var e=this,n=this.xhr=m.getXHR(),o=this._timeout,i=this._formData||this._data;this._callback=t||r,n.onreadystatechange=function(){if(4==n.readyState){var t;try{t=n.status}catch(r){t=0}if(0==t){if(e.timedout)return e._timeoutError();if(e._aborted)return;return e.crossDomainError()}e.emit("end")}};var s=function(t,n){n.total>0&&(n.percent=n.loaded/n.total*100),n.direction=t,e.emit("progress",n)};if(this.hasListeners("progress"))try{n.onprogress=s.bind(null,"download"),n.upload&&(n.upload.onprogress=s.bind(null,"upload"))}catch(a){}if(o&&!this._timer&&(this._timer=setTimeout(function(){e.timedout=!0,e.abort()},o)),this._appendQueryString(),this.username&&this.password?n.open(this.method,this.url,!0,this.username,this.password):n.open(this.method,this.url,!0),this._withCredentials&&(n.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof i&&!this._isHost(i)){var u=this._header["content-type"],f=this._serializer||m.serialize[u?u.split(";")[0]:""];!f&&c(u)&&(f=m.serialize["application/json"]),f&&(i=f(i))}for(var l in this.header)null!=this.header[l]&&n.setRequestHeader(l,this.header[l]);return this._responseType&&(n.responseType=this._responseType),this.emit("request",this),n.send("undefined"!=typeof i?i:null),this},m.Request=d,m.get=function(t,e,n){var r=m("GET",t);return"function"==typeof e&&(n=e,e=null),e&&r.query(e),n&&r.end(n),r},m.head=function(t,e,n){var r=m("HEAD",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},m.options=function(t,e,n){var r=m("OPTIONS",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},m.del=h,m["delete"]=h,m.patch=function(t,e,n){var r=m("PATCH",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},m.post=function(t,e,n){var r=m("POST",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},m.put=function(t,e,n){var r=m("PUT",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r}},function(t,e,n){function r(t){if(t)return o(t)}function o(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r,o=0;o<n.length;o++)if(r=n[o],r===e||r.fn===e){n.splice(o,1);break}return this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n){n=n.slice(0);for(var r=0,o=n.length;r<o;++r)n[r].apply(this,e)}return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,n){var r=n(23);e.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},e.parse=function(t){return this._parser=t,this},e.serialize=function(t){return this._serializer=t,this},e.timeout=function(t){return this._timeout=t,this},e.then=function(t,e){if(!this._fullfilledPromise){var n=this;this._fullfilledPromise=new Promise(function(t,e){n.end(function(n,r){n?e(n):t(r)})})}return this._fullfilledPromise.then(t,e)},e["catch"]=function(t){return this.then(void 0,t)},e.use=function(t){return t(this),this},e.get=function(t){return this._header[t.toLowerCase()]},e.getHeader=e.get,e.set=function(t,e){if(r(t)){for(var n in t)this.set(n,t[n]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},e.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},e.field=function(t,e){if(null===t||void 0===t)throw new Error(".field(name, val) name can not be empty");if(r(t)){for(var n in t)this.field(n,t[n]);return this}if(null===e||void 0===e)throw new Error(".field(name, val) val can not be empty");return this._getFormData().append(t,e),this},e.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},e.withCredentials=function(){return this._withCredentials=!0,this},e.redirects=function(t){return this._maxRedirects=t,this},e.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},e._isHost=function(t){var e={}.toString.call(t);switch(e){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}},e.send=function(t){var e=r(t),n=this._header["content-type"];if(e&&r(this._data))for(var o in t)this._data[o]=t[o];else"string"==typeof t?(n||this.type("form"),n=this._header["content-type"],"application/x-www-form-urlencoded"==n?this._data=this._data?this._data+"&"+t:t:this._data=(this._data||"")+t):this._data=t;return!e||this._isHost(t)?this:(n||this.type("json"),this)}},function(t,e){function n(t){return null!==t&&"object"==typeof t}t.exports=n},function(t,e){function n(t,e,n){return"function"==typeof n?new t("GET",e).end(n):2==arguments.length?new t("GET",e):new t(e,n)}t.exports=n},function(t,e,n){!function(r,o){t.exports=e=o(n(26))}(this,function(t){return function(e){var n=t,r=n.lib,o=r.WordArray,i=r.Hasher,s=n.algo,a=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(t){return 4294967296*(t-(0|t))|0}for(var r=2,o=0;o<64;)t(r)&&(o<8&&(a[o]=n(e.pow(r,.5))),c[o]=n(e.pow(r,1/3)),o++),r++}();var u=[],f=s.SHA256=i.extend({_doReset:function(){this._hash=new o.init(a.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],s=n[3],a=n[4],f=n[5],l=n[6],d=n[7],h=0;h<64;h++){if(h<16)u[h]=0|t[e+h];else{var p=u[h-15],v=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,y=u[h-2],g=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;u[h]=v+u[h-7]+g+u[h-16]}var m=a&f^~a&l,_=r&o^r&i^o&i,b=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),w=(a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25),k=d+w+m+c[h]+u[h],E=b+_;d=l,l=f,f=a,a=s+k|0,s=i,i=o,o=r,r=k+E|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+f|0,n[6]=n[6]+l|0,n[7]=n[7]+d|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[(o+64>>>9<<4)+14]=e.floor(r/4294967296),n[(o+64>>>9<<4)+15]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});n.SHA256=i._createHelper(f),n.HmacSHA256=i._createHmacHelper(f)}(Math),t.SHA256})},function(t,e,n){!function(n,r){t.exports=e=r()}(this,function(){var t=t||function(t,e){var n=Object.create||function(){function t(){}return function(e){var n;return t.prototype=e,n=new t,t.prototype=null,n}}(),r={},o=r.lib={},i=o.Base=function(){return{extend:function(t){var e=n(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=o.WordArray=i.extend({init:function(t,n){t=this.words=t||[],n!=e?this.sigBytes=n:this.sigBytes=4*t.length},toString:function(t){return(t||c).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes,o=t.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var s=n[i>>>2]>>>24-i%4*8&255;e[r+i>>>2]|=s<<24-(r+i)%4*8}else for(var i=0;i<o;i+=4)e[r+i>>>2]=n[i>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n,r=[],o=function(e){var e=e,n=987654321,r=4294967295;return function(){n=36969*(65535&n)+(n>>16)&r,e=18e3*(65535&e)+(e>>16)&r;var o=(n<<16)+e&r;return o/=4294967296,o+=.5,o*(t.random()>.5?1:-1)}},i=0;i<e;i+=4){var a=o(4294967296*(n||t.random()));n=987654071*a(),r.push(4294967296*a()|0)}return new s.init(r,e)}}),a=r.enc={},c=a.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new s.init(n,e/2)}},u=a.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new s.init(n,e)}},f=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(t){return u.parse(unescape(encodeURIComponent(t)))}},l=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=f.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,r=n.words,o=n.sigBytes,i=this.blockSize,a=4*i,c=o/a;c=e?t.ceil(c):t.max((0|c)-this._minBufferSize,0);var u=c*i,f=t.min(4*u,o);if(u){for(var l=0;l<u;l+=i)this._doProcessBlock(r,l);var d=r.splice(0,u);n.sigBytes-=f}return new s.init(d,f)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),d=(o.Hasher=l.extend({cfg:i.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){t&&this._append(t);var e=this._doFinalize();return e},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new d.HMAC.init(t,n).finalize(e)}}}),r.algo={});return r}(Math);return t})},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(28),i=r(o),s=i["default"].methodFactory;i["default"].methodFactory=function(t,e){var n=s(t,e);return function(t){n("Telepat: "+t)}},i["default"].setLevel("warn"),e["default"]=i["default"],t.exports=e["default"]},function(t,e,n){var r,o;!function(i,s){"use strict";r=s,o="function"==typeof r?r.call(e,n,e,t):r,!(void 0!==o&&(t.exports=o))}(this,function(){"use strict";function t(t){return typeof console!==a&&(void 0!==console[t]?e(console,t):void 0!==console.log?e(console,"log"):s)}function e(t,e){var n=t[e];if("function"==typeof n.bind)return n.bind(t);try{return Function.prototype.bind.call(n,t)}catch(r){return function(){return Function.prototype.apply.apply(n,[t,arguments])}}}function n(t,e,n){return function(){typeof console!==a&&(r.call(this,e,n),this[t].apply(this,arguments))}}function r(t,e){for(var n=0;n<c.length;n++){var r=c[n];this[r]=n<t?s:this.methodFactory(r,t,e)}}function o(e,r,o){return t(e)||n.apply(this,arguments)}function i(t,e,n){function i(t){var e=(c[t]||"silent").toUpperCase();try{return void(window.localStorage[l]=e)}catch(n){}try{window.document.cookie=encodeURIComponent(l)+"="+e+";"}catch(n){}}function s(){var t;try{t=window.localStorage[l]}catch(e){}if(typeof t===a)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(l)+"=");r&&(t=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===f.levels[t]&&(t=void 0),t}var u,f=this,l="loglevel";t&&(l+=":"+t),f.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},f.methodFactory=n||o,f.getLevel=function(){return u},f.setLevel=function(e,n){if("string"==typeof e&&void 0!==f.levels[e.toUpperCase()]&&(e=f.levels[e.toUpperCase()]),!("number"==typeof e&&e>=0&&e<=f.levels.SILENT))throw"log.setLevel() called with invalid level: "+e;if(u=e,n!==!1&&i(e),r.call(f,e,t),typeof console===a&&e<f.levels.SILENT)return"No console available for logging"},f.setDefaultLevel=function(t){s()||f.setLevel(t,!1)},f.enableAll=function(t){f.setLevel(f.levels.TRACE,t)},f.disableAll=function(t){f.setLevel(f.levels.SILENT,t)};var d=s();null==d&&(d=null==e?"WARN":e),f.setLevel(d,!1)}var s=function(){},a="undefined",c=["trace","debug","info","warn","error"],u=new i,f={};u.getLogger=function(t){if("string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var e=f[t];return e||(e=f[t]=new i(t,u.getLevel(),u.methodFactory)),e};var l=typeof window!==a?window.log:void 0;return u.noConflict=function(){return typeof window!==a&&window.log===u&&(window.log=l),u},u})},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t){return s["default"].error(t),new Error(t)}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=o;var i=n(27),s=r(i);t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(27),c=r(a),u=function(){function t(){o(this,t),this.eventFunctions={}}return s(t,[{key:"on",value:function(t,e){"object"!==i(this.eventFunctions[t])&&(this.eventFunctions[t]={});var n=Date.now()+Object.keys(this.eventFunctions[t]).length;return this.eventFunctions[t][n]=e,n}},{key:"removeCallback",value:function(t,e){delete this.eventFunctions[t][e]}},{key:"emit",value:function(t){c["default"].debug("Emitting "+arguments[0]+" event");var e=Array.prototype.slice.call(arguments);if(e.shift(),"undefined"!=typeof this.eventFunctions[arguments[0]]){var n=this.eventFunctions[arguments[0]];for(var r in n)n[r].apply(this,e)}}}]),t}();e["default"]=u,t.exports=e["default"]},function(t,e,n){(function(r){"use strict";function o(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=n(30),u=o(c),f=n(19),l=o(f),d=n(27),h=o(d),p=n(29),v=o(p),y=n(36),g=o(y),m=g["default"].create({objectHash:function(t){return t.id?t.id:JSON.stringify(t)},textDiff:{minLength:1e4}}),_=function(){function t(){function e(t){function e(t){var e={};for(var n in t)"$$"!==n.slice(0,2)&&"function"!=typeof t[n]&&(e[n]=t[n]);return e}t.leftIsArray||"object"!==t.leftType||(t.left=e(t.left)),t.rightIsArray||"object"!==t.rightType||(t.right=e(t.right))}var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:150;i(this,t),m.processor.pipes.diff.before("objects",e),this._updateRunning=!1,this._processingPatch=!1,this._timer=null,this._lastObjects={},this._events={},this.objects={},this.options={},this.callbacks={},this.timerInterval=n}return a(t,[{key:"remove",value:function(e){var n=t.subscriptionKeyForOptions(e);delete this.objects[n],delete this._lastObjects[n],delete this.options[n],delete this.callbacks[n],delete this._events[n]}},{key:"add",value:function(e,n,r,o,i,a){var c=this,u=function d(t){if(Array.isArray(t)||"a"===t._t)return!0;for(var e in t)"object"===s(t[e])&&d(t[e])&&delete t[e];return 0===Object.keys(t).length},f=function(){if(!c._processingPatch&&!c._updateRunning){var t=m.diff(c._lastObjects,c.objects);if(void 0!==t){h["default"].debug("Found diff: "+JSON.stringify(t));for(var e in t)for(var n=c._lastObjects[e],r=t[e],o=c.options[e],i=c.callbacks[e],a=Object.keys(r),f=0;f<a.length;f++){var l=a[f];if("_t"!==l){var d=r[l];if(Array.isArray(d))1===d.length?(i.add(c.objects[e][l]),delete n[l],delete c.objects[e][l],h["default"].debug("Adding object to "+e+" channel")):3===d.length&&(i.remove(l),delete n[l],h["default"].debug("Removing object from "+e+" channel"));else{var p=Object.keys(d),v=[],y=l;Array.isArray(c.objects[e])&&c.objects[e][l].id&&(y=c.objects[e][l].id);for(var g=0;g<p.length;g++){var _=p[g],b=d[_];u(b)?(v.push({op:"replace",path:o.channel.model+"/"+y+"/"+_,value:c.objects[e][l][_]}),h["default"].debug("Modified "+_+" property on object "+l+", "+o.channel.model+" channel")):"object"===("undefined"==typeof b?"undefined":s(b))?(v.push({op:"replace",path:o.channel.model+"/"+y+"/"+_,value:c.objects[e][l][_]}),h["default"].debug("Modified "+_+" property on object "+l+", "+o.channel.model+" channel")):1===b.length?(v.push({op:"replace",path:o.channel.model+"/"+y+"/"+_,value:b[0]}),h["default"].debug("Added "+_+" property to object "+l+", "+o.channel.model+" channel")):2===b.length?(v.push({op:"replace",path:o.channel.model+"/"+y+"/"+_,value:b[1]}),h["default"].debug("Modified "+_+" property on object "+l+", "+o.channel.model+" channel")):3===b.length&&h["default"].info("Removing object properties is not supported in this version. Try setting to an empty value instead."),n[l][_]=JSON.parse(JSON.stringify(c.objects[e][l][_]))}v.length&&i.update(y,v),h["default"].debug("Sending patch to object "+l+" on "+o.channel.model+" channel: "+JSON.stringify(v))}}}}}},l=t.subscriptionKeyForOptions(e);this.objects[l]=n,this.options[l]=e,this.callbacks[l]={add:o,remove:i,update:a},this._events[l]=r,this._lastObjects[l]=JSON.parse(JSON.stringify(this.objects[l])),null===this._timer&&(this._timer=setInterval(f,this.timerInterval))}},{key:"processMessage",value:function(t){var e=this,n=function(t){for(var n=0;n<t.subscriptions.length;n++){var r=t.subscriptions[n],o=r.split(":");"context"===o[2]&&4===o.length&&(o.pop(),r=o.join(":"));var i=e.objects[r],s=e._lastObjects[r],a=e._events[r];if(i)if("new"===t.op)i.hasOwnProperty(t.object.id)?a.emit("error",(0,v["default"])("Object id already exists "+t.object.id),t.object.id,i[t.object.id]):(t.object.$$event=new u["default"](h["default"]),i[t.object.id]=t.object,s[t.object.id]=JSON.parse(JSON.stringify(t.object)),a.emit("update","add",t.object.id,t.object),h["default"].debug("Added object with id "+t.object.id));else if("update"===t.op){var c=t.patch.path.split("/"),f=c[1],l=c[2],d=t.patch.value;if(i.hasOwnProperty(f))if("undefined"!=typeof d){var p=i[f],y=void 0;"undefined"!=typeof p[l]&&(y=JSON.parse(JSON.stringify(p[l]))),p[l]=d,s[f][l]=JSON.parse(JSON.stringify(d)),a.emit("update","replace",f,p,{path:l,oldValue:y}),h["default"].debug("Replaced property "+l+" of object id "+f+" with  value "+d)}else a.emit("error",(0,v["default"])("Invalid operation "+JSON.stringify(t)));else a.emit("error",(0,v["default"])("Object id doesn't exist "+f),f,l,d)}else{var g=i[t.object.id];delete i[t.object.id],delete s[t.object.id],a.emit("update","delete",t.object.id,g),h["default"].debug("Removed object id "+t.object.id)}else h["default"].warn("Subscription not found "+r)}};this._processingPatch=!0,h["default"].debug("Received update: "+JSON.stringify(t));var r,o;for(r=0;r<t.data["new"].length;r++)o=t.data["new"][r],o.op="new",n(o);for(r=0;r<t.data.updated.length;r++)o=t.data.updated[r],o.op="update",n(o);for(r=0;r<t.data.deleted.length;r++)o=t.data.deleted[r],o.op="remove",n(o);this._processingPatch=!1}}],[{key:"subscriptionKeyForOptions",value:function(t){var e="blg:"+l["default"].appId;return!t.channel.id&&t.channel.context&&(e+=":context:"+t.channel.context),t.channel.parent&&(e+=":"+t.channel.parent.model+":"+t.channel.parent.id),t.channel.user&&(e+=":users:"+t.channel.user),e+=":"+t.channel.model,t.channel.id&&(e+=":"+t.channel.id),t.filters&&(e+=":filter:"+new r(JSON.stringify(t.filters)).toString("base64")),e}}]),t}();e["default"]=_,t.exports=e["default"]}).call(e,n(32).Buffer)},function(t,e,n){(function(t,r){/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
"use strict";function o(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(e){return!1}}function i(){return t.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,n){if(i()<n)throw new RangeError("Invalid typed array length");return t.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(n),e.__proto__=t.prototype):(null===e&&(e=new t(n)),e.length=n),e}function t(e,n,r){if(!(t.TYPED_ARRAY_SUPPORT||this instanceof t))return new t(e,n,r);if("number"==typeof e){if("string"==typeof n)throw new Error("If encoding is specified then the first argument must be a string");return f(this,e)}return a(this,e,n,r)}function a(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?h(t,e,n,r):"string"==typeof e?l(t,e,n):p(t,e)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function u(t,e,n,r){return c(e),e<=0?s(t,e):void 0!==n?"string"==typeof r?s(t,e).fill(n,r):s(t,e).fill(n):s(t,e)}function f(e,n){if(c(n),e=s(e,n<0?0:0|v(n)),!t.TYPED_ARRAY_SUPPORT)for(var r=0;r<n;++r)e[r]=0;return e}function l(e,n,r){if("string"==typeof r&&""!==r||(r="utf8"),!t.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var o=0|g(n,r);e=s(e,o);var i=e.write(n,r);return i!==o&&(e=e.slice(0,i)),e}function d(t,e){var n=e.length<0?0:0|v(e.length);t=s(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function h(e,n,r,o){if(n.byteLength,r<0||n.byteLength<r)throw new RangeError("'offset' is out of bounds");if(n.byteLength<r+(o||0))throw new RangeError("'length' is out of bounds");return n=void 0===r&&void 0===o?new Uint8Array(n):void 0===o?new Uint8Array(n,r):new Uint8Array(n,r,o),t.TYPED_ARRAY_SUPPORT?(e=n,e.__proto__=t.prototype):e=d(e,n),e}function p(e,n){if(t.isBuffer(n)){var r=0|v(n.length);return e=s(e,r),0===e.length?e:(n.copy(e,0,0,r),e)}if(n){if("undefined"!=typeof ArrayBuffer&&n.buffer instanceof ArrayBuffer||"length"in n)return"number"!=typeof n.length||W(n.length)?s(e,0):d(e,n);if("Buffer"===n.type&&Z(n.data))return d(e,n.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function v(t){if(t>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|t}function y(e){return+e!=e&&(e=0),t.alloc(+e)}function g(e,n){if(t.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var o=!1;;)switch(n){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return J(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return V(e).length;default:if(o)return J(e).length;n=(""+n).toLowerCase(),o=!0}}function m(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,e>>>=0,n<=e)return"";for(t||(t="utf8");;)switch(t){case"hex":return D(this,e,n);case"utf8":case"utf-8":return T(this,e,n);case"ascii":return R(this,e,n);case"latin1":case"binary":return q(this,e,n);case"base64":return C(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function _(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function b(e,n,r,o,i){if(0===e.length)return-1;if("string"==typeof r?(o=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof n&&(n=t.from(n,o)),t.isBuffer(n))return 0===n.length?-1:w(e,n,r,o,i);if("number"==typeof n)return n=255&n,t.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,n,r):Uint8Array.prototype.lastIndexOf.call(e,n,r):w(e,[n],r,o,i);throw new TypeError("val must be string, number or Buffer")}function w(t,e,n,r,o){function i(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}var s=1,a=t.length,c=e.length;if(void 0!==r&&(r=String(r).toLowerCase(),"ucs2"===r||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s=2,a/=2,c/=2,n/=2}var u;if(o){var f=-1;for(u=n;u<a;u++)if(i(t,u)===i(e,f===-1?0:u-f)){if(f===-1&&(f=u),u-f+1===c)return f*s}else f!==-1&&(u-=u-f),f=-1}else for(n+c>a&&(n=a-c),u=n;u>=0;u--){for(var l=!0,d=0;d<c;d++)if(i(t,u+d)!==i(e,d)){l=!1;break}if(l)return u}return-1}function k(t,e,n,r){n=Number(n)||0;var o=t.length-n;r?(r=Number(r),r>o&&(r=o)):r=o;var i=e.length;if(i%2!==0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var s=0;s<r;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[n+s]=a}return s}function E(t,e,n,r){return K(J(e,t.length-n),t,n,r)}function x(t,e,n,r){return K(Y(e),t,n,r)}function A(t,e,n,r){return x(t,e,n,r)}function S(t,e,n,r){return K(V(e),t,n,r)}function j(t,e,n,r){return K(X(e,t.length-n),t,n,r)}function C(t,e,n){return 0===e&&n===t.length?G.fromByteArray(t):G.fromByteArray(t.slice(e,n))}function T(t,e,n){n=Math.min(t.length,n);for(var r=[],o=e;o<n;){var i=t[o],s=null,a=i>239?4:i>223?3:i>191?2:1;if(o+a<=n){var c,u,f,l;switch(a){case 1:i<128&&(s=i);break;case 2:c=t[o+1],128===(192&c)&&(l=(31&i)<<6|63&c,l>127&&(s=l));break;case 3:c=t[o+1],u=t[o+2],128===(192&c)&&128===(192&u)&&(l=(15&i)<<12|(63&c)<<6|63&u,l>2047&&(l<55296||l>57343)&&(s=l));break;case 4:c=t[o+1],u=t[o+2],f=t[o+3],128===(192&c)&&128===(192&u)&&128===(192&f)&&(l=(15&i)<<18|(63&c)<<12|(63&u)<<6|63&f,l>65535&&l<1114112&&(s=l))}}null===s?(s=65533,a=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),o+=a}return O(r)}function O(t){var e=t.length;if(e<=tt)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=tt));return n}function R(t,e,n){var r="";n=Math.min(t.length,n);for(var o=e;o<n;++o)r+=String.fromCharCode(127&t[o]);return r}function q(t,e,n){var r="";n=Math.min(t.length,n);for(var o=e;o<n;++o)r+=String.fromCharCode(t[o]);return r}function D(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=e;i<n;++i)o+=z(t[i]);return o}function I(t,e,n){for(var r=t.slice(e,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function B(t,e,n){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function N(e,n,r,o,i,s){if(!t.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>i||n<s)throw new RangeError('"value" argument is out of bounds');if(r+o>e.length)throw new RangeError("Index out of range")}function L(t,e,n,r){e<0&&(e=65535+e+1);for(var o=0,i=Math.min(t.length-n,2);o<i;++o)t[n+o]=(e&255<<8*(r?o:1-o))>>>8*(r?o:1-o)}function P(t,e,n,r){e<0&&(e=4294967295+e+1);for(var o=0,i=Math.min(t.length-n,4);o<i;++o)t[n+o]=e>>>8*(r?o:3-o)&255}function U(t,e,n,r,o,i){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function M(t,e,n,r,o){return o||U(t,e,n,4,3.4028234663852886e38,-3.4028234663852886e38),Q.write(t,e,n,r,23,4),n+4}function F(t,e,n,r,o){return o||U(t,e,n,8,1.7976931348623157e308,-1.7976931348623157e308),Q.write(t,e,n,r,52,8),n+8}function $(t){if(t=H(t).replace(et,""),t.length<2)return"";for(;t.length%4!==0;)t+="=";return t}function H(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function z(t){return t<16?"0"+t.toString(16):t.toString(16)}function J(t,e){e=e||1/0;for(var n,r=t.length,o=null,i=[],s=0;s<r;++s){if(n=t.charCodeAt(s),n>55295&&n<57344){if(!o){if(n>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(e-=3)>-1&&i.push(239,191,189),o=n;continue}n=(o-55296<<10|n-56320)+65536}else o&&(e-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((e-=1)<0)break;i.push(n)}else if(n<2048){if((e-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function Y(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}function X(t,e){for(var n,r,o,i=[],s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),r=n>>8,o=n%256,i.push(o),i.push(r);return i}function V(t){return G.toByteArray($(t))}function K(t,e,n,r){for(var o=0;o<r&&!(o+n>=e.length||o>=t.length);++o)e[o+n]=t[o];return o}function W(t){return t!==t}var G=n(33),Q=n(34),Z=n(35);e.Buffer=t,e.SlowBuffer=y,e.INSPECT_MAX_BYTES=50,t.TYPED_ARRAY_SUPPORT=void 0!==r.TYPED_ARRAY_SUPPORT?r.TYPED_ARRAY_SUPPORT:o(),e.kMaxLength=i(),t.poolSize=8192,t._augment=function(e){return e.__proto__=t.prototype,e},t.from=function(t,e,n){return a(null,t,e,n)},t.TYPED_ARRAY_SUPPORT&&(t.prototype.__proto__=Uint8Array.prototype,t.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&t[Symbol.species]===t&&Object.defineProperty(t,Symbol.species,{value:null,configurable:!0})),t.alloc=function(t,e,n){return u(null,t,e,n)},t.allocUnsafe=function(t){return f(null,t)},t.allocUnsafeSlow=function(t){return f(null,t)},t.isBuffer=function(t){return!(null==t||!t._isBuffer)},t.compare=function(e,n){if(!t.isBuffer(e)||!t.isBuffer(n))throw new TypeError("Arguments must be Buffers");if(e===n)return 0;for(var r=e.length,o=n.length,i=0,s=Math.min(r,o);i<s;++i)if(e[i]!==n[i]){r=e[i],o=n[i];break}return r<o?-1:o<r?1:0},t.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},t.concat=function(e,n){if(!Z(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return t.alloc(0);var r;if(void 0===n)for(n=0,r=0;r<e.length;++r)n+=e[r].length;var o=t.allocUnsafe(n),i=0;for(r=0;r<e.length;++r){var s=e[r];if(!t.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(o,i),i+=s.length}return o},t.byteLength=g,t.prototype._isBuffer=!0,t.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)_(this,e,e+1);return this},t.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)_(this,e,e+3),_(this,e+1,e+2);return this},t.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)_(this,e,e+7),_(this,e+1,e+6),_(this,e+2,e+5),_(this,e+3,e+4);return this},t.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?T(this,0,t):m.apply(this,arguments)},t.prototype.equals=function(e){if(!t.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===t.compare(this,e)},t.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},t.prototype.compare=function(e,n,r,o,i){if(!t.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===n&&(n=0),void 0===r&&(r=e?e.length:0),void 0===o&&(o=0),void 0===i&&(i=this.length),n<0||r>e.length||o<0||i>this.length)throw new RangeError("out of range index");if(o>=i&&n>=r)return 0;if(o>=i)return-1;if(n>=r)return 1;if(n>>>=0,r>>>=0,o>>>=0,i>>>=0,this===e)return 0;for(var s=i-o,a=r-n,c=Math.min(s,a),u=this.slice(o,i),f=e.slice(n,r),l=0;l<c;++l)if(u[l]!==f[l]){s=u[l],a=f[l];break}return s<a?-1:a<s?1:0},t.prototype.includes=function(t,e,n){return this.indexOf(t,e,n)!==-1},t.prototype.indexOf=function(t,e,n){return b(this,t,e,n,!0)},t.prototype.lastIndexOf=function(t,e,n){return b(this,t,e,n,!1)},t.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e=0|e,isFinite(n)?(n=0|n,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-e;if((void 0===n||n>o)&&(n=o),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return k(this,t,e,n);case"utf8":case"utf-8":return E(this,t,e,n);case"ascii":return x(this,t,e,n);case"latin1":case"binary":return A(this,t,e,n);case"base64":return S(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,t,e,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},t.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var tt=4096;t.prototype.slice=function(e,n){var r=this.length;e=~~e,n=void 0===n?r:~~n,e<0?(e+=r,e<0&&(e=0)):e>r&&(e=r),n<0?(n+=r,n<0&&(n=0)):n>r&&(n=r),n<e&&(n=e);var o;if(t.TYPED_ARRAY_SUPPORT)o=this.subarray(e,n),o.__proto__=t.prototype;else{var i=n-e;o=new t(i,(void 0));for(var s=0;s<i;++s)o[s]=this[s+e]}return o},t.prototype.readUIntLE=function(t,e,n){t=0|t,e=0|e,n||B(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r},t.prototype.readUIntBE=function(t,e,n){t=0|t,e=0|e,n||B(t,e,this.length);for(var r=this[t+--e],o=1;e>0&&(o*=256);)r+=this[t+--e]*o;return r},t.prototype.readUInt8=function(t,e){return e||B(t,1,this.length),this[t]},t.prototype.readUInt16LE=function(t,e){return e||B(t,2,this.length),this[t]|this[t+1]<<8},t.prototype.readUInt16BE=function(t,e){return e||B(t,2,this.length),this[t]<<8|this[t+1]},t.prototype.readUInt32LE=function(t,e){return e||B(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},t.prototype.readUInt32BE=function(t,e){return e||B(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},t.prototype.readIntLE=function(t,e,n){t=0|t,e=0|e,n||B(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return o*=128,r>=o&&(r-=Math.pow(2,8*e)),r},t.prototype.readIntBE=function(t,e,n){t=0|t,e=0|e,n||B(t,e,this.length);for(var r=e,o=1,i=this[t+--r];r>0&&(o*=256);)i+=this[t+--r]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*e)),i},t.prototype.readInt8=function(t,e){return e||B(t,1,this.length),128&this[t]?(255-this[t]+1)*-1:this[t]},t.prototype.readInt16LE=function(t,e){e||B(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},t.prototype.readInt16BE=function(t,e){e||B(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},t.prototype.readInt32LE=function(t,e){return e||B(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},t.prototype.readInt32BE=function(t,e){return e||B(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},t.prototype.readFloatLE=function(t,e){return e||B(t,4,this.length),Q.read(this,t,!0,23,4)},t.prototype.readFloatBE=function(t,e){return e||B(t,4,this.length),Q.read(this,t,!1,23,4)},t.prototype.readDoubleLE=function(t,e){return e||B(t,8,this.length),Q.read(this,t,!0,52,8)},t.prototype.readDoubleBE=function(t,e){return e||B(t,8,this.length),Q.read(this,t,!1,52,8)},t.prototype.writeUIntLE=function(t,e,n,r){if(t=+t,e=0|e,n=0|n,!r){var o=Math.pow(2,8*n)-1;N(this,t,e,n,o,0)}var i=1,s=0;for(this[e]=255&t;++s<n&&(i*=256);)this[e+s]=t/i&255;return e+n},t.prototype.writeUIntBE=function(t,e,n,r){if(t=+t,e=0|e,n=0|n,!r){var o=Math.pow(2,8*n)-1;N(this,t,e,n,o,0)}var i=n-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+n},t.prototype.writeUInt8=function(e,n,r){return e=+e,n=0|n,r||N(this,e,n,1,255,0),t.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[n]=255&e,n+1},t.prototype.writeUInt16LE=function(e,n,r){return e=+e,n=0|n,r||N(this,e,n,2,65535,0),t.TYPED_ARRAY_SUPPORT?(this[n]=255&e,this[n+1]=e>>>8):L(this,e,n,!0),n+2},t.prototype.writeUInt16BE=function(e,n,r){return e=+e,n=0|n,r||N(this,e,n,2,65535,0),t.TYPED_ARRAY_SUPPORT?(this[n]=e>>>8,this[n+1]=255&e):L(this,e,n,!1),n+2},t.prototype.writeUInt32LE=function(e,n,r){return e=+e,n=0|n,r||N(this,e,n,4,4294967295,0),t.TYPED_ARRAY_SUPPORT?(this[n+3]=e>>>24,this[n+2]=e>>>16,this[n+1]=e>>>8,this[n]=255&e):P(this,e,n,!0),n+4},t.prototype.writeUInt32BE=function(e,n,r){return e=+e,n=0|n,r||N(this,e,n,4,4294967295,0),t.TYPED_ARRAY_SUPPORT?(this[n]=e>>>24,this[n+1]=e>>>16,this[n+2]=e>>>8,this[n+3]=255&e):P(this,e,n,!1),n+4},t.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e=0|e,!r){var o=Math.pow(2,8*n-1);N(this,t,e,n,o-1,-o)}var i=0,s=1,a=0;for(this[e]=255&t;++i<n&&(s*=256);)t<0&&0===a&&0!==this[e+i-1]&&(a=1),this[e+i]=(t/s>>0)-a&255;return e+n},t.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e=0|e,!r){var o=Math.pow(2,8*n-1);N(this,t,e,n,o-1,-o)}var i=n-1,s=1,a=0;for(this[e+i]=255&t;--i>=0&&(s*=256);)t<0&&0===a&&0!==this[e+i+1]&&(a=1),this[e+i]=(t/s>>0)-a&255;return e+n},t.prototype.writeInt8=function(e,n,r){return e=+e,n=0|n,r||N(this,e,n,1,127,-128),t.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[n]=255&e,n+1},t.prototype.writeInt16LE=function(e,n,r){return e=+e,n=0|n,r||N(this,e,n,2,32767,-32768),t.TYPED_ARRAY_SUPPORT?(this[n]=255&e,this[n+1]=e>>>8):L(this,e,n,!0),n+2},t.prototype.writeInt16BE=function(e,n,r){return e=+e,n=0|n,r||N(this,e,n,2,32767,-32768),t.TYPED_ARRAY_SUPPORT?(this[n]=e>>>8,this[n+1]=255&e):L(this,e,n,!1),n+2},t.prototype.writeInt32LE=function(e,n,r){return e=+e,n=0|n,r||N(this,e,n,4,2147483647,-2147483648),t.TYPED_ARRAY_SUPPORT?(this[n]=255&e,this[n+1]=e>>>8,this[n+2]=e>>>16,this[n+3]=e>>>24):P(this,e,n,!0),n+4},t.prototype.writeInt32BE=function(e,n,r){return e=+e,n=0|n,r||N(this,e,n,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),t.TYPED_ARRAY_SUPPORT?(this[n]=e>>>24,this[n+1]=e>>>16,this[n+2]=e>>>8,this[n+3]=255&e):P(this,e,n,!1),n+4},t.prototype.writeFloatLE=function(t,e,n){return M(this,t,e,!0,n)},t.prototype.writeFloatBE=function(t,e,n){return M(this,t,e,!1,n)},t.prototype.writeDoubleLE=function(t,e,n){return F(this,t,e,!0,n)},t.prototype.writeDoubleBE=function(t,e,n){return F(this,t,e,!1,n)},t.prototype.copy=function(e,n,r,o){if(r||(r=0),o||0===o||(o=this.length),n>=e.length&&(n=e.length),n||(n=0),o>0&&o<r&&(o=r),o===r)return 0;if(0===e.length||0===this.length)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-n<o-r&&(o=e.length-n+r);var i,s=o-r;if(this===e&&r<n&&n<o)for(i=s-1;i>=0;--i)e[i+n]=this[i+r];else if(s<1e3||!t.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+n]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+s),n);return s},t.prototype.fill=function(e,n,r,o){if("string"==typeof e){if("string"==typeof n?(o=n,n=0,r=this.length):"string"==typeof r&&(o=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!t.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof e&&(e=255&e);if(n<0||this.length<n||this.length<r)throw new RangeError("Out of range index");if(r<=n)return this;n>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0);var s;if("number"==typeof e)for(s=n;s<r;++s)this[s]=e;else{var a=t.isBuffer(e)?e:J(new t(e,o).toString()),c=a.length;for(s=0;s<r-n;++s)this[s+n]=a[s%c]}return this};var et=/[^+\/0-9A-Za-z-_]/g}).call(e,n(32).Buffer,function(){return this}())},function(t,e){"use strict";function n(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function r(t){return 3*t.length/4-n(t)}function o(t){var e,r,o,i,s,a=t.length;i=n(t),s=new f(3*a/4-i),r=i>0?a-4:a;var c=0;for(e=0;e<r;e+=4)o=u[t.charCodeAt(e)]<<18|u[t.charCodeAt(e+1)]<<12|u[t.charCodeAt(e+2)]<<6|u[t.charCodeAt(e+3)],s[c++]=o>>16&255,s[c++]=o>>8&255,s[c++]=255&o;return 2===i?(o=u[t.charCodeAt(e)]<<2|u[t.charCodeAt(e+1)]>>4,s[c++]=255&o):1===i&&(o=u[t.charCodeAt(e)]<<10|u[t.charCodeAt(e+1)]<<4|u[t.charCodeAt(e+2)]>>2,s[c++]=o>>8&255,s[c++]=255&o),s}function i(t){return c[t>>18&63]+c[t>>12&63]+c[t>>6&63]+c[63&t]}function s(t,e,n){for(var r,o=[],s=e;s<n;s+=3)r=(t[s]<<16)+(t[s+1]<<8)+t[s+2],o.push(i(r));return o.join("")}function a(t){for(var e,n=t.length,r=n%3,o="",i=[],a=16383,u=0,f=n-r;u<f;u+=a)i.push(s(t,u,u+a>f?f:u+a));return 1===r?(e=t[n-1],o+=c[e>>2],o+=c[e<<4&63],o+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],o+=c[e>>10],o+=c[e>>4&63],o+=c[e<<2&63],o+="="),i.push(o),i.join("")}e.byteLength=r,e.toByteArray=o,e.fromByteArray=a;for(var c=[],u=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,h=l.length;d<h;++d)c[d]=l[d],u[l.charCodeAt(d)]=d;u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,r,o){var i,s,a=8*o-r-1,c=(1<<a)-1,u=c>>1,f=-7,l=n?o-1:0,d=n?-1:1,h=t[e+l];for(l+=d,i=h&(1<<-f)-1,h>>=-f,f+=a;f>0;i=256*i+t[e+l],l+=d,f-=8);for(s=i&(1<<-f)-1,i>>=-f,f+=r;f>0;s=256*s+t[e+l],l+=d,f-=8);if(0===i)i=1-u;else{if(i===c)return s?NaN:(h?-1:1)*(1/0);s+=Math.pow(2,r),i-=u}return(h?-1:1)*s*Math.pow(2,i-r)},e.write=function(t,e,n,r,o,i){var s,a,c,u=8*i-o-1,f=(1<<u)-1,l=f>>1,d=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:i-1,p=r?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=f):(s=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-s))<1&&(s--,c*=2),e+=s+l>=1?d/c:d*Math.pow(2,1-l),e*c>=2&&(s++,c/=2),s+l>=f?(a=0,s=f):s+l>=1?(a=(e*c-1)*Math.pow(2,o),s+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,o),s=0));o>=8;t[n+h]=255&a,h+=p,a/=256,o-=8);for(s=s<<o|a,u+=o;u>0;t[n+h]=255&s,h+=p,s/=256,u-=8);t[n+h-p]|=128*v}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){var r=n(37),o=n(38).DiffPatcher;e.DiffPatcher=o,e.create=function(t){return new o(t)},e.dateReviver=n(67);var i;if(e.diff=function(){return i||(i=new o),i.diff.apply(i,arguments)},e.patch=function(){return i||(i=new o),i.patch.apply(i,arguments)},e.unpatch=function(){return i||(i=new o),i.unpatch.apply(i,arguments)},e.reverse=function(){return i||(i=new o),i.reverse.apply(i,arguments)},e.clone=function(){return i||(i=new o),i.clone.apply(i,arguments)},r.isBrowser)e.homepage="{{package-homepage}}",e.version="{{package-version}}";else{var s="../package.json",a=n(52)(s);e.homepage=a.homepage,e.version=a.version;var c="./formatters",u=n(52)(c);e.formatters=u,e.console=u.console}},function(t,e){e.isBrowser="undefined"!=typeof window},function(t,e,n){var r=n(39).Processor,o=n(40).Pipe,i=n(41).DiffContext,s=n(44).PatchContext,a=n(45).ReverseContext,c=n(43),u=n(46),f=n(47),l=n(48),d=n(50),h=n(51),p=function(t){this.processor=new r(t),this.processor.pipe(new o("diff").append(f.collectChildrenDiffFilter,u.diffFilter,d.diffFilter,h.diffFilter,f.objectsDiffFilter,l.diffFilter).shouldHaveResult()),this.processor.pipe(new o("patch").append(f.collectChildrenPatchFilter,l.collectChildrenPatchFilter,u.patchFilter,h.patchFilter,f.patchFilter,l.patchFilter).shouldHaveResult()),this.processor.pipe(new o("reverse").append(f.collectChildrenReverseFilter,l.collectChildrenReverseFilter,u.reverseFilter,h.reverseFilter,f.reverseFilter,l.reverseFilter).shouldHaveResult())};p.prototype.options=function(){return this.processor.options.apply(this.processor,arguments)},p.prototype.diff=function(t,e){return this.processor.process(new i(t,e))},p.prototype.patch=function(t,e){return this.processor.process(new s(t,e))},p.prototype.reverse=function(t){return this.processor.process(new a(t))},p.prototype.unpatch=function(t,e){return this.patch(t,this.reverse(e))},p.prototype.clone=function(t){return c(t)},e.DiffPatcher=p},function(t,e){var n=function(t){this.selfOptions=t||{},this.pipes={}};n.prototype.options=function(t){return t&&(this.selfOptions=t),this.selfOptions},n.prototype.pipe=function(t,e){if("string"==typeof t){if("undefined"==typeof e)return this.pipes[t];this.pipes[t]=e}if(t&&t.name){if(e=t,e.processor===this)return e;this.pipes[e.name]=e}return e.processor=this,e},n.prototype.process=function(t,e){var n=t;n.options=this.options();for(var r,o,i=e||t.pipe||"default";i;)"undefined"!=typeof n.nextAfterChildren&&(n.next=n.nextAfterChildren,n.nextAfterChildren=null),"string"==typeof i&&(i=this.pipe(i)),i.process(n),o=n,r=i,i=null,n&&n.next&&(n=n.next,i=o.nextPipe||n.pipe||r);return n.hasResult?n.result:void 0},e.Processor=n},function(t,e){var n=function(t){this.name=t,this.filters=[]};n.prototype.process=function(t){if(!this.processor)throw new Error("add this pipe to a processor before using it");for(var e=this.debug,n=this.filters.length,r=t,o=0;o<n;o++){var i=this.filters[o];if(e&&this.log("filter: "+i.filterName),i(r),"object"==typeof r&&r.exiting){r.exiting=!1;break}}!r.next&&this.resultCheck&&this.resultCheck(r)},n.prototype.log=function(t){console.log("[jsondiffpatch] "+this.name+" pipe, "+t)},n.prototype.append=function(){return this.filters.push.apply(this.filters,arguments),this},n.prototype.prepend=function(){return this.filters.unshift.apply(this.filters,arguments),this},n.prototype.indexOf=function(t){if(!t)throw new Error("a filter name is required");for(var e=0;e<this.filters.length;e++){var n=this.filters[e];if(n.filterName===t)return e}throw new Error("filter not found: "+t)},n.prototype.list=function(){for(var t=[],e=0;e<this.filters.length;e++){var n=this.filters[e];t.push(n.filterName)}return t},n.prototype.after=function(t){var e=this.indexOf(t),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(e+1,0),Array.prototype.splice.apply(this.filters,n),this},n.prototype.before=function(t){var e=this.indexOf(t),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(e,0),Array.prototype.splice.apply(this.filters,n),this},n.prototype.clear=function(){return this.filters.length=0,this},n.prototype.shouldHaveResult=function(t){if(t===!1)return void(this.resultCheck=null);if(!this.resultCheck){var e=this;return this.resultCheck=function(t){if(!t.hasResult){console.log(t);var n=new Error(e.name+" failed");throw n.noResult=!0,n}},this}},e.Pipe=n},function(t,e,n){var r=n(42).Context,o=n(43),i=function(t,e){this.left=t,this.right=e,this.pipe="diff"};i.prototype=new r,i.prototype.setResult=function(t){if(this.options.cloneDiffValues&&"object"==typeof t){var e="function"==typeof this.options.cloneDiffValues?this.options.cloneDiffValues:o;"object"==typeof t[0]&&(t[0]=e(t[0])),"object"==typeof t[1]&&(t[1]=e(t[1]))}return r.prototype.setResult.apply(this,arguments)},e.DiffContext=i},function(t,e,n){var r=n(40).Pipe,o=function(){};o.prototype.setResult=function(t){return this.result=t,this.hasResult=!0,this},o.prototype.exit=function(){return this.exiting=!0,this},o.prototype.switchTo=function(t,e){return"string"==typeof t||t instanceof r?this.nextPipe=t:(this.next=t,e&&(this.nextPipe=e)),this},o.prototype.push=function(t,e){return t.parent=this,"undefined"!=typeof e&&(t.childName=e),t.root=this.root||this,t.options=t.options||this.options,this.children?(this.children[this.children.length-1].next=t,this.children.push(t)):(this.children=[t],this.nextAfterChildren=this.next||null,this.next=t),t.next=this,this},e.Context=o},function(t,e){function n(t){var e=/^\/(.*)\/([gimyu]*)$/.exec(t.toString());return new RegExp(e[1],e[2])}function r(t){if("object"!=typeof t)return t;if(null===t)return null;if(o(t))return t.map(r);if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return n(t);var e={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=r(t[i]));return e}var o="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array};t.exports=r},function(t,e,n){var r=n(42).Context,o=function(t,e){this.left=t,this.delta=e,this.pipe="patch"};o.prototype=new r,e.PatchContext=o},function(t,e,n){var r=n(42).Context,o=function(t){this.delta=t,this.pipe="reverse"};o.prototype=new r,e.ReverseContext=o},function(t,e){var n="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},r=function(t){if(t.left===t.right)return void t.setResult(void 0).exit();if("undefined"==typeof t.left){if("function"==typeof t.right)throw new Error("functions are not supported");return void t.setResult([t.right]).exit()}if("undefined"==typeof t.right)return void t.setResult([t.left,0,0]).exit();if("function"==typeof t.left||"function"==typeof t.right)throw new Error("functions are not supported");if(t.leftType=null===t.left?"null":typeof t.left,t.rightType=null===t.right?"null":typeof t.right,t.leftType!==t.rightType)return void t.setResult([t.left,t.right]).exit();if("boolean"===t.leftType||"number"===t.leftType)return void t.setResult([t.left,t.right]).exit();if("object"===t.leftType&&(t.leftIsArray=n(t.left)),"object"===t.rightType&&(t.rightIsArray=n(t.right)),t.leftIsArray!==t.rightIsArray)return void t.setResult([t.left,t.right]).exit();if(t.left instanceof RegExp){if(!(t.right instanceof RegExp))return void t.setResult([t.left,t.right]).exit();t.setResult([t.left.toString(),t.right.toString()]).exit()}};r.filterName="trivial";var o=function(t){if("undefined"==typeof t.delta)return void t.setResult(t.left).exit();if(t.nested=!n(t.delta),!t.nested){if(1===t.delta.length)return void t.setResult(t.delta[0]).exit();if(2===t.delta.length){if(t.left instanceof RegExp){var e=/^\/(.*)\/([gimyu]+)$/.exec(t.delta[1]);if(e)return void t.setResult(new RegExp(e[1],e[2])).exit()}return void t.setResult(t.delta[1]).exit()}return 3===t.delta.length&&0===t.delta[2]?void t.setResult(void 0).exit():void 0}};o.filterName="trivial";var i=function(t){return"undefined"==typeof t.delta?void t.setResult(t.delta).exit():(t.nested=!n(t.delta),t.nested?void 0:1===t.delta.length?void t.setResult([t.delta[0],0,0]).exit():2===t.delta.length?void t.setResult([t.delta[1],t.delta[0]]).exit():3===t.delta.length&&0===t.delta[2]?void t.setResult([t.delta[0]]).exit():void 0)};i.filterName="trivial",e.diffFilter=r,e.patchFilter=o,e.reverseFilter=i},function(t,e,n){var r=n(41).DiffContext,o=n(44).PatchContext,i=n(45).ReverseContext,s=function(t){if(t&&t.children){for(var e,n=t.children.length,r=t.result,o=0;o<n;o++)e=t.children[o],"undefined"!=typeof e.result&&(r=r||{},r[e.childName]=e.result);r&&t.leftIsArray&&(r._t="a"),t.setResult(r).exit()}};s.filterName="collectChildren";var a=function(t){if(!t.leftIsArray&&"object"===t.leftType){var e,n,o=t.options.propertyFilter;for(e in t.left)Object.prototype.hasOwnProperty.call(t.left,e)&&(o&&!o(e,t)||(n=new r(t.left[e],t.right[e]),t.push(n,e)));for(e in t.right)Object.prototype.hasOwnProperty.call(t.right,e)&&(o&&!o(e,t)||"undefined"==typeof t.left[e]&&(n=new r((void 0),t.right[e]),t.push(n,e)));return t.children&&0!==t.children.length?void t.exit():void t.setResult(void 0).exit()}};a.filterName="objects";var c=function(t){if(t.nested&&!t.delta._t){var e,n;for(e in t.delta)n=new o(t.left[e],t.delta[e]),t.push(n,e);t.exit()}};c.filterName="objects";var u=function(t){if(t&&t.children&&!t.delta._t){for(var e,n=t.children.length,r=0;r<n;r++)e=t.children[r],Object.prototype.hasOwnProperty.call(t.left,e.childName)&&void 0===e.result?delete t.left[e.childName]:t.left[e.childName]!==e.result&&(t.left[e.childName]=e.result);t.setResult(t.left).exit()}};u.filterName="collectChildren";var f=function(t){if(t.nested&&!t.delta._t){var e,n;for(e in t.delta)n=new i(t.delta[e]),t.push(n,e);
t.exit()}};f.filterName="objects";var l=function(t){if(t&&t.children&&!t.delta._t){for(var e,n=t.children.length,r={},o=0;o<n;o++)e=t.children[o],r[e.childName]!==e.result&&(r[e.childName]=e.result);t.setResult(r).exit()}};l.filterName="collectChildren",e.collectChildrenDiffFilter=s,e.objectsDiffFilter=a,e.patchFilter=c,e.collectChildrenPatchFilter=u,e.reverseFilter=f,e.collectChildrenReverseFilter=l},function(t,e,n){function r(t,e,n,r){for(var o=0;o<n;o++)for(var i=t[o],s=0;s<r;s++){var a=e[s];if(o!==s&&i===a)return!0}}function o(t,e,n,r,o){var i=t[n],s=e[r];if(i===s)return!0;if("object"!=typeof i||"object"!=typeof s)return!1;var a=o.objectHash;if(!a)return o.matchByPosition&&n===r;var c,u;return"number"==typeof n?(o.hashCache1=o.hashCache1||[],c=o.hashCache1[n],"undefined"==typeof c&&(o.hashCache1[n]=c=a(i,n))):c=a(i),"undefined"!=typeof c&&("number"==typeof r?(o.hashCache2=o.hashCache2||[],u=o.hashCache2[r],"undefined"==typeof u&&(o.hashCache2[r]=u=a(s,r))):u=a(s),"undefined"!=typeof u&&c===u)}var i=n(41).DiffContext,s=n(44).PatchContext,a=n(45).ReverseContext,c=n(49),u=3,f="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},l="function"==typeof Array.prototype.indexOf?function(t,e){return t.indexOf(e)}:function(t,e){for(var n=t.length,r=0;r<n;r++)if(t[r]===e)return r;return-1},d=function(t){if(t.leftIsArray){var e,n,s,a,f={objectHash:t.options&&t.options.objectHash,matchByPosition:t.options&&t.options.matchByPosition},d=0,h=0,p=t.left,v=t.right,y=p.length,g=v.length;for(y>0&&g>0&&!f.objectHash&&"boolean"!=typeof f.matchByPosition&&(f.matchByPosition=!r(p,v,y,g));d<y&&d<g&&o(p,v,d,d,f);)e=d,a=new i(t.left[e],t.right[e]),t.push(a,e),d++;for(;h+d<y&&h+d<g&&o(p,v,y-1-h,g-1-h,f);)n=y-1-h,s=g-1-h,a=new i(t.left[n],t.right[s]),t.push(a,s),h++;var m;if(d+h===y){if(y===g)return void t.setResult(void 0).exit();for(m=m||{_t:"a"},e=d;e<g-h;e++)m[e]=[v[e]];return void t.setResult(m).exit()}if(d+h===g){for(m=m||{_t:"a"},e=d;e<y-h;e++)m["_"+e]=[p[e],0,0];return void t.setResult(m).exit()}delete f.hashCache1,delete f.hashCache2;var _=p.slice(d,y-h),b=v.slice(d,g-h),w=c.get(_,b,o,f),k=[];for(m=m||{_t:"a"},e=d;e<y-h;e++)l(w.indices1,e-d)<0&&(m["_"+e]=[p[e],0,0],k.push(e));var E=!0;t.options&&t.options.arrays&&t.options.arrays.detectMove===!1&&(E=!1);var x=!1;t.options&&t.options.arrays&&t.options.arrays.includeValueOnMove&&(x=!0);var A=k.length;for(e=d;e<g-h;e++){var S=l(w.indices2,e-d);if(S<0){var j=!1;if(E&&A>0)for(var C=0;C<A;C++)if(n=k[C],o(_,b,n-d,e-d,f)){m["_"+n].splice(1,2,e,u),x||(m["_"+n][0]=""),s=e,a=new i(t.left[n],t.right[s]),t.push(a,s),k.splice(C,1),j=!0;break}j||(m[e]=[v[e]])}else n=w.indices1[S]+d,s=w.indices2[S]+d,a=new i(t.left[n],t.right[s]),t.push(a,s)}t.setResult(m).exit()}};d.filterName="arrays";var h={numerically:function(t,e){return t-e},numericallyBy:function(t){return function(e,n){return e[t]-n[t]}}},p=function(t){if(t.nested&&"a"===t.delta._t){var e,n,r=t.delta,o=t.left,i=[],a=[],c=[];for(e in r)if("_t"!==e)if("_"===e[0]){if(0!==r[e][2]&&r[e][2]!==u)throw new Error("only removal or move can be applied at original array indices, invalid diff type: "+r[e][2]);i.push(parseInt(e.slice(1),10))}else 1===r[e].length?a.push({index:parseInt(e,10),value:r[e][0]}):c.push({index:parseInt(e,10),delta:r[e]});for(i=i.sort(h.numerically),e=i.length-1;e>=0;e--){n=i[e];var f=r["_"+n],l=o.splice(n,1)[0];f[2]===u&&a.push({index:f[1],value:l})}a=a.sort(h.numericallyBy("index"));var d=a.length;for(e=0;e<d;e++){var p=a[e];o.splice(p.index,0,p.value)}var v,y=c.length;if(y>0)for(e=0;e<y;e++){var g=c[e];v=new s(t.left[g.index],g.delta),t.push(v,g.index)}return t.children?void t.exit():void t.setResult(t.left).exit()}};p.filterName="arrays";var v=function(t){if(t&&t.children&&"a"===t.delta._t){for(var e,n=t.children.length,r=0;r<n;r++)e=t.children[r],t.left[e.childName]=e.result;t.setResult(t.left).exit()}};v.filterName="arraysCollectChildren";var y=function(t){if(!t.nested)return void(t.delta[2]===u&&(t.newName="_"+t.delta[1],t.setResult([t.delta[0],parseInt(t.childName.substr(1),10),u]).exit()));if("a"===t.delta._t){var e,n;for(e in t.delta)"_t"!==e&&(n=new a(t.delta[e]),t.push(n,e));t.exit()}};y.filterName="arrays";var g=function(t,e,n){if("string"==typeof e&&"_"===e[0])return parseInt(e.substr(1),10);if(f(n)&&0===n[2])return"_"+e;var r=+e;for(var o in t){var i=t[o];if(f(i))if(i[2]===u){var s=parseInt(o.substr(1),10),a=i[1];if(a===+e)return s;s<=r&&a>r?r++:s>=r&&a<r&&r--}else if(0===i[2]){var c=parseInt(o.substr(1),10);c<=r&&r++}else 1===i.length&&o<=r&&r--}return r},m=function(t){if(t&&t.children&&"a"===t.delta._t){for(var e,n=t.children.length,r={_t:"a"},o=0;o<n;o++){e=t.children[o];var i=e.newName;"undefined"==typeof i&&(i=g(t.delta,e.childName,e.result)),r[i]!==e.result&&(r[i]=e.result)}t.setResult(r).exit()}};m.filterName="arraysCollectChildren",e.diffFilter=d,e.patchFilter=p,e.collectChildrenPatchFilter=v,e.reverseFilter=y,e.collectChildrenReverseFilter=m},function(t,e){var n=function(t,e,n,r){return t[n]===e[r]},r=function(t,e,n,r){var o,i,s=t.length,a=e.length,c=[s+1];for(o=0;o<s+1;o++)for(c[o]=[a+1],i=0;i<a+1;i++)c[o][i]=0;for(c.match=n,o=1;o<s+1;o++)for(i=1;i<a+1;i++)n(t,e,o-1,i-1,r)?c[o][i]=c[o-1][i-1]+1:c[o][i]=Math.max(c[o-1][i],c[o][i-1]);return c},o=function(t,e,n,r,i,s){if(0===r||0===i)return{sequence:[],indices1:[],indices2:[]};if(t.match(e,n,r-1,i-1,s)){var a=o(t,e,n,r-1,i-1,s);return a.sequence.push(e[r-1]),a.indices1.push(r-1),a.indices2.push(i-1),a}return t[r][i-1]>t[r-1][i]?o(t,e,n,r,i-1,s):o(t,e,n,r-1,i,s)},i=function(t,e,i,s){s=s||{};var a=r(t,e,i||n,s),c=o(a,t,e,t.length,e.length,s);return"string"==typeof t&&"string"==typeof e&&(c.sequence=c.sequence.join("")),c};e.get=i},function(t,e){var n=function(t){t.left instanceof Date?(t.right instanceof Date?t.left.getTime()!==t.right.getTime()?t.setResult([t.left,t.right]):t.setResult(void 0):t.setResult([t.left,t.right]),t.exit()):t.right instanceof Date&&t.setResult([t.left,t.right]).exit()};n.filterName="dates",e.diffFilter=n},function(t,e,n){var r=2,o=60,i=null,s=function(t){if(!i){var e;if("undefined"!=typeof diff_match_patch)e="function"==typeof diff_match_patch?new diff_match_patch:new diff_match_patch.diff_match_patch;else try{var r="diff_match_patch_uncompressed",o=n(52)("./"+r);e=new o.diff_match_patch}catch(s){e=null}if(!e){if(!t)return null;var a=new Error("text diff_match_patch library not found");throw a.diff_match_patch_not_found=!0,a}i={diff:function(t,n){return e.patch_toText(e.patch_make(t,n))},patch:function(t,n){for(var r=e.patch_apply(e.patch_fromText(n),t),o=0;o<r[1].length;o++)if(!r[1][o]){var i=new Error("text patch failed");i.textPatchFailed=!0}return r[0]}}}return i},a=function(t){if("string"===t.leftType){var e=t.options&&t.options.textDiff&&t.options.textDiff.minLength||o;if(t.left.length<e||t.right.length<e)return void t.setResult([t.left,t.right]).exit();var n=s();if(!n)return void t.setResult([t.left,t.right]).exit();var i=n.diff;t.setResult([i(t.left,t.right),0,r]).exit()}};a.filterName="texts";var c=function(t){if(!t.nested&&t.delta[2]===r){var e=s(!0).patch;t.setResult(e(t.left,t.delta[0])).exit()}};c.filterName="texts";var u=function(t){var e,n,r,o,i,s,a,c,u=null,f=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/;for(r=t.split("\n"),e=0,n=r.length;e<n;e++){o=r[e];var l=o.slice(0,1);"@"===l?(u=f.exec(o),s=e,a=null,c=null,r[s]="@@ -"+u[3]+","+u[4]+" +"+u[1]+","+u[2]+" @@"):"+"===l?(a=e,r[e]="-"+r[e].slice(1),"+"===r[e-1].slice(0,1)&&(i=r[e],r[e]=r[e-1],r[e-1]=i)):"-"===l&&(c=e,r[e]="+"+r[e].slice(1))}return r.join("\n")},f=function(t){t.nested||t.delta[2]===r&&t.setResult([u(t.delta[0]),0,r]).exit()};f.filterName="texts",e.diffFilter=a,e.patchFilter=c,e.reverseFilter=f},function(t,e,n){function r(t){return n(o(t))}function o(t){return i[t]||function(){throw new Error("Cannot find module '"+t+"'.")}()}var i={"../package.json":53,"./console":54,"./formatters":63};r.keys=function(){return Object.keys(i)},r.resolve=o,t.exports=r,r.id=52},function(t,e){t.exports={_args:[["jsondiffpatch@0.2.4","/home/adelina/telepat-js"]],_from:"jsondiffpatch@0.2.4",_id:"jsondiffpatch@0.2.4",_inBundle:!1,_integrity:"sha1-1LbFOz/H2htLkcHCrsi5MrdRHVw=",_location:"/jsondiffpatch",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"jsondiffpatch@0.2.4",name:"jsondiffpatch",escapedName:"jsondiffpatch",rawSpec:"0.2.4",saveSpec:null,fetchSpec:"0.2.4"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/jsondiffpatch/-/jsondiffpatch-0.2.4.tgz",_spec:"0.2.4",_where:"/home/adelina/telepat-js",author:{name:"Benjamin Eidelman",email:"beneidel@gmail.com"},bin:{jsondiffpatch:"./bin/jsondiffpatch"},bugs:{url:"https://github.com/benjamine/jsondiffpatch/issues"},bundleDependencies:[],contributors:[{name:"Benjamin Eidelman",email:"beneidel@gmail.com"}],dependencies:{chalk:"^0.5.1"},description:"Diff & Patch for Javascript objects",devDependencies:{"bulk-require":"^0.2.1","codeclimate-test-reporter":"0.0.3","expect.js":"~0.3.1",fiberglass:"0.0.22",gulp:"^3.8.8",istanbul:"^0.3.2",mocha:"^1.21.4"},engine:{node:">=0.10"},engines:{node:"*"},homepage:"https://github.com/benjamine/jsondiffpatch",keywords:["json","diff","patch"],license:"MIT",main:"./src/main",name:"jsondiffpatch",repository:{type:"git",url:"git+https://github.com/benjamine/jsondiffpatch.git"},scripts:{bump:"gulp bump",cover:"istanbul cover --root src gulp test","cover-publish":"istanbul cover _mocha --report lcovonly && codeclimate < coverage/lcov.info","cover-report":"open coverage/lcov-report/index.html",test:"gulp test && gulp test-browser"},testling:{harness:"mocha",files:"test/index.js",scripts:["build/jsondiffpatch.js","external/diff_match_patch_uncompressed.js"],browsers:["ie/8..latest","chrome/27..latest","firefox/22..latest","safari/5.1..latest","opera/12..latest","iphone/6..latest","ipad/6..latest","android-browser/4.2..latest"]},version:"0.2.4"}},function(t,e,n){var r=n(55),o=n(62),i=o.BaseFormatter,s={added:r.green,deleted:r.red,movedestination:r.gray,moved:r.yellow,unchanged:r.gray,error:r.white.bgRed,textDiffLine:r.gray},a=function(){this.includeMoveDestinations=!1};a.prototype=new i,a.prototype.prepareContext=function(t){i.prototype.prepareContext.call(this,t),t.indent=function(t){this.indentLevel=(this.indentLevel||0)+("undefined"==typeof t?1:t),this.indentPad=new Array(this.indentLevel+1).join("  "),this.outLine()},t.outLine=function(){this.buffer.push("\n"+(this.indentPad||""))},t.out=function(){for(var t=0,e=arguments.length;t<e;t++){var n=arguments[t].split("\n"),r=n.join("\n"+(this.indentPad||""));this.color&&this.color[0]&&(r=this.color[0](r)),this.buffer.push(r)}},t.pushColor=function(t){this.color=this.color||[],this.color.unshift(t)},t.popColor=function(){this.color=this.color||[],this.color.shift()}},a.prototype.typeFormattterErrorFormatter=function(t,e){t.pushColor(s.error),t.out("[ERROR]"+e),t.popColor()},a.prototype.formatValue=function(t,e){t.out(JSON.stringify(e,null,2))},a.prototype.formatTextDiffString=function(t,e){var n=this.parseTextDiff(e);t.indent();for(var r=0,o=n.length;r<o;r++){var i=n[r];t.pushColor(s.textDiffLine),t.out(i.location.line+","+i.location.chr+" "),t.popColor();for(var a=i.pieces,c=0,u=a.length;c<u;c++){var f=a[c];t.pushColor(s[f.type]),t.out(f.text),t.popColor()}r<o-1&&t.outLine()}t.indent(-1)},a.prototype.rootBegin=function(t,e,n){t.pushColor(s[e]),"node"===e&&(t.out("array"===n?"[":"{"),t.indent())},a.prototype.rootEnd=function(t,e,n){"node"===e&&(t.indent(-1),t.out("array"===n?"]":"}")),t.popColor()},a.prototype.nodeBegin=function(t,e,n,r,o){t.pushColor(s[r]),t.out(n+": "),"node"===r&&(t.out("array"===o?"[":"{"),t.indent())},a.prototype.nodeEnd=function(t,e,n,r,o,i){"node"===r&&(t.indent(-1),t.out("array"===o?"]":"}"+(i?"":","))),i||t.outLine(),t.popColor()},a.prototype.format_unchanged=function(t,e,n){"undefined"!=typeof n&&this.formatValue(t,n)},a.prototype.format_movedestination=function(t,e,n){"undefined"!=typeof n&&this.formatValue(t,n)},a.prototype.format_node=function(t,e,n){this.formatDeltaChildren(t,e,n)},a.prototype.format_added=function(t,e){this.formatValue(t,e[0])},a.prototype.format_modified=function(t,e){t.pushColor(s.deleted),this.formatValue(t,e[0]),t.popColor(),t.out(" => "),t.pushColor(s.added),this.formatValue(t,e[1]),t.popColor()},a.prototype.format_deleted=function(t,e){this.formatValue(t,e[0])},a.prototype.format_moved=function(t,e){t.out("==> "+e[1])},a.prototype.format_textdiff=function(t,e){this.formatTextDiffString(t,e[0])},e.ConsoleFormatter=a;var c,u=function(t,e){return c||(c=new a),c.format(t,e)};e.log=function(t,e){console.log(u(t,e))},e.format=u},function(t,e,n){"use strict";function r(t){var e=function n(){return o.apply(n,arguments)};return e._styles=t,e.__proto__=p,e}function o(){var t=arguments,e=t.length,n=0!==e&&String(arguments[0]);if(e>1)for(var r=1;r<e;r++)n+=" "+t[r];if(!d.enabled||!n)return n;for(var o=this._styles,i=0;i<o.length;i++){var s=a[o[i]];n=s.open+n.replace(s.closeRe,s.open)+s.close}return n}function i(){var t={};return Object.keys(h).forEach(function(e){t[e]={get:function(){return r([e])}}}),t}var s=n(56),a=n(57),c=n(58),u=n(60),f=n(61),l=Object.defineProperties,d=t.exports,h=function(){var t={};return a.grey=a.gray,Object.keys(a).forEach(function(e){a[e].closeRe=new RegExp(s(a[e].close),"g"),t[e]={get:function(){return r(this._styles.concat(e))}}}),t}(),p=l(function(){},h);l(d,i()),d.styles=a,d.hasColor=u,d.stripColor=c,d.supportsColor=f,void 0===d.enabled&&(d.enabled=d.supportsColor)},function(t,e){"use strict";var n=/[|\\{}()[\]^$+*?.]/g;t.exports=function(t){if("string"!=typeof t)throw new TypeError("Expected a string");return t.replace(n,"\\$&")}},function(t,e){"use strict";var n=t.exports,r={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49]};Object.keys(r).forEach(function(t){var e=r[t],o=n[t]={};o.open="["+e[0]+"m",o.close="["+e[1]+"m"})},function(t,e,n){"use strict";var r=n(59)();t.exports=function(t){return"string"==typeof t?t.replace(r,""):t}},function(t,e){"use strict";t.exports=function(){return/\u001b\[(?:[0-9]{1,3}(?:;[0-9]{1,3})*)?[m|K]/g}},function(t,e,n){"use strict";var r=n(59),o=new RegExp(r().source);t.exports=o.test.bind(o)},function(t,e,n){(function(e){"use strict";t.exports=function(){return e.argv.indexOf("--no-color")===-1&&(e.argv.indexOf("--color")!==-1||!(e.stdout&&!e.stdout.isTTY)&&("win32"===e.platform||("COLORTERM"in e.env||"dumb"!==e.env.TERM&&!!/^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(e.env.TERM))))}()}).call(e,n(1))},function(t,e){var n="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},r="function"==typeof Object.keys?function(t){return Object.keys(t)}:function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e},o=function(t){return"_"===t.substr(0,1)?t.slice(1):t},i=function(t){return"_t"===t?-1:"_"===t.substr(0,1)?parseInt(t.slice(1),10):parseInt(t,10)+.1},s=function(t,e){return i(t)-i(e)},a=function(){};a.prototype.format=function(t,e){var n={};return this.prepareContext(n),this.recurse(n,t,e),this.finalize(n)},a.prototype.prepareContext=function(t){t.buffer=[],t.out=function(){this.buffer.push.apply(this.buffer,arguments)}},a.prototype.typeFormattterNotFound=function(t,e){throw new Error("cannot format delta type: "+e)},a.prototype.typeFormattterErrorFormatter=function(t,e){return e.toString()},a.prototype.finalize=function(t){if(n(t.buffer))return t.buffer.join("")},a.prototype.recurse=function(t,e,n,r,o,i,s){var a=e&&i,c=a?i.value:n;if("undefined"!=typeof e||"undefined"!=typeof r){var u=this.getDeltaType(e,i),f="node"===u?"a"===e._t?"array":"object":"";"undefined"!=typeof r?this.nodeBegin(t,r,o,u,f,s):this.rootBegin(t,u,f);var l;try{l=this["format_"+u]||this.typeFormattterNotFound(t,u),l.call(this,t,e,c,r,o,i)}catch(d){this.typeFormattterErrorFormatter(t,d,e,c,r,o,i),"undefined"!=typeof console&&console.error&&console.error(d.stack)}"undefined"!=typeof r?this.nodeEnd(t,r,o,u,f,s):this.rootEnd(t,u,f)}},a.prototype.formatDeltaChildren=function(t,e,n){var r=this;this.forEachDeltaKey(e,n,function(o,i,s,a){r.recurse(t,e[o],n?n[i]:void 0,o,i,s,a)})},a.prototype.forEachDeltaKey=function(t,e,i){var a,c=r(t),u="a"===t._t,f={};if("undefined"!=typeof e)for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&("undefined"!=typeof t[a]||u&&"undefined"!=typeof t["_"+a]||c.push(a));for(a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var l=t[a];n(l)&&3===l[2]&&(f[l[1].toString()]={key:a,value:e&&e[parseInt(a.substr(1))]},this.includeMoveDestinations!==!1&&"undefined"==typeof e&&"undefined"==typeof t[l[1]]&&c.push(l[1].toString()))}u?c.sort(s):c.sort();for(var d=0,h=c.length;d<h;d++){var p=c[d];if(!u||"_t"!==p){var v=u?"number"==typeof p?p:parseInt(o(p),10):p,y=d===h-1;i(p,v,f[v],y)}}},a.prototype.getDeltaType=function(t,e){if("undefined"==typeof t)return"undefined"!=typeof e?"movedestination":"unchanged";if(n(t)){if(1===t.length)return"added";if(2===t.length)return"modified";if(3===t.length&&0===t[2])return"deleted";if(3===t.length&&2===t[2])return"textdiff";if(3===t.length&&3===t[2])return"moved"}else if("object"==typeof t)return"node";return"unknown"},a.prototype.parseTextDiff=function(t){for(var e=[],n=t.split("\n@@ "),r=0,o=n.length;r<o;r++){var i=n[r],s={pieces:[]},a=/^(?:@@ )?[-+]?(\d+),(\d+)/.exec(i).slice(1);s.location={line:a[0],chr:a[1]};for(var c=i.split("\n").slice(1),u=0,f=c.length;u<f;u++){var l=c[u];if(l.length){var d={type:"context"};"+"===l.substr(0,1)?d.type="added":"-"===l.substr(0,1)&&(d.type="deleted"),d.text=l.slice(1),s.pieces.push(d)}}e.push(s)}return e},e.BaseFormatter=a},function(t,e,n){var r=n(37);if(e.base=n(62),e.html=n(64),e.annotated=n(65),e.jsonpatch=n(66),!r.isBrowser){var o="./console";e.console=n(52)(o)}},function(t,e,n){function r(t){for(var e=t,n=[[/&/g,"&amp;"],[/</g,"&lt;"],[/>/g,"&gt;"],[/'/g,"&apos;"],[/"/g,"&quot;"]],r=0;r<n.length;r++)e=e.replace(n[r][0],n[r][1]);return e}var o=n(62),i=o.BaseFormatter,s=function(){};s.prototype=new i,s.prototype.typeFormattterErrorFormatter=function(t,e){t.out('<pre class="jsondiffpatch-error">'+e+"</pre>")},s.prototype.formatValue=function(t,e){t.out("<pre>"+r(JSON.stringify(e,null,2))+"</pre>")},s.prototype.formatTextDiffString=function(t,e){var n=this.parseTextDiff(e);t.out('<ul class="jsondiffpatch-textdiff">');for(var o=0,i=n.length;o<i;o++){var s=n[o];t.out('<li><div class="jsondiffpatch-textdiff-location"><span class="jsondiffpatch-textdiff-line-number">'+s.location.line+'</span><span class="jsondiffpatch-textdiff-char">'+s.location.chr+'</span></div><div class="jsondiffpatch-textdiff-line">');for(var a=s.pieces,c=0,u=a.length;c<u;c++){var f=a[c];t.out('<span class="jsondiffpatch-textdiff-'+f.type+'">'+r(unescape(f.text))+"</span>")}t.out("</div></li>")}t.out("</ul>")};var a=function(t){t=t||document;var e=function(t){return t.textContent||t.innerText},n=function(t,e,n){for(var r=t.querySelectorAll(e),o=0,i=r.length;o<i;o++)n(r[o])},r=function(t,e){for(var n=0,r=t.children.length;n<r;n++)e(t.children[n],n)};n(t,".jsondiffpatch-arrow",function(t){var n=t.parentNode,o=t.children[0],i=o.children[1];o.style.display="none";var s,a=e(n.querySelector(".jsondiffpatch-moved-destination")),c=n.parentNode;if(r(c,function(t){t.getAttribute("data-key")===a&&(s=t)}),s)try{var u=s.offsetTop-n.offsetTop;o.setAttribute("height",Math.abs(u)+6),t.style.top=-8+(u>0?0:u)+"px";var f=u>0?"M30,0 Q-10,"+Math.round(u/2)+" 26,"+(u-4):"M30,"+-u+" Q-10,"+Math.round(-u/2)+" 26,4";i.setAttribute("d",f),o.style.display=""}catch(l){return}})};s.prototype.rootBegin=function(t,e,n){var r="jsondiffpatch-"+e+(n?" jsondiffpatch-child-node-type-"+n:"");t.out('<div class="jsondiffpatch-delta '+r+'">')},s.prototype.rootEnd=function(t){t.out("</div>"+(t.hasArrows?'<script type="text/javascript">setTimeout('+a.toString()+",10);</script>":""))},s.prototype.nodeBegin=function(t,e,n,r,o){var i="jsondiffpatch-"+r+(o?" jsondiffpatch-child-node-type-"+o:"");t.out('<li class="'+i+'" data-key="'+n+'"><div class="jsondiffpatch-property-name">'+n+"</div>")},s.prototype.nodeEnd=function(t){t.out("</li>")},s.prototype.format_unchanged=function(t,e,n){"undefined"!=typeof n&&(t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,n),t.out("</div>"))},s.prototype.format_movedestination=function(t,e,n){"undefined"!=typeof n&&(t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,n),t.out("</div>"))},s.prototype.format_node=function(t,e,n){var r="a"===e._t?"array":"object";t.out('<ul class="jsondiffpatch-node jsondiffpatch-node-type-'+r+'">'),this.formatDeltaChildren(t,e,n),t.out("</ul>")},s.prototype.format_added=function(t,e){t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,e[0]),t.out("</div>")},s.prototype.format_modified=function(t,e){t.out('<div class="jsondiffpatch-value jsondiffpatch-left-value">'),this.formatValue(t,e[0]),t.out('</div><div class="jsondiffpatch-value jsondiffpatch-right-value">'),this.formatValue(t,e[1]),t.out("</div>")},s.prototype.format_deleted=function(t,e){t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,e[0]),t.out("</div>")},s.prototype.format_moved=function(t,e){t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,e[0]),t.out('</div><div class="jsondiffpatch-moved-destination">'+e[1]+"</div>"),t.out('<div class="jsondiffpatch-arrow" style="position: relative; left: -34px;">\t        <svg width="30" height="60" style="position: absolute; display: none;">\t        <defs>\t            <marker id="markerArrow" markerWidth="8" markerHeight="8" refx="2" refy="4"\t                   orient="auto" markerUnits="userSpaceOnUse">\t                <path d="M1,1 L1,7 L7,4 L1,1" style="fill: #339;" />\t            </marker>\t        </defs>\t        <path d="M30,0 Q-10,25 26,50" style="stroke: #88f; stroke-width: 2px; fill: none;\t        stroke-opacity: 0.5; marker-end: url(#markerArrow);"></path>\t        </svg>\t        </div>'),t.hasArrows=!0},s.prototype.format_textdiff=function(t,e){t.out('<div class="jsondiffpatch-value">'),this.formatTextDiffString(t,e[0]),t.out("</div>")};var c=function(t,e,n){var r=e||document.body,o="jsondiffpatch-unchanged-",i={showing:o+"showing",hiding:o+"hiding",visible:o+"visible",hidden:o+"hidden"},s=r.classList;if(s){if(!n)return s.remove(i.showing),s.remove(i.hiding),s.remove(i.visible),s.remove(i.hidden),void(t===!1&&s.add(i.hidden));t===!1?(s.remove(i.showing),s.add(i.visible),setTimeout(function(){s.add(i.hiding)},10)):(s.remove(i.hiding),s.add(i.showing),s.remove(i.hidden));var c=setInterval(function(){a(r)},100);setTimeout(function(){s.remove(i.showing),s.remove(i.hiding),t===!1?(s.add(i.hidden),s.remove(i.visible)):(s.add(i.visible),s.remove(i.hidden)),setTimeout(function(){s.remove(i.visible),clearInterval(c)},n+400)},n)}},u=function(t,e){return c(!1,t,e)};e.HtmlFormatter=s,e.showUnchanged=c,e.hideUnchanged=u;var f;e.format=function(t,e){return f||(f=new s),f.format(t,e)}},function(t,e,n){var r=n(62),o=r.BaseFormatter,i=function(){this.includeMoveDestinations=!1};i.prototype=new o,i.prototype.prepareContext=function(t){o.prototype.prepareContext.call(this,t),t.indent=function(t){this.indentLevel=(this.indentLevel||0)+("undefined"==typeof t?1:t),this.indentPad=new Array(this.indentLevel+1).join("&nbsp;&nbsp;")},t.row=function(e,n){t.out('<tr><td style="white-space: nowrap;"><pre class="jsondiffpatch-annotated-indent" style="display: inline-block">'),t.out(t.indentPad),t.out('</pre><pre style="display: inline-block">'),t.out(e),t.out('</pre></td><td class="jsondiffpatch-delta-note"><div>'),t.out(n),t.out("</div></td></tr>")}},i.prototype.typeFormattterErrorFormatter=function(t,e){t.row("",'<pre class="jsondiffpatch-error">'+e+"</pre>")},i.prototype.formatTextDiffString=function(t,e){var n=this.parseTextDiff(e);t.out('<ul class="jsondiffpatch-textdiff">');for(var r=0,o=n.length;r<o;r++){var i=n[r];t.out('<li><div class="jsondiffpatch-textdiff-location"><span class="jsondiffpatch-textdiff-line-number">'+i.location.line+'</span><span class="jsondiffpatch-textdiff-char">'+i.location.chr+'</span></div><div class="jsondiffpatch-textdiff-line">');for(var s=i.pieces,a=0,c=s.length;a<c;a++){var u=s[a];t.out('<span class="jsondiffpatch-textdiff-'+u.type+'">'+u.text+"</span>")}t.out("</div></li>")}t.out("</ul>")},i.prototype.rootBegin=function(t,e,n){t.out('<table class="jsondiffpatch-annotated-delta">'),"node"===e&&(t.row("{"),t.indent()),"array"===n&&t.row('"_t": "a",',"Array delta (member names indicate array indices)")},i.prototype.rootEnd=function(t,e){"node"===e&&(t.indent(-1),t.row("}")),t.out("</table>")},i.prototype.nodeBegin=function(t,e,n,r,o){t.row("&quot;"+e+"&quot;: {"),"node"===r&&t.indent(),"array"===o&&t.row('"_t": "a",',"Array delta (member names indicate array indices)")},i.prototype.nodeEnd=function(t,e,n,r,o,i){"node"===r&&t.indent(-1),t.row("}"+(i?"":","))},i.prototype.format_unchanged=function(){},i.prototype.format_movedestination=function(){},i.prototype.format_node=function(t,e,n){this.formatDeltaChildren(t,e,n)};var s=function(t){return'<pre style="display:inline-block">&quot;'+t+"&quot;</pre>"},a={added:function(t,e,n,r){var o=" <pre>([newValue])</pre>";return"undefined"==typeof r?"new value"+o:"number"==typeof r?"insert at index "+r+o:"add property "+s(r)+o},modified:function(t,e,n,r){var o=" <pre>([previousValue, newValue])</pre>";return"undefined"==typeof r?"modify value"+o:"number"==typeof r?"modify at index "+r+o:"modify property "+s(r)+o},deleted:function(t,e,n,r){var o=" <pre>([previousValue, 0, 0])</pre>";return"undefined"==typeof r?"delete value"+o:"number"==typeof r?"remove index "+r+o:"delete property "+s(r)+o},moved:function(t,e,n,r){return'move from <span title="(position to remove at original state)">index '+r+'</span> to <span title="(position to insert at final state)">index '+t[1]+"</span>"},textdiff:function(t,e,n,r){var o="undefined"==typeof r?"":"number"==typeof r?" at index "+r:" at property "+s(r);return"text diff"+o+', format is <a href="https://code.google.com/p/google-diff-match-patch/wiki/Unidiff">a variation of Unidiff</a>'}},c=function(t,e){var n=this.getDeltaType(e),r=a[n],o=r&&r.apply(r,Array.prototype.slice.call(arguments,1)),i=JSON.stringify(e,null,2);"textdiff"===n&&(i=i.split("\\n").join('\\n"+\n   "')),t.indent(),t.row(i,o),t.indent(-1)};i.prototype.format_added=c,i.prototype.format_modified=c,i.prototype.format_deleted=c,i.prototype.format_moved=c,i.prototype.format_textdiff=c,e.AnnotatedFormatter=i;var u;e.format=function(t,e){return u||(u=new i),u.format(t,e)}},function(t,e,n){!function(){function t(){this.includeMoveDestinations=!1}function r(t){return t[t.length-1]}function o(t,e){return t.sort(e),t}function i(t){return o(t,function(t,e){var n=t.path.split("/"),o=e.path.split("/");return n.length!==o.length?n.length-o.length:d(r(n),r(o))})}function s(t,e){var n=[],r=[];return t.forEach(function(t){var o=e(t)?n:r;o.push(t)}),[n,r]}function a(t){var e=s(t,function(t){return"remove"===t.op}),n=e[0],r=e[1],o=i(n);return o.concat(r)}var c=n(62),u=c.BaseFormatter,f={added:"add",deleted:"remove",modified:"replace",moved:"moved",movedestination:"movedestination",unchanged:"unchanged",error:"error",textDiffLine:"textDiffLine"};t.prototype=new u,t.prototype.prepareContext=function(t){u.prototype.prepareContext.call(this,t),t.result=[],t.path=[],t.pushCurrentOp=function(t,e){var n={op:t,path:this.currentPath()};"undefined"!=typeof e&&(n.value=e),this.result.push(n)},t.currentPath=function(){return"/"+this.path.join("/")}},t.prototype.typeFormattterErrorFormatter=function(t,e){t.out("[ERROR]"+e)},t.prototype.rootBegin=function(){},t.prototype.rootEnd=function(){},t.prototype.nodeBegin=function(t,e,n){t.path.push(n)},t.prototype.nodeEnd=function(t){t.path.pop()},t.prototype.format_unchanged=function(t,e,n){"undefined"!=typeof n&&t.pushCurrentOp(f.unchanged,n)},t.prototype.format_movedestination=function(t,e,n){"undefined"!=typeof n&&t.pushCurrentOp(f.movedestination,n)},t.prototype.format_node=function(t,e,n){this.formatDeltaChildren(t,e,n)},t.prototype.format_added=function(t,e){t.pushCurrentOp(f.added,e[0])},t.prototype.format_modified=function(t,e){t.pushCurrentOp(f.modified,e[1])},t.prototype.format_deleted=function(t){t.pushCurrentOp(f.deleted)},t.prototype.format_moved=function(t,e){t.pushCurrentOp(f.moved,e[1])},t.prototype.format_textdiff=function(){throw"not implimented"},t.prototype.format=function(t,e){var n={};return this.prepareContext(n),this.recurse(n,t,e),n.result},e.JSONFormatter=t;var l,d=function(t,e){var n=parseInt(t,10),r=parseInt(e,10);return isNaN(n)||isNaN(r)?0:r-n},h=function(e,n){return l||(l=new t),a(l.format(e,n))};e.log=function(t,e){console.log(h(t,e))},e.format=h}()},function(t,e){t.exports=function(t,e){var n;return"string"==typeof e&&(n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d*))?(Z|([+\-])(\d{2}):(\d{2}))$/.exec(e))?new Date(Date.UTC(+n[1],+n[2]-1,+n[3],+n[4],+n[5],+n[6],+(n[7]||0))):e}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(30),a=r(s),c=n(19),u=r(c),f=n(27),l=r(f),d=n(29),h=r(d),p=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;o(this,t),this._event=new a["default"](l["default"]),this._monitor=e,this._options=n,this._addCallback=r,this._updateCallback=s,this._removeCallback=c,this._subscribed=!1,this.objects={},this.objectsArray=[],this.objectsCount=null,this._event.on("update",function(t,e,n,r){"add"===t?(i.objectsArray.push(n),i._sortObjectArray(),i.objectsCount&&i.objectsCount++):"delete"===t&&(i.objectsArray=i.objectsArray.filter(function(t){return t.id!==e}),i._sortObjectArray(),i.objectsCount&&i.objectsCount--)})}return i(t,[{key:"_sortObjectArray",value:function(){var t=this;this._options.sort&&this.objectsArray.sort(function(e,n){var r=null;return Object.keys(t._options.sort).map(function(o){var i=t._options.sort[o],s="asc"===i?1:-1;e[o]&&!n[o]&&(r=s),!e[o]&&n[o]&&(r=-s),e[o]&&n[o]&&(e[o]<n[o]&&(r=-s),e[o]>n[o]&&(r=s))}),r?r:0})}},{key:"subscribe",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};u["default"].call("object/subscribe",this._options,function(n,r){if(n)t._event.emit("error",(0,h["default"])("Subscribe failed with error: "+n)),e(n,null);else{var o=void 0;for(t.objects={},t.objectsArray=[],t.objectsCount=0,o=0;o<r.body.content.length;o++)t.objects[r.body.content[o].id]=r.body.content[o];t.objectsArray=r.body.content,t._sortObjectArray();var i=Object.keys(t.objects);for(o=0;o<i.length;o++)t.objects[i[o]].$$event=new a["default"](l["default"]);t._monitor.add(t._options,t.objects,t._event,t._addCallback||t.add.bind(t),t._removeCallback||t.remove.bind(t),t._updateCallback||t.update.bind(t)),t._subscribed?t._event.emit("update","resync"):t._event.emit("subscribe"),t._subscribed=!0,e(null,t)}})}},{key:"unsubscribe",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};u["default"].call("object/unsubscribe",this._options,function(n){n?(t._event.emit("error",(0,h["default"])("Unsubscribe failed with error: "+n)),e(n,null)):(t.objects={},t.objectsArray=[],t.objectsCount=null,
t._monitor.remove(t._options),t._event.emit("unsubscribe"),t._event.emit("_unsubscribe"),t._subscribed=!1,e(null,t))})}},{key:"getCount",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};u["default"].call("object/count",this._options,function(n,r){n?(t._event.emit("error",(0,h["default"])("Get object count failed with error: "+n)),e(n,null)):(t.objectsCount=r.body.content.count,e(null,t.objectsCount))})}},{key:"add",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};u["default"].call("object/create",{model:this._options.channel.model,context:this._options.channel.context||t.context_id,content:t},function(r){r?(e._event.emit("error",(0,h["default"])("Adding object failed with error: "+r)),n(r,null)):n(null,t)})}},{key:"remove",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};u["default"].del("object/delete",{model:this._options.channel.model,context:this._options.channel.context||this.objects[t].context_id,id:t},function(r){r?(e._event.emit("error",(0,h["default"])("Removing object failed with error: "+r)),n(r,null)):n(null,t)})}},{key:"update",value:function(t,e){var n=this;arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};u["default"].call("object/update",{model:this._options.channel.model,context:this._options.channel.context||this.objects[t].context_id,id:t,patches:e},function(t){t&&n._event.emit("error",(0,h["default"])("Updating object failed with error: "+t))})}},{key:"on",value:function(t,e){return this._event.on(t,e)}},{key:"removeCallback",value:function(t,e){return this._event.removeCallback(t,e)}}]),t}();e["default"]=p,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(19),a=r(s),c=n(27),u=r(c),f=n(29),l=r(f),d=n(70),h=r(d),p=function(){function t(e,n,r,i){var s=this,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){};o(this,t),this._event=n,this._monitor=r,this._setAdmin=i,this._db=e,this._customProperties=[],this._userChannel=null,this.tokenKey=":userToken"+c,this.isAdmin=!1,this.canReauth=null,this.data={},this.isLoggedIn=!1,a["default"].tokenUpdateCallback=function(t){s._saveToken(t)},this._db.get(this.tokenKey).then(function(t){s.canReauth=!0,u()})["catch"](function(){s.canReauth=!1,u()})}return i(t,[{key:"_saveToken",value:function(t){var e=this,n={_id:this.tokenKey,value:{token:t,admin:this.isAdmin}};this._db.get(this.tokenKey).then(function(t){n._rev=t._rev,u["default"].info("Replacing existing authentication token"),e._db.put(n).then(function(t){e.canReauth=!0})["catch"](function(t){e.canReauth=!1,u["default"].warn("Could not persist authentication token. Error: "+t)})})["catch"](function(){e._db.put(n).then(function(t){e.canReauth=!0})["catch"](function(t){e.canReauth=!1,u["default"].warn("Could not persist authentication token. Error: "+t)})})}},{key:"_login",value:function(t,e,n){var r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i=function(t){var e={};r.isLoggedIn=!0;for(var i in t.body.content.user)r.data[i]=t.body.content.user[i],r._customProperties.push(i);n&&(r.isAdmin=!0,r._setAdmin(new h["default"](r))),e[r.data.id]=r.data,r._monitor.add({channel:{model:r.isAdmin?"admin":"user"}},e,null,function(){},function(){},r.update.bind(r)),a["default"].authenticationToken=t.body.content.token,r._saveToken(a["default"].authenticationToken),r._event.emit("login"),o(null,r)};a["default"].call(t,e,function(n,s){n?404===n.status&&e.hasOwnProperty("access_token")?(u["default"].info("Got 404 on Facebook login, registering user first"),a["default"].call("user/register-facebook",e,function(n,o){n?(u["default"].error("Failed to login with Facebook. Could not register or login user."),r._event.emit("login_error",(0,l["default"])("Login failed with error: "+n))):a["default"].call(t,e,function(t,e){t?(u["default"].error("Failed to login with Facebook. User registration was successful, but login failed."),this._event.emit("login_error",(0,l["default"])("Login failed with error: "+t))):i(e)})})):(r._event.emit("login_error",(0,l["default"])("Login failed with error: "+n)),o(n,null)):i(s)})}},{key:"reauth",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this._db.get(this.tokenKey).then(function(n){u["default"].info("Retrieved saved authentication token"),a["default"].authenticationToken=n.value.token,a["default"].get(n.value.admin?"admin/me":"user/me","",function(t,r){if(t)a["default"].authenticationToken=null,this._setAdmin(null),this._db.remove(n._id,n._rev),this.canReauth=!1,e((0,l["default"])("Saved authentication token expired"),null),this._customProperties=[],this.data={},this.isLoggedIn=!1,this._event.emit("logout");else{var o={};this.isLoggedIn=!0;for(var i in r.body.content)this.data[i]=r.body.content[i],this._customProperties.push(i);"admin"===r.body.content.type&&(this.isAdmin=!0,this._saveToken(a["default"].authenticationToken),this._setAdmin(new h["default"](this))),o[this.data.id]=this.data,this._monitor.add({channel:{model:this.isAdmin?"admin":"user"}},o,null,function(){},function(){},this.update.bind(this)),e(null,r),this._event.emit("login")}}.bind(t))})["catch"](function(t){e((0,l["default"])("Error retrieving authentication token: "+t),null)})}},{key:"update",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};a["default"].call(this.isAdmin?"admin/update":"user/update",{patches:e},function(t,e){t?n((0,l["default"])("Failed updating user: "+e.body.message)):n()})}},{key:"requestPasswordReset",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(!t){if(!this.email)return void n((0,l["default"])("You must provide a valid email address for the account that needs the password reset"),null);t=this.email}a["default"].call("user/request_password_reset",{callbackUrl:e,username:t},function(t,e){t?n((0,l["default"])("Password reset request failed with error: "+t),null):n(null,e.body.content)})}},{key:"resetPassword",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};return t&&e&&n?void a["default"].call("user/password_reset",{token:e,user_id:t,password:n},function(t,e){t?r((0,l["default"])("Password reset request failed with error: "+t),null):r(null,e.body.content)}):void r((0,l["default"])("You must provide a valid user-id, pass reset token and new password for the account that needs the password reset"),null)}},{key:"register",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};a["default"].call("user/register-username",t,e)}},{key:"registerAdmin",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};a["default"].call("admin/add",t,function(t,n){t?e((0,l["default"])("Register failed with error: "+n.body.message||""),null):e(null,n.body.content)})}},{key:"loginWithFacebook",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return this._login("user/login-facebook",{access_token:t},!1,e)}},{key:"login",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};return this._login("user/login_password",{username:t,password:e},!1,n)}},{key:"loginAdmin",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};return this._login("admin/login",{email:t,password:e},!0,n)}},{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};a["default"].get("user/get","user_id="+encodeURIComponent(t),function(t,n){t?e((0,l["default"])("Retrieving user failed with error: "+t),null):e(null,n.body.content)})}},{key:"me",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};a["default"].get(this.isAdmin?"admin/me":"user/me","",function(e,n){e?t(console.error("Request failed with error: "+e),null):t(null,JSON.parse(n.text).content)})}},{key:"logout",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this._db.get(this.tokenKey).then(function(e){t._db.remove(e._id,e._rev)})["catch"](function(){}),this._setAdmin(null),this.isAdmin=!1,this.isLoggedIn=!1,this.canReauth=!1,this._customProperties=[],this.data={},a["default"].get("user/logout","",function(n){a["default"].authenticationToken=null,n?(t._event.emit("logout_error",(0,l["default"])("Logout failed with error: "+n)),e(n)):(t._event.emit("logout"),e())})}}]),t}();e["default"]=p,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(19),a=r(s),c=n(29),u=r(c),f=n(30),l=r(f),d=n(27),h=r(d),p=function(){function t(e){o(this,t),this._user=e,this._monitor=e._monitor,this._event=e._event,this.userChannel=null,this.apps=null,this.app=null,this.users=null}return i(t,[{key:"getApps",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};a["default"].call("admin/apps","",function(n,r){if(n)e((0,u["default"])("Retrieving apps failed with error: "+n),null);else{t.apps={};for(var o in r.body.content){var i=r.body.content[o];t.apps[i.id]=i}t.app=t.apps[a["default"].appId],t._monitor.add({channel:{model:"application"}},t.apps,new l["default"](h["default"]),function(){},function(){},t.updateApp),e(null,r.body.content)}},"get")}},{key:"addApp",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};a["default"].call("admin/app/add",t,function(t,r){t?n((0,u["default"])("Adding application failed with error: "+t),null):(e._monitor.processMessage({data:{"new":[{op:"create",object:r.body.content,subscriptions:["blg:null:application"]}],updated:[],deleted:[]}}),n(null,r.body.content))})}},{key:"updateApp",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};t!==a["default"].appId&&n((0,u["default"])("Cannot update an app that is not active. Please reconnect to that specific app id to make updates.")),a["default"].call("admin/app/update",{id:t,patches:e},function(t,e){t?n((0,u["default"])("Updating application failed with error: "+t)):n()})}},{key:"deleteApp",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};a["default"].del("admin/app/remove",{id:t},function(r,o){r?n((0,u["default"])("Removing application failed with error: "+r),null):(e._monitor.processMessage({data:{deleted:[{op:"delete",object:{id:t},subscriptions:["blg:null:application"]}],updated:[],"new":[]}}),n())})}},{key:"addCollection",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};a["default"].call("admin/context/add",t,function(t,n){t?e((0,u["default"])("Creating collection failed with error: "+t)):e(null,n)})}},{key:"updateCollection",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};a["default"].call("admin/context/update",{id:t,patches:e},function(t,e){t?n((0,u["default"])("Updating collection failed with error: "+t)):n()})}},{key:"deleteCollection",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};a["default"].del("admin/context/remove",{id:t},function(t,n){t?e((0,u["default"])("Deleting collection failed with error: "+t)):e()})}},{key:"deleteModel",value:function(t,e){a["default"].del("admin/schema/remove_model",{model_name:t},function(t,n){t?e((0,u["default"])("Deleting model failed with error: "+t)):e()})}},{key:"getAppUsers",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};a["default"].call("admin/users",{},function(n,r){if(n)e((0,u["default"])("Retrieving users failed with error: "+n),null);else{t.users={};for(var o in r.body.content)t.users[r.body.content[o].id]=r.body.content[o];t.userChannel=new l["default"](h["default"]),t._monitor.add({channel:{model:"user"}},t.users,t.userChannel,t.addUser.bind(t),t.deleteUser,t.updateUser),e(null,t.users)}})}},{key:"addUser",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._user.register(t,e)}},{key:"deleteUser",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};a["default"].del("admin/user/delete",{id:t},function(t,n){t?e((0,u["default"])("Removing user failed with error: "+t),null):e()})}},{key:"updateUser",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};a["default"].call("admin/user/update",{patches:e},function(t,e){t?n((0,u["default"])("Updating user failed with error: "+t),null):n()})}},{key:"authorize",value:function(t,e){a["default"].call("/admin/app/authorize",{email:t},function(t,n){t?e((0,u["default"])("Authorizing admin failed with error: "+t),null):e()})}},{key:"deauthorize",value:function(t,e){a["default"].call("/admin/app/deauthorize",{email:t},function(t,n){t?e((0,u["default"])("Deauthorizing admin failed with error: "+t),null):e()})}},{key:"unhook",value:function(){this._monitor.remove({channel:{model:"application"}}),this._monitor.remove({channel:{model:"user"}})}}]),t}();e["default"]=p,t.exports=e["default"]},function(t,e,n){function r(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,r=i(t),s=r.source,f=r.id,l=r.path,d=u[f]&&l in u[f].nsps,h=e.forceNew||e["force new connection"]||!1===e.multiplex||d;return h?(c("ignoring socket cache for %s",s),n=a(s,e)):(u[f]||(c("new io instance for %s",s),u[f]=a(s,e)),n=u[f]),r.query&&!e.query?e.query=r.query:e&&"object"==typeof e.query&&(e.query=o(e.query)),n.socket(r.path,e)}function o(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e.join("&")}var i=n(72),s=n(77),a=n(88),c=n(74)("socket.io-client");t.exports=e=r;var u=e.managers={};e.protocol=s.protocol,e.connect=r,e.Manager=n(88),e.Socket=n(118)},function(t,e,n){(function(e){function r(t,n){var r=t;n=n||e.location,null==t&&(t=n.protocol+"//"+n.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?n.protocol+t:n.host+t),/^(https?|wss?):\/\//.test(t)||(i("protocol-less url %s",t),t="undefined"!=typeof n?n.protocol+"//"+t:"https://"+t),i("parse %s",t),r=o(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var s=r.host.indexOf(":")!==-1,a=s?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+a+":"+r.port,r.href=r.protocol+"://"+a+(n&&n.port===r.port?"":":"+r.port),r}var o=n(73),i=n(74)("socket.io-client:url");t.exports=r}).call(e,function(){return this}())},function(t,e){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var e=t,o=t.indexOf("["),i=t.indexOf("]");o!=-1&&i!=-1&&(t=t.substring(0,o)+t.substring(o,i).replace(/:/g,";")+t.substring(i,t.length));for(var s=n.exec(t||""),a={},c=14;c--;)a[r[c]]=s[c]||"";return o!=-1&&i!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(t,e,n){(function(r){function o(){return"undefined"!=typeof document&&"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function i(){var t=arguments,n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return t;var r="color: "+this.color;t=[t[0],r,"color: inherit"].concat(Array.prototype.slice.call(t,1));var o=0,i=0;return t[0].replace(/%[a-z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(i=o))}),t.splice(i,0,r),t}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(n){}}function c(){try{return e.storage.debug}catch(t){}if("undefined"!=typeof r&&"env"in r)return r.env.DEBUG}function u(){try{return window.localStorage}catch(t){}}e=t.exports=n(75),e.log=s,e.formatArgs=i,e.save=a,e.load=c,e.useColors=o,e.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:u(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},e.enable(c())}).call(e,n(1))},function(t,e,n){function r(){return e.colors[f++%e.colors.length]}function o(t){function n(){}function o(){var t=o,n=+new Date,i=n-(u||n);t.diff=i,t.prev=u,t.curr=n,u=n,null==t.useColors&&(t.useColors=e.useColors()),null==t.color&&t.useColors&&(t.color=r());for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var c=0;s[0]=s[0].replace(/%([a-z%])/g,function(n,r){if("%%"===n)return n;c++;var o=e.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(t,i),s.splice(c,1),c--}return n}),s=e.formatArgs.apply(t,s);var f=o.log||e.log||console.log.bind(console);f.apply(t,s)}n.enabled=!1,o.enabled=!0;var i=e.enabled(t)?o:n;return i.namespace=t,i}function i(t){e.save(t);for(var n=(t||"").split(/[\s,]+/),r=n.length,o=0;o<r;o++)n[o]&&(t=n[o].replace(/[\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*?"),"-"===t[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function s(){e.enable("")}function a(t){var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1}function c(t){return t instanceof Error?t.stack||t.message:t}e=t.exports=o.debug=o,e.coerce=c,e.disable=s,e.enable=i,e.enabled=a,e.humanize=n(76),e.names=[],e.skips=[],e.formatters={};var u,f=0},function(t,e){function n(t){if(t=String(t),!(t.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*f;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function r(t){return t>=u?Math.round(t/u)+"d":t>=c?Math.round(t/c)+"h":t>=a?Math.round(t/a)+"m":t>=s?Math.round(t/s)+"s":t+"ms"}function o(t){return i(t,u,"day")||i(t,c,"hour")||i(t,a,"minute")||i(t,s,"second")||t+" ms"}function i(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var s=1e3,a=60*s,c=60*a,u=24*c,f=365.25*u;t.exports=function(t,e){e=e||{};var i=typeof t;if("string"===i&&t.length>0)return n(t);if("number"===i&&isNaN(t)===!1)return e["long"]?o(t):r(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){function r(){}function o(t){var n="",r=!1;return n+=t.type,e.BINARY_EVENT!=t.type&&e.BINARY_ACK!=t.type||(n+=t.attachments,n+="-"),t.nsp&&"/"!=t.nsp&&(r=!0,n+=t.nsp),null!=t.id&&(r&&(n+=",",r=!1),n+=t.id),null!=t.data&&(r&&(n+=","),n+=d.stringify(t.data)),l("encoded %j as %s",t,n),n}function i(t,e){function n(t){var n=p.deconstructPacket(t),r=o(n.packet),i=n.buffers;i.unshift(r),e(i)}p.removeBlobs(t,n)}function s(){this.reconstructor=null}function a(t){var n={},r=0;if(n.type=Number(t.charAt(0)),null==e.types[n.type])return f();if(e.BINARY_EVENT==n.type||e.BINARY_ACK==n.type){for(var o="";"-"!=t.charAt(++r)&&(o+=t.charAt(r),r!=t.length););if(o!=Number(o)||"-"!=t.charAt(r))throw new Error("Illegal attachments");n.attachments=Number(o)}if("/"==t.charAt(r+1))for(n.nsp="";++r;){var i=t.charAt(r);if(","==i)break;if(n.nsp+=i,r==t.length)break}else n.nsp="/";var s=t.charAt(r+1);if(""!==s&&Number(s)==s){for(n.id="";++r;){var i=t.charAt(r);if(null==i||Number(i)!=i){--r;break}if(n.id+=t.charAt(r),r==t.length)break}n.id=Number(n.id)}return t.charAt(++r)&&(n=c(n,t.substr(r))),l("decoded %s as %j",t,n),n}function c(t,e){try{t.data=d.parse(e)}catch(n){return f()}return t}function u(t){this.reconPack=t,this.buffers=[]}function f(t){return{type:e.ERROR,data:"parser error"}}var l=n(78)("socket.io-parser"),d=n(81),h=n(84),p=n(85),v=n(87);e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=r,e.Decoder=s,r.prototype.encode=function(t,n){if(l("encoding packet %j",t),e.BINARY_EVENT==t.type||e.BINARY_ACK==t.type)i(t,n);else{var r=o(t);n([r])}},h(s.prototype),s.prototype.add=function(t){var n;if("string"==typeof t)n=a(t),e.BINARY_EVENT==n.type||e.BINARY_ACK==n.type?(this.reconstructor=new u(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!v(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,this.emit("decoded",n))}},s.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},u.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length==this.reconPack.attachments){var e=p.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},u.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(t,e,n){function r(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function o(){var t=arguments,n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return t;var r="color: "+this.color;t=[t[0],r,"color: inherit"].concat(Array.prototype.slice.call(t,1));var o=0,i=0;return t[0].replace(/%[a-z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(i=o))}),t.splice(i,0,r),t}function i(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(n){}}function a(){var t;try{t=e.storage.debug}catch(n){}return t}function c(){try{return window.localStorage}catch(t){}}e=t.exports=n(79),e.log=i,e.formatArgs=o,e.save=s,e.load=a,e.useColors=r,e.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){return JSON.stringify(t)},e.enable(a())},function(t,e,n){function r(){return e.colors[f++%e.colors.length]}function o(t){function n(){}function o(){var t=o,n=+new Date,i=n-(u||n);t.diff=i,t.prev=u,t.curr=n,u=n,null==t.useColors&&(t.useColors=e.useColors()),null==t.color&&t.useColors&&(t.color=r());var s=Array.prototype.slice.call(arguments);s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var a=0;s[0]=s[0].replace(/%([a-z%])/g,function(n,r){if("%%"===n)return n;a++;var o=e.formatters[r];if("function"==typeof o){var i=s[a];n=o.call(t,i),s.splice(a,1),a--}return n}),"function"==typeof e.formatArgs&&(s=e.formatArgs.apply(t,s));var c=o.log||e.log||console.log.bind(console);c.apply(t,s)}n.enabled=!1,o.enabled=!0;var i=e.enabled(t)?o:n;return i.namespace=t,i}function i(t){e.save(t);for(var n=(t||"").split(/[\s,]+/),r=n.length,o=0;o<r;o++)n[o]&&(t=n[o].replace(/\*/g,".*?"),"-"===t[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function s(){e.enable("")}function a(t){var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1}function c(t){return t instanceof Error?t.stack||t.message:t}e=t.exports=o,e.coerce=c,e.disable=s,e.enable=i,e.enabled=a,e.humanize=n(80),e.names=[],e.skips=[],e.formatters={};var u,f=0},function(t,e){function n(t){if(t=""+t,!(t.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*f;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}function r(t){return t>=u?Math.round(t/u)+"d":t>=c?Math.round(t/c)+"h":t>=a?Math.round(t/a)+"m":t>=s?Math.round(t/s)+"s":t+"ms"}function o(t){return i(t,u,"day")||i(t,c,"hour")||i(t,a,"minute")||i(t,s,"second")||t+" ms"}function i(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var s=1e3,a=60*s,c=60*a,u=24*c,f=365.25*u;t.exports=function(t,e){return e=e||{},"string"==typeof t?n(t):e["long"]?o(t):r(t)}},function(t,e,n){var r;(function(t,o){(function(){function i(t,e){function n(t){if(n[t]!==y)return n[t];var i;if("bug-string-char-index"==t)i="a"!="a"[0];else if("json"==t)i=n("json-stringify")&&n("json-parse");else{var s,a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==t){var u=e.stringify,f="function"==typeof u&&_;if(f){(s=function(){return 1}).toJSON=s;try{f="0"===u(0)&&"0"===u(new r)&&'""'==u(new o)&&u(m)===y&&u(y)===y&&u()===y&&"1"===u(s)&&"[1]"==u([s])&&"[null]"==u([y])&&"null"==u(null)&&"[null,null,null]"==u([y,m,null])&&u({a:[s,!0,!1,null,"\0\b\n\f\r\t"]})==a&&"1"===u(null,s)&&"[\n 1,\n 2\n]"==u([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==u(new c((-864e13)))&&'"+275760-09-13T00:00:00.000Z"'==u(new c(864e13))&&'"-000001-01-01T00:00:00.000Z"'==u(new c((-621987552e5)))&&'"1969-12-31T23:59:59.999Z"'==u(new c((-1)))}catch(l){f=!1}}i=f}if("json-parse"==t){var d=e.parse;if("function"==typeof d)try{if(0===d("0")&&!d(!1)){s=d(a);var h=5==s.a.length&&1===s.a[0];if(h){try{h=!d('"\t"')}catch(l){}if(h)try{h=1!==d("01")}catch(l){}if(h)try{h=1!==d("1.")}catch(l){}}}}catch(l){h=!1}i=h}}return n[t]=!!i}t||(t=u.Object()),e||(e=u.Object());var r=t.Number||u.Number,o=t.String||u.String,s=t.Object||u.Object,c=t.Date||u.Date,f=t.SyntaxError||u.SyntaxError,l=t.TypeError||u.TypeError,d=t.Math||u.Math,h=t.JSON||u.JSON;"object"==typeof h&&h&&(e.stringify=h.stringify,e.parse=h.parse);var p,v,y,g=s.prototype,m=g.toString,_=new c((-0xc782b5b800cec));try{_=_.getUTCFullYear()==-109252&&0===_.getUTCMonth()&&1===_.getUTCDate()&&10==_.getUTCHours()&&37==_.getUTCMinutes()&&6==_.getUTCSeconds()&&708==_.getUTCMilliseconds()}catch(b){}if(!n("json")){var w="[object Function]",k="[object Date]",E="[object Number]",x="[object String]",A="[object Array]",S="[object Boolean]",j=n("bug-string-char-index");if(!_)var C=d.floor,T=[0,31,59,90,120,151,181,212,243,273,304,334],O=function(t,e){return T[e]+365*(t-1970)+C((t-1969+(e=+(e>1)))/4)-C((t-1901+e)/100)+C((t-1601+e)/400)};if((p=g.hasOwnProperty)||(p=function(t){var e,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=m?p=function(t){var e=this.__proto__,n=t in(this.__proto__=null,this);return this.__proto__=e,n}:(e=n.constructor,p=function(t){var n=(this.constructor||e).prototype;return t in this&&!(t in n&&this[t]===n[t])}),n=null,p.call(this,t)}),v=function(t,e){var n,r,o,i=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,r=new n;for(o in r)p.call(r,o)&&i++;return n=r=null,i?v=2==i?function(t,e){var n,r={},o=m.call(t)==w;for(n in t)o&&"prototype"==n||p.call(r,n)||!(r[n]=1)||!p.call(t,n)||e(n)}:function(t,e){var n,r,o=m.call(t)==w;for(n in t)o&&"prototype"==n||!p.call(t,n)||(r="constructor"===n)||e(n);(r||p.call(t,n="constructor"))&&e(n)}:(r=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],v=function(t,e){var n,o,i=m.call(t)==w,s=!i&&"function"!=typeof t.constructor&&a[typeof t.hasOwnProperty]&&t.hasOwnProperty||p;for(n in t)i&&"prototype"==n||!s.call(t,n)||e(n);for(o=r.length;n=r[--o];s.call(t,n)&&e(n));}),v(t,e)},!n("json-stringify")){var R={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},q="000000",D=function(t,e){return(q+(e||0)).slice(-t)},I="\\u00",B=function(t){for(var e='"',n=0,r=t.length,o=!j||r>10,i=o&&(j?t.split(""):t);n<r;n++){var s=t.charCodeAt(n);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=R[s];break;default:if(s<32){e+=I+D(2,s.toString(16));break}e+=o?i[n]:t.charAt(n)}}return e+'"'},N=function(t,e,n,r,o,i,s){var a,c,u,f,d,h,g,_,b,w,j,T,R,q,I,L;try{a=e[t]}catch(P){}if("object"==typeof a&&a)if(c=m.call(a),c!=k||p.call(a,"toJSON"))"function"==typeof a.toJSON&&(c!=E&&c!=x&&c!=A||p.call(a,"toJSON"))&&(a=a.toJSON(t));else if(a>-1/0&&a<1/0){if(O){for(d=C(a/864e5),u=C(d/365.2425)+1970-1;O(u+1,0)<=d;u++);for(f=C((d-O(u,0))/30.42);O(u,f+1)<=d;f++);d=1+d-O(u,f),h=(a%864e5+864e5)%864e5,g=C(h/36e5)%24,_=C(h/6e4)%60,b=C(h/1e3)%60,w=h%1e3}else u=a.getUTCFullYear(),f=a.getUTCMonth(),d=a.getUTCDate(),g=a.getUTCHours(),_=a.getUTCMinutes(),b=a.getUTCSeconds(),w=a.getUTCMilliseconds();a=(u<=0||u>=1e4?(u<0?"-":"+")+D(6,u<0?-u:u):D(4,u))+"-"+D(2,f+1)+"-"+D(2,d)+"T"+D(2,g)+":"+D(2,_)+":"+D(2,b)+"."+D(3,w)+"Z"}else a=null;if(n&&(a=n.call(e,t,a)),null===a)return"null";if(c=m.call(a),c==S)return""+a;if(c==E)return a>-1/0&&a<1/0?""+a:"null";if(c==x)return B(""+a);if("object"==typeof a){for(q=s.length;q--;)if(s[q]===a)throw l();if(s.push(a),j=[],I=i,i+=o,c==A){for(R=0,q=a.length;R<q;R++)T=N(R,a,n,r,o,i,s),j.push(T===y?"null":T);L=j.length?o?"[\n"+i+j.join(",\n"+i)+"\n"+I+"]":"["+j.join(",")+"]":"[]"}else v(r||a,function(t){var e=N(t,a,n,r,o,i,s);e!==y&&j.push(B(t)+":"+(o?" ":"")+e)}),L=j.length?o?"{\n"+i+j.join(",\n"+i)+"\n"+I+"}":"{"+j.join(",")+"}":"{}";return s.pop(),L}};e.stringify=function(t,e,n){var r,o,i,s;if(a[typeof e]&&e)if((s=m.call(e))==w)o=e;else if(s==A){i={};for(var c,u=0,f=e.length;u<f;c=e[u++],s=m.call(c),(s==x||s==E)&&(i[c]=1));}if(n)if((s=m.call(n))==E){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else s==x&&(r=n.length<=10?n:n.slice(0,10));return N("",(c={},c[""]=t,c),o,i,r,"",[])}}if(!n("json-parse")){var L,P,U=o.fromCharCode,M={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},F=function(){throw L=P=null,f()},$=function(){for(var t,e,n,r,o,i=P,s=i.length;L<s;)switch(o=i.charCodeAt(L)){case 9:case 10:case 13:case 32:
L++;break;case 123:case 125:case 91:case 93:case 58:case 44:return t=j?i.charAt(L):i[L],L++,t;case 34:for(t="@",L++;L<s;)if(o=i.charCodeAt(L),o<32)F();else if(92==o)switch(o=i.charCodeAt(++L)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:t+=M[o],L++;break;case 117:for(e=++L,n=L+4;L<n;L++)o=i.charCodeAt(L),o>=48&&o<=57||o>=97&&o<=102||o>=65&&o<=70||F();t+=U("0x"+i.slice(e,L));break;default:F()}else{if(34==o)break;for(o=i.charCodeAt(L),e=L;o>=32&&92!=o&&34!=o;)o=i.charCodeAt(++L);t+=i.slice(e,L)}if(34==i.charCodeAt(L))return L++,t;F();default:if(e=L,45==o&&(r=!0,o=i.charCodeAt(++L)),o>=48&&o<=57){for(48==o&&(o=i.charCodeAt(L+1),o>=48&&o<=57)&&F(),r=!1;L<s&&(o=i.charCodeAt(L),o>=48&&o<=57);L++);if(46==i.charCodeAt(L)){for(n=++L;n<s&&(o=i.charCodeAt(n),o>=48&&o<=57);n++);n==L&&F(),L=n}if(o=i.charCodeAt(L),101==o||69==o){for(o=i.charCodeAt(++L),43!=o&&45!=o||L++,n=L;n<s&&(o=i.charCodeAt(n),o>=48&&o<=57);n++);n==L&&F(),L=n}return+i.slice(e,L)}if(r&&F(),"true"==i.slice(L,L+4))return L+=4,!0;if("false"==i.slice(L,L+5))return L+=5,!1;if("null"==i.slice(L,L+4))return L+=4,null;F()}return"$"},H=function(t){var e,n;if("$"==t&&F(),"string"==typeof t){if("@"==(j?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(e=[];t=$(),"]"!=t;n||(n=!0))n&&(","==t?(t=$(),"]"==t&&F()):F()),","==t&&F(),e.push(H(t));return e}if("{"==t){for(e={};t=$(),"}"!=t;n||(n=!0))n&&(","==t?(t=$(),"}"==t&&F()):F()),","!=t&&"string"==typeof t&&"@"==(j?t.charAt(0):t[0])&&":"==$()||F(),e[t.slice(1)]=H($());return e}F()}return t},z=function(t,e,n){var r=J(t,e,n);r===y?delete t[e]:t[e]=r},J=function(t,e,n){var r,o=t[e];if("object"==typeof o&&o)if(m.call(o)==A)for(r=o.length;r--;)z(o,r,n);else v(o,function(t){z(o,t,n)});return n.call(t,e,o)};e.parse=function(t,e){var n,r;return L=0,P=""+t,n=H($()),"$"!=$()&&F(),L=P=null,e&&m.call(e)==w?J((r={},r[""]=n,r),"",e):n}}}return e.runInContext=i,e}var s=n(83),a={"function":!0,object:!0},c=a[typeof e]&&e&&!e.nodeType&&e,u=a[typeof window]&&window||this,f=c&&a[typeof t]&&t&&!t.nodeType&&"object"==typeof o&&o;if(!f||f.global!==f&&f.window!==f&&f.self!==f||(u=f),c&&!s)i(u,c);else{var l=u.JSON,d=u.JSON3,h=!1,p=i(u,u.JSON3={noConflict:function(){return h||(h=!0,u.JSON=l,u.JSON3=d,l=d=null),p}});u.JSON={parse:p.parse,stringify:p.stringify}}s&&(r=function(){return p}.call(e,n,e,t),!(void 0!==r&&(t.exports=r)))}).call(this)}).call(e,n(82)(t),function(){return this}())},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e){(function(e){t.exports=e}).call(e,{})},function(t,e){function n(t){if(t)return r(t)}function r(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this},n.prototype.once=function(t,e){function n(){r.off(t,n),e.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},n.fn=e,this.on(t,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[t];if(!n)return this;if(1==arguments.length)return delete this._callbacks[t],this;for(var r,o=0;o<n.length;o++)if(r=n[o],r===e||r.fn===e){n.splice(o,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks[t];if(n){n=n.slice(0);for(var r=0,o=n.length;r<o;++r)n[r].apply(this,e)}return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,n){(function(t){var r=n(86),o=n(87);e.deconstructPacket=function(t){function e(t){if(!t)return t;if(o(t)){var i={_placeholder:!0,num:n.length};return n.push(t),i}if(r(t)){for(var s=new Array(t.length),a=0;a<t.length;a++)s[a]=e(t[a]);return s}if("object"==typeof t&&!(t instanceof Date)){var s={};for(var c in t)s[c]=e(t[c]);return s}return t}var n=[],i=t.data,s=t;return s.data=e(i),s.attachments=n.length,{packet:s,buffers:n}},e.reconstructPacket=function(t,e){function n(t){if(t&&t._placeholder){var o=e[t.num];return o}if(r(t)){for(var i=0;i<t.length;i++)t[i]=n(t[i]);return t}if(t&&"object"==typeof t){for(var s in t)t[s]=n(t[s]);return t}return t}return t.data=n(t.data),t.attachments=void 0,t},e.removeBlobs=function(e,n){function i(e,c,u){if(!e)return e;if(t.Blob&&e instanceof Blob||t.File&&e instanceof File){s++;var f=new FileReader;f.onload=function(){u?u[c]=this.result:a=this.result,--s||n(a)},f.readAsArrayBuffer(e)}else if(r(e))for(var l=0;l<e.length;l++)i(e[l],l,e);else if(e&&"object"==typeof e&&!o(e))for(var d in e)i(e[d],d,e)}var s=0,a=e;i(a),s||n(a)}}).call(e,function(){return this}())},function(t,e){t.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}},function(t,e){(function(e){function n(t){return e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer}t.exports=n}).call(e,function(){return this}())},function(t,e,n){function r(t,e){return this instanceof r?(t&&"object"==typeof t&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new d({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new a.Encoder,this.decoder=new a.Decoder,this.autoConnect=e.autoConnect!==!1,void(this.autoConnect&&this.open())):new r(t,e)}var o=n(89),i=n(118),s=n(21),a=n(77),c=n(120),u=n(121),f=n(74)("socket.io-client:manager"),l=n(116),d=n(122),h=Object.prototype.hasOwnProperty;t.exports=r,r.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var t in this.nsps)h.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},r.prototype.updateSocketIds=function(){for(var t in this.nsps)h.call(this.nsps,t)&&(this.nsps[t].id=this.engine.id)},s(r.prototype),r.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},r.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},r.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},r.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},r.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},r.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},r.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},r.prototype.open=r.prototype.connect=function(t,e){if(f("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;f("opening %s",this.uri),this.engine=o(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var i=c(n,"open",function(){r.onopen(),t&&t()}),s=c(n,"error",function(e){if(f("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",e),t){var n=new Error("Connection error");n.data=e,t(n)}else r.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout;f("connect attempt will timeout after %d",a);var u=setTimeout(function(){f("connect attempt timed out after %d",a),i.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(i),this.subs.push(s),this},r.prototype.onopen=function(){f("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(c(t,"data",u(this,"ondata"))),this.subs.push(c(t,"ping",u(this,"onping"))),this.subs.push(c(t,"pong",u(this,"onpong"))),this.subs.push(c(t,"error",u(this,"onerror"))),this.subs.push(c(t,"close",u(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",u(this,"ondecoded")))},r.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},r.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},r.prototype.ondata=function(t){this.decoder.add(t)},r.prototype.ondecoded=function(t){this.emit("packet",t)},r.prototype.onerror=function(t){f("error",t),this.emitAll("error",t)},r.prototype.socket=function(t,e){function n(){~l(o.connecting,r)||o.connecting.push(r)}var r=this.nsps[t];if(!r){r=new i(this,t,e),this.nsps[t]=r;var o=this;r.on("connecting",n),r.on("connect",function(){r.id=o.engine.id}),this.autoConnect&&n()}return r},r.prototype.destroy=function(t){var e=l(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},r.prototype.packet=function(t){f("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,function(n){for(var r=0;r<n.length;r++)e.engine.write(n[r],t.options);e.encoding=!1,e.processPacketQueue()}))},r.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},r.prototype.cleanup=function(){f("cleanup");for(var t=this.subs.length,e=0;e<t;e++){var n=this.subs.shift();n.destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},r.prototype.close=r.prototype.disconnect=function(){f("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},r.prototype.onclose=function(t){f("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},r.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)f("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();f("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout(function(){t.skipReconnect||(f("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(f("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(f("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(n)}})}},r.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}},function(t,e,n){t.exports=n(90)},function(t,e,n){t.exports=n(91),t.exports.parser=n(98)},function(t,e,n){(function(e){function r(t,n){if(!(this instanceof r))return new r(t,n);n=n||{},t&&"object"==typeof t&&(n=t,t=null),t?(t=f(t),n.hostname=t.host,n.secure="https"===t.protocol||"wss"===t.protocol,n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=f(n.host).host),this.secure=null!=n.secure?n.secure:e.location&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.agent=n.agent||!1,this.hostname=n.hostname||(e.location?location.hostname:"localhost"),this.port=n.port||(e.location&&location.port?location.port:this.secure?443:80),this.query=n.query||{},"string"==typeof this.query&&(this.query=d.decode(this.query)),this.upgrade=!1!==n.upgrade,this.path=(n.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!n.forceJSONP,this.jsonp=!1!==n.jsonp,this.forceBase64=!!n.forceBase64,this.enablesXDR=!!n.enablesXDR,this.timestampParam=n.timestampParam||"t",this.timestampRequests=n.timestampRequests,this.transports=n.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=n.policyPort||843,this.rememberUpgrade=n.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=n.onlyBinaryUpgrades,this.perMessageDeflate=!1!==n.perMessageDeflate&&(n.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=n.pfx||null,this.key=n.key||null,this.passphrase=n.passphrase||null,this.cert=n.cert||null,this.ca=n.ca||null,this.ciphers=n.ciphers||null,this.rejectUnauthorized=void 0===n.rejectUnauthorized?null:n.rejectUnauthorized,this.forceNode=!!n.forceNode;var o="object"==typeof e&&e;o.global===o&&(n.extraHeaders&&Object.keys(n.extraHeaders).length>0&&(this.extraHeaders=n.extraHeaders),n.localAddress&&(this.localAddress=n.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}function o(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}var i=n(92),s=n(21),a=n(110)("engine.io-client:socket"),c=n(116),u=n(98),f=n(73),l=n(117),d=n(107);t.exports=r,r.priorWebsocketSuccess=!1,s(r.prototype),r.protocol=u.protocol,r.Socket=r,r.Transport=n(97),r.transports=n(92),r.parser=n(98),r.prototype.createTransport=function(t){a('creating transport "%s"',t);var e=o(this.query);e.EIO=u.protocol,e.transport=t,this.id&&(e.sid=this.id);var n=new i[t]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:e,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders,forceNode:this.forceNode,localAddress:this.localAddress});return n},r.prototype.open=function(){var t;if(this.rememberUpgrade&&r.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout(function(){e.emit("error","No transports available")},0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(n){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},r.prototype.setTransport=function(t){a("setting transport %s",t.name);var e=this;this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},r.prototype.probe=function(t){function e(){if(d.onlyBinaryUpgrades){var e=!this.supportsBinary&&d.transport.supportsBinary;l=l||e}l||(a('probe transport "%s" opened',t),f.send([{type:"ping",data:"probe"}]),f.once("packet",function(e){if(!l)if("pong"===e.type&&"probe"===e.data){if(a('probe transport "%s" pong',t),d.upgrading=!0,d.emit("upgrading",f),!f)return;r.priorWebsocketSuccess="websocket"===f.name,a('pausing current transport "%s"',d.transport.name),d.transport.pause(function(){l||"closed"!==d.readyState&&(a("changing transport and sending upgrade packet"),u(),d.setTransport(f),f.send([{type:"upgrade"}]),d.emit("upgrade",f),f=null,d.upgrading=!1,d.flush())})}else{a('probe transport "%s" failed',t);var n=new Error("probe error");n.transport=f.name,d.emit("upgradeError",n)}}))}function n(){l||(l=!0,u(),f.close(),f=null)}function o(e){var r=new Error("probe error: "+e);r.transport=f.name,n(),a('probe transport "%s" failed because of error: %s',t,e),d.emit("upgradeError",r)}function i(){o("transport closed")}function s(){o("socket closed")}function c(t){f&&t.name!==f.name&&(a('"%s" works - aborting "%s"',t.name,f.name),n())}function u(){f.removeListener("open",e),f.removeListener("error",o),f.removeListener("close",i),d.removeListener("close",s),d.removeListener("upgrading",c)}a('probing transport "%s"',t);var f=this.createTransport(t,{probe:1}),l=!1,d=this;r.priorWebsocketSuccess=!1,f.once("open",e),f.once("error",o),f.once("close",i),this.once("close",s),this.once("upgrading",c),f.open()},r.prototype.onOpen=function(){if(a("socket open"),this.readyState="open",r.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){a("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},r.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(a('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(l(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else a('packet received with socket readyState "%s"',this.readyState)},r.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},r.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){"closed"!==e.readyState&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},r.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){a("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},r.prototype.ping=function(){var t=this;this.sendPacket("ping",function(){t.emit("ping")})},r.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},r.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},r.prototype.write=r.prototype.send=function(t,e,n){return this.sendPacket("message",t,e,n),this},r.prototype.sendPacket=function(t,e,n,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){n=n||{},n.compress=!1!==n.compress;var o={type:t,data:e,options:n};this.emit("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}},r.prototype.close=function(){function t(){r.onClose("forced close"),a("socket closing - telling transport to close"),r.transport.close()}function e(){r.removeListener("upgrade",e),r.removeListener("upgradeError",e),t()}function n(){r.once("upgrade",e),r.once("upgradeError",e)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var r=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():t()}):this.upgrading?n():t()}return this},r.prototype.onError=function(t){a("socket error %j",t),r.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},r.prototype.onClose=function(t,e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){a('socket close with reason: "%s"',t);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),n.writeBuffer=[],n.prevBufferLen=0}},r.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;n<r;n++)~c(this.transports,t[n])&&e.push(t[n]);return e}}).call(e,function(){return this}())},function(t,e,n){(function(t){function r(e){var n,r=!1,a=!1,c=!1!==e.jsonp;if(t.location){var u="https:"===location.protocol,f=location.port;f||(f=u?443:80),r=e.hostname!==location.hostname||f!==e.port,a=e.secure!==u}if(e.xdomain=r,e.xscheme=a,n=new o(e),"open"in n&&!e.forceJSONP)return new i(e);if(!c)throw new Error("JSONP disabled");return new s(e)}var o=n(93),i=n(95),s=n(113),a=n(114);e.polling=r,e.websocket=a}).call(e,function(){return this}())},function(t,e,n){(function(e){var r=n(94);t.exports=function(t){var n=t.xdomain,o=t.xscheme,i=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!n||r))return new XMLHttpRequest}catch(s){}try{if("undefined"!=typeof XDomainRequest&&!o&&i)return new XDomainRequest}catch(s){}if(!n)try{return new(e[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(s){}}}).call(e,function(){return this}())},function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(n){t.exports=!1}},function(t,e,n){(function(e){function r(){}function o(t){if(c.call(this,t),this.requestTimeout=t.requestTimeout,e.location){var n="https:"===location.protocol,r=location.port;r||(r=n?443:80),this.xd=t.hostname!==e.location.hostname||r!==t.port,this.xs=t.secure!==n}else this.extraHeaders=t.extraHeaders}function i(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}function s(){for(var t in i.requests)i.requests.hasOwnProperty(t)&&i.requests[t].abort()}var a=n(93),c=n(96),u=n(21),f=n(108),l=n(110)("engine.io-client:polling-xhr");t.exports=o,t.exports.Request=i,f(o,c),o.prototype.supportsBinary=!0,o.prototype.request=function(t){return t=t||{},t.uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new i(t)},o.prototype.doWrite=function(t,e){var n="string"!=typeof t&&void 0!==t,r=this.request({method:"POST",data:t,isBinary:n}),o=this;r.on("success",e),r.on("error",function(t){o.onError("xhr post error",t)}),this.sendXhr=r},o.prototype.doPoll=function(){l("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},u(i.prototype),i.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var n=this.xhr=new a(t),r=this;try{l("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,this.async);try{if(this.extraHeaders){n.setDisableHeaderCheck(!0);for(var o in this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&n.setRequestHeader(o,this.extraHeaders[o])}}catch(s){}if(this.supportsBinary&&(n.responseType="arraybuffer"),"POST"===this.method)try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}try{n.setRequestHeader("Accept","*/*")}catch(s){}"withCredentials"in n&&(n.withCredentials=!0),this.requestTimeout&&(n.timeout=this.requestTimeout),this.hasXDR()?(n.onload=function(){r.onLoad()},n.onerror=function(){r.onError(n.responseText)}):n.onreadystatechange=function(){4===n.readyState&&(200===n.status||1223===n.status?r.onLoad():setTimeout(function(){r.onError(n.status)},0))},l("xhr data %s",this.data),n.send(this.data)}catch(s){return void setTimeout(function(){r.onError(s)},0)}e.document&&(this.index=i.requestsCount++,i.requests[this.index]=this)},i.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},i.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},i.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},i.prototype.cleanup=function(t){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=r:this.xhr.onreadystatechange=r,t)try{this.xhr.abort()}catch(n){}e.document&&delete i.requests[this.index],this.xhr=null}},i.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(n){}if("application/octet-stream"===e)t=this.xhr.response||this.xhr.responseText;else if(this.supportsBinary)try{t=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(n){for(var r=new Uint8Array(this.xhr.response),o=[],i=0,s=r.length;i<s;i++)o.push(r[i]);t=String.fromCharCode.apply(null,o)}else t=this.xhr.responseText}catch(n){this.onError(n)}null!=t&&this.onData(t)},i.prototype.hasXDR=function(){return"undefined"!=typeof e.XDomainRequest&&!this.xs&&this.enablesXDR},i.prototype.abort=function(){this.cleanup()},i.requestsCount=0,i.requests={},e.document&&(e.attachEvent?e.attachEvent("onunload",s):e.addEventListener&&e.addEventListener("beforeunload",s,!1))}).call(e,function(){return this}())},function(t,e,n){function r(t){var e=t&&t.forceBase64;f&&!e||(this.supportsBinary=!1),o.call(this,t)}var o=n(97),i=n(107),s=n(98),a=n(108),c=n(109),u=n(110)("engine.io-client:polling");t.exports=r;var f=function(){var t=n(93),e=new t({xdomain:!1});return null!=e.responseType}();a(r,o),r.prototype.name="polling",r.prototype.doOpen=function(){this.poll()},r.prototype.pause=function(t){function e(){u("paused"),n.readyState="paused",t()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(u("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){u("pre-pause polling complete"),--r||e()})),this.writable||(u("we are currently writing - waiting to pause"),r++,this.once("drain",function(){u("pre-pause writing complete"),--r||e()}))}else e()},r.prototype.poll=function(){u("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},r.prototype.onData=function(t){var e=this;u("polling got data %s",t);var n=function(t,n,r){return"opening"===e.readyState&&e.onOpen(),"close"===t.type?(e.onClose(),!1):void e.onPacket(t)};s.decodePayload(t,this.socket.binaryType,n),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():u('ignoring poll - transport state "%s"',this.readyState))},r.prototype.doClose=function(){function t(){u("writing close packet"),e.write([{type:"close"}])}var e=this;"open"===this.readyState?(u("transport open - closing"),t()):(u("transport not open - deferring close"),this.once("open",t))},r.prototype.write=function(t){var e=this;this.writable=!1;var n=function(){e.writable=!0,e.emit("drain")};s.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,n)})},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";!1!==this.timestampRequests&&(t[this.timestampParam]=c()),this.supportsBinary||t.sid||(t.b64=1),t=i.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(n=":"+this.port),t.length&&(t="?"+t);var r=this.hostname.indexOf(":")!==-1;return e+"://"+(r?"["+this.hostname+"]":this.hostname)+n+this.path+t}},function(t,e,n){function r(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}var o=n(98),i=n(21);t.exports=r,i(r.prototype),r.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},r.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},r.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},r.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},r.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},r.prototype.onData=function(t){var e=o.decodePacket(t,this.socket.binaryType);this.onPacket(e)},r.prototype.onPacket=function(t){this.emit("packet",t)},r.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(t,e,n){(function(t){function r(t,n){var r="b"+e.packets[t.type]+t.data.data;return n(r)}function o(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var o=t.data,i=new Uint8Array(o),s=new Uint8Array(1+o.byteLength);s[0]=m[t.type];for(var a=0;a<i.length;a++)s[a+1]=i[a];return r(s.buffer)}function i(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var o=new FileReader;return o.onload=function(){t.data=o.result,e.encodePacket(t,n,!0,r)},o.readAsArrayBuffer(t.data)}function s(t,n,r){if(!n)return e.encodeBase64Packet(t,r);if(g)return i(t,n,r);var o=new Uint8Array(1);o[0]=m[t.type];var s=new w([o.buffer,t.data]);return r(s)}function a(t){try{t=p.decode(t)}catch(e){return!1}return t}function c(t,e,n){for(var r=new Array(t.length),o=h(t.length,n),i=function(t,n,o){e(n,function(e,n){r[t]=n,o(e,r)})},s=0;s<t.length;s++)i(s,t[s],o)}var u,f=n(99),l=n(100),d=n(102),h=n(103),p=n(104);t&&t.ArrayBuffer&&(u=n(105));var v="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),y="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),g=v||y;e.protocol=3;var m=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},_=f(m),b={type:"error",data:"parser error"},w=n(106);e.encodePacket=function(e,n,i,a){"function"==typeof n&&(a=n,n=!1),"function"==typeof i&&(a=i,i=null);var c=void 0===e.data?void 0:e.data.buffer||e.data;if(t.ArrayBuffer&&c instanceof ArrayBuffer)return o(e,n,a);if(w&&c instanceof t.Blob)return s(e,n,a);if(c&&c.base64)return r(e,a);var u=m[e.type];return void 0!==e.data&&(u+=i?p.encode(String(e.data)):String(e.data)),a(""+u)},e.encodeBase64Packet=function(n,r){var o="b"+e.packets[n.type];if(w&&n.data instanceof t.Blob){var i=new FileReader;return i.onload=function(){var t=i.result.split(",")[1];r(o+t)},i.readAsDataURL(n.data)}var s;try{s=String.fromCharCode.apply(null,new Uint8Array(n.data))}catch(a){for(var c=new Uint8Array(n.data),u=new Array(c.length),f=0;f<c.length;f++)u[f]=c[f];s=String.fromCharCode.apply(null,u)}return o+=t.btoa(s),r(o)},e.decodePacket=function(t,n,r){if(void 0===t)return b;if("string"==typeof t){if("b"==t.charAt(0))return e.decodeBase64Packet(t.substr(1),n);
if(r&&(t=a(t),t===!1))return b;var o=t.charAt(0);return Number(o)==o&&_[o]?t.length>1?{type:_[o],data:t.substring(1)}:{type:_[o]}:b}var i=new Uint8Array(t),o=i[0],s=d(t,1);return w&&"blob"===n&&(s=new w([s])),{type:_[o],data:s}},e.decodeBase64Packet=function(t,e){var n=_[t.charAt(0)];if(!u)return{type:n,data:{base64:!0,data:t.substr(1)}};var r=u.decode(t.substr(1));return"blob"===e&&w&&(r=new w([r])),{type:n,data:r}},e.encodePayload=function(t,n,r){function o(t){return t.length+":"+t}function i(t,r){e.encodePacket(t,!!s&&n,!0,function(t){r(null,o(t))})}"function"==typeof n&&(r=n,n=null);var s=l(t);return n&&s?w&&!g?e.encodePayloadAsBlob(t,r):e.encodePayloadAsArrayBuffer(t,r):t.length?void c(t,i,function(t,e){return r(e.join(""))}):r("0:")},e.decodePayload=function(t,n,r){if("string"!=typeof t)return e.decodePayloadAsBinary(t,n,r);"function"==typeof n&&(r=n,n=null);var o;if(""==t)return r(b,0,1);for(var i,s,a="",c=0,u=t.length;c<u;c++){var f=t.charAt(c);if(":"!=f)a+=f;else{if(""==a||a!=(i=Number(a)))return r(b,0,1);if(s=t.substr(c+1,i),a!=s.length)return r(b,0,1);if(s.length){if(o=e.decodePacket(s,n,!0),b.type==o.type&&b.data==o.data)return r(b,0,1);var l=r(o,c+i,u);if(!1===l)return}c+=i,a=""}}return""!=a?r(b,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,n){function r(t,n){e.encodePacket(t,!0,!0,function(t){return n(null,t)})}return t.length?void c(t,r,function(t,e){var r=e.reduce(function(t,e){var n;return n="string"==typeof e?e.length:e.byteLength,t+n.toString().length+n+2},0),o=new Uint8Array(r),i=0;return e.forEach(function(t){var e="string"==typeof t,n=t;if(e){for(var r=new Uint8Array(t.length),s=0;s<t.length;s++)r[s]=t.charCodeAt(s);n=r.buffer}e?o[i++]=0:o[i++]=1;for(var a=n.byteLength.toString(),s=0;s<a.length;s++)o[i++]=parseInt(a[s]);o[i++]=255;for(var r=new Uint8Array(n),s=0;s<r.length;s++)o[i++]=r[s]}),n(o.buffer)}):n(new ArrayBuffer(0))},e.encodePayloadAsBlob=function(t,n){function r(t,n){e.encodePacket(t,!0,!0,function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var r=new Uint8Array(t.length),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);t=r.buffer,e[0]=0}for(var i=t instanceof ArrayBuffer?t.byteLength:t.size,s=i.toString(),a=new Uint8Array(s.length+1),o=0;o<s.length;o++)a[o]=parseInt(s[o]);if(a[s.length]=255,w){var c=new w([e.buffer,a.buffer,t]);n(null,c)}})}c(t,r,function(t,e){return n(new w(e))})},e.decodePayloadAsBinary=function(t,n,r){"function"==typeof n&&(r=n,n=null);for(var o=t,i=[],s=!1;o.byteLength>0;){for(var a=new Uint8Array(o),c=0===a[0],u="",f=1;255!=a[f];f++){if(u.length>310){s=!0;break}u+=a[f]}if(s)return r(b,0,1);o=d(o,2+u.length),u=parseInt(u);var l=d(o,0,u);if(c)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(h){var p=new Uint8Array(l);l="";for(var f=0;f<p.length;f++)l+=String.fromCharCode(p[f])}i.push(l),o=d(o,u)}var v=i.length;i.forEach(function(t,o){r(e.decodePacket(t,n,!0),o,v)})}}).call(e,function(){return this}())},function(t,e){t.exports=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e}},function(t,e,n){(function(e){function r(t){function n(t){if(!t)return!1;if(e.Buffer&&e.Buffer.isBuffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer||e.Blob&&t instanceof Blob||e.File&&t instanceof File)return!0;if(o(t)){for(var r=0;r<t.length;r++)if(n(t[r]))return!0}else if(t&&"object"==typeof t){t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON());for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&n(t[i]))return!0}return!1}return n(t)}var o=n(101);t.exports=r}).call(e,function(){return this}())},function(t,e){t.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}},function(t,e){t.exports=function(t,e,n){var r=t.byteLength;if(e=e||0,n=n||r,t.slice)return t.slice(e,n);if(e<0&&(e+=r),n<0&&(n+=r),n>r&&(n=r),e>=r||e>=n||0===r)return new ArrayBuffer(0);for(var o=new Uint8Array(t),i=new Uint8Array(n-e),s=e,a=0;s<n;s++,a++)i[a]=o[s];return i.buffer}},function(t,e){function n(t,e,n){function o(t,r){if(o.count<=0)throw new Error("after called too many times");--o.count,t?(i=!0,e(t),e=n):0!==o.count||i||e(null,r)}var i=!1;return n=n||r,o.count=t,0===t?e():o}function r(){}t.exports=n},function(t,e,n){var r;(function(t,o){!function(i){function s(t){for(var e,n,r=[],o=0,i=t.length;o<i;)e=t.charCodeAt(o++),e>=55296&&e<=56319&&o<i?(n=t.charCodeAt(o++),56320==(64512&n)?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),o--)):r.push(e);return r}function a(t){for(var e,n=t.length,r=-1,o="";++r<n;)e=t[r],e>65535&&(e-=65536,o+=_(e>>>10&1023|55296),e=56320|1023&e),o+=_(e);return o}function c(t,e){return _(t>>e&63|128)}function u(t){if(0==(4294967168&t))return _(t);var e="";return 0==(4294965248&t)?e=_(t>>6&31|192):0==(4294901760&t)?(e=_(t>>12&15|224),e+=c(t,6)):0==(4292870144&t)&&(e=_(t>>18&7|240),e+=c(t,12),e+=c(t,6)),e+=_(63&t|128)}function f(t){for(var e,n=s(t),r=n.length,o=-1,i="";++o<r;)e=n[o],i+=u(e);return i}function l(){if(m>=g)throw Error("Invalid byte index");var t=255&y[m];if(m++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function d(){var t,e,n,r,o;if(m>g)throw Error("Invalid byte index");if(m==g)return!1;if(t=255&y[m],m++,0==(128&t))return t;if(192==(224&t)){var e=l();if(o=(31&t)<<6|e,o>=128)return o;throw Error("Invalid continuation byte")}if(224==(240&t)){if(e=l(),n=l(),o=(15&t)<<12|e<<6|n,o>=2048)return o;throw Error("Invalid continuation byte")}if(240==(248&t)&&(e=l(),n=l(),r=l(),o=(15&t)<<18|e<<12|n<<6|r,o>=65536&&o<=1114111))return o;throw Error("Invalid WTF-8 detected")}function h(t){y=s(t),g=y.length,m=0;for(var e,n=[];(e=d())!==!1;)n.push(e);return a(n)}var p="object"==typeof e&&e,v=("object"==typeof t&&t&&t.exports==p&&t,"object"==typeof o&&o);v.global!==v&&v.window!==v||(i=v);var y,g,m,_=String.fromCharCode,b={version:"1.0.0",encode:f,decode:h};r=function(){return b}.call(e,n,e,t),!(void 0!==r&&(t.exports=r))}(this)}).call(e,n(82)(t),function(){return this}())},function(t,e){!function(){"use strict";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<t.length;r++)n[t.charCodeAt(r)]=r;e.encode=function(e){var n,r=new Uint8Array(e),o=r.length,i="";for(n=0;n<o;n+=3)i+=t[r[n]>>2],i+=t[(3&r[n])<<4|r[n+1]>>4],i+=t[(15&r[n+1])<<2|r[n+2]>>6],i+=t[63&r[n+2]];return o%3===2?i=i.substring(0,i.length-1)+"=":o%3===1&&(i=i.substring(0,i.length-2)+"=="),i},e.decode=function(t){var e,r,o,i,s,a=.75*t.length,c=t.length,u=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var f=new ArrayBuffer(a),l=new Uint8Array(f);for(e=0;e<c;e+=4)r=n[t.charCodeAt(e)],o=n[t.charCodeAt(e+1)],i=n[t.charCodeAt(e+2)],s=n[t.charCodeAt(e+3)],l[u++]=r<<2|o>>4,l[u++]=(15&o)<<4|i>>2,l[u++]=(3&i)<<6|63&s;return f}}()},function(t,e){(function(e){function n(t){for(var e=0;e<t.length;e++){var n=t[e];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var o=new Uint8Array(n.byteLength);o.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=o.buffer}t[e]=r}}}function r(t,e){e=e||{};var r=new i;n(t);for(var o=0;o<t.length;o++)r.append(t[o]);return e.type?r.getBlob(e.type):r.getBlob()}function o(t,e){return n(t),new Blob(t,e||{})}var i=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,s=function(){try{var t=new Blob(["hi"]);return 2===t.size}catch(e){return!1}}(),a=s&&function(){try{var t=new Blob([new Uint8Array([1,2])]);return 2===t.size}catch(e){return!1}}(),c=i&&i.prototype.append&&i.prototype.getBlob;t.exports=function(){return s?a?e.Blob:o:c?r:void 0}()}).call(e,function(){return this}())},function(t,e){e.encode=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},e.decode=function(t){for(var e={},n=t.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}},function(t,e){t.exports=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e){"use strict";function n(t){var e="";do e=s[t%a]+e,t=Math.floor(t/a);while(t>0);return e}function r(t){var e=0;for(f=0;f<t.length;f++)e=e*a+c[t.charAt(f)];return e}function o(){var t=n(+new Date);return t!==i?(u=0,i=t):t+"."+n(u++)}for(var i,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),a=64,c={},u=0,f=0;f<a;f++)c[s[f]]=f;o.encode=n,o.decode=r,t.exports=o},function(t,e,n){(function(r){function o(){return"undefined"!=typeof document&&"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function i(){var t=arguments,n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return t;var r="color: "+this.color;t=[t[0],r,"color: inherit"].concat(Array.prototype.slice.call(t,1));var o=0,i=0;return t[0].replace(/%[a-z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(i=o))}),t.splice(i,0,r),t}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(n){}}function c(){try{return e.storage.debug}catch(t){}if("undefined"!=typeof r&&"env"in r)return r.env.DEBUG}function u(){try{return window.localStorage}catch(t){}}e=t.exports=n(111),e.log=s,e.formatArgs=i,e.save=a,e.load=c,e.useColors=o,e.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:u(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},e.enable(c())}).call(e,n(1))},function(t,e,n){function r(){return e.colors[f++%e.colors.length]}function o(t){function n(){}function o(){var t=o,n=+new Date,i=n-(u||n);t.diff=i,t.prev=u,t.curr=n,u=n,null==t.useColors&&(t.useColors=e.useColors()),null==t.color&&t.useColors&&(t.color=r());for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var c=0;s[0]=s[0].replace(/%([a-z%])/g,function(n,r){if("%%"===n)return n;c++;var o=e.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(t,i),s.splice(c,1),c--}return n}),s=e.formatArgs.apply(t,s);var f=o.log||e.log||console.log.bind(console);f.apply(t,s)}n.enabled=!1,o.enabled=!0;var i=e.enabled(t)?o:n;return i.namespace=t,i}function i(t){e.save(t);for(var n=(t||"").split(/[\s,]+/),r=n.length,o=0;o<r;o++)n[o]&&(t=n[o].replace(/[\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*?"),"-"===t[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function s(){e.enable("")}function a(t){var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1}function c(t){return t instanceof Error?t.stack||t.message:t}e=t.exports=o.debug=o,e.coerce=c,e.disable=s,e.enable=i,e.enabled=a,e.humanize=n(112),e.names=[],e.skips=[],e.formatters={};var u,f=0},function(t,e){function n(t){if(t=String(t),!(t.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*f;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function r(t){return t>=u?Math.round(t/u)+"d":t>=c?Math.round(t/c)+"h":t>=a?Math.round(t/a)+"m":t>=s?Math.round(t/s)+"s":t+"ms"}function o(t){return i(t,u,"day")||i(t,c,"hour")||i(t,a,"minute")||i(t,s,"second")||t+" ms"}function i(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var s=1e3,a=60*s,c=60*a,u=24*c,f=365.25*u;t.exports=function(t,e){e=e||{};var i=typeof t;if("string"===i&&t.length>0)return n(t);if("number"===i&&isNaN(t)===!1)return e["long"]?o(t):r(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){(function(e){function r(){}function o(t){i.call(this,t),this.query=this.query||{},a||(e.___eio||(e.___eio=[]),a=e.___eio),this.index=a.length;var n=this;a.push(function(t){n.onData(t)}),this.query.j=this.index,e.document&&e.addEventListener&&e.addEventListener("beforeunload",function(){n.script&&(n.script.onerror=r)},!1)}var i=n(96),s=n(108);t.exports=o;var a,c=/\n/g,u=/\\n/g;s(o,i),o.prototype.supportsBinary=!1,o.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),i.prototype.doClose.call(this)},o.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e;var r="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);r&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},o.prototype.doWrite=function(t,e){function n(){r(),e()}function r(){if(o.iframe)try{o.form.removeChild(o.iframe)}catch(t){o.onError("jsonp polling iframe removal error",t)}try{var e='<iframe src="javascript:0" name="'+o.iframeId+'">';i=document.createElement(e)}catch(t){i=document.createElement("iframe"),i.name=o.iframeId,i.src="javascript:0"}i.id=o.iframeId,o.form.appendChild(i),o.iframe=i}var o=this;if(!this.form){var i,s=document.createElement("form"),a=document.createElement("textarea"),f=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=f,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),r(),t=t.replace(u,"\\\n"),this.area.value=t.replace(c,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===o.iframe.readyState&&n()}:this.iframe.onload=n}}).call(e,function(){return this}())},function(t,e,n){(function(e){function r(t){var e=t&&t.forceBase64;e&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=l&&!t.forceNode,this.usingBrowserWebSocket||(h=o),i.call(this,t)}var o,i=n(97),s=n(98),a=n(107),c=n(108),u=n(109),f=n(110)("engine.io-client:websocket"),l=e.WebSocket||e.MozWebSocket;if("undefined"==typeof window)try{o=n(115)}catch(d){}var h=l;h||"undefined"!=typeof window||(h=o),t.exports=r,c(r,i),r.prototype.name="websocket",r.prototype.supportsBinary=!0,r.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=void 0,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?new h(t):new h(t,e,n)}catch(r){return this.emit("error",r)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},r.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},r.prototype.write=function(t){function n(){r.emit("flush"),setTimeout(function(){r.writable=!0,r.emit("drain")},0)}var r=this;this.writable=!1;for(var o=t.length,i=0,a=o;i<a;i++)!function(t){s.encodePacket(t,r.supportsBinary,function(i){if(!r.usingBrowserWebSocket){var s={};if(t.options&&(s.compress=t.options.compress),r.perMessageDeflate){var a="string"==typeof i?e.Buffer.byteLength(i):i.length;a<r.perMessageDeflate.threshold&&(s.compress=!1)}}try{r.usingBrowserWebSocket?r.ws.send(i):r.ws.send(i,s)}catch(c){f("websocket closed before onclose event")}--o||n()})}(t[i])},r.prototype.onClose=function(){i.prototype.onClose.call(this)},r.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=u()),this.supportsBinary||(t.b64=1),t=a.encode(t),t.length&&(t="?"+t);var r=this.hostname.indexOf(":")!==-1;return e+"://"+(r?"["+this.hostname+"]":this.hostname)+n+this.path+t},r.prototype.check=function(){return!(!h||"__initialize"in h&&this.name===r.prototype.name)}}).call(e,function(){return this}())},function(t,e){},function(t,e){var n=[].indexOf;t.exports=function(t,e){if(n)return t.indexOf(e);for(var r=0;r<t.length;++r)if(t[r]===e)return r;return-1}},function(t,e){(function(e){var n=/^[\],:{}\s]*$/,r=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,o=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,i=/(?:^|:|,)(?:\s*\[)+/g,s=/^\s+/,a=/\s+$/;t.exports=function(t){return"string"==typeof t&&t?(t=t.replace(s,"").replace(a,""),e.JSON&&JSON.parse?JSON.parse(t):n.test(t.replace(r,"@").replace(o,"]").replace(i,""))?new Function("return "+t)():void 0):null}}).call(e,function(){return this}())},function(t,e,n){function r(t,e,n){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}var o=n(77),i=n(21),s=n(119),a=n(120),c=n(121),u=n(74)("socket.io-client:socket"),f=n(100);t.exports=e=r;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},d=i.prototype.emit;i(r.prototype),r.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[a(t,"open",c(this,"onopen")),a(t,"packet",c(this,"onpacket")),a(t,"close",c(this,"onclose"))]}},r.prototype.open=r.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},r.prototype.send=function(){var t=s(arguments);return t.unshift("message"),this.emit.apply(this,t),this},r.prototype.emit=function(t){if(l.hasOwnProperty(t))return d.apply(this,arguments),this;var e=s(arguments),n=o.EVENT;f(e)&&(n=o.BINARY_EVENT);var r={type:n,data:e};return r.options={},r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(u("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),delete this.flags,this},r.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},r.prototype.onopen=function(){u("transport is open - connecting"),"/"!==this.nsp&&(this.query?this.packet({type:o.CONNECT,query:this.query}):this.packet({type:o.CONNECT}))},r.prototype.onclose=function(t){u("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},r.prototype.onpacket=function(t){if(t.nsp===this.nsp)switch(t.type){case o.CONNECT:this.onconnect();break;case o.EVENT:this.onevent(t);break;case o.BINARY_EVENT:this.onevent(t);break;case o.ACK:this.onack(t);break;case o.BINARY_ACK:this.onack(t);break;case o.DISCONNECT:this.ondisconnect();break;case o.ERROR:this.emit("error",t.data)}},r.prototype.onevent=function(t){var e=t.data||[];u("emitting event %j",e),null!=t.id&&(u("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?d.apply(this,e):this.receiveBuffer.push(e)},r.prototype.ack=function(t){var e=this,n=!1;return function(){if(!n){n=!0;var r=s(arguments);u("sending ack %j",r);var i=f(r)?o.BINARY_ACK:o.ACK;e.packet({type:i,id:t,data:r})}}},r.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(u("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):u("bad ack %s",t.id)},r.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},r.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)d.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},r.prototype.ondisconnect=function(){u("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},r.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},r.prototype.close=r.prototype.disconnect=function(){return this.connected&&(u("performing disconnect (%s)",this.nsp),this.packet({type:o.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},r.prototype.compress=function(t){return this.flags=this.flags||{},this.flags.compress=t,this}},function(t,e){function n(t,e){var n=[];e=e||0;for(var r=e||0;r<t.length;r++)n[r-e]=t[r];return n}t.exports=n},function(t,e){function n(t,e,n){return t.on(e,n),{destroy:function(){t.removeListener(e,n)}}}t.exports=n},function(t,e){var n=[].slice;t.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return e.apply(t,r.concat(n.call(arguments)))}}},function(t,e){function n(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=n,n.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(t){this.ms=t},n.prototype.setMax=function(t){this.max=t},n.prototype.setJitter=function(t){this.jitter=t}}])});
//# sourceMappingURL=telepat.client.min.js.map