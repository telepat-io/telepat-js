!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Telepat",[],e):"object"==typeof exports?exports.Telepat=e():t.Telepat=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){(function(r){"use strict";function o(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(2),c=o(a),u=n(3),f=o(u),l=n(17),h=o(l),d=n(25),p=o(d),v=n(27),y=o(v),g=n(28),m=o(g),_=n(29),b=o(_),w=n(66),k=o(w),E=n(67),x=o(E),A=":deviceId",S=function(){function t(){function e(){return r.env["win32"===r.platform?"USERPROFILE":"HOME"]}function n(){var t=e()+"/.telepat-cli";return c["default"].existsSync(t)||c["default"].mkdirSync(t,744),t}var o=arguments.length<=0||void 0===arguments[0]?null:arguments[0];i(this,t),this._db=new f["default"]("undefined"!=typeof window?"/_telepat":n()),this._event=new m["default"](p["default"]),this._monitor=new b["default"],this._socketEndpoint=null,this._socket=null,this._persistentConnectionOptions=null,this.connected=!1,this.connecting=!1,this.configured=!1,this.currentAppId=null,this.collections={},this.subscriptions={},this.admin=null,this.user=null,this.collectionEvent=new m["default"](p["default"]),o&&this.connect(o)}return s(t,[{key:"onReady",value:function(t){return this.on("ready",t)}},{key:"getCollections",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];h["default"].get("context/all","",function(n,r){if(n){var o=(0,y["default"])("Error retrieving collections "+n);t.callback(o,null)}else{t._monitor.remove({channel:{model:"context"}}),t.collections={};for(var i in r.body.content)t.collections[r.body.content[i].id]=r.body.content[i];t._monitor.add({channel:{model:"context"}},t.collections,t.collectionEvent,t._addCollection.bind(t),t._deleteCollection.bind(t),t._updateCollection.bind(t)),t.collectionEvent.on("update",function(e,n,r,o){t._event.emit("collections_update")}),e(null,t.collections),t._event.emit("collections_update")}})}},{key:"_addCollection",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];this.admin?this.admin.addCollection(t,e):p["default"].warn("Editing collection data as non-admin user. Changes will not be remotely persisted.")}},{key:"_updateCollection",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2];this.admin?this.admin.updateCollection(t,e,n):p["default"].warn("Editing collection data as non-admin user. Changes will not be remotely persisted.")}},{key:"_deleteCollection",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];this.admin?this.admin.deleteCollection(t,e):p["default"].warn("Editing collection data as non-admin user. Changes will not be remotely persisted.")}},{key:"_updateUser",value:function(){var t=this,e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],n=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];this.user?n(null):this.user=new x["default"](this._db,this._event,this._monitor,function(e){t.admin=e},function(){e?t.user.reauth(n):n(null)})}},{key:"_getSavedUDID",value:function(t){this._db.get(A).then(function(e){e[h["default"].appId]?t(null,e[h["default"].appId]):(p["default"].warn("Could not retrieve saved UDID"),t(new Error("Could not retrieve saved UDID")))})["catch"](function(e){p["default"].warn("Could not retrieve saved UDID",e),t(e)})}},{key:"_saveUDID",value:function(t,e){var n=this;this._db.get(A).then(function(r){r[h["default"].appId]=t,n._db.put(r).then(function(){p["default"].info("Replaced existing UDID"),e(null)})["catch"](function(t){p["default"].warn("Could not persist UDID. Error: "+t),e(t)})})["catch"](function(){var t={_id:A};t[h["default"].appId]=h["default"].UDID,n._db.put(t).then(function(){p["default"].info("Saved new UDID"),e(null)})["catch"](function(t){p["default"].warn("Could not persist UDID. Error: "+t),e(t)})})}},{key:"_rebindVolatileTransport",value:function(t){var e=this;this._socket&&!function(){var n=setTimeout(function(){t((0,y["default"])("Socket transport connection timeout"))},5e3);e._socket.emit("bind_device",{device_id:h["default"].UDID,application_id:h["default"].appId}),e._socket.on("ready",function(){e._socket.removeAllListeners("ready"),clearTimeout(n),n=null;for(var r in e.subscriptions)e.subscriptions[r].subscribe();t(null)})}()}},{key:"configure",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];"undefined"!=typeof e.apiEndpoint?h["default"].apiEndpoint=e.apiEndpoint+"/":n((0,y["default"])("Configure options must provide an apiEndpoint property")),"undefined"!=typeof e.socketEndpoint?this._socketEndpoint=e.socketEndpoint:n((0,y["default"])("Configure options must provide an socketEndpoint property")),this._updateUser(e.reauth,function(){t._event.emit("configure"),t.configured=!0,n(null,t)})}},{key:"registerDevice",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0],n=function(n,r){n?e(n):(r.body.content.identifier&&(h["default"].UDID=r.body.content.identifier,p["default"].info("Received new UDID: "+h["default"].UDID),t._saveUDID(h["default"].UDID,function(){})),e(null,r))},r={info:{os:"web",userAgent:"undefined"!=typeof navigator?navigator.userAgent:"node"},"volatile":{type:"sockets",active:1}};this._persistentConnectionOptions&&(r.persistent=this._persistentConnectionOptions,1===r.persistent.active&&(r["volatile"].active=0)),h["default"].call("device/register",r,function(t,e){t&&h["default"].UDID?(h["default"].UDID=null,h["default"].call("device/register",r,function(t,e){n(t,e)})):n(null,e)})}},{key:"connectVolatileTransport",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];this.disconnectVolatileTransport(),this._socket=n(69)(this._socketEndpoint,e),p["default"].info("Connecting to socket service "+this._socketEndpoint),this._socket.on("error",function(t){r(t)}),this._socket.on("connect",function(){t._rebindVolatileTransport(function(t){r(t)})}),this._socket.on("message",function(e){t.processMessage(e)}),this._socket.on("context-update",function(){t.getCollections()}),this._socket.on("disconnect",function(){p["default"].warn("Sockets disconnected"),t._event.emit("volatile_disconnect")}),this._socket.on("reconnect",function(){t._rebindVolatileTransport(function(e){e?t._event.emit("reconnect_failed"):t._event.emit("reconnect")})}),this._socket.on("reconnect_failed",function(){p["default"].warn("Sockets reconnect failed"),t._event.emit("reconnect_failed")})}},{key:"disconnectVolatileTransport",value:function(){this._socket&&(this._socket.removeAllListeners(),this._socket.close(),this._socket=null)}},{key:"connect",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];if("undefined"==typeof e)return n((0,y["default"])("Options object not provided to the connect function"));if("undefined"==typeof e.apiKey)return n((0,y["default"])("Connect options must provide an apiKey property"));if("undefined"==typeof e.appId)return n((0,y["default"])("Connect options must provide an appId property"));if("undefined"!=typeof e.apiEndpoint)h["default"].apiEndpoint=e.apiEndpoint+"/";else if(!h["default"].apiEndpoint)return n((0,y["default"])("Connect options must provide an apiEndpoint property, or you must run `configure` first"));if("undefined"!=typeof e.socketEndpoint)this._socketEndpoint=e.socketEndpoint;else if(!this._socketEndpoint)return n((0,y["default"])("Connect options must provide an socketEndpoint property, or you must run `configure` first"));"undefined"!=typeof e.timerInterval&&(this._monitor.timerInterval=e.timerInterval);var r=function(e){t.connected=!1,t.connecting=!1,t.currentAppId=null,n((0,y["default"])("Device registration failed with error: "+e)),t._event.emit("connect_error",e)},o=function(){t.connected=!0,t.connecting=!1,t.currentAppId=h["default"].appId,n(null),t._event.emit("connect"),t._event.emit("ready")},i=function(){t.getCollections(function(n){n?r(n):t._updateUser(e.reauth,function(){o()})})},s=function(e,n){e?r(e):t._persistentConnectionOptions&&1===t._persistentConnectionOptions.active?i():t.connectVolatileTransport({},function(t){t?r(t):i()})};return this.connected&&(this.connected=!1,this.disconnect()),this.connecting=!0,h["default"].apiKey=e.apiKey,h["default"].appId=e.appId,this.admin&&this.admin.apps&&(this.admin.app=this.admin.apps[h["default"].appId]),this._persistentConnectionOptions=e.persistentConnection||this._persistentConnectionOptions,e.updateUDID?this.registerDevice(s):this._getSavedUDID(function(e,n){e||(h["default"].UDID=n),t.registerDevice(s)}),this}},{key:"disconnect",value:function(){var t=this;this.disconnectVolatileTransport(),this.collections=null,this._monitor.remove({channel:{model:"context"}});for(var e in this.subscriptions)this.subscriptions[e].unsubscribe();this.subscriptions={},this.user.isAdmin||this.user.logout(function(){t.admin.unhook(),t.admin=null,t.user=null}),h["default"].apiKey=null,h["default"].appId=null,h["default"].UDID=null,this._event.emit("disconnect"),this.currentAppId=null,this.connected=!1}},{key:"processMessage",value:function(t){this._monitor.processMessage(t)}},{key:"setLogLevel",value:function(t){return p["default"].setLevel(t),this}},{key:"on",value:function(t,e){return"connect"!==t&&"ready"!==t||!this.connected||setTimeout(e,0),this._event.on(t,e)}},{key:"removeCallback",value:function(t,e){return this._event.removeCallback(t,e)}},{key:"subscribe",value:function(t,e){var n=this,r=new k["default"](this._monitor,t),o=b["default"].subscriptionKeyForOptions(t);return this.subscriptions[o]=r,r.subscribe(),void 0!==e&&r.on("subscribe",e),r.on("_unsubscribe",function(){delete n.subscriptions[o]}),r}},{key:"getChannel",value:function(t){var e=b["default"].subscriptionKeyForOptions(t);return this.subscriptions[e]?this.subscriptions[e]:new k["default"](this._monitor,t)}},{key:"sendEmail",value:function(t,e,n,r,o,i){h["default"].call("/email",{recipients:n,from:t,from_name:e,subject:r,body:o},function(t,e){t?i((0,y["default"])("Send email failed with error: "+t),null):i(null,e.body.content)})}},{key:"get",value:function(t,e){t.no_subscribe=!0,h["default"].call("object/subscribe",t,function(t,n){t?e((0,y["default"])("Get objects failed with error: "+t),null):e(null,n.body.content)})}}]),t}();e["default"]=S,t.exports=e["default"]}).call(e,n(1))},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(f===setTimeout)return setTimeout(t,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(t,0);try{return f(t,0)}catch(e){try{return f.call(null,t,0)}catch(e){return f.call(this,t,0)}}}function i(t){if(l===clearTimeout)return clearTimeout(t);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function s(){v&&d&&(v=!1,d.length?p=d.concat(p):y=-1,p.length&&a())}function a(){if(!v){var t=o(s);v=!0;for(var e=p.length;e;){for(d=p,p=[];++y<e;)d&&d[y].run();y=-1,e=p.length}d=null,v=!1,i(t)}}function c(t,e){this.fun=t,this.array=e}function u(){}var f,l,h=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(t){f=n}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(t){l=r}}();var d,p=[],v=!1,y=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new c(t,e)),1!==p.length||v||o(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=u,h.addListener=u,h.once=u,h.off=u,h.removeListener=u,h.removeAllListeners=u,h.emit=u,h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,e){console.log("I'm `fs` modules")},function(t,e,n){(function(e,r){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t["default"]:t}function i(t){return"$"+t}function s(t){return t.substring(1)}function a(){this.store={}}function c(t){if(this.store=new a,t&&Array.isArray(t))for(var e=0,n=t.length;e<n;e++)this.add(t[e])}function u(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer||"undefined"!=typeof Blob&&t instanceof Blob}function f(t){if("function"==typeof t.slice)return t.slice(0);var e=new ArrayBuffer(t.byteLength),n=new Uint8Array(e),r=new Uint8Array(t);return n.set(r),e}function l(t){if(t instanceof ArrayBuffer)return f(t);var e=t.size,n=t.type;return"function"==typeof t.slice?t.slice(0,e,n):t.webkitSlice(0,e,n)}function h(t){var e=Object.getPrototypeOf(t);if(null===e)return!0;var n=e.constructor;return"function"==typeof n&&n instanceof n&&Wr.call(n)==$r}function d(t){var e,n,r;if(!t||"object"!=typeof t)return t;if(Array.isArray(t)){for(e=[],n=0,r=t.length;n<r;n++)e[n]=d(t[n]);return e}if(t instanceof Date)return t.toISOString();if(u(t))return l(t);if(!h(t))return t;e={};for(n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=d(t[n]);"undefined"!=typeof o&&(e[n]=o)}return e}function p(t){var e=!1;return Hr(function(n){if(e)throw new Error("once called more than once");e=!0,t.apply(this,n)})}function v(t){return Hr(function(n){n=d(n);var r,o=this,i="function"==typeof n[n.length-1]&&n.pop();i&&(r=function(t,n){e.nextTick(function(){i(t,n)})});var s=new Vr(function(e,r){var i;try{var s=p(function(t,n){t?r(t):e(n)});n.push(s),i=t.apply(o,n),i&&"function"==typeof i.then&&e(i)}catch(a){r(a)}});return r&&s.then(function(t){r(null,t)},r),s})}function y(t,e){function n(t,e,n){if(Gr.enabled){for(var r=[t.name,e],o=0;o<n.length-1;o++)r.push(n[o]);Gr.apply(null,r);var i=n[n.length-1];n[n.length-1]=function(n,r){var o=[t.name,e];o=o.concat(n?["error",n]:["success",r]),Gr.apply(null,o),i(n,r)}}}return v(Hr(function(r){if(this._closed)return Vr.reject(new Error("database is closed"));if(this._destroyed)return Vr.reject(new Error("database is destroyed"));var o=this;return n(o,t,r),this.taskqueue.isReady?e.apply(this,r):new Vr(function(e,n){o.taskqueue.addTask(function(i){i?n(i):e(o[t].apply(o,r))})})}))}function g(t,e){for(var n={},r=0,o=e.length;r<o;r++){var i=e[r];i in t&&(n[i]=t[i])}return n}function m(t){return t}function _(t){return[{ok:t}]}function b(t,e,n){function r(){var t=[];h.forEach(function(e){e.docs.forEach(function(n){t.push({id:e.id,docs:[n]})})}),n(null,{results:t})}function o(){++l===f&&r()}function i(t,e,n){h[t]={id:e,docs:n},o()}function s(){if(!(p>=d.length)){var t=Math.min(p+Qr,d.length),e=d.slice(p,t);a(e,p),p+=e.length}}function a(n,r){n.forEach(function(n,o){var a=r+o,c=u[n],f=g(c[0],["atts_since","attachments"]);f.open_revs=c.map(function(t){return t.rev}),f.open_revs=f.open_revs.filter(m);var l=m;0===f.open_revs.length&&(delete f.open_revs,l=_),["revs","attachments","binary","ajax"].forEach(function(t){t in e&&(f[t]=e[t])}),t.get(n,f,function(t,e){var r;r=t?[{error:t}]:l(e),i(a,n,r),s()})})}var c=e.docs,u={};c.forEach(function(t){t.id in u?u[t.id].push(t):u[t.id]=[t]});var f=Object.keys(u).length,l=0,h=new Array(f),d=Object.keys(u),p=0;s()}function w(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function k(){return Kr}function E(t){w()?chrome.storage.onChanged.addListener(function(e){null!=e.db_name&&t.emit(e.dbName.newValue)}):k()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(e){t.emit(e.key)}):window.attachEvent("storage",function(e){t.emit(e.key)}))}function x(){Fr.EventEmitter.call(this),this._listeners={},E(this)}function A(t){if("undefined"!==console&&t in console){var e=Array.prototype.slice.call(arguments,1);console[t].apply(console,e)}}function S(t,e){var n=6e5;t=parseInt(t,10)||0,e=parseInt(e,10),e!==e||e<=t?e=(t||1)<<1:e+=1,e>n&&(t=n>>1,e=n);var r=Math.random(),o=e-t;return~~(o*r+t)}function j(t){var e=0;return t||(e=2e3),S(t,e)}function T(t,e){A("info","The above "+t+" is totally normal. "+e)}function C(t){Error.call(this,t.reason),this.status=t.status,this.name=t.error,this.message=t.reason,this.error=!0}function O(t,e){function n(e){for(var n in t)"function"!=typeof t[n]&&(this[n]=t[n]);void 0!==e&&(this.reason=e)}return n.prototype=C.prototype,new n(e)}function R(t){if("object"!=typeof t){var e=t;t=ao,t.data=e}return"error"in t&&"conflict"===t.error&&(t.name="conflict",t.status=409),"name"in t||(t.name=t.error||"unknown"),"status"in t||(t.status=500),"message"in t||(t.message=t.message||t.reason),t}function D(t,e,n){try{return!t(e,n)}catch(r){var o="Filter function threw: "+r.toString();return O(lo,o)}}function q(t){var e={},n=t.filter&&"function"==typeof t.filter;return e.query=t.query_params,function(r){r.doc||(r.doc={});var o=n&&D(t.filter,r.doc,e);if("object"==typeof o)return o;if(o)return!1;if(t.include_docs){if(!t.attachments)for(var i in r.doc._attachments)r.doc._attachments.hasOwnProperty(i)&&(r.doc._attachments[i].stub=!0)}else delete r.doc;return!0}}function I(t){for(var e=[],n=0,r=t.length;n<r;n++)e=e.concat(t[n]);return e}function B(t){var e;if(t?"string"!=typeof t?e=O(ro):/^_/.test(t)&&!/^_(design|local)/.test(t)&&(e=O(io)):e=O(oo),e)throw e}function L(t,e){return"listenerCount"in t?t.listenerCount(e):Fr.EventEmitter.listenerCount(t,e)}function P(t){if(!t)return null;var e=t.split("/");return 2===e.length?e:1===e.length?[t,t]:null}function N(t){var e=P(t);return e?e.join("/"):null}function U(t){for(var e=wo.exec(t),n={},r=14;r--;){var o=mo[r],i=e[r]||"",s=["user","password"].indexOf(o)!==-1;n[o]=s?decodeURIComponent(i):i}return n[_o]={},n[mo[12]].replace(bo,function(t,e,r){e&&(n[_o][e]=r)}),n}function M(t,e,n){return new Vr(function(r,o){t.get(e,function(i,s){if(i){if(404!==i.status)return o(i);s={}}var a=s._rev,c=n(s);return c?(c._id=e,c._rev=a,void r(F(t,c,n))):r({updated:!1,rev:a})})})}function F(t,e,n){return t.put(e).then(function(t){return{updated:!0,rev:t.rev}},function(r){if(409!==r.status)throw r;return M(t,e._id,n)})}function H(t){return 0|Math.random()*t}function z(t,e){e=e||ko.length;var n="",r=-1;if(t){for(;++r<t;)n+=ko[H(e)];return n}for(;++r<36;)switch(r){case 8:case 13:case 18:case 23:n+="-";break;case 19:n+=ko[3&H(16)|8];break;default:n+=ko[H(16)]}return n}function J(t){for(var e,n,r,o,i=t.rev_tree.slice();o=i.pop();){var s=o.ids,a=s[2],c=o.pos;if(a.length)for(var u=0,f=a.length;u<f;u++)i.push({pos:c+1,ids:a[u]});else{var l=!!s[1].deleted,h=s[0];e&&!(r!==l?r:n!==c?n<c:e<h)||(e=h,n=c,r=l)}}return n+"-"+e}function Y(t,e){for(var n,r=t.slice();n=r.pop();)for(var o=n.pos,i=n.ids,s=i[2],a=e(0===s.length,o,i[0],n.ctx,i[1]),c=0,u=s.length;c<u;c++)r.push({pos:o+1,ids:s[c],ctx:a})}function X(t,e){return t.pos-e.pos}function V(t){var e=[];Y(t,function(t,n,r,o,i){t&&e.push({rev:n+"-"+r,pos:n,opts:i})}),e.sort(X).reverse();for(var n=0,r=e.length;n<r;n++)delete e[n].pos;return e}function K(t){for(var e=J(t),n=V(t.rev_tree),r=[],o=0,i=n.length;o<i;o++){var s=n[o];s.rev===e||s.opts.deleted||r.push(s.rev)}return r}function W(t){var e=[];return Y(t.rev_tree,function(t,n,r,o,i){"available"!==i.status||t||(e.push(n+"-"+r),i.status="missing")}),e}function $(t){for(var e,n=[],r=t.slice();e=r.pop();){var o=e.pos,i=e.ids,s=i[0],a=i[1],c=i[2],u=0===c.length,f=e.history?e.history.slice():[];f.push({id:s,opts:a}),u&&n.push({pos:o+1-f.length,ids:f});for(var l=0,h=c.length;l<h;l++)r.push({pos:o+1,ids:c[l],history:f})}return n.reverse()}function G(t,e){return t.pos-e.pos}function Q(t,e,n){for(var r,o=0,i=t.length;o<i;)r=o+i>>>1,n(t[r],e)<0?o=r+1:i=r;return o}function Z(t,e,n){var r=Q(t,e,n);t.splice(r,0,e)}function tt(t,e){for(var n,r,o=e,i=t.length;o<i;o++){var s=t[o],a=[s.id,s.opts,[]];r?(r[2].push(a),r=a):n=r=a}return n}function et(t,e){return t[0]<e[0]?-1:1}function nt(t,e){for(var n=[{tree1:t,tree2:e}],r=!1;n.length>0;){var o=n.pop(),i=o.tree1,s=o.tree2;(i[1].status||s[1].status)&&(i[1].status="available"===i[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(i[2][0]){for(var c=!1,u=0;u<i[2].length;u++)i[2][u][0]===s[2][a][0]&&(n.push({tree1:i[2][u],tree2:s[2][a]}),c=!0);c||(r="new_branch",Z(i[2],s[2][a],et))}else r="new_leaf",i[2][0]=s[2][a]}return{conflicts:r,tree:t}}function rt(t,e,n){var r,o=[],i=!1,s=!1;if(!t.length)return{tree:[e],conflicts:"new_leaf"};for(var a=0,c=t.length;a<c;a++){var u=t[a];if(u.pos===e.pos&&u.ids[0]===e.ids[0])r=nt(u.ids,e.ids),o.push({pos:u.pos,ids:r.tree}),i=i||r.conflicts,s=!0;else if(n!==!0){var f=u.pos<e.pos?u:e,l=u.pos<e.pos?e:u,h=l.pos-f.pos,d=[],p=[];for(p.push({ids:f.ids,diff:h,parent:null,parentIdx:null});p.length>0;){var v=p.pop();if(0!==v.diff)for(var y=v.ids[2],g=0,m=y.length;g<m;g++)p.push({ids:y[g],diff:v.diff-1,parent:v.ids,parentIdx:g});else v.ids[0]===l.ids[0]&&d.push(v)}var _=d[0];_?(r=nt(_.ids,l.ids),_.parent[2][_.parentIdx]=r.tree,o.push({pos:f.pos,ids:f.ids}),i=i||r.conflicts,s=!0):o.push(u)}else o.push(u)}return s||o.push(e),o.sort(G),{tree:o,conflicts:i||"internal_node"}}function ot(t,e){for(var n,r=$(t),o={},i=0,s=r.length;i<s;i++){for(var a=r[i],c=a.ids,u=Math.max(0,c.length-e),f={pos:a.pos+u,ids:tt(c,u)},l=0;l<u;l++){var h=a.pos+l+"-"+c[l].id;o[h]=!0}n=n?rt(n,f,!0).tree:[f]}return Y(n,function(t,e,n){delete o[e+"-"+n]}),{tree:n,revs:Object.keys(o)}}function it(t,e,n){var r=rt(t,e),o=ot(r.tree,n);return{tree:o.tree,stemmedRevs:o.revs,conflicts:r.conflicts}}function st(t,e){for(var n,r=t.slice(),o=e.split("-"),i=parseInt(o[0],10),s=o[1];n=r.pop();){if(n.pos===i&&n.ids[0]===s)return!0;for(var a=n.ids[2],c=0,u=a.length;c<u;c++)r.push({pos:n.pos+1,ids:a[c]})}return!1}function at(t){return t.ids}function ct(t,e){e||(e=J(t));for(var n,r=e.substring(e.indexOf("-")+1),o=t.rev_tree.map(at);n=o.pop();){if(n[0]===r)return!!n[1].deleted;o=o.concat(n[2])}}function ut(t){return/^_local/.test(t)}function ft(t){return zr('"use strict";\nreturn '+t+";",{})}function lt(t){var e=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+t+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n");return zr(e,{})}function ht(t,e){try{t.emit("change",e)}catch(n){A("error",'Error in .on("change", function):',n)}}function dt(t,e,n){function r(){o.cancel()}Fr.EventEmitter.call(this);var o=this;this.db=t,e=e?d(e):{};var i=e.complete=p(function(e,n){e?L(o,"error")>0&&o.emit("error",e):o.emit("complete",n),o.removeAllListeners(),t.removeListener("destroyed",r)});n&&(o.on("complete",function(t){n(null,t)}),o.on("error",n)),t.once("destroyed",r),e.onChange=function(t){e.isCancelled||ht(o,t)};var s=new Vr(function(t,n){e.complete=function(e,r){e?n(e):t(r)}});o.once("cancel",function(){t.removeListener("destroyed",r),e.complete(null,{status:"cancelled"})}),this.then=s.then.bind(s),this["catch"]=s["catch"].bind(s),this.then(function(t){i(null,t)},i),t.taskqueue.isReady?o.doChanges(e):t.taskqueue.addTask(function(t){t?e.complete(t):o.isCancelled?o.emit("cancel"):o.doChanges(e)})}function pt(t,e,n){var r=[{rev:t._rev}];"all_docs"===n.style&&(r=V(e.rev_tree).map(function(t){return{rev:t.rev}}));var o={id:e.id,changes:r,doc:t};return ct(e,t._rev)&&(o.deleted=!0),n.conflicts&&(o.doc._conflicts=K(e),o.doc._conflicts.length||delete o.doc._conflicts),o}function vt(t,e){return t<e?-1:t>e?1:0}function yt(t,e){for(var n=0;n<t.length;n++)if(e(t[n],n)===!0)return t[n]}function gt(t){return function(e,n){e||n[0]&&n[0].error?t(e||n[0]):t(null,n.length?n[0]:n)}}function mt(t){for(var e=0;e<t.length;e++){var n=t[e];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),o=0;o<r.length;o++){var i=r[o];n._attachments[i]=g(n._attachments[i],["data","digest","content_type","length","revpos","stub"])}}}function _t(t,e){var n=vt(t._id,e._id);if(0!==n)return n;var r=t._revisions?t._revisions.start:0,o=e._revisions?e._revisions.start:0;return vt(r,o)}function bt(t){var e={},n=[];return Y(t,function(t,r,o,i){var s=r+"-"+o;return t&&(e[s]=0),void 0!==i&&n.push({from:i,to:s}),s}),n.reverse(),n.forEach(function(t){void 0===e[t.from]?e[t.from]=1+e[t.to]:e[t.from]=Math.min(e[t.from],1+e[t.to])}),e}function wt(t,e,n){var r="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;if(e.descending&&r.reverse(),!r.length)return t._allDocs({limit:0},n);var o={offset:e.skip};return Vr.all(r.map(function(n){var r=Pr.extend({key:n,deleted:"ok"},e);return["limit","skip","keys"].forEach(function(t){delete r[t]}),new Vr(function(e,i){t._allDocs(r,function(t,r){return t?i(t):(o.total_rows=r.total_rows,void e(r.rows[0]||{key:n,error:"not_found"}))})})})).then(function(t){return o.rows=t,o})}function kt(t){var n=t._compactionQueue[0],r=n.opts,o=n.callback;t.get("_local/compaction")["catch"](function(){return!1}).then(function(n){n&&n.last_seq&&(r.last_seq=n.last_seq),t._compact(r,function(n,r){n?o(n):o(null,r),e.nextTick(function(){t._compactionQueue.shift(),t._compactionQueue.length&&kt(t)})})})}function Et(t){return"_"===t.charAt(0)&&t+"is not a valid attachment name, attachment names cannot start with '_'"}function xt(){Fr.EventEmitter.call(this)}function At(){this.isReady=!1,this.failed=!1,this.queue=[]}function St(t,e){var n=t.match(/([a-z\-]*):\/\/(.*)/);if(n)return t=/http(s?)/.test(n[1])?n[1]+"://"+n[2]:n[2],{name:t,adapter:n[1]};var r,o="idb"in Tt.adapters&&"websql"in Tt.adapters&&k()&&localStorage["_pouch__websqldb_"+Tt.prefix+t];if(e.adapter)r=e.adapter;else if("undefined"!=typeof e&&e.db)r="leveldb";else for(var i=0;i<Tt.preferredAdapters.length;++i){r=Tt.preferredAdapters[i];{if(!o||"idb"!==r)break;A("log",'PouchDB is downgrading "'+t+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.')}}var s=Tt.adapters[r],a=!(s&&"use_prefix"in s)||s.use_prefix;return{name:a?Tt.prefix+t:t,adapter:r}}function jt(t){function e(){t.constructor.emit("destroyed",t.name)}function n(){t.removeListener("destroyed",e),t.emit("destroyed",t)}var r=t.constructor._destructionListeners;t.once("destroyed",e),r.has(t.name)||r.set(t.name,[]),r.get(t.name).push(n)}function Tt(t,e){if(!(this instanceof Tt))return new Tt(t,e);var n=this;if(e=e||{},t&&"object"==typeof t&&(e=t,t=e.name,delete e.name),this.__opts=e=d(e),n.auto_compaction=e.auto_compaction,n.prefix=Tt.prefix,"string"!=typeof t)throw new Error("Missing/invalid DB name");var r=(e.prefix||"")+t,o=St(r,e);if(e.name=o.name,e.adapter=e.adapter||o.adapter,n.name=t,n._adapter=e.adapter,Nr("pouchdb:adapter")("Picked adapter: "+e.adapter),!Tt.adapters[e.adapter]||!Tt.adapters[e.adapter].valid())throw new Error("Invalid Adapter: "+e.adapter);xt.call(n),n.taskqueue=new At,n.adapter=e.adapter,Tt.adapters[e.adapter].call(n,e,function(t){return t?n.taskqueue.fail(t):(jt(n),n.emit("created",n),Tt.emit("created",n.name),void n.taskqueue.ready(n))})}function Ct(t){Object.keys(Fr.EventEmitter.prototype).forEach(function(e){"function"==typeof Fr.EventEmitter.prototype[e]&&(t[e]=Eo[e].bind(Eo))});var e=t._destructionListeners=new a;t.on("destroyed",function(t){e.get(t).forEach(function(t){t()}),e["delete"](t)})}function Ot(t){return t.reduce(function(t,e){return t[e]=!0,t},{})}function Rt(t){if(!/^\d+\-./.test(t))return O(yo);var e=t.indexOf("-"),n=t.substring(0,e),r=t.substring(e+1);return{prefix:parseInt(n,10),id:r}}function Dt(t,e){for(var n=t.start-t.ids.length+1,r=t.ids,o=[r[0],e,[]],i=1,s=r.length;i<s;i++)o=[r[i],{status:"missing"},[o]];return[{pos:n,ids:o}]}function qt(t,e){var n,r,o,i={status:"available"};if(t._deleted&&(i.deleted=!0),e)if(t._id||(t._id=z()),r=z(32,16).toLowerCase(),t._rev){if(o=Rt(t._rev),o.error)return o;t._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[r,i,[]]]]}],n=o.prefix+1}else t._rev_tree=[{pos:1,ids:[r,i,[]]}],n=1;else if(t._revisions&&(t._rev_tree=Dt(t._revisions,i),n=t._revisions.start,r=t._revisions.ids[0]),!t._rev_tree){if(o=Rt(t._rev),o.error)return o;n=o.prefix,r=o.id,t._rev_tree=[{pos:n,ids:[r,i,[]]}]}B(t._id),t._rev=n+"-"+r;var s={metadata:{},data:{}};for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var c="_"===a[0];if(c&&!So[a]){var u=O(fo,a);throw u.message=fo.message+": "+a,u}c&&!jo[a]?s.metadata[a.slice(1)]=t[a]:s.data[a]=t[a]}return s}function It(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(n){if("TypeError"!==n.name)throw n;for(var r="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,o=new r,i=0;i<t.length;i+=1)o.append(t[i]);return o.getBlob(e.type)}}function Bt(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),o=0;o<e;o++)r[o]=t.charCodeAt(o);return n}function Lt(t,e){return It([Bt(t)],{type:e})}function Pt(t,e){return Lt(To(t),e)}function Nt(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,o=0;o<r;o++)e+=String.fromCharCode(n[o]);return e}function Ut(t,e){if("undefined"==typeof FileReader)return e(Nt((new FileReaderSync).readAsArrayBuffer(t)));var n=new FileReader,r="function"==typeof n.readAsBinaryString;n.onloadend=function(t){var n=t.target.result||"";return r?e(n):void e(Nt(n))},r?n.readAsBinaryString(t):n.readAsArrayBuffer(t)}function Mt(t,e){Ut(t,function(t){e(t)})}function Ft(t,e){Mt(t,function(t){e(Co(t))})}function Ht(t,e){if("undefined"==typeof FileReader)return e((new FileReaderSync).readAsArrayBuffer(t));var n=new FileReader;n.onloadend=function(t){var n=t.target.result||new ArrayBuffer(0);e(n)},n.readAsArrayBuffer(t)}function zt(t){return Co(t)}function Jt(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.slice(e,n)}function Yt(t,e,n,r,o){(n>0||r<e.size)&&(e=Jt(e,n,r)),Ht(e,function(e){t.append(e),o()})}function Xt(t,e,n,r,o){(n>0||r<e.length)&&(e=e.substring(n,r)),t.appendBinary(e),o()}function Vt(t,e){function n(){Oo(o)}function r(){var t=f.end(!0),n=zt(t);e(n),f.destroy()}function o(){var e=u*a,o=e+a;u++,u<c?l(f,t,e,o,n):l(f,t,e,o,r)}var i="string"==typeof t,s=i?t.length:t.size,a=Math.min(Ro,s),c=Math.ceil(s/a),u=0,f=i?new Jr:new Jr.ArrayBuffer,l=i?Xt:Yt;o()}function Kt(t){return Jr.hash(t)}function Wt(t){try{return To(t)}catch(e){var n=O(co,"Attachment is not a valid base64 string");return{error:n}}}function $t(t,e,n){var r=Wt(t.data);return r.error?n(r.error):(t.length=r.length,"blob"===e?t.data=Lt(r,t.content_type):"base64"===e?t.data=Co(r):t.data=r,void Vt(r,function(e){t.digest="md5-"+e,n()}))}function Gt(t,e,n){Vt(t.data,function(r){t.digest="md5-"+r,t.length=t.data.size||t.data.length||0,"binary"===e?Mt(t.data,function(e){t.data=e,n()}):"base64"===e?Ft(t.data,function(e){t.data=e,n()}):n()})}function Qt(t,e,n){return t.stub?n():void("string"==typeof t.data?$t(t,e,n):Gt(t,e,n))}function Zt(t,e,n){function r(){i++,t.length===i&&(o?n(o):n())}if(!t.length)return n();var o,i=0;t.forEach(function(t){function n(t){o=t,s++,s===i.length&&r()}var i=t.data&&t.data._attachments?Object.keys(t.data._attachments):[],s=0;if(!i.length)return r();for(var a in t.data._attachments)t.data._attachments.hasOwnProperty(a)&&Qt(t.data._attachments[a],e,n)})}function te(t,e,n,r,o,i,s,a){
if(st(e.rev_tree,n.metadata.rev))return r[o]=n,i();var c=e.winningRev||J(e),u="deleted"in e?e.deleted:ct(e,c),f="deleted"in n.metadata?n.metadata.deleted:ct(n.metadata),l=/^1-/.test(n.metadata.rev);if(u&&!f&&a&&l){var h=n.data;h._rev=c,h._id=n.metadata.id,n=qt(h,a)}var d=it(e.rev_tree,n.metadata.rev_tree[0],t),p=a&&(u&&f||!u&&"new_leaf"!==d.conflicts||u&&!f&&"new_branch"===d.conflicts);if(p){var v=O(no);return r[o]=v,i()}var y=n.metadata.rev;n.metadata.rev_tree=d.tree,n.stemmedRevs=d.stemmedRevs||[],e.rev_map&&(n.metadata.rev_map=e.rev_map);var g,m=J(n.metadata),_=ct(n.metadata,m),b=u===_?0:u<_?-1:1;g=y===m?_:ct(n.metadata,y),s(n,m,_,g,!0,b,o,i)}function ee(t){return"missing"===t.metadata.rev_tree[0].ids[1].status}function ne(t,e,n,r,o,i,s,c,u){function f(t,e,n){var r=J(t.metadata),o=ct(t.metadata,r);if("was_delete"in c&&o)return i[e]=O(eo,"deleted"),n();var a=h&&ee(t);if(a){var u=O(no);return i[e]=u,n()}var f=o?0:1;s(t,r,o,o,!1,f,e,n)}function l(){++p===v&&u&&u()}t=t||1e3;var h=c.new_edits,d=new a,p=0,v=e.length;e.forEach(function(t,e){if(t._id&&ut(t._id)){var r=t._deleted?"_removeLocal":"_putLocal";return void n[r](t,{ctx:o},function(t,n){i[e]=t||n,l()})}var s=t.metadata.id;d.has(s)?(v--,d.get(s).push([t,e])):d.set(s,[[t,e]])}),d.forEach(function(e,n){function o(){++c<e.length?a():l()}function a(){var a=e[c],u=a[0],l=a[1];if(r.has(n))te(t,r.get(n),u,i,l,o,s,h);else{var d=it([],u.metadata.rev_tree[0],t);u.metadata.rev_tree=d.tree,u.stemmedRevs=d.stemmedRevs||[],f(u,l,o)}}var c=0;a()})}function re(t){try{return JSON.parse(t)}catch(e){return Yr.parse(t)}}function oe(t){return t.length<5e4?JSON.parse(t):re(t)}function ie(t){try{return JSON.stringify(t)}catch(e){return Yr.stringify(t)}}function se(t,e,n,r){try{t.apply(e,n)}catch(o){r.emit("error",o)}}function ae(t){if(!Mo.running&&Mo.queue.length){Mo.running=!0;var n=Mo.queue.shift();n.action(function(r,o){se(n.callback,this,[r,o],t),Mo.running=!1,e.nextTick(function(){ae(t)})})}}function ce(t){return function(e){var n="unknown_error";e.target&&e.target.error&&(n=e.target.error.name||e.target.error.message),t(O(po,n,e.type))}}function ue(t,e,n){return{data:ie(t),winningRev:e,deletedOrLocal:n?"1":"0",seq:t.seq,id:t.id}}function fe(t){if(!t)return null;var e=oe(t.data);return e.winningRev=t.winningRev,e.deleted="1"===t.deletedOrLocal,e.seq=t.seq,e}function le(t){if(!t)return t;var e=t._doc_id_rev.lastIndexOf(":");return t._id=t._doc_id_rev.substring(0,e-1),t._rev=t._doc_id_rev.substring(e+1),delete t._doc_id_rev,t}function he(t,e,n,r){n?r(t?"string"!=typeof t?t:Pt(t,e):It([""],{type:e})):t?"string"!=typeof t?Ut(t,function(t){r(Co(t))}):r(t):r("")}function de(t,e,n,r){function o(){++a===s.length&&r&&r()}function i(t,e){var r=t._attachments[e],i=r.digest,s=n.objectStore(Bo).get(i);s.onsuccess=function(t){r.body=t.target.result.body,o()}}var s=Object.keys(t._attachments||{});if(!s.length)return r&&r();var a=0;s.forEach(function(n){e.attachments&&e.include_docs?i(t,n):(t._attachments[n].stub=!0,o())})}function pe(t,e){return Vr.all(t.map(function(t){if(t.doc&&t.doc._attachments){var n=Object.keys(t.doc._attachments);return Vr.all(n.map(function(n){var r=t.doc._attachments[n];if("body"in r){var o=r.body,i=r.content_type;return new Vr(function(s){he(o,i,e,function(e){t.doc._attachments[n]=Pr.extend(g(r,["digest","content_type"]),{data:e}),s()})})}}))}}))}function ve(t,e,n){function r(){u--,u||o()}function o(){i.length&&i.forEach(function(t){var e=c.index("digestSeq").count(IDBKeyRange.bound(t+"::",t+"::￿",!1,!1));e.onsuccess=function(e){var n=e.target.result;n||a["delete"](t)}})}var i=[],s=n.objectStore(Io),a=n.objectStore(Bo),c=n.objectStore(Lo),u=t.length;t.forEach(function(t){var n=s.index("_doc_id_rev"),o=e+"::"+t;n.getKey(o).onsuccess=function(t){var e=t.target.result;if("number"!=typeof e)return r();s["delete"](e);var n=c.index("seq").openCursor(IDBKeyRange.only(e));n.onsuccess=function(t){var e=t.target.result;if(e){var n=e.value.digestSeq.split("::")[0];i.push(n),c["delete"](e.primaryKey),e["continue"]()}else r()}}})}function ye(t,e,n){try{return{txn:t.transaction(e,n)}}catch(r){return{error:r}}}function ge(t,e,n,r,o,i,s){function c(){var t=[qo,Io,Bo,No,Lo],e=ye(o,t,"readwrite");return e.error?s(e.error):(_=e.txn,_.onabort=ce(s),_.ontimeout=ce(s),_.oncomplete=l,b=_.objectStore(qo),w=_.objectStore(Io),k=_.objectStore(Bo),E=_.objectStore(Lo),void d(function(t){return t?(q=!0,s(t)):void f()}))}function u(){ne(t.revs_limit,A,r,D,_,R,p,n)}function f(){function t(){++n===A.length&&u()}function e(e){var n=fe(e.target.result);n&&D.set(n.id,n),t()}if(A.length)for(var n=0,r=0,o=A.length;r<o;r++){var i=A[r];if(i._id&&ut(i._id))t();else{var s=b.get(i.metadata.id);s.onsuccess=e}}}function l(){q||(i.notify(r._meta.name),r._meta.docCount+=S,s(null,R))}function h(t,e){var n=k.get(t);n.onsuccess=function(n){if(n.target.result)e();else{var r=O(go,"unknown stub attachment with digest "+t);r.status=412,e(r)}}}function d(t){function e(){++o===n.length&&t(r)}var n=[];if(A.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(e){var r=t.data._attachments[e];r.stub&&n.push(r.digest)})}),!n.length)return t();var r,o=0;n.forEach(function(t){h(t,function(t){t&&!r&&(r=t),e()})})}function p(t,e,n,r,o,i,s,a){S+=i,t.metadata.winningRev=e,t.metadata.deleted=n;var c=t.data;c._id=t.metadata.id,c._rev=t.metadata.rev,r&&(c._deleted=!0);var u=c._attachments&&Object.keys(c._attachments).length;return u?y(t,e,n,o,s,a):void v(t,e,n,o,s,a)}function v(t,e,n,o,i,s){function a(i){var s=t.stemmedRevs||[];o&&r.auto_compaction&&(s=s.concat(W(t.metadata))),s&&s.length&&ve(s,t.metadata.id,_),l.seq=i.target.result,delete l.rev;var a=ue(l,e,n),c=b.put(a);c.onsuccess=u}function c(t){t.preventDefault(),t.stopPropagation();var e=w.index("_doc_id_rev"),n=e.getKey(f._doc_id_rev);n.onsuccess=function(t){var e=w.put(f,t.target.result);e.onsuccess=a}}function u(){R[i]={ok:!0,id:l.id,rev:e},D.set(t.metadata.id,t.metadata),g(t,l.seq,s)}var f=t.data,l=t.metadata;f._doc_id_rev=l.id+"::"+l.rev,delete f._id,delete f._rev;var h=w.put(f);h.onsuccess=a,h.onerror=c}function y(t,e,n,r,o,i){function s(){u===f.length&&v(t,e,n,r,o,i)}function a(){u++,s()}var c=t.data,u=0,f=Object.keys(c._attachments);f.forEach(function(n){var r=t.data._attachments[n];if(r.stub)u++,s();else{var o=r.data;delete r.data,r.revpos=parseInt(e,10);var i=r.digest;m(i,o,a)}})}function g(t,e,n){function r(){++i===s.length&&n()}function o(n){var o=t.data._attachments[n].digest,i=E.put({seq:e,digestSeq:o+"::"+e});i.onsuccess=r,i.onerror=function(t){t.preventDefault(),t.stopPropagation(),r()}}var i=0,s=Object.keys(t.data._attachments||{});if(!s.length)return n();for(var a=0;a<s.length;a++)o(s[a])}function m(t,e,n){var r=k.count(t);r.onsuccess=function(r){var o=r.target.result;if(o)return n();var i={digest:t,body:e},s=k.put(i);s.onsuccess=n}}for(var _,b,w,k,E,x,A=e.docs,S=0,j=0,T=A.length;j<T;j++){var C=A[j];C._id&&ut(C._id)||(C=A[j]=qt(C,n.new_edits),C.error&&!x&&(x=C))}if(x)return s(x);var R=new Array(A.length),D=new a,q=!1,I=r._meta.blobSupport?"blob":"base64";Zt(A,I,function(t){return t?s(t):void c()})}function me(t,e,n,r,o){try{if(t&&e)return o?IDBKeyRange.bound(e,t,!n,!1):IDBKeyRange.bound(t,e,!1,!n);if(t)return o?IDBKeyRange.upperBound(t):IDBKeyRange.lowerBound(t);if(e)return o?IDBKeyRange.lowerBound(e,!n):IDBKeyRange.upperBound(e,!n);if(r)return IDBKeyRange.only(r)}catch(i){return{error:i}}return null}function _e(t,e,n,r){return"DataError"===n.name&&0===n.code?r(null,{total_rows:t._meta.docCount,offset:e.skip,rows:[]}):void r(O(po,n.name,n.message))}function be(t,e,n,r){function o(t,r){function o(e,n,r){var o=e.id+"::"+r;E.get(o).onsuccess=function(r){n.doc=le(r.target.result),t.conflicts&&(n.doc._conflicts=K(e)),de(n.doc,t,_)}}function i(e,n,r){var i={id:r.id,key:r.id,value:{rev:n}},s=r.deleted;if("ok"===t.deleted)x.push(i),s?(i.value.deleted=!0,i.doc=null):t.include_docs&&o(r,i,n);else if(!s&&h--<=0&&(x.push(i),t.include_docs&&o(r,i,n),0===--d))return;e["continue"]()}function s(t){A=e._meta.docCount;var n=t.target.result;if(n){var r=fe(n.value),o=r.winningRev;i(n,o,r)}}function a(){r(null,{total_rows:A,offset:t.skip,rows:x})}function c(){t.attachments?pe(x,t.binary).then(a):a()}var u="startkey"in t&&t.startkey,f="endkey"in t&&t.endkey,l="key"in t&&t.key,h=t.skip||0,d="number"==typeof t.limit?t.limit:-1,p=t.inclusive_end!==!1,v="descending"in t&&t.descending?"prev":null,y=me(u,f,p,l,v);if(y&&y.error)return _e(e,t,y.error,r);var g=[qo,Io];t.attachments&&g.push(Bo);var m=ye(n,g,"readonly");if(m.error)return r(m.error);var _=m.txn,b=_.objectStore(qo),w=_.objectStore(Io),k=v?b.openCursor(y,v):b.openCursor(y),E=w.index("_doc_id_rev"),x=[],A=0;_.oncomplete=c,k.onsuccess=s}function i(t,n){return 0===t.limit?n(null,{total_rows:e._meta.docCount,offset:t.skip,rows:[]}):void o(t,n)}i(t,r)}function we(t){return new Vr(function(e){var n=It([""]);t.objectStore(Uo).put(n,"key"),t.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},t.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);e(n||!t||parseInt(t[1],10)>=43)}})["catch"](function(){return!1})}function ke(t,e){var n=this;Mo.queue.push({action:function(e){Ee(n,t,e)},callback:e}),ae(n.constructor)}function Ee(t,n,r){function o(t){var e=t.createObjectStore(qo,{keyPath:"id"});t.createObjectStore(Io,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),t.createObjectStore(Bo,{keyPath:"digest"}),t.createObjectStore(Po,{keyPath:"id",autoIncrement:!1}),t.createObjectStore(Uo),e.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),t.createObjectStore(No,{keyPath:"_id"});var n=t.createObjectStore(Lo,{autoIncrement:!0});n.createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0})}function i(t,e){var n=t.objectStore(qo);n.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),n.openCursor().onsuccess=function(t){var r=t.target.result;if(r){var o=r.value,i=ct(o);o.deletedOrLocal=i?"1":"0",n.put(o),r["continue"]()}else e()}}function s(t){t.createObjectStore(No,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function u(t,e){var n=t.objectStore(No),r=t.objectStore(qo),o=t.objectStore(Io),i=r.openCursor();i.onsuccess=function(t){var i=t.target.result;if(i){var s=i.value,a=s.id,c=ut(a),u=J(s);if(c){var f=a+"::"+u,l=a+"::",h=a+"::~",d=o.index("_doc_id_rev"),p=IDBKeyRange.bound(l,h,!1,!1),v=d.openCursor(p);v.onsuccess=function(t){if(v=t.target.result){var e=v.value;e._doc_id_rev===f&&n.put(e),o["delete"](v.primaryKey),v["continue"]()}else r["delete"](i.primaryKey),i["continue"]()}}else i["continue"]()}else e&&e()}}function f(t){var e=t.createObjectStore(Lo,{autoIncrement:!0});e.createIndex("seq","seq"),e.createIndex("digestSeq","digestSeq",{unique:!0})}function l(t,e){var n=t.objectStore(Io),r=t.objectStore(Bo),o=t.objectStore(Lo),i=r.count();i.onsuccess=function(t){var r=t.target.result;return r?void(n.openCursor().onsuccess=function(t){var n=t.target.result;if(!n)return e();for(var r=n.value,i=n.primaryKey,s=Object.keys(r._attachments||{}),a={},c=0;c<s.length;c++){var u=r._attachments[s[c]];a[u.digest]=!0}var f=Object.keys(a);for(c=0;c<f.length;c++){var l=f[c];o.put({seq:i,digestSeq:l+"::"+i})}n["continue"]()}):e()}}function h(t){function e(t){return t.data?fe(t):(t.deleted="1"===t.deletedOrLocal,t)}var n=t.objectStore(Io),r=t.objectStore(qo),o=r.openCursor();o.onsuccess=function(t){function o(){var t=a.id+"::",e=a.id+"::￿",r=n.index("_doc_id_rev").openCursor(IDBKeyRange.bound(t,e)),o=0;r.onsuccess=function(t){var e=t.target.result;if(!e)return a.seq=o,i();var n=e.primaryKey;n>o&&(o=n),e["continue"]()}}function i(){var t=ue(a,a.winningRev,a.deleted),e=r.put(t);e.onsuccess=function(){s["continue"]()}}var s=t.target.result;if(s){var a=e(s.value);return a.winningRev=a.winningRev||J(a),a.seq?i():void o()}}}var p=n.name,y=null;t._meta=null,t.type=function(){return"idb"},t._id=v(function(e){e(null,t._meta.instanceId)}),t._bulkDocs=function(e,r,o){ge(n,e,r,t,y,Ho,o)},t._get=function(t,e,n){function r(){n(s,{doc:o,metadata:i,ctx:a})}var o,i,s,a=e.ctx;if(!a){var c=ye(y,[qo,Io,Bo],"readonly");if(c.error)return n(c.error);a=c.txn}a.objectStore(qo).get(t).onsuccess=function(t){if(i=fe(t.target.result),!i)return s=O(eo,"missing"),r();if(ct(i)&&!e.rev)return s=O(eo,"deleted"),r();var n=a.objectStore(Io),c=e.rev||i.winningRev,u=i.id+"::"+c;n.index("_doc_id_rev").get(u).onsuccess=function(t){return o=t.target.result,o&&(o=le(o)),o?void r():(s=O(eo,"missing"),r())}}},t._getAttachment=function(t,e,n,r,o){var i;if(r.ctx)i=r.ctx;else{var s=ye(y,[qo,Io,Bo],"readonly");if(s.error)return o(s.error);i=s.txn}var a=n.digest,c=n.content_type;i.objectStore(Bo).get(a).onsuccess=function(t){var e=t.target.result.body;he(e,c,r.binary,function(t){o(null,t)})}},t._info=function(e){if(null===y||!Fo.has(p)){var n=new Error("db isn't open");return n.id="idbNull",e(n)}var r,o,i=ye(y,[Io],"readonly");if(i.error)return e(i.error);var s=i.txn,a=s.objectStore(Io).openCursor(null,"prev");a.onsuccess=function(e){var n=e.target.result;r=n?n.key:0,o=t._meta.docCount},s.oncomplete=function(){e(null,{doc_count:o,update_seq:r,idb_attachment_format:t._meta.blobSupport?"binary":"base64"})}},t._allDocs=function(e,n){be(e,t,y,n)},t._changes=function(e){function n(t){function n(){return a.seq!==s?t["continue"]():(f=s,a.winningRev===i._rev?o(i):void r())}function r(){var t=i._id+"::"+a.winningRev,e=_.get(t);e.onsuccess=function(t){o(le(t.target.result))}}function o(n){var r=e.processChange(n,a,e);r.seq=a.seq;var o=k(r);return"object"==typeof o?e.complete(o):(o&&(w++,h&&b.push(r),e.attachments&&e.include_docs?de(n,e,v,function(){pe([r],e.binary).then(function(){e.onChange(r)})}):e.onChange(r)),void(w!==l&&t["continue"]()))}var i=le(t.value),s=t.key;if(u&&!u.has(i._id))return t["continue"]();var a;return(a=E.get(i._id))?n():void(m.get(i._id).onsuccess=function(t){a=fe(t.target.result),E.set(i._id,a),n()})}function r(t){var e=t.target.result;e&&n(e)}function o(){var t=[qo,Io];e.attachments&&t.push(Bo);var n=ye(y,t,"readonly");if(n.error)return e.complete(n.error);v=n.txn,v.onabort=ce(e.complete),v.oncomplete=i,g=v.objectStore(Io),m=v.objectStore(qo),_=g.index("_doc_id_rev");var o;o=e.descending?g.openCursor(null,"prev"):g.openCursor(IDBKeyRange.lowerBound(e.since,!0)),o.onsuccess=r}function i(){function t(){e.complete(null,{results:b,last_seq:f})}!e.continuous&&e.attachments?pe(b).then(t):t()}if(e=d(e),e.continuous){var s=p+":"+z();return Ho.addListener(p,s,t,e),Ho.notify(p),{cancel:function(){Ho.removeListener(p,s)}}}var u=e.doc_ids&&new c(e.doc_ids);e.since=e.since||0;var f=e.since,l="limit"in e?e.limit:-1;0===l&&(l=1);var h;h="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var v,g,m,_,b=[],w=0,k=q(e),E=new a;o()},t._close=function(t){return null===y?t(O(so)):(y.close(),Fo["delete"](p),y=null,void t())},t._getRevisionTree=function(t,e){var n=ye(y,[qo],"readonly");if(n.error)return e(n.error);var r=n.txn,o=r.objectStore(qo).get(t);o.onsuccess=function(t){var n=fe(t.target.result);n?e(null,n.rev_tree):e(O(eo))}},t._doCompaction=function(t,e,n){var r=[qo,Io,Bo,Lo],o=ye(y,r,"readwrite");if(o.error)return n(o.error);var i=o.txn,s=i.objectStore(qo);s.get(t).onsuccess=function(n){var r=fe(n.target.result);Y(r.rev_tree,function(t,n,r,o,i){var s=n+"-"+r;e.indexOf(s)!==-1&&(i.status="missing")}),ve(e,t,i);var o=r.winningRev,s=r.deleted;i.objectStore(qo).put(ue(r,o,s))},i.onabort=ce(n),i.oncomplete=function(){n()}},t._getLocal=function(t,e){var n=ye(y,[No],"readonly");if(n.error)return e(n.error);var r=n.txn,o=r.objectStore(No).get(t);o.onerror=ce(e),o.onsuccess=function(t){var n=t.target.result;n?(delete n._doc_id_rev,e(null,n)):e(O(eo))}},t._putLocal=function(t,e,n){"function"==typeof e&&(n=e,e={}),delete t._revisions;var r=t._rev,o=t._id;r?t._rev="0-"+(parseInt(r.split("-")[1],10)+1):t._rev="0-1";var i,s=e.ctx;if(!s){var a=ye(y,[No],"readwrite");if(a.error)return n(a.error);s=a.txn,s.onerror=ce(n),s.oncomplete=function(){i&&n(null,i)}}var c,u=s.objectStore(No);r?(c=u.get(o),c.onsuccess=function(o){var s=o.target.result;if(s&&s._rev===r){var a=u.put(t);a.onsuccess=function(){i={ok:!0,id:t._id,rev:t._rev},e.ctx&&n(null,i)}}else n(O(no))}):(c=u.add(t),c.onerror=function(t){n(O(no)),t.preventDefault(),t.stopPropagation()},c.onsuccess=function(){i={ok:!0,id:t._id,rev:t._rev},e.ctx&&n(null,i)})},t._removeLocal=function(t,e,n){"function"==typeof e&&(n=e,e={});var r=e.ctx;if(!r){var o=ye(y,[No],"readwrite");if(o.error)return n(o.error);r=o.txn,r.oncomplete=function(){i&&n(null,i)}}var i,s=t._id,a=r.objectStore(No),c=a.get(s);c.onerror=ce(n),c.onsuccess=function(r){var o=r.target.result;o&&o._rev===t._rev?(a["delete"](s),i={ok:!0,id:s,rev:"0-0"},e.ctx&&n(null,i)):n(O(eo))}},t._destroy=function(t,e){Ho.removeAllListeners(p);var n=zo.get(p);n&&n.result&&(n.result.close(),Fo["delete"](p));var r=indexedDB.deleteDatabase(p);r.onsuccess=function(){zo["delete"](p),k()&&p in localStorage&&delete localStorage[p],e(null,{ok:!0})},r.onerror=ce(e)};var g=Fo.get(p);if(g)return y=g.idb,t._meta=g.global,void e.nextTick(function(){r(null,t)});var m;m=n.storage?xe(p,n.storage):indexedDB.open(p,Do),zo.set(p,m),m.onupgradeneeded=function(t){function e(){var t=a[c-1];c++,t&&t(r,e)}var n=t.target.result;if(t.oldVersion<1)return o(n);var r=t.currentTarget.transaction;t.oldVersion<3&&s(n),t.oldVersion<4&&f(n);var a=[i,u,l,h],c=t.oldVersion;e()},m.onsuccess=function(e){y=e.target.result,y.onversionchange=function(){y.close(),Fo["delete"](p)},y.onabort=function(t){A("error","Database has a global failure",t.target.error),y.close(),Fo["delete"](p)};var n=y.transaction([Po,Uo,qo],"readwrite"),o=n.objectStore(Po).get(Po),i=null,s=null,a=null;o.onsuccess=function(e){var o=function(){null!==i&&null!==s&&null!==a&&(t._meta={name:p,instanceId:a,blobSupport:i,docCount:s},Fo.set(p,{idb:y,global:t._meta}),r(null,t))},c=e.target.result||{id:Po};p+"_id"in c?(a=c[p+"_id"],o()):(a=z(),c[p+"_id"]=a,n.objectStore(Po).put(c).onsuccess=function(){o()}),Ao||(Ao=we(n)),Ao.then(function(t){i=t,o()});var u=n.objectStore(qo).index("deletedOrLocal");u.count(IDBKeyRange.only("0")).onsuccess=function(t){s=t.target.result,o()}}},m.onerror=function(){var t="Failed to open indexedDB, are you in private browsing mode?";A("error",t),r(O(po,t))}}function xe(t,e){try{return indexedDB.open(t,{version:Do,storage:e})}catch(n){return indexedDB.open(t,Do)}}function Ae(t){t.adapter("idb",ke,!0)}function Se(t){return decodeURIComponent(escape(t))}function je(t){return t<65?t-48:t-55}function Te(t,e,n){for(var r="";e<n;)r+=String.fromCharCode(je(t.charCodeAt(e++))<<4|je(t.charCodeAt(e++)));return r}function Ce(t,e,n){for(var r="";e<n;)r+=String.fromCharCode(je(t.charCodeAt(e+2))<<12|je(t.charCodeAt(e+3))<<8|je(t.charCodeAt(e))<<4|je(t.charCodeAt(e+1))),e+=4;return r}function Oe(t,e){return"UTF-8"===e?Se(Te(t,0,t.length)):Ce(t,0,t.length)}function Re(t){return"'"+t+"'"}function De(t){return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function qe(t){return t.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function Ie(t){return delete t._id,delete t._rev,JSON.stringify(t)}function Be(t,e,n){return t=JSON.parse(t),t._id=e,t._rev=n,t}function Le(t){for(var e="(";t--;)e+="?",t&&(e+=",");return e+")"}function Pe(t,e,n,r,o){return"SELECT "+t+" FROM "+("string"==typeof e?e:e.join(" JOIN "))+(n?" ON "+n:"")+(r?" WHERE "+("string"==typeof r?r:r.join(" AND ")):"")+(o?" ORDER BY "+o:"")}function Ne(t,e,n){function r(){++i===t.length&&o()}function o(){if(s.length){var t="SELECT DISTINCT digest AS digest FROM "+$o+" WHERE seq IN "+Le(s.length);n.executeSql(t,s,function(t,e){for(var n=[],r=0;r<e.rows.length;r++)n.push(e.rows.item(r).digest);if(n.length){var o="DELETE FROM "+$o+" WHERE seq IN ("+s.map(function(){return"?"}).join(",")+")";t.executeSql(o,s,function(t){var e="SELECT digest FROM "+$o+" WHERE digest IN ("+n.map(function(){return"?"}).join(",")+")";t.executeSql(e,n,function(t,e){for(var r=new c,o=0;o<e.rows.length;o++)r.add(e.rows.item(o).digest);n.forEach(function(e){r.has(e)||(t.executeSql("DELETE FROM "+$o+" WHERE digest=?",[e]),t.executeSql("DELETE FROM "+Vo+" WHERE digest=?",[e]))})})})}})}}if(t.length){var i=0,s=[];t.forEach(function(t){var o="SELECT seq FROM "+Xo+" WHERE doc_id=? AND rev=?";n.executeSql(o,[e,t],function(t,e){if(!e.rows.length)return r();var n=e.rows.item(0).seq;s.push(n),t.executeSql("DELETE FROM "+Xo+" WHERE seq=?",[n],r)})})}}function Ue(t){return function(e){A("error","WebSQL threw an error",e);var n=e&&e.constructor.toString().match(/function ([^\(]+)/),r=n&&n[1]||e.type,o=e.target||e.message;t(O(vo,o,r))}}function Me(t){if("size"in t)return 1e6*t.size;var e="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return e?5e6:1}function Fe(t,e,n,r,o,i,s){function c(){return b?s(b):(i.notify(r._name),r._docCount=-1,void s(null,w))}function u(t,e){var n="SELECT count(*) as cnt FROM "+Vo+" WHERE digest=?";_.executeSql(n,[t],function(n,r){if(0===r.rows.item(0).cnt){var o=O(go,"unknown stub attachment with digest "+t);e(o)}else e()})}function f(t){function e(){++o===n.length&&t(r)}var n=[];if(g.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(e){var r=t.data._attachments[e];r.stub&&n.push(r.digest)})}),!n.length)return t();var r,o=0;n.forEach(function(t){u(t,function(t){t&&!r&&(r=t),e()})})}function l(t,e,n,o,i,s,a,c){function u(){function e(t,e){function r(){return++i===s.length&&e(),!1}function o(e){var o="INSERT INTO "+$o+" (digest, seq) VALUES (?,?)",i=[n._attachments[e].digest,t];_.executeSql(o,i,r,r)}var i=0,s=Object.keys(n._attachments||{});if(!s.length)return e();for(var a=0;a<s.length;a++)o(s[a])}var n=t.data,r=o?1:0,i=n._id,s=n._rev,a=Ie(n),c="INSERT INTO "+Xo+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",u=[i,s,a,r];_.executeSql(c,u,function(t,n){var r=n.insertId;e(r,function(){h(t,r)})},function(){var t=Pe("seq",Xo,null,"doc_id=? AND rev=?");return _.executeSql(t,[i,s],function(t,n){var o=n.rows.item(0).seq,c="UPDATE "+Xo+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",u=[a,r,i,s];t.executeSql(c,u,function(t){e(o,function(){h(t,o)})})}),!1})}function f(t){d||(t?(d=t,c(d)):v===y.length&&u())}function l(t){v++,f(t)}function h(n,o){var s=t.metadata.id,u=t.stemmedRevs||[];i&&r.auto_compaction&&(u=W(t.metadata).concat(u)),u.length&&Ne(u,s,n),t.metadata.seq=o,delete t.metadata.rev;var f=i?"UPDATE "+Yo+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+Xo+" WHERE doc_id="+Yo+".id AND rev=?) WHERE id=?":"INSERT INTO "+Yo+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",l=ie(t.metadata),h=i?[l,o,e,s]:[s,o,o,l];n.executeSql(f,h,function(){w[a]={ok:!0,id:t.metadata.id,rev:e},k.set(s,t.metadata),c()})}var d=null,v=0;t.data._id=t.metadata.id,t.data._rev=t.metadata.rev;var y=Object.keys(t.data._attachments||{});o&&(t.data._deleted=!0),y.forEach(function(n){var r=t.data._attachments[n];if(r.stub)v++,f();else{var o=r.data;delete r.data,r.revpos=parseInt(e,10);var i=r.digest;p(i,o,l)}}),y.length||u()}function h(){ne(t.revs_limit,g,r,k,_,w,l,n)}function d(t){function e(){++n===g.length&&t()}if(!g.length)return t();var n=0;g.forEach(function(t){if(t._id&&ut(t._id))return e();var n=t.metadata.id;_.executeSql("SELECT json FROM "+Yo+" WHERE id = ?",[n],function(t,r){if(r.rows.length){var o=oe(r.rows.item(0).json);k.set(n,o)}e()})})}function p(t,e,n){var r="SELECT digest FROM "+Vo+" WHERE digest=?";_.executeSql(r,[t],function(o,i){return i.rows.length?n():(r="INSERT INTO "+Vo+" (digest, body, escaped) VALUES (?,?,1)",void o.executeSql(r,[t,De(e)],function(){n()},function(){return n(),!1}))})}var v=n.new_edits,y=e.docs,g=y.map(function(t){if(t._id&&ut(t._id))return t;var e=qt(t,v);return e}),m=g.filter(function(t){return t.error});if(m.length)return s(m[0]);var _,b,w=new Array(g.length),k=new a;Zt(g,"binary",function(t){return t?s(t):void o.transaction(function(t){_=t,f(function(t){t?b=t:d(h)})},Ue(s),c)})}function He(t){return t.websql(t.name,t.version,t.description,t.size)}function ze(t){try{return{db:He(t)}}catch(e){return{error:e}}}function Je(t){var e=Go.get(t.name);return e||(e=ze(t),Go.set(t.name,e)),e}function Ye(t,e,n,r,o){function i(){++c===a.length&&o&&o()}function s(t,o){var s=t._attachments[o],a={binary:e.binary,ctx:r};n._getAttachment(t._id,o,s,a,function(e,n){t._attachments[o]=Pr.extend(g(s,["digest","content_type"]),{data:n}),i()})}var a=Object.keys(t._attachments||{});if(!a.length)return o&&o();var c=0;a.forEach(function(n){e.attachments&&e.include_docs?s(t,n):(t._attachments[n].stub=!0,i())})}function Xe(t,e){function n(){k()&&(window.localStorage["_pouch__websqldb_"+m._name]=!0),e(null,m)}function r(t,e){t.executeSql(ni),t.executeSql("ALTER TABLE "+Xo+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){t.executeSql(ti),t.executeSql("ALTER TABLE "+Yo+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){t.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+Yo+" (local, id)");var n="SELECT "+Yo+".winningseq AS seq, "+Yo+".json AS metadata FROM "+Xo+" JOIN "+Yo+" ON "+Xo+".seq = "+Yo+".winningseq";t.executeSql(n,[],function(t,n){for(var r=[],o=[],i=0;i<n.rows.length;i++){var s=n.rows.item(i),a=s.seq,c=JSON.parse(s.metadata);ct(c)&&r.push(a),ut(c.id)&&o.push(c.id)}t.executeSql("UPDATE "+Yo+"SET local = 1 WHERE id IN "+Le(o.length),o,function(){t.executeSql("UPDATE "+Xo+" SET deleted = 1 WHERE seq IN "+Le(r.length),r,e)})})})})}function o(t,e){var n="CREATE TABLE IF NOT EXISTS "+Ko+" (id UNIQUE, rev, json)";t.executeSql(n,[],function(){var n="SELECT "+Yo+".id AS id, "+Xo+".json AS data FROM "+Xo+" JOIN "+Yo+" ON "+Xo+".seq = "+Yo+".winningseq WHERE local = 1";t.executeSql(n,[],function(t,n){function r(){if(!o.length)return e(t);var n=o.shift(),i=JSON.parse(n.data)._rev;t.executeSql("INSERT INTO "+Ko+" (id, rev, json) VALUES (?,?,?)",[n.id,i,n.data],function(t){t.executeSql("DELETE FROM "+Yo+" WHERE id=?",[n.id],function(t){t.executeSql("DELETE FROM "+Xo+" WHERE seq=?",[n.seq],function(){r()})})})}for(var o=[],i=0;i<n.rows.length;i++)o.push(n.rows.item(i));r()})})}function i(t,e){function n(n){function r(){if(!n.length)return e(t);var o=n.shift(),i=Oe(o.hex,g),s=i.lastIndexOf("::"),a=i.substring(0,s),c=i.substring(s+2),u="UPDATE "+Xo+" SET doc_id=?, rev=? WHERE doc_id_rev=?";t.executeSql(u,[a,c,i],function(){r()})}r()}var r="ALTER TABLE "+Xo+" ADD COLUMN doc_id";t.executeSql(r,[],function(t){var e="ALTER TABLE "+Xo+" ADD COLUMN rev";t.executeSql(e,[],function(t){t.executeSql(ei,[],function(t){var e="SELECT hex(doc_id_rev) as hex FROM "+Xo;t.executeSql(e,[],function(t,e){for(var r=[],o=0;o<e.rows.length;o++)r.push(e.rows.item(o));n(r)})})})})}function s(t,e){function n(t){var n="SELECT COUNT(*) AS cnt FROM "+Vo;t.executeSql(n,[],function(t,n){function r(){var n=Pe(si+", "+Yo+".id AS id",[Yo,Xo],ii,null,Yo+".id ");n+=" LIMIT "+s+" OFFSET "+i,i+=s,t.executeSql(n,[],function(t,n){function o(t,e){var n=i[t]=i[t]||[];n.indexOf(e)===-1&&n.push(e)}if(!n.rows.length)return e(t);for(var i={},s=0;s<n.rows.length;s++)for(var a=n.rows.item(s),c=Be(a.data,a.id,a.rev),u=Object.keys(c._attachments||{}),f=0;f<u.length;f++){var l=c._attachments[u[f]];o(l.digest,a.seq)}var h=[];if(Object.keys(i).forEach(function(t){var e=i[t];e.forEach(function(e){h.push([t,e])})}),!h.length)return r();var d=0;h.forEach(function(e){var n="INSERT INTO "+$o+" (digest, seq) VALUES (?,?)";t.executeSql(n,e,function(){++d===h.length&&r()})})})}var o=n.rows.item(0).cnt;if(!o)return e(t);var i=0,s=10;r()})}var r="CREATE TABLE IF NOT EXISTS "+$o+" (digest, seq INTEGER)";t.executeSql(r,[],function(t){t.executeSql(oi,[],function(t){t.executeSql(ri,[],n)})})}function a(t,e){var n="ALTER TABLE "+Vo+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";t.executeSql(n,[],e)}function c(t,e){var n="ALTER TABLE "+Yo+" ADD COLUMN max_seq INTEGER";t.executeSql(n,[],function(t){var n="UPDATE "+Yo+" SET max_seq=(SELECT MAX(seq) FROM "+Xo+" WHERE doc_id=id)";t.executeSql(n,[],function(t){var n="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+Yo+" (max_seq)";t.executeSql(n,[],e)})})}function u(t,e){t.executeSql('SELECT HEX("a") AS hex',[],function(t,n){var r=n.rows.item(0).hex;g=2===r.length?"UTF-8":"UTF-16",e()})}function f(){for(;w.length>0;){var t=w.pop();t(null,_)}}function l(t,e){if(0===e){var n="CREATE TABLE IF NOT EXISTS "+Wo+" (dbid, db_version INTEGER)",u="CREATE TABLE IF NOT EXISTS "+Vo+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",l="CREATE TABLE IF NOT EXISTS "+$o+" (digest, seq INTEGER)",h="CREATE TABLE IF NOT EXISTS "+Yo+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",d="CREATE TABLE IF NOT EXISTS "+Xo+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",p="CREATE TABLE IF NOT EXISTS "+Ko+" (id UNIQUE, rev, json)";t.executeSql(u),t.executeSql(p),t.executeSql(l,[],function(){t.executeSql(ri),t.executeSql(oi)}),t.executeSql(h,[],function(){t.executeSql(ni),t.executeSql(d,[],function(){t.executeSql(ti),t.executeSql(ei),t.executeSql(n,[],function(){var e="INSERT INTO "+Wo+" (db_version, dbid) VALUES (?,?)";_=z();var n=[Jo,_];t.executeSql(e,n,function(){f()})})})})}else{var v=function(){var n=e<Jo;n&&t.executeSql("UPDATE "+Wo+" SET db_version = "+Jo);var r="SELECT dbid FROM "+Wo;t.executeSql(r,[],function(t,e){_=e.rows.item(0).dbid,f()})},y=[r,o,i,s,a,c,v],g=e,m=function(t){y[g-1](t,m),g++};m(t)}}function h(){A.transaction(function(t){u(t,function(){p(t)})},Ue(e),n)}function p(t){var e="SELECT sql FROM sqlite_master WHERE tbl_name = "+Wo;t.executeSql(e,[],function(t,e){e.rows.length?/db_version/.test(e.rows.item(0).sql)?t.executeSql("SELECT db_version FROM "+Wo,[],function(t,e){var n=e.rows.item(0).db_version;l(t,n)}):t.executeSql("ALTER TABLE "+Wo+" ADD COLUMN db_version INTEGER",[],function(){l(t,1)}):l(t,0)})}function y(t,e){if(m._docCount!==-1)return e(m._docCount);var n=Pe("COUNT("+Yo+".id) AS 'num'",[Yo,Xo],ii,Xo+".deleted=0");t.executeSql(n,[],function(t,n){m._docCount=n.rows.item(0).num,e(m._docCount)})}var g,m=this,_=null,b=Me(t),w=[];m._docCount=-1,m._name=t.name;var E=Pr.extend({},t,{version:Zo,description:t.name,size:b}),x=Je(E);if(x.error)return Ue(e)(x.error);var A=x.db;"function"!=typeof A.readTransaction&&(A.readTransaction=A.transaction),h(),m.type=function(){return"websql"},m._id=v(function(t){t(null,_)}),m._info=function(t){A.readTransaction(function(e){y(e,function(n){var r="SELECT MAX(seq) AS seq FROM "+Xo;e.executeSql(r,[],function(e,r){var o=r.rows.item(0).seq||0;t(null,{doc_count:n,update_seq:o,websql_encoding:g})})})},Ue(t))},m._bulkDocs=function(e,n,r){Fe(t,e,n,m,A,Qo,r)},m._get=function(t,e,n){function r(){n(s,{doc:o,metadata:i,ctx:a})}var o,i,s,a=e.ctx;if(!a)return A.readTransaction(function(r){m._get(t,Pr.extend({ctx:r},e),n)});var c,u;e.rev?(c=Pe(si,[Yo,Xo],Yo+".id="+Xo+".doc_id",[Xo+".doc_id=?",Xo+".rev=?"]),u=[t,e.rev]):(c=Pe(si,[Yo,Xo],ii,Yo+".id=?"),u=[t]),a.executeSql(c,u,function(t,n){if(!n.rows.length)return s=O(eo,"missing"),r();var a=n.rows.item(0);return i=oe(a.metadata),a.deleted&&!e.rev?(s=O(eo,"deleted"),r()):(o=Be(a.data,i.id,a.rev),void r())})},m._allDocs=function(t,e){var n,r=[],o="startkey"in t&&t.startkey,i="endkey"in t&&t.endkey,s="key"in t&&t.key,a="descending"in t&&t.descending,c="limit"in t?t.limit:-1,u="skip"in t?t.skip:0,f=t.inclusive_end!==!1,l=[],h=[];if(s!==!1)h.push(Yo+".id = ?"),l.push(s);else if(o!==!1||i!==!1){if(o!==!1&&(h.push(Yo+".id "+(a?"<=":">=")+" ?"),l.push(o)),i!==!1){var d=a?">":"<";f&&(d+="="),h.push(Yo+".id "+d+" ?"),l.push(i)}s!==!1&&(h.push(Yo+".id = ?"),l.push(s))}"ok"!==t.deleted&&h.push(Xo+".deleted = 0"),A.readTransaction(function(e){y(e,function(o){if(n=o,0!==c){var i=Pe(si,[Yo,Xo],ii,h,Yo+".id "+(a?"DESC":"ASC"));i+=" LIMIT "+c+" OFFSET "+u,e.executeSql(i,l,function(e,n){for(var o=0,i=n.rows.length;o<i;o++){var s=n.rows.item(o),a=oe(s.metadata),c=a.id,u=Be(s.data,c,s.rev),f=u._rev,l={
id:c,key:c,value:{rev:f}};if(t.include_docs&&(l.doc=u,l.doc._rev=f,t.conflicts&&(l.doc._conflicts=K(a)),Ye(l.doc,t,m,e)),s.deleted){if("ok"!==t.deleted)continue;l.value.deleted=!0,l.doc=null}r.push(l)}})}})},Ue(e),function(){e(null,{total_rows:n,offset:t.skip,rows:r})})},m._changes=function(t){function e(){var e=Yo+".json AS metadata, "+Yo+".max_seq AS maxSeq, "+Xo+".json AS winningDoc, "+Xo+".rev AS winningRev ",n=Yo+" JOIN "+Xo,c=Yo+".id="+Xo+".doc_id AND "+Yo+".winningseq="+Xo+".seq",u=["maxSeq > ?"],f=[t.since];t.doc_ids&&(u.push(Yo+".id IN "+Le(t.doc_ids.length)),f=f.concat(t.doc_ids));var l="maxSeq "+(r?"DESC":"ASC"),h=Pe(e,n,c,u,l),d=q(t);t.view||t.filter||(h+=" LIMIT "+o);var p=t.since||0;A.readTransaction(function(e){e.executeSql(h,f,function(e,n){function r(e){return function(){t.onChange(e)}}for(var c=0,u=n.rows.length;c<u;c++){var f=n.rows.item(c),l=oe(f.metadata);p=f.maxSeq;var h=Be(f.winningDoc,l.id,f.winningRev),v=t.processChange(h,l,t);v.seq=f.maxSeq;var y=d(v);if("object"==typeof y)return t.complete(y);if(y&&(a++,i&&s.push(v),t.attachments&&t.include_docs?Ye(h,t,m,e,r(v)):r(v)()),a===o)break}})},Ue(t.complete),function(){t.continuous||t.complete(null,{results:s,last_seq:p})})}if(t=d(t),t.continuous){var n=m._name+":"+z();return Qo.addListener(m._name,n,m,t),Qo.notify(m._name),{cancel:function(){Qo.removeListener(m._name,n)}}}var r=t.descending;t.since=t.since&&!r?t.since:0;var o="limit"in t?t.limit:-1;0===o&&(o=1);var i;i="return_docs"in t?t.return_docs:!("returnDocs"in t)||t.returnDocs;var s=[],a=0;e()},m._close=function(t){t()},m._getAttachment=function(t,e,n,r,o){var i,s=r.ctx,a=n.digest,c=n.content_type,u="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+Vo+" WHERE digest=?";s.executeSql(u,[a],function(t,e){var n=e.rows.item(0),s=n.escaped?qe(n.body):Oe(n.body,g);i=r.binary?Lt(s,c):Co(s),o(null,i)})},m._getRevisionTree=function(t,e){A.readTransaction(function(n){var r="SELECT json AS metadata FROM "+Yo+" WHERE id = ?";n.executeSql(r,[t],function(t,n){if(n.rows.length){var r=oe(n.rows.item(0).metadata);e(null,r.rev_tree)}else e(O(eo))})})},m._doCompaction=function(t,e,n){return e.length?void A.transaction(function(n){var r="SELECT json AS metadata FROM "+Yo+" WHERE id = ?";n.executeSql(r,[t],function(n,r){var o=oe(r.rows.item(0).metadata);Y(o.rev_tree,function(t,n,r,o,i){var s=n+"-"+r;e.indexOf(s)!==-1&&(i.status="missing")});var i="UPDATE "+Yo+" SET json = ? WHERE id = ?";n.executeSql(i,[ie(o),t])}),Ne(e,t,n)},Ue(n),function(){n()}):n()},m._getLocal=function(t,e){A.readTransaction(function(n){var r="SELECT json, rev FROM "+Ko+" WHERE id=?";n.executeSql(r,[t],function(n,r){if(r.rows.length){var o=r.rows.item(0),i=Be(o.json,t,o.rev);e(null,i)}else e(O(eo))})})},m._putLocal=function(t,e,n){function r(t){var r,u;i?(r="UPDATE "+Ko+" SET rev=?, json=? WHERE id=? AND rev=?",u=[o,c,s,i]):(r="INSERT INTO "+Ko+" (id, rev, json) VALUES (?,?,?)",u=[s,o,c]),t.executeSql(r,u,function(t,r){r.rowsAffected?(a={ok:!0,id:s,rev:o},e.ctx&&n(null,a)):n(O(no))},function(){return n(O(no)),!1})}"function"==typeof e&&(n=e,e={}),delete t._revisions;var o,i=t._rev,s=t._id;o=i?t._rev="0-"+(parseInt(i.split("-")[1],10)+1):t._rev="0-1";var a,c=Ie(t);e.ctx?r(e.ctx):A.transaction(r,Ue(n),function(){a&&n(null,a)})},m._removeLocal=function(t,e,n){function r(r){var i="DELETE FROM "+Ko+" WHERE id=? AND rev=?",s=[t._id,t._rev];r.executeSql(i,s,function(r,i){return i.rowsAffected?(o={ok:!0,id:t._id,rev:"0-0"},void(e.ctx&&n(null,o))):n(O(eo))})}"function"==typeof e&&(n=e,e={});var o;e.ctx?r(e.ctx):A.transaction(r,Ue(n),function(){o&&n(null,o)})},m._destroy=function(t,e){Qo.removeAllListeners(m._name),A.transaction(function(t){var e=[Yo,Xo,Vo,Wo,Ko,$o];e.forEach(function(e){t.executeSql("DROP TABLE IF EXISTS "+e,[])})},Ue(e),function(){k()&&(delete window.localStorage["_pouch__websqldb_"+m._name],delete window.localStorage[m._name]),e(null,{ok:!0})})}}function Ve(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(t){return!1}}function Ke(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var t=k(),e="_pouch__websqldb_valid_"+navigator.userAgent;if(t&&localStorage[e])return"1"===localStorage[e];var n=Ve();return t&&(localStorage[e]=n?"1":"0"),n}function We(){return"function"==typeof openDatabase&&Ke()}function $e(t,e,n,r){return openDatabase(t,e,n,r)}function Ge(t,e){var n=Pr.extend({websql:$e},t);Xe.call(this,n,e)}function Qe(t){t.adapter("websql",Ge,!0)}function Ze(){for(var t={},e=new Vr(function(e,n){t.resolve=e,t.reject=n}),n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return t.promise=e,Vr.resolve().then(function(){return fetch.apply(null,n)}).then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)}),t}function tn(t,e){var n,r,o,i=new Headers,s={method:t.method,credentials:"include",headers:i};return t.json&&(i.set("Accept","application/json"),i.set("Content-Type",t.headers["Content-Type"]||"application/json")),t.body&&t.body instanceof Blob?Ht(t.body,function(t){s.body=t}):t.body&&t.processData&&"string"!=typeof t.body?s.body=JSON.stringify(t.body):"body"in t?s.body=t.body:s.body=null,Object.keys(t.headers).forEach(function(e){t.headers.hasOwnProperty(e)&&i.set(e,t.headers[e])}),n=Ze(t.url,s),t.timeout>0&&(r=setTimeout(function(){n.reject(new Error("Load timeout for resource: "+t.url))},t.timeout)),n.promise.then(function(e){return o={statusCode:e.status},t.timeout>0&&clearTimeout(r),o.statusCode>=200&&o.statusCode<300?t.binary?e.blob():e.text():e.json()}).then(function(t){o.statusCode>=200&&o.statusCode<300?e(null,o,t):e(t,o)})["catch"](function(t){e(t,o)}),{abort:n.reject}}function en(t,e){var n,r,o=!1,i=function(){n.abort(),c()},s=function(){o=!0,n.abort(),c()},a={abort:i},c=function(){clearTimeout(r),a.abort=function(){},n&&(n.onprogress=void 0,n.upload&&(n.upload.onprogress=void 0),n.onreadystatechange=void 0,n=void 0)};n=t.xhr?new t.xhr:new XMLHttpRequest;try{n.open(t.method,t.url)}catch(u){return e(new Error(u.name||"Url is invalid"))}n.withCredentials=!("withCredentials"in t)||t.withCredentials,"GET"===t.method?delete t.headers["Content-Type"]:t.json&&(t.headers.Accept="application/json",t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.body&&t.processData&&"string"!=typeof t.body&&(t.body=JSON.stringify(t.body))),t.binary&&(n.responseType="arraybuffer"),"body"in t||(t.body=null);for(var f in t.headers)t.headers.hasOwnProperty(f)&&n.setRequestHeader(f,t.headers[f]);return t.timeout>0&&(r=setTimeout(s,t.timeout),n.onprogress=function(){clearTimeout(r),4!==n.readyState&&(r=setTimeout(s,t.timeout))},"undefined"!=typeof n.upload&&(n.upload.onprogress=n.onprogress)),n.onreadystatechange=function(){if(4===n.readyState){var r={statusCode:n.status};if(n.status>=200&&n.status<300){var i;i=t.binary?It([n.response||""],{type:n.getResponseHeader("Content-Type")}):n.responseText,e(null,r,i)}else{var s={};if(o)s=new Error("ETIMEDOUT"),s.code="ETIMEDOUT";else if("string"==typeof n.response)try{s=JSON.parse(n.response)}catch(a){}s.status=n.status,e(s)}c()}},t.body&&t.body instanceof Blob?Ht(t.body,function(t){n.send(t)}):n.send(t.body),a}function nn(){try{return new XMLHttpRequest,!0}catch(t){return!1}}function rn(t,e){return ai||t.xhr?en(t,e):tn(t,e)}function on(){return""}function sn(t,e){function n(e,n,r){if(!t.binary&&t.json&&"string"==typeof e)try{e=JSON.parse(e)}catch(o){return r(o)}Array.isArray(e)&&(e=e.map(function(t){return t.error||t.missing?R(t):t})),t.binary&&ci(e,n),r(null,e,n)}t=d(t);var r={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};return t=Pr.extend(r,t),t.json&&(t.binary||(t.headers.Accept="application/json"),t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json"),t.binary&&(t.encoding=null,t.json=!1),t.processData||(t.json=!1),rn(t,function(r,o,i){if(r)return e(R(r));var s,a=o.headers&&o.headers["content-type"],c=i||on();if(!t.binary&&(t.json||!t.processData)&&"object"!=typeof c&&(/json/.test(a)||/^[\s]*\{/.test(c)&&/\}[\s]*$/.test(c)))try{c=JSON.parse(c.toString())}catch(u){}o.statusCode>=200&&o.statusCode<300?n(c,o,e):(s=R(c),s.status=o.statusCode,e(s))})}function an(t,e){var n=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",r=n.indexOf("safari")!==-1&&n.indexOf("chrome")===-1,o=n.indexOf("msie")!==-1,i=n.indexOf("edge")!==-1,s=r||(o||i)&&"GET"===t.method,a=!("cache"in t)||t.cache,c=/^blob:/.test(t.url);if(!c&&(s||!a)){var u=t.url.indexOf("?")!==-1;t.url+=(u?"&":"?")+"_nonce="+Date.now()}return sn(t,e)}function cn(t){var e=t.doc&&t.doc._attachments;e&&Object.keys(e).forEach(function(t){var n=e[t];n.data=Pt(n.data,n.content_type)})}function un(t){return/^_design/.test(t)?"_design/"+encodeURIComponent(t.slice(8)):/^_local/.test(t)?"_local/"+encodeURIComponent(t.slice(7)):encodeURIComponent(t)}function fn(t){return t._attachments&&Object.keys(t._attachments)?Vr.all(Object.keys(t._attachments).map(function(e){var n=t._attachments[e];if(n.data&&"string"!=typeof n.data)return new Vr(function(t){Ft(n.data,t)}).then(function(t){n.data=t})})):Vr.resolve()}function ln(t){if(!t.prefix)return!1;var e=U(t.prefix).protocol;return"http"===e||"https"===e}function hn(t,e){if(ln(e)){var n=e.name.substr(e.prefix.length);t=e.prefix+encodeURIComponent(n)}var r=U(t);(r.user||r.password)&&(r.auth={username:r.user,password:r.password});var o=r.path.replace(/(^\/|\/$)/g,"").split("/");return r.db=o.pop(),r.db.indexOf("%")===-1&&(r.db=encodeURIComponent(r.db)),r.path=o.join("/"),r}function dn(t,e){return pn(t,t.db+"/"+e)}function pn(t,e){var n=t.path?"/":"";return t.protocol+"://"+t.host+(t.port?":"+t.port:"")+"/"+t.path+n+e}function vn(t){return"?"+Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")}function yn(t,e){function n(t,e,n){var r=t.ajax||{},o=Pr.extend(d(f),r,e);return hi(o.method+" "+o.url),a._ajax(o,n)}function r(t,e){return new Vr(function(r,o){n(t,e,function(t,e){return t?o(t):void r(e)})})}function o(t,e){return y(t,Hr(function(t){i().then(function(){return e.apply(this,t)})["catch"](function(e){var n=t.pop();n(e)})}))}function i(){if(t.skipSetup||t.skip_setup)return Vr.resolve();if(v)return v;var e={method:"GET",url:u};return v=r({},e)["catch"](function(t){return t&&t.status&&404===t.status?(T(404,"PouchDB is just detecting if the remote exists."),r({},{method:"PUT",url:u})):Vr.reject(t)})["catch"](function(t){return!(!t||!t.status||412!==t.status)||Vr.reject(t)}),v["catch"](function(){v=null}),v}function s(t){return t.split("/").map(encodeURIComponent).join("/")}var a=this,c=hn(t.name,t),u=dn(c,"");t=d(t);var f=t.ajax||{};if(t.auth||c.auth){var l=t.auth||c.auth,h=l.username+":"+l.password,p=Co(unescape(encodeURIComponent(h)));f.headers=f.headers||{},f.headers.Authorization="Basic "+p}a._ajax=an;var v;setTimeout(function(){e(null,a)}),a.type=function(){return"http"},a.id=o("id",function(t){n({},{method:"GET",url:pn(c,"")},function(e,n){var r=n&&n.uuid?n.uuid+c.db:dn(c,"");t(null,r)})}),a.request=o("request",function(t,e){t.url=dn(c,t.url),n({},t,e)}),a.compact=o("compact",function(t,e){"function"==typeof t&&(e=t,t={}),t=d(t),n(t,{url:dn(c,"_compact"),method:"POST"},function(){function n(){a.info(function(r,o){o&&!o.compact_running?e(null,{ok:!0}):setTimeout(n,t.interval||200)})}n()})}),a.bulkGet=y("bulkGet",function(t,e){function r(e){var r={};t.revs&&(r.revs=!0),t.attachments&&(r.attachments=!0),n({},{url:dn(c,"_bulk_get"+vn(r)),method:"POST",body:{docs:t.docs}},e)}function o(){function n(t){return function(n,r){a[t]=r.results,++s===o&&e(null,{results:I(a)})}}for(var r=fi,o=Math.ceil(t.docs.length/r),s=0,a=new Array(o),c=0;c<o;c++){var u=g(t,["revs","attachments"]);u.ajax=f,u.docs=t.docs.slice(c*r,Math.min(t.docs.length,(c+1)*r)),b(i,u,n(c))}}var i=this,s=pn(c,""),a=li[s];"boolean"!=typeof a?r(function(t,n){if(t){var r=Math.floor(t.status/100);4===r||5===r?(li[s]=!1,T(t.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),o()):e(t)}else li[s]=!0,e(null,n)}):a?r(e):o()}),a._info=function(t){i().then(function(){n({},{method:"GET",url:dn(c,"")},function(e,n){return e?t(e):(n.host=dn(c,""),void t(null,n))})})["catch"](t)},a.get=o("get",function(t,e,n){function o(t){function n(){if(!i.length)return null;var n=i.pop(),a=o[n],u=un(t._id)+"/"+s(n)+"?rev="+t._rev;return r(e,{method:"GET",url:dn(c,u),binary:!0}).then(function(t){return e.binary?t:new Vr(function(e){Ft(t,e)})}).then(function(t){delete a.stub,delete a.length,a.data=t})}var o=t._attachments,i=o&&Object.keys(o);if(o&&i.length)return new Xr(n,5,{promise:Vr}).start()}function i(t){return Array.isArray(t)?Vr.all(t.map(function(t){if(t.ok)return o(t.ok)})):o(t)}"function"==typeof e&&(n=e,e={}),e=d(e);var a={};e.revs&&(a.revs=!0),e.revs_info&&(a.revs_info=!0),e.open_revs&&("all"!==e.open_revs&&(e.open_revs=JSON.stringify(e.open_revs)),a.open_revs=e.open_revs),e.rev&&(a.rev=e.rev),e.conflicts&&(a.conflicts=e.conflicts),t=un(t);var u={method:"GET",url:dn(c,t+vn(a))};r(e,u).then(function(t){return Vr.resolve().then(function(){if(e.attachments)return i(t)}).then(function(){n(null,t)})})["catch"](n)}),a.remove=o("remove",function(t,e,r,o){var i;"string"==typeof e?(i={_id:t,_rev:e},"function"==typeof r&&(o=r,r={})):(i=t,"function"==typeof e?(o=e,r={}):(o=r,r=e));var s=i._rev||r.rev;n(r,{method:"DELETE",url:dn(c,un(i._id))+"?rev="+s},o)}),a.getAttachment=o("getAttachment",function(t,e,r,o){"function"==typeof r&&(o=r,r={});var i=r.rev?"?rev="+r.rev:"",a=dn(c,un(t))+"/"+s(e)+i;n(r,{method:"GET",url:a,binary:!0},o)}),a.removeAttachment=o("removeAttachment",function(t,e,r,o){var i=dn(c,un(t)+"/"+s(e))+"?rev="+r;n({},{method:"DELETE",url:i},o)}),a.putAttachment=o("putAttachment",function(t,e,r,o,i,a){"function"==typeof i&&(a=i,i=o,o=r,r=null);var u=un(t)+"/"+s(e),l=dn(c,u);if(r&&(l+="?rev="+r),"string"==typeof o){var h;try{h=To(o)}catch(d){return a(O(co,"Attachment is not a valid base64 string"))}o=h?Lt(h,i):""}var p={headers:{"Content-Type":i},method:"PUT",url:l,processData:!1,body:o,timeout:f.timeout||6e4};n({},p,a)}),a._bulkDocs=function(t,e,r){t.new_edits=e.new_edits,i().then(function(){return Vr.all(t.docs.map(fn))}).then(function(){n(e,{method:"POST",url:dn(c,"_bulk_docs"),timeout:e.timeout,body:t},function(t,e){return t?r(t):(e.forEach(function(t){t.ok=!0}),void r(null,e))})})["catch"](r)},a._put=function(t,e,r){i().then(function(){return fn(t)}).then(function(){n(e,{method:"PUT",url:dn(c,un(t._id)),body:t},function(t,e){return t?r(t):void r(null,e)})})["catch"](r)},a.allDocs=o("allDocs",function(t,e){"function"==typeof t&&(e=t,t={}),t=d(t);var n,o={},i="GET";t.conflicts&&(o.conflicts=!0),t.descending&&(o.descending=!0),t.include_docs&&(o.include_docs=!0),t.attachments&&(o.attachments=!0),t.key&&(o.key=JSON.stringify(t.key)),t.start_key&&(t.startkey=t.start_key),t.startkey&&(o.startkey=JSON.stringify(t.startkey)),t.end_key&&(t.endkey=t.end_key),t.endkey&&(o.endkey=JSON.stringify(t.endkey)),"undefined"!=typeof t.inclusive_end&&(o.inclusive_end=!!t.inclusive_end),"undefined"!=typeof t.limit&&(o.limit=t.limit),"undefined"!=typeof t.skip&&(o.skip=t.skip);var s=vn(o);"undefined"!=typeof t.keys&&(i="POST",n={keys:t.keys}),r(t,{method:i,url:dn(c,"_all_docs"+s),body:n}).then(function(n){t.include_docs&&t.attachments&&t.binary&&n.rows.forEach(cn),e(null,n)})["catch"](e)}),a._changes=function(t){var e="batch_size"in t?t.batch_size:ui;t=d(t),t.timeout="timeout"in t?t.timeout:"timeout"in f?f.timeout:3e4;var r,o=t.timeout?{timeout:t.timeout-5e3}:{},s="undefined"!=typeof t.limit&&t.limit;r="return_docs"in t?t.return_docs:!("returnDocs"in t)||t.returnDocs;var a=s;if(t.style&&(o.style=t.style),(t.include_docs||t.filter&&"function"==typeof t.filter)&&(o.include_docs=!0),t.attachments&&(o.attachments=!0),t.continuous&&(o.feed="longpoll"),t.conflicts&&(o.conflicts=!0),t.descending&&(o.descending=!0),"heartbeat"in t?t.heartbeat&&(o.heartbeat=t.heartbeat):o.heartbeat=1e4,t.filter&&"string"==typeof t.filter&&(o.filter=t.filter),t.view&&"string"==typeof t.view&&(o.filter="_view",o.view=t.view),t.query_params&&"object"==typeof t.query_params)for(var u in t.query_params)t.query_params.hasOwnProperty(u)&&(o[u]=t.query_params[u]);var l,h="GET";t.doc_ids&&(o.filter="_doc_ids",h="POST",l={doc_ids:t.doc_ids});var p,v,y=function(r,u){if(!t.aborted){o.since=r,"object"==typeof o.since&&(o.since=JSON.stringify(o.since)),t.descending?s&&(o.limit=a):o.limit=!s||a>e?e:a;var f={method:h,url:dn(c,"_changes"+vn(o)),timeout:t.timeout,body:l};v=r,t.aborted||i().then(function(){p=n(t,f,u)})["catch"](u)}},g={results:[]},m=function(n,o){if(!t.aborted){var i=0;if(o&&o.results){i=o.results.length,g.last_seq=o.last_seq;var c={};c.query=t.query_params,o.results=o.results.filter(function(e){a--;var n=q(t)(e);return n&&(t.include_docs&&t.attachments&&t.binary&&cn(e),r&&g.results.push(e),t.onChange(e)),n})}else if(n)return t.aborted=!0,void t.complete(n);o&&o.last_seq&&(v=o.last_seq);var u=s&&a<=0||o&&i<e||t.descending;(!t.continuous||s&&a<=0)&&u?t.complete(null,g):setTimeout(function(){y(v,m)},0)}};return y(t.since||0,m),{cancel:function(){t.aborted=!0,p&&p.abort()}}},a.revsDiff=o("revsDiff",function(t,e,r){"function"==typeof e&&(r=e,e={}),n(e,{method:"POST",url:dn(c,"_revs_diff"),body:t},r)}),a._close=function(t){t()},a._destroy=function(t,e){n(t,{url:dn(c,""),method:"DELETE"},function(t,n){return t&&t.status&&404!==t.status?e(t):void e(null,n)})}}function gn(t){t.adapter("http",yn,!1),t.adapter("https",yn,!1)}function mn(t,e,n){for(var r="",o=n-t.length;r.length<o;)r+=e;return r}function _n(t,e,n){var r=mn(t,e,n);return r+t}function bn(t,e){if(t===e)return 0;t=wn(t),e=wn(e);var n=On(t),r=On(e);if(n-r!==0)return n-r;if(null===t)return 0;switch(typeof t){case"number":return t-e;case"boolean":return t===e?0:t<e?-1:1;case"string":return Tn(t,e)}return Array.isArray(t)?jn(t,e):Cn(t,e)}function wn(t){switch(typeof t){case"undefined":return null;case"number":return t===1/0||t===-(1/0)||isNaN(t)?null:t;case"object":var e=t;if(Array.isArray(t)){var n=t.length;t=new Array(n);for(var r=0;r<n;r++)t[r]=wn(e[r])}else{if(t instanceof Date)return t.toJSON();if(null!==t){t={};for(var o in e)if(e.hasOwnProperty(o)){var i=e[o];"undefined"!=typeof i&&(t[o]=wn(i))}}}}return t}function kn(t){if(null!==t)switch(typeof t){case"boolean":return t?1:0;case"number":return Rn(t);case"string":return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var e=Array.isArray(t),n=e?t:Object.keys(t),r=-1,o=n.length,i="";if(e)for(;++r<o;)i+=En(n[r]);else for(;++r<o;){var s=n[r];i+=En(s)+En(t[s])}return i}return""}function En(t){var e="\0";return t=wn(t),On(t)+vi+kn(t)+e}function xn(t,e){var n,r=e,o="1"===t[e];if(o)n=0,e++;else{var i="0"===t[e];e++;var s="",a=t.substring(e,e+pi),c=parseInt(a,10)+di;for(i&&(c=-c),e+=pi;;){var u=t[e];if("\0"===u)break;s+=u,e++}s=s.split("."),n=1===s.length?parseInt(s,10):parseFloat(s[0]+"."+s[1]),i&&(n-=10),0!==c&&(n=parseFloat(n+"e"+c))}return{num:n,length:e-r}}function An(t,e){var n=t.pop();if(e.length){var r=e[e.length-1];n===r.element&&(e.pop(),r=e[e.length-1]);var o=r.element,i=r.index;if(Array.isArray(o))o.push(n);else if(i===t.length-2){var s=t.pop();o[s]=n}else t.push(n)}}function Sn(t){for(var e=[],n=[],r=0;;){var o=t[r++];if("\0"!==o)switch(o){case"1":e.push(null);break;case"2":e.push("1"===t[r]),r++;break;case"3":var i=xn(t,r);e.push(i.num),r+=i.length;break;case"4":for(var s="";;){var a=t[r];if("\0"===a)break;s+=a,r++}s=s.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(s);break;case"5":var c={element:[],index:e.length};e.push(c.element),n.push(c);break;case"6":var u={element:{},index:e.length};e.push(u.element),n.push(u);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+o)}else{if(1===e.length)return e.pop();An(e,n)}}}function jn(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var o=bn(t[r],e[r]);if(0!==o)return o}return t.length===e.length?0:t.length>e.length?1:-1}function Tn(t,e){return t===e?0:t>e?1:-1}function Cn(t,e){for(var n=Object.keys(t),r=Object.keys(e),o=Math.min(n.length,r.length),i=0;i<o;i++){var s=bn(n[i],r[i]);if(0!==s)return s;if(s=bn(t[n[i]],e[r[i]]),0!==s)return s}return n.length===r.length?0:n.length>r.length?1:-1}function On(t){var e=["boolean","number","string","object"],n=e.indexOf(typeof t);return~n?null===t?1:Array.isArray(t)?5:n<3?n+2:n+3:Array.isArray(t)?5:void 0}function Rn(t){if(0===t)return"1";var e=t.toExponential().split(/e\+?/),n=parseInt(e[1],10),r=t<0,o=r?"0":"2",i=(r?-n:n)-di,s=_n(i.toString(),"0",pi);o+=vi+s;var a=Math.abs(parseFloat(e[0]));r&&(a=10-a);var c=a.toFixed(20);return c=c.replace(/\.?0+$/,""),o+=vi+c}function Dn(){this.promise=new Vr(function(t){t()})}function qn(t){var e,n=t.db,r=t.viewName,o=t.map,i=t.reduce,s=t.temporary,a=o.toString()+(i&&i.toString())+"undefined";if(!s&&(e=n._cachedViews=n._cachedViews||{},e[a]))return e[a];var c=n.info().then(function(t){function c(t){t.views=t.views||{};var e=r;e.indexOf("/")===-1&&(e=r+"/"+r);var n=t.views[e]=t.views[e]||{};if(!n[u])return n[u]=!0,t}var u=t.db_name+"-mrview-"+(s?"temp":Kt(a));return M(n,"_local/mrviews",c).then(function(){return n.registerDependentDatabase(u).then(function(t){var r=t.db;r.auto_compaction=!0;var s={name:u,db:r,sourceDB:n,adapter:n.adapter,mapFun:o,reduceFun:i};return s.db.get("_local/lastSeq")["catch"](function(t){if(404!==t.status)throw t}).then(function(t){return s.seq=t?t.seq:0,e&&s.db.once("destroyed",function(){delete e[a]}),s})})})});return e&&(e[a]=c),c}function In(t){this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,In)}catch(e){}}function Bn(t){this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Bn)}catch(e){}}function Ln(t){this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Ln)}catch(e){}}function Pn(t){var e="builtin "+t+" function requires map values to be numbers or number arrays";return new Ln(e)}function Nn(t){for(var e=0,n=0,r=t.length;n<r;n++){var o=t[n];if("number"!=typeof o){if(!Array.isArray(o))throw Pn("_sum");e="number"==typeof e?[e]:e;for(var i=0,s=o.length;i<s;i++){var a=o[i];if("number"!=typeof a)throw Pn("_sum");"undefined"==typeof e[i]?e.push(a):e[i]+=a}}else"number"==typeof e?e+=o:e[0]+=o}return e}function Un(t,e){return zr("return ("+t.replace(/;\s*$/,"")+");",{emit:e,sum:Nn,log:yi,isArray:gi,toJSON:mi})}function Mn(t){return t.indexOf("/")===-1?[t,t]:t.split("/")}function Fn(t){return 1===t.length&&/^1-/.test(t[0].rev)}function Hn(t,e){try{t.emit("error",e)}catch(n){A("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),A("error",e)}}function zn(t,e,n){try{return{output:e.apply(null,n)}}catch(r){return Hn(t,r),{error:r}}}function Jn(t,e){var n=bn(t.key,e.key);return 0!==n?n:bn(t.value,e.value)}function Yn(t,e,n){return n=n||0,"number"==typeof e?t.slice(n,e+n):n>0?t.slice(n):t}function Xn(t){var e=t.value,n=e&&"object"==typeof e&&e._id||t.id;return n}function Vn(t){t.rows.forEach(function(t){var e=t.doc&&t.doc._attachments;e&&Object.keys(e).forEach(function(t){var n=e[t];e[t].data=Pt(n.data,n.content_type)})})}function Kn(t){return function(e){return t.include_docs&&t.attachments&&t.binary&&Vn(e),e}}function Wn(t,e,n,r){var o=e[t];"undefined"!=typeof o&&(r&&(o=encodeURIComponent(JSON.stringify(o))),n.push(t+"="+o))}function $n(t){if("undefined"!=typeof t){var e=Number(t);return isNaN(e)||e!==parseInt(t,10)?t:e}}function Gn(t){return t.group_level=$n(t.group_level),t.limit=$n(t.limit),t.skip=$n(t.skip),t}function Qn(t){if(t){if("number"!=typeof t)return new In('Invalid value for integer: "'+t+'"');if(t<0)return new In('Invalid value for positive integer: "'+t+'"')}}function Zn(t,e){var n=t.descending?"endkey":"startkey",r=t.descending?"startkey":"endkey";if("undefined"!=typeof t[n]&&"undefined"!=typeof t[r]&&bn(t[n],t[r])>0)throw new In("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(e.reduce&&t.reduce!==!1){if(t.include_docs)throw new In("{include_docs:true} is invalid for reduce");if(t.keys&&t.keys.length>1&&!t.group&&!t.group_level)throw new In("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(e){var n=Qn(t[e]);if(n)throw n})}function tr(t,e,n){var r,o=[],i="GET";if(Wn("reduce",n,o),Wn("include_docs",n,o),Wn("attachments",n,o),Wn("limit",n,o),Wn("descending",n,o),Wn("group",n,o),Wn("group_level",n,o),Wn("skip",n,o),Wn("stale",n,o),Wn("conflicts",n,o),Wn("startkey",n,o,!0),Wn("start_key",n,o,!0),Wn("endkey",n,o,!0),Wn("end_key",n,o,!0),Wn("inclusive_end",n,o),Wn("key",n,o,!0),o=o.join("&"),o=""===o?"":"?"+o,"undefined"!=typeof n.keys){var s=2e3,a="keys="+encodeURIComponent(JSON.stringify(n.keys));a.length+o.length+1<=s?o+=("?"===o[0]?"&":"?")+a:(i="POST","string"==typeof e?r={keys:n.keys}:e.keys=n.keys)}if("string"==typeof e){var c=Mn(e);return t.request({method:i,url:"_design/"+c[0]+"/_view/"+c[1]+o,body:r}).then(Kn(n))}return r=r||{},Object.keys(e).forEach(function(t){Array.isArray(e[t])?r[t]=e[t]:r[t]=e[t].toString()}),t.request({method:"POST",url:"_temp_view"+o,body:r}).then(Kn(n))}function er(t,e,n){return new Vr(function(r,o){t._query(e,n,function(t,e){return t?o(t):void r(e)})})}function nr(t){return new Vr(function(e,n){t._viewCleanup(function(t,r){return t?n(t):void e(r)})})}function rr(t){return function(e){if(404===e.status)return t;throw e}}function or(t,e,n){function r(){return Fn(f)?Vr.resolve(a):e.db.get(s)["catch"](rr(a))}function o(t){return t.keys.length?e.db.allDocs({keys:t.keys,include_docs:!0}):Vr.resolve({rows:[]})}function i(t,e){for(var n=[],r={},o=0,i=e.rows.length;o<i;o++){var s=e.rows[o],a=s.doc;if(a&&(n.push(a),r[a._id]=!0,a._deleted=!u[a._id],!a._deleted)){var c=u[a._id];"value"in c&&(a.value=c.value)}}var f=Object.keys(u);return f.forEach(function(t){if(!r[t]){var e={_id:t},o=u[t];"value"in o&&(e.value=o.value),n.push(e)}}),t.keys=Ei(f.concat(t.keys)),n.push(t),n}var s="_local/doc_"+t,a={_id:s,keys:[]},c=n[t],u=c.indexableKeysToKeyValues,f=c.changes;return r().then(function(t){return o(t).then(function(e){return i(t,e)})})}function ir(t,e,n){var r="_local/lastSeq";return t.db.get(r)["catch"](rr({_id:r,seq:0})).then(function(r){var o=Object.keys(e);return Vr.all(o.map(function(n){return or(n,t,e)})).then(function(e){var o=I(e);return r.seq=n,o.push(r),t.db.bulkDocs({docs:o})})})}function sr(t){var e="string"==typeof t?t:t.name,n=xi[e];return n||(n=xi[e]=new Dn),n}function ar(t){return ki(sr(t),function(){return cr(t)})()}function cr(t){function e(t,e){var n={id:o._id,key:wn(t)};"undefined"!=typeof e&&null!==e&&(n.value=wn(e)),r.push(n)}function n(e,n){return function(){return ir(t,e,n)}}var r,o,i;if("function"==typeof t.mapFun&&2===t.mapFun.length){var s=t.mapFun;i=function(t){return s(t,e)}}else i=Un(t.mapFun.toString(),e);var a=t.seq||0,c=new Dn;return new Vr(function(e,s){function u(){c.finish().then(function(){t.seq=a,e()})}function f(){function e(t){s(t)}t.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:a,limit:Si}).on("complete",function(e){var s=e.results;if(!s.length)return u();for(var l={},h=0,d=s.length;h<d;h++){var p=s[h];if("_"!==p.doc._id[0]){r=[],o=p.doc,o._deleted||zn(t.sourceDB,i,[o]),r.sort(Jn);for(var v,y={},g=0,m=r.length;g<m;g++){var _=r[g],b=[_.key,_.id];0===bn(_.key,v)&&b.push(g);var w=En(b);y[w]=_,v=_.key}l[p.doc._id]={indexableKeysToKeyValues:y,changes:p.changes}}a=p.seq}return c.add(n(l,a)),s.length<Si?u():f()}).on("error",e)}f()})}function ur(t,e,n){0===n.group_level&&delete n.group_level;var r,o=n.group||n.group_level;r=ji[t.reduceFun]?ji[t.reduceFun]:Un(t.reduceFun.toString());var i=[],s=isNaN(n.group_level)?Number.POSITIVE_INFINITY:n.group_level;e.forEach(function(t){var e=i[i.length-1],n=o?t.key:null;return o&&Array.isArray(n)&&(n=n.slice(0,s)),e&&0===bn(e.groupKey,n)?(e.keys.push([t.key,t.id]),void e.values.push(t.value)):void i.push({keys:[[t.key,t.id]],values:[t.value],groupKey:n})}),e=[];for(var a=0,c=i.length;a<c;a++){var u=i[a],f=zn(t.sourceDB,r,[u.keys,u.values,!1]);if(f.error&&f.error instanceof Ln)throw f.error;e.push({value:f.error?null:f.output,key:u.groupKey})}return{rows:Yn(e,n.limit,n.skip)}}function fr(t,e){return ki(sr(t),function(){return lr(t,e)})()}function lr(t,e){function n(e){return e.include_docs=!0,t.db.allDocs(e).then(function(t){return o=t.total_rows,t.rows.map(function(t){if("value"in t.doc&&"object"==typeof t.doc.value&&null!==t.doc.value){var e=Object.keys(t.doc.value).sort(),n=["id","key","value"];if(!(e<n||e>n))return t.doc.value}var r=Sn(t.doc._id);return{key:r[0],id:r[1],value:"value"in t.doc?t.doc.value:null}})})}function r(n){var r;if(r=i?ur(t,n,e):{total_rows:o,offset:s,rows:n},e.include_docs){var a=Ei(n.map(Xn));return t.sourceDB.allDocs({keys:a,include_docs:!0,conflicts:e.conflicts,attachments:e.attachments,binary:e.binary}).then(function(t){var e={};return t.rows.forEach(function(t){t.doc&&(e["$"+t.id]=t.doc)}),n.forEach(function(t){var n=Xn(t),r=e["$"+n];r&&(t.doc=r)}),r})}return r}var o,i=t.reduceFun&&e.reduce!==!1,s=e.skip||0;if("undefined"==typeof e.keys||e.keys.length||(e.limit=0,delete e.keys),"undefined"!=typeof e.keys){var a=e.keys,c=a.map(function(t){var e={startkey:En([t]),endkey:En([t,{}])};return n(e)});return Vr.all(c).then(I).then(r)}var u={descending:e.descending};if(e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"undefined"!=typeof e.startkey&&(u.startkey=En(e.descending?[e.startkey,{}]:[e.startkey])),"undefined"!=typeof e.endkey){var f=e.inclusive_end!==!1;e.descending&&(f=!f),u.endkey=En(f?[e.endkey,{}]:[e.endkey])}if("undefined"!=typeof e.key){var l=En([e.key]),h=En([e.key,{}]);u.descending?(u.endkey=l,u.startkey=h):(u.startkey=l,u.endkey=h)}return i||("number"==typeof e.limit&&(u.limit=e.limit),u.skip=s),n(u).then(r)}function hr(t){return t.request({method:"POST",url:"_view_cleanup"})}function dr(t){return t.get("_local/mrviews").then(function(e){var n={};Object.keys(e.views).forEach(function(t){var e=Mn(t),r="_design/"+e[0],o=e[1];n[r]=n[r]||{},n[r][o]=!0});var r={keys:Object.keys(n),include_docs:!0};return t.allDocs(r).then(function(r){var o={};r.rows.forEach(function(t){var r=t.key.substring(8);Object.keys(n[t.key]).forEach(function(n){var i=r+"/"+n;e.views[i]||(i=n);var s=Object.keys(e.views[i]),a=t.doc&&t.doc.views&&t.doc.views[n];s.forEach(function(t){o[t]=o[t]||a})})});var i=Object.keys(o).filter(function(t){return!o[t]}),s=i.map(function(e){return ki(sr(e),function(){return new t.constructor(e,t.__opts).destroy()})()});return Vr.all(s).then(function(){return{ok:!0}})})},rr({ok:!0}))}function pr(t,n,r){if("http"===t.type())return tr(t,n,r);if("function"==typeof t._query)return er(t,n,r);if("string"!=typeof n){Zn(r,n);var o={db:t,viewName:"temp_view/temp_view",map:n.map,reduce:n.reduce,temporary:!0};return Ai.add(function(){return qn(o).then(function(t){function e(){return t.db.destroy()}return wi(ar(t).then(function(){return fr(t,r)}),e)})}),Ai.finish()}var i=n,s=Mn(i),a=s[0],c=s[1];return t.get("_design/"+a).then(function(n){var o=n.views&&n.views[c];if(!o||"string"!=typeof o.map)throw new Bn("ddoc "+a+" has no view named "+c);Zn(r,o);var s={db:t,viewName:i,map:o.map,reduce:o.reduce};return qn(s).then(function(t){return"ok"===r.stale||"update_after"===r.stale?("update_after"===r.stale&&e.nextTick(function(){ar(t)}),fr(t,r)):ar(t).then(function(){return fr(t,r)})})})}function vr(t){return/^1-/.test(t)}function yr(t,e,n){return!t._attachments||!t._attachments[n]||t._attachments[n].digest!==e._attachments[n].digest}function gr(t,e){var n=Object.keys(e._attachments);return Vr.all(n.map(function(n){return t.getAttachment(e._id,n,{rev:e._rev})}))}function mr(t,e,n){
var r="http"===e.type()&&"http"!==t.type(),o=Object.keys(n._attachments);return r?t.get(n._id).then(function(r){return Vr.all(o.map(function(o){return yr(r,n,o)?e.getAttachment(n._id,o):t.getAttachment(r._id,o)}))})["catch"](function(t){if(404!==t.status)throw t;return gr(e,n)}):gr(e,n)}function _r(t){var e=[];return Object.keys(t).forEach(function(n){var r=t[n].missing;r.forEach(function(t){e.push({id:n,rev:t})})}),{docs:e,revs:!0}}function br(t,e,n,r){function o(){var o=_r(n);if(o.docs.length)return t.bulkGet(o).then(function(n){if(r.cancelled)throw new Error("cancelled");return Vr.all(n.results.map(function(n){return Vr.all(n.docs.map(function(n){var r=n.ok;return n.error&&(f=!1),r&&r._attachments?mr(e,t,r).then(function(t){var e=Object.keys(r._attachments);return t.forEach(function(t,n){var o=r._attachments[e[n]];delete o.stub,delete o.length,o.data=t}),r}):r}))})).then(function(t){u=u.concat(I(t).filter(Boolean))})})}function i(t){return t._attachments&&Object.keys(t._attachments).length>0}function s(e){return t.allDocs({keys:e,include_docs:!0}).then(function(t){if(r.cancelled)throw new Error("cancelled");t.rows.forEach(function(t){!t.deleted&&t.doc&&vr(t.value.rev)&&!i(t.doc)&&(u.push(t.doc),delete n[t.id])})})}function a(){var t=Object.keys(n).filter(function(t){var e=n[t].missing;return 1===e.length&&vr(e[0])});if(t.length>0)return s(t)}function c(){return{ok:f,docs:u}}n=d(n);var u=[],f=!0;return Vr.resolve().then(a).then(o).then(c)}function wr(t,e,n,r,o){return t.get(e)["catch"](function(n){if(404===n.status)return"http"===t.type()&&T(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:e,history:[],replicator:Di,version:Ri};throw n}).then(function(i){if(!o.cancelled&&i.last_seq!==n)return i.history=(i.history||[]).filter(function(t){return t.session_id!==r}),i.history.unshift({last_seq:n,session_id:r}),i.history=i.history.slice(0,qi),i.version=Ri,i.replicator=Di,i.session_id=r,i.last_seq=n,t.put(i)["catch"](function(i){if(409===i.status)return wr(t,e,n,r,o);throw i})})}function kr(t,e,n,r){this.src=t,this.target=e,this.id=n,this.returnValue=r}function Er(t,e){return t.session_id===e.session_id?{last_seq:t.last_seq,history:t.history}:xr(t.history,e.history)}function xr(t,e){var n=t[0],r=t.slice(1),o=e[0],i=e.slice(1);if(!n||0===e.length)return{last_seq:Ii,history:[]};var s=n.session_id;if(Ar(s,e))return{last_seq:n.last_seq,history:t};var a=o.session_id;return Ar(a,r)?{last_seq:o.last_seq,history:i}:xr(r,i)}function Ar(t,e){var n=e[0],r=e.slice(1);return!(!t||0===e.length)&&(t===n.session_id||Ar(t,r))}function Sr(t){return"number"==typeof t.status&&4===Math.floor(t.status/100)}function jr(t,e,n,r){if(t.retry===!1)return e.emit("error",n),void e.removeAllListeners();if("function"!=typeof t.back_off_function&&(t.back_off_function=j),e.emit("requestError",n),"active"===e.state||"pending"===e.state){e.emit("paused",n),e.state="stopped";var o=function(){t.current_back_off=Li},i=function(){e.removeListener("active",o)};e.once("paused",i),e.once("active",o)}t.current_back_off=t.current_back_off||Li,t.current_back_off=t.back_off_function(t.current_back_off),setTimeout(r,t.current_back_off)}function Tr(t){return Object.keys(t).sort(bn).reduce(function(e,n){return e[n]=t[n],e},{})}function Cr(t,e,n){var r=n.doc_ids?n.doc_ids.sort(bn):"",o=n.filter?n.filter.toString():"",i="",s="";return n.filter&&n.query_params&&(i=JSON.stringify(Tr(n.query_params))),n.filter&&"_view"===n.filter&&(s=n.view.toString()),Vr.all([t.id(),e.id()]).then(function(t){var e=t[0]+t[1]+o+s+i+r;return new Vr(function(t){Vt(e,t)})}).then(function(t){return t=t.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+t})}function Or(t,e,n,r,o){function i(){return E?Vr.resolve():Cr(t,e,n).then(function(n){k=n,E=new kr(t,e,k,r)})}function s(){if(L=[],0!==w.docs.length){var t=w.docs,i={timeout:n.timeout};return e.bulkDocs({docs:t,new_edits:!1},i).then(function(e){if(r.cancelled)throw p(),new Error("cancelled");var n=Object.create(null);e.forEach(function(t){t.error&&(n[t.id]=t)});var i=Object.keys(n).length;o.doc_write_failures+=i,o.docs_written+=t.length-i,t.forEach(function(t){var e=n[t._id];if(e){if(o.errors.push(e),"unauthorized"!==e.name&&"forbidden"!==e.name)throw e;r.emit("denied",d(e))}else L.push(t)})},function(e){throw o.doc_write_failures+=t.length,e})}}function a(){if(w.error)throw new Error("There was a problem getting docs.");o.last_seq=C=w.seq;var t=d(o);return L.length&&(t.docs=L,r.emit("change",t)),S=!0,E.writeCheckpoint(w.seq,P).then(function(){if(S=!1,r.cancelled)throw p(),new Error("cancelled");w=void 0,m()})["catch"](function(t){throw b(t),t})}function c(){var t={};return w.changes.forEach(function(e){"_user/"!==e.id&&(t[e.id]=e.changes.map(function(t){return t.rev}))}),e.revsDiff(t).then(function(t){if(r.cancelled)throw p(),new Error("cancelled");w.diffs=t})}function u(){return br(t,e,w.diffs,r).then(function(t){w.error=!t.ok,t.docs.forEach(function(t){delete w.diffs[t._id],o.docs_read++,w.docs.push(t)})})}function f(){if(!r.cancelled&&!w){if(0===x.length)return void l(!0);w=x.shift(),c().then(u).then(s).then(a).then(f)["catch"](function(t){h("batch processing terminated with error",t)})}}function l(t){return 0===A.changes.length?void(0!==x.length||w||((O&&N.live||j)&&(r.state="pending",r.emit("paused")),j&&p())):void((t||j||A.changes.length>=R)&&(x.push(A),A={seq:0,changes:[],docs:[]},"pending"!==r.state&&"stopped"!==r.state||(r.state="active",r.emit("active")),f()))}function h(t,e){T||(e.message||(e.message=t),o.ok=!1,o.status="aborting",x=[],A={seq:0,changes:[],docs:[]},p(e))}function p(i){T||r.cancelled&&(o.status="cancelled",S)||(o.status=o.status||"complete",o.end_time=new Date,o.last_seq=C,T=!0,i?(i.result=o,"unauthorized"===i.name||"forbidden"===i.name?(r.emit("error",i),r.removeAllListeners()):jr(n,r,i,function(){Or(t,e,n,r)})):(r.emit("complete",o),r.removeAllListeners()))}function v(t){if(r.cancelled)return p();var e=q(n)(t);e&&(A.seq=t.seq,A.changes.push(t),l(0===x.length&&N.live))}function y(t){if(I=!1,r.cancelled)return p();if(t.results.length>0)N.since=t.last_seq,m(),l(!0);else{var e=function(){O?(N.live=!0,m()):j=!0,l(!0)};w||0!==t.results.length?e():(S=!0,E.writeCheckpoint(t.last_seq,P).then(function(){S=!1,o.last_seq=C=t.last_seq,e()})["catch"](b))}}function g(t){return I=!1,r.cancelled?p():void h("changes rejected",t)}function m(){function e(){i.cancel()}function o(){r.removeListener("cancel",e)}if(!I&&!j&&x.length<D){I=!0,r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",e);var i=t.changes(N).on("change",v);i.then(o,o),i.then(y)["catch"](g),n.retry&&(r._changes=i,r._abortChanges=e)}}function _(){i().then(function(){return r.cancelled?void p():E.getCheckpoint().then(function(t){C=t,N={since:C,limit:R,batch_size:R,style:"all_docs",doc_ids:B,return_docs:!0},n.filter&&("string"!=typeof n.filter?N.include_docs=!0:N.filter=n.filter),"heartbeat"in n&&(N.heartbeat=n.heartbeat),"timeout"in n&&(N.timeout=n.timeout),n.query_params&&(N.query_params=n.query_params),n.view&&(N.view=n.view),m()})})["catch"](function(t){h("getCheckpoint rejected with ",t)})}function b(t){S=!1,h("writeCheckpoint completed with error",t)}var w,k,E,x=[],A={seq:0,changes:[],docs:[]},S=!1,j=!1,T=!1,C=0,O=n.continuous||n.live||!1,R=n.batch_size||100,D=n.batches_limit||10,I=!1,B=n.doc_ids,L=[],P=z();o=o||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var N={};return r.ready(t,e),r.cancelled?void p():(r._addedListeners||(r.once("cancel",p),"function"==typeof n.complete&&(r.once("error",n.complete),r.once("complete",function(t){n.complete(null,t)})),r._addedListeners=!0),void("undefined"==typeof n.since?_():i().then(function(){return S=!0,E.writeCheckpoint(n.since,P)}).then(function(){return S=!1,r.cancelled?void p():(C=n.since,void _())})["catch"](b)))}function Rr(){Fr.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var t=this,e=new Vr(function(e,n){t.once("complete",e),t.once("error",n)});t.then=function(t,n){return e.then(t,n)},t["catch"]=function(t){return e["catch"](t)},t["catch"](function(){})}function Dr(t,e){var n=e.PouchConstructor;return"string"==typeof t?new n(t,e):t}function qr(t,e,n,r){if("function"==typeof n&&(r=n,n={}),"undefined"==typeof n&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw O(lo,"`doc_ids` filter parameter is not a list.");n.complete=r,n=d(n),n.continuous=n.continuous||n.live,n.retry="retry"in n&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var o=new Rr(n),i=Dr(t,n),s=Dr(e,n);return Or(i,s,n,o),o}function Ir(t,e,n,r){return"function"==typeof n&&(r=n,n={}),"undefined"==typeof n&&(n={}),n=d(n),n.PouchConstructor=n.PouchConstructor||this,t=Dr(t,n),e=Dr(e,n),new Br(t,e,n,r)}function Br(t,e,n,r){function o(t){d.emit("change",{direction:"pull",change:t})}function i(t){d.emit("change",{direction:"push",change:t})}function s(t){d.emit("denied",{direction:"push",doc:t})}function a(t){d.emit("denied",{direction:"pull",doc:t})}function c(){d.pushPaused=!0,d.pullPaused&&d.emit("paused")}function u(){d.pullPaused=!0,d.pushPaused&&d.emit("paused")}function f(){d.pushPaused=!1,d.pullPaused&&d.emit("active",{direction:"push"})}function l(){d.pullPaused=!1,d.pushPaused&&d.emit("active",{direction:"pull"})}function h(t){return function(e,n){var r="change"===e&&(n===o||n===i),h="denied"===e&&(n===a||n===s),p="paused"===e&&(n===u||n===c),v="active"===e&&(n===l||n===f);(r||h||p||v)&&(e in y||(y[e]={}),y[e][t]=!0,2===Object.keys(y[e]).length&&d.removeAllListeners(e))}}var d=this;this.canceled=!1;var p=n.push?Pr.extend({},n,n.push):n,v=n.pull?Pr.extend({},n,n.pull):n;this.push=qr(t,e,p),this.pull=qr(e,t,v),this.pushPaused=!0,this.pullPaused=!0;var y={};n.live&&(this.push.on("complete",d.pull.cancel.bind(d.pull)),this.pull.on("complete",d.push.cancel.bind(d.push))),this.on("newListener",function(t){"change"===t?(d.pull.on("change",o),d.push.on("change",i)):"denied"===t?(d.pull.on("denied",a),d.push.on("denied",s)):"active"===t?(d.pull.on("active",l),d.push.on("active",f)):"paused"===t&&(d.pull.on("paused",u),d.push.on("paused",c))}),this.on("removeListener",function(t){"change"===t?(d.pull.removeListener("change",o),d.push.removeListener("change",i)):"denied"===t?(d.pull.removeListener("denied",a),d.push.removeListener("denied",s)):"active"===t?(d.pull.removeListener("active",l),d.push.removeListener("active",f)):"paused"===t&&(d.pull.removeListener("paused",u),d.push.removeListener("paused",c))}),this.pull.on("removeListener",h("pull")),this.push.on("removeListener",h("push"));var g=Vr.all([this.push,this.pull]).then(function(t){var e={push:t[0],pull:t[1]};return d.emit("complete",e),r&&r(null,e),d.removeAllListeners(),e},function(t){if(d.cancel(),r?r(t):d.emit("error",t),d.removeAllListeners(),r)throw t});this.then=function(t,e){return g.then(t,e)},this["catch"]=function(t){return g["catch"](t)}}function Lr(t){t.replicate=qr,t.sync=Ir,Object.defineProperty(t.prototype,"replicate",{get:function(){var t=this;return{from:function(e,n,r){return t.constructor.replicate(e,t,n,r)},to:function(e,n,r){return t.constructor.replicate(t,e,n,r)}}}}),t.prototype.sync=function(t,e,n){return this.constructor.sync(this,t,e,n)}}var Pr=n(4),Nr=o(n(5)),Ur=o(n(8)),Mr=o(n(9)),Fr=n(11),Hr=o(n(12)),zr=o(n(13)),Jr=o(n(14)),Yr=o(n(15)),Xr=o(n(16)),Vr="function"==typeof Promise?Promise:Mr;a.prototype.get=function(t){var e=i(t);return this.store[e]},a.prototype.set=function(t,e){var n=i(t);return this.store[n]=e,!0},a.prototype.has=function(t){var e=i(t);return e in this.store},a.prototype["delete"]=function(t){var e=i(t),n=e in this.store;return delete this.store[e],n},a.prototype.forEach=function(t){for(var e=Object.keys(this.store),n=0,r=e.length;n<r;n++){var o=e[n],i=this.store[o];o=s(o),t(i,o)}},c.prototype.add=function(t){return this.store.set(t,!0)},c.prototype.has=function(t){return this.store.has(t)};var Kr,Wr=Function.prototype.toString,$r=Wr.call(Object),Gr=Nr("pouchdb:api"),Qr=6;if(w())Kr=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),Kr=!!localStorage.getItem("_pouch_check_localstorage")}catch(Zr){Kr=!1}Ur(x,Fr.EventEmitter),x.prototype.addListener=function(t,e,n,r){function o(){function t(){s=!1}if(i._listeners[e]){if(s)return void(s="waiting");s=!0;var a=g(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);n.changes(a).on("change",function(t){t.seq>r.since&&!r.cancelled&&(r.since=t.seq,r.onChange(t))}).on("complete",function(){"waiting"===s&&setTimeout(function(){o()},0),s=!1}).on("error",t)}}if(!this._listeners[e]){var i=this,s=!1;this._listeners[e]=o,this.on(t,o)}},x.prototype.removeListener=function(t,e){e in this._listeners&&(Fr.EventEmitter.prototype.removeListener.call(this,t,this._listeners[e]),delete this._listeners[e])},x.prototype.notifyLocalWindows=function(t){w()?chrome.storage.local.set({dbName:t}):k()&&(localStorage[t]="a"===localStorage[t]?"b":"a")},x.prototype.notify=function(t){this.emit(t),this.notifyLocalWindows(t)},Ur(C,Error),C.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var to=(new C({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),new C({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"})),eo=new C({status:404,error:"not_found",reason:"missing"}),no=new C({status:409,error:"conflict",reason:"Document update conflict"}),ro=new C({status:400,error:"bad_request",reason:"_id field must contain a string"}),oo=new C({status:412,error:"missing_id",reason:"_id is required for puts"}),io=new C({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),so=new C({status:412,error:"precondition_failed",reason:"Database not open"}),ao=new C({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),co=new C({status:500,error:"badarg",reason:"Some query argument is invalid"}),uo=(new C({status:400,error:"invalid_request",reason:"Request was invalid"}),new C({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"})),fo=new C({status:500,error:"doc_validation",reason:"Bad special document member"}),lo=new C({status:400,error:"bad_request",reason:"Something wrong with the request"}),ho=new C({status:400,error:"bad_request",reason:"Document must be a JSON object"}),po=(new C({status:404,error:"not_found",reason:"Database not found"}),new C({status:500,error:"indexed_db_went_bad",reason:"unknown"})),vo=new C({status:500,error:"web_sql_went_bad",reason:"unknown"}),yo=(new C({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),new C({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),new C({status:400,error:"bad_request",reason:"Invalid rev format"})),go=(new C({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),new C({status:412,error:"missing_stub"})),mo=(new C({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"]),_o="queryKey",bo=/(?:^|&)([^&=]*)=?([^&]*)/g,wo=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ko="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Ur(dt,Fr.EventEmitter),dt.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},dt.prototype.doChanges=function(t){var e=this,n=t.complete;if(t=d(t),"live"in t&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=pt,"latest"===t.since&&(t.since="now"),t.since||(t.since=0),"now"===t.since)return void this.db.info().then(function(r){return e.isCancelled?void n(null,{status:"cancelled"}):(t.since=r.update_seq,void e.doChanges(t))},n);if(t.view&&!t.filter&&(t.filter="_view"),t.filter&&"string"==typeof t.filter&&("_view"===t.filter?t.view=N(t.view):t.filter=N(t.filter),"http"!==this.db.type()&&!t.doc_ids))return this.filterChanges(t);"descending"in t||(t.descending=!1),t.limit=0===t.limit?1:t.limit,t.complete=n;var r=this.db._changes(t);if(r&&"function"==typeof r.cancel){var o=e.cancel;e.cancel=Hr(function(t){r.cancel(),o.apply(this,t)})}},dt.prototype.filterChanges=function(t){var e=this,n=t.complete;if("_view"===t.filter){if(!t.view||"string"!=typeof t.view){var r=O(lo,"`view` filter parameter not found or invalid.");return n(r)}var o=P(t.view);this.db.get("_design/"+o[0],function(r,i){if(e.isCancelled)return n(null,{status:"cancelled"});if(r)return n(R(r));var s=i&&i.views&&i.views[o[1]]&&i.views[o[1]].map;return s?(t.filter=lt(s),void e.doChanges(t)):n(O(eo,i.views?"missing json key: "+o[1]:"missing json key: views"))})}else{var i=P(t.filter);if(!i)return e.doChanges(t);this.db.get("_design/"+i[0],function(r,o){if(e.isCancelled)return n(null,{status:"cancelled"});if(r)return n(R(r));var s=o&&o.filters&&o.filters[i[1]];return s?(t.filter=ft(s),void e.doChanges(t)):n(O(eo,o&&o.filters?"missing json key: "+i[1]:"missing json key: filters"))})}},Ur(xt,Fr.EventEmitter),xt.prototype.post=y("post",function(t,e,n){return"function"==typeof e&&(n=e,e={}),"object"!=typeof t||Array.isArray(t)?n(O(ho)):void this.bulkDocs({docs:[t]},e,gt(n))}),xt.prototype.put=y("put",function(t,e,n){return"function"==typeof e&&(n=e,e={}),"object"!=typeof t||Array.isArray(t)?n(O(ho)):(B(t._id),ut(t._id)&&"function"==typeof this._putLocal?t._deleted?this._removeLocal(t,n):this._putLocal(t,n):void("function"==typeof this._put&&e.new_edits!==!1?this._put(t,e,n):this.bulkDocs({docs:[t]},e,gt(n))))}),xt.prototype.putAttachment=y("putAttachment",function(t,e,n,r,o){function i(t){var n="_rev"in t?parseInt(t._rev,10):0;return t._attachments=t._attachments||{},t._attachments[e]={content_type:o,data:r,revpos:++n},s.put(t)}var s=this;return"function"==typeof o&&(o=r,r=n,n=null),"undefined"==typeof o&&(o=r,r=n,n=null),s.get(t).then(function(t){if(t._rev!==n)throw O(no);return i(t)},function(e){if(e.reason===eo.message)return i({_id:t});throw e})}),xt.prototype.removeAttachment=y("removeAttachment",function(t,e,n,r){var o=this;o.get(t,function(t,i){return t?void r(t):i._rev!==n?void r(O(no)):i._attachments?(delete i._attachments[e],0===Object.keys(i._attachments).length&&delete i._attachments,void o.put(i,r)):r()})}),xt.prototype.remove=y("remove",function(t,e,n,r){var o;"string"==typeof e?(o={_id:t,_rev:e},"function"==typeof n&&(r=n,n={})):(o=t,"function"==typeof e?(r=e,n={}):(r=n,n=e)),n=n||{},n.was_delete=!0;var i={_id:o._id,_rev:o._rev||n.rev};return i._deleted=!0,ut(i._id)&&"function"==typeof this._removeLocal?this._removeLocal(o,r):void this.bulkDocs({docs:[i]},n,gt(r))}),xt.prototype.revsDiff=y("revsDiff",function(t,e,n){function r(t,e){c.has(t)||c.set(t,{missing:[]}),c.get(t).missing.push(e)}function o(e,n){var o=t[e].slice(0);Y(n,function(t,n,i,s,a){var c=n+"-"+i,u=o.indexOf(c);u!==-1&&(o.splice(u,1),"available"!==a.status&&r(e,c))}),o.forEach(function(t){r(e,t)})}"function"==typeof e&&(n=e,e={});var i=Object.keys(t);if(!i.length)return n(null,{});var s=0,c=new a;i.map(function(e){this._getRevisionTree(e,function(r,a){if(r&&404===r.status&&"missing"===r.message)c.set(e,{missing:t[e]});else{if(r)return n(r);o(e,a)}if(++s===i.length){var u={};return c.forEach(function(t,e){u[e]=t}),n(null,u)}})},this)}),xt.prototype.bulkGet=y("bulkGet",function(t,e){b(this,t,e)}),xt.prototype.compactDocument=y("compactDocument",function(t,e,n){var r=this;this._getRevisionTree(t,function(o,i){if(o)return n(o);var s=bt(i),a=[],c=[];Object.keys(s).forEach(function(t){s[t]>e&&a.push(t)}),Y(i,function(t,e,n,r,o){var i=e+"-"+n;"available"===o.status&&a.indexOf(i)!==-1&&c.push(i)}),r._doCompaction(t,c,n)})}),xt.prototype.compact=y("compact",function(t,e){"function"==typeof t&&(e=t,t={});var n=this;t=t||{},n._compactionQueue=n._compactionQueue||[],n._compactionQueue.push({opts:t,callback:e}),1===n._compactionQueue.length&&kt(n)}),xt.prototype._compact=function(t,e){function n(t){s.push(o.compactDocument(t.id,0))}function r(t){var n=t.last_seq;Vr.all(s).then(function(){return M(o,"_local/compaction",function(t){return(!t.last_seq||t.last_seq<n)&&(t.last_seq=n,t)})}).then(function(){e(null,{ok:!0})})["catch"](e)}var o=this,i={return_docs:!1,last_seq:t.last_seq||0},s=[];o.changes(i).on("change",n).on("complete",r).on("error",e)},xt.prototype.get=y("get",function(t,e,n){function r(){var r=[],s=o.length;return s?void o.forEach(function(o){i.get(t,{rev:o,revs:e.revs,attachments:e.attachments},function(t,e){t?r.push({missing:o}):r.push({ok:e}),s--,s||n(null,r)})}):n(null,r)}if("function"==typeof e&&(n=e,e={}),"string"!=typeof t)return n(O(ro));if(ut(t)&&"function"==typeof this._getLocal)return this._getLocal(t,n);var o=[],i=this;if(!e.open_revs)return this._get(t,e,function(t,r){if(t)return n(t);var o=r.doc,s=r.metadata,a=r.ctx;if(e.conflicts){var c=K(s);c.length&&(o._conflicts=c)}if(ct(s,o._rev)&&(o._deleted=!0),e.revs||e.revs_info){var u=$(s.rev_tree),f=yt(u,function(t){return t.ids.map(function(t){return t.id}).indexOf(o._rev.split("-")[1])!==-1}),l=f.ids.map(function(t){return t.id}).indexOf(o._rev.split("-")[1])+1,h=f.ids.length-l;if(f.ids.splice(l,h),f.ids.reverse(),e.revs&&(o._revisions={start:f.pos+f.ids.length-1,ids:f.ids.map(function(t){return t.id})}),e.revs_info){var d=f.pos+f.ids.length;o._revs_info=f.ids.map(function(t){return d--,{rev:d+"-"+t.id,status:t.opts.status}})}}if(e.attachments&&o._attachments){var p=o._attachments,v=Object.keys(p).length;if(0===v)return n(null,o);Object.keys(p).forEach(function(t){this._getAttachment(o._id,t,p[t],{rev:o._rev,binary:e.binary,ctx:a},function(e,r){var i=o._attachments[t];i.data=r,delete i.stub,delete i.length,--v||n(null,o)})},i)}else{if(o._attachments)for(var y in o._attachments)o._attachments.hasOwnProperty(y)&&(o._attachments[y].stub=!0);n(null,o)}});if("all"===e.open_revs)this._getRevisionTree(t,function(t,e){return t?n(t):(o=V(e).map(function(t){return t.rev}),void r())});else{if(!Array.isArray(e.open_revs))return n(O(ao,"function_clause"));o=e.open_revs;for(var s=0;s<o.length;s++){var a=o[s];if("string"!=typeof a||!/^\d+-/.test(a))return n(O(yo))}r()}}),xt.prototype.getAttachment=y("getAttachment",function(t,e,n,r){var o=this;n instanceof Function&&(r=n,n={}),this._get(t,n,function(i,s){return i?r(i):s.doc._attachments&&s.doc._attachments[e]?(n.ctx=s.ctx,n.binary=!0,o._getAttachment(t,e,s.doc._attachments[e],n,r),void 0):r(O(eo))})}),xt.prototype.allDocs=y("allDocs",function(t,e){if("function"==typeof t&&(e=t,t={}),t.skip="undefined"!=typeof t.skip?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return e(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(e){return e in t})[0];if(n)return void e(O(uo,"Query parameter `"+n+"` is not compatible with multi-get"));if("http"!==this.type())return wt(this,t,e)}return this._allDocs(t,e)}),xt.prototype.changes=function(t,e){return"function"==typeof t&&(e=t,t={}),new dt(this,t,e)},xt.prototype.close=y("close",function(t){return this._closed=!0,this._close(t)}),xt.prototype.info=y("info",function(t){var e=this;this._info(function(n,r){return n?t(n):(r.db_name=r.db_name||e.name,r.auto_compaction=!(!e.auto_compaction||"http"===e.type()),r.adapter=e.type(),void t(null,r))})}),xt.prototype.id=y("id",function(t){return this._id(t)}),xt.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},xt.prototype.bulkDocs=y("bulkDocs",function(t,e,n){if("function"==typeof e&&(n=e,e={}),e=e||{},Array.isArray(t)&&(t={docs:t}),!t||!t.docs||!Array.isArray(t.docs))return n(O(to));for(var r=0;r<t.docs.length;++r)if("object"!=typeof t.docs[r]||Array.isArray(t.docs[r]))return n(O(ho));var o;return t.docs.forEach(function(t){t._attachments&&Object.keys(t._attachments).forEach(function(t){o=o||Et(t)})}),o?n(O(lo,o)):("new_edits"in e||("new_edits"in t?e.new_edits=t.new_edits:e.new_edits=!0),e.new_edits||"http"===this.type()||t.docs.sort(_t),mt(t.docs),this._bulkDocs(t,e,function(t,r){return t?n(t):(e.new_edits||(r=r.filter(function(t){return t.error})),void n(null,r))}))}),xt.prototype.registerDependentDatabase=y("registerDependentDatabase",function(t,e){function n(e){return e.dependentDbs=e.dependentDbs||{},!e.dependentDbs[t]&&(e.dependentDbs[t]=!0,e)}var r=new this.constructor(t,this.__opts);M(this,"_local/_pouch_dependentDbs",n).then(function(){e(null,{db:r})})["catch"](e)}),xt.prototype.destroy=y("destroy",function(t,e){function n(){r._destroy(t,function(t,n){return t?e(t):(r._destroyed=!0,r.emit("destroyed"),void e(null,n||{ok:!0}))})}"function"==typeof t&&(e=t,t={});var r=this,o=!("use_prefix"in r)||r.use_prefix;return"http"===r.type()?n():void r.get("_local/_pouch_dependentDbs",function(t,i){if(t)return 404!==t.status?e(t):n();var s=i.dependentDbs,a=r.constructor,c=Object.keys(s).map(function(t){var e=o?t.replace(new RegExp("^"+a.prefix),""):t;return new a(e,r.__opts).destroy()});Vr.all(c).then(n,e)})}),At.prototype.execute=function(){var t;if(this.failed)for(;t=this.queue.shift();)t(this.failed);else for(;t=this.queue.shift();)t()},At.prototype.fail=function(t){this.failed=t,this.execute()},At.prototype.ready=function(t){this.isReady=!0,this.db=t,this.execute()},At.prototype.addTask=function(t){this.queue.push(t),this.failed&&this.execute()},Ur(Tt,xt),Tt.debug=Nr,Tt.adapters={},Tt.preferredAdapters=[],Tt.prefix="_pouch_";var Eo=new Fr.EventEmitter;Ct(Tt),Tt.adapter=function(t,e,n){e.valid()&&(Tt.adapters[t]=e,n&&Tt.preferredAdapters.push(t))},Tt.plugin=function(t){if("function"==typeof t)t(Tt);else{if("object"!=typeof t||0===Object.keys(t).length)throw new Error("Invalid plugin: object passed in is empty or not an object");Object.keys(t).forEach(function(e){Tt.prototype[e]=t[e]})}return Tt},Tt.defaults=function(t){function e(n,r){return this instanceof e?(r=r||{},n&&"object"==typeof n&&(r=n,n=r.name,delete r.name),r=Pr.extend({},t,r),void Tt.call(this,n,r)):new e(n,r)}return Ur(e,Tt),e.preferredAdapters=Tt.preferredAdapters.slice(),Object.keys(Tt).forEach(function(t){t in e||(e[t]=Tt[t])}),e};var xo="6.0.5";Tt.version=xo;var Ao,So=Ot(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),jo=Ot(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),To=function(t){return atob(t)},Co=function(t){return btoa(t)},Oo=r.setImmediate||r.setTimeout,Ro=32768,Do=5,qo="document-store",Io="by-sequence",Bo="attach-store",Lo="attach-seq-store",Po="meta-store",No="local-store",Uo="detect-blob-support",Mo={running:!1,queue:[]},Fo=new a,Ho=new x,zo=new a;ke.valid=function(){var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return!t&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var Jo=7,Yo=Re("document-store"),Xo=Re("by-sequence"),Vo=Re("attach-store"),Ko=Re("local-store"),Wo=Re("metadata-store"),$o=Re("attach-seq-store"),Go=new a,Qo=new x,Zo=1,ti="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+Xo+" (seq, deleted)",ei="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+Xo+" (doc_id, rev)",ni="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+Yo+" (winningseq)",ri="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+$o+" (seq)",oi="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+$o+" (digest, seq)",ii=Xo+".seq = "+Yo+".winningseq",si=Xo+".seq AS seq, "+Xo+".deleted AS deleted, "+Xo+".json AS data, "+Xo+".rev AS rev, "+Yo+".json AS metadata";Ge.valid=We,Ge.use_prefix=!0;var ai=nn(),ci=function(){},ui=25,fi=50,li={},hi=Nr("pouchdb:http");yn.valid=function(){return!0};var di=-324,pi=3,vi="";Dn.prototype.add=function(t){return this.promise=this.promise["catch"](function(){}).then(function(){return t()}),this.promise},Dn.prototype.finish=function(){return this.promise},Ur(In,Error),Ur(Bn,Error),Ur(Ln,Error);var yi=A.bind(null,"log"),gi=Array.isArray,mi=JSON.parse,_i=function(t,n){return n&&t.then(function(t){e.nextTick(function(){n(null,t)})},function(t){e.nextTick(function(){n(t)})}),t},bi=function(t){return Hr(function(e){var n=e.pop(),r=t.apply(this,e);return"function"==typeof n&&_i(r,n),r})},wi=function(t,e){return t.then(function(t){return e().then(function(){return t})},function(t){return e().then(function(){throw t})})},ki=function(t,e){return function(){var n=arguments,r=this;return t.add(function(){return e.apply(r,n)})}},Ei=function(t){for(var e={},n=0,r=t.length;n<r;n++)e["$"+t[n]]=!0;var o=Object.keys(e),i=new Array(o.length);for(n=0,r=o.length;n<r;n++)i[n]=o[n].substring(1);return i},xi={},Ai=new Dn,Si=50,ji={_sum:function(t,e){return Nn(e)},_count:function(t,e){return e.length},_stats:function(t,e){function n(t){for(var e=0,n=0,r=t.length;n<r;n++){var o=t[n];e+=o*o}return e}return{sum:Nn(e),min:Math.min.apply(null,e),max:Math.max.apply(null,e),count:e.length,sumsqr:n(e)}}},Ti=bi(function(){var t=this;return"http"===t.type()?hr(t):"function"==typeof t._viewCleanup?nr(t):dr(t)}),Ci=function(t,e,n){"function"==typeof e&&(n=e,e={}),e=e?Gn(e):{},"function"==typeof t&&(t={map:t});var r=this,o=Vr.resolve().then(function(){return pr(r,t,e)});return _i(o,n),o},Oi={query:Ci,viewCleanup:Ti},Ri=1,Di="pouchdb",qi=5,Ii=0;kr.prototype.writeCheckpoint=function(t,e){var n=this;return this.updateTarget(t,e).then(function(){return n.updateSource(t,e)})},kr.prototype.updateTarget=function(t,e){return wr(this.target,this.id,t,e,this.returnValue)},kr.prototype.updateSource=function(t,e){var n=this;return this.readOnlySource?Vr.resolve(!0):wr(this.src,this.id,t,e,this.returnValue)["catch"](function(t){if(Sr(t))return n.readOnlySource=!0,!0;throw t})};var Bi={undefined:function(t,e){return 0===bn(t.last_seq,e.last_seq)?e.last_seq:0},1:function(t,e){return Er(e,t).last_seq}};kr.prototype.getCheckpoint=function(){var t=this;return t.target.get(t.id).then(function(e){return t.readOnlySource?Vr.resolve(e.last_seq):t.src.get(t.id).then(function(t){if(e.version!==t.version)return Ii;var n;return n=e.version?e.version.toString():"undefined",n in Bi?Bi[n](e,t):Ii},function(n){if(404===n.status&&e.last_seq)return t.src.put({_id:t.id,last_seq:Ii}).then(function(){return Ii},function(n){return Sr(n)?(t.readOnlySource=!0,e.last_seq):Ii});throw n})})["catch"](function(t){if(404!==t.status)throw t;return Ii})};var Li=0;Ur(Rr,Fr.EventEmitter),Rr.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Rr.prototype.ready=function(t,e){function n(){o.cancel()}function r(){t.removeListener("destroyed",n),e.removeListener("destroyed",n)}var o=this;o._readyCalled||(o._readyCalled=!0,t.once("destroyed",n),e.once("destroyed",n),o.once("complete",r))},Ur(Br,Fr.EventEmitter),Br.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},Tt.plugin(Ae).plugin(Qe).plugin(gn).plugin(Oi).plugin(Lr),t.exports=Tt}).call(e,n(1),function(){return this}())},function(t,e,n){(function(t){t(e)}).call(this,function(t){var e=Array.prototype.slice,n=Array.prototype.forEach,r=function(t){if("object"!=typeof t)throw t+" is not an object";var o=e.call(arguments,1);return n.call(o,function(e){if(e)for(var n in e)"object"==typeof e[n]&&t[n]?r.call(t,t[n],e[n]):t[n]=e[n]}),t};t.extend=r})},function(t,e,n){function r(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31;
}function o(){var t=arguments,n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return t;var r="color: "+this.color;t=[t[0],r,"color: inherit"].concat(Array.prototype.slice.call(t,1));var o=0,i=0;return t[0].replace(/%[a-z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(i=o))}),t.splice(i,0,r),t}function i(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(n){}}function a(){var t;try{t=e.storage.debug}catch(n){}return t}function c(){try{return window.localStorage}catch(t){}}e=t.exports=n(6),e.log=i,e.formatArgs=o,e.save=s,e.load=a,e.useColors=r,e.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){return JSON.stringify(t)},e.enable(a())},function(t,e,n){function r(){return e.colors[f++%e.colors.length]}function o(t){function n(){}function o(){var t=o,n=+new Date,i=n-(u||n);t.diff=i,t.prev=u,t.curr=n,u=n,null==t.useColors&&(t.useColors=e.useColors()),null==t.color&&t.useColors&&(t.color=r());var s=Array.prototype.slice.call(arguments);s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var a=0;s[0]=s[0].replace(/%([a-z%])/g,function(n,r){if("%%"===n)return n;a++;var o=e.formatters[r];if("function"==typeof o){var i=s[a];n=o.call(t,i),s.splice(a,1),a--}return n}),"function"==typeof e.formatArgs&&(s=e.formatArgs.apply(t,s));var c=o.log||e.log||console.log.bind(console);c.apply(t,s)}n.enabled=!1,o.enabled=!0;var i=e.enabled(t)?o:n;return i.namespace=t,i}function i(t){e.save(t);for(var n=(t||"").split(/[\s,]+/),r=n.length,o=0;o<r;o++)n[o]&&(t=n[o].replace(/\*/g,".*?"),"-"===t[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function s(){e.enable("")}function a(t){var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1}function c(t){return t instanceof Error?t.stack||t.message:t}e=t.exports=o,e.coerce=c,e.disable=s,e.enable=i,e.enabled=a,e.humanize=n(7),e.names=[],e.skips=[],e.formatters={};var u,f=0},function(t,e){function n(t){if(t=""+t,!(t.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*f;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}function r(t){return t>=u?Math.round(t/u)+"d":t>=c?Math.round(t/c)+"h":t>=a?Math.round(t/a)+"m":t>=s?Math.round(t/s)+"s":t+"ms"}function o(t){return i(t,u,"day")||i(t,c,"hour")||i(t,a,"minute")||i(t,s,"second")||t+" ms"}function i(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var s=1e3,a=60*s,c=60*a,u=24*c,f=365.25*u;t.exports=function(t,e){return e=e||{},"string"==typeof t?n(t):e["long"]?o(t):r(t)}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e,n){"use strict";function r(){}function o(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,t!==r&&c(this,t)}function i(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function s(t,e,n){p(function(){var r;try{r=e(n)}catch(o){return v.reject(t,o)}r===t?v.reject(t,new TypeError("Cannot resolve promise with itself")):v.resolve(t,r)})}function a(t){var e=t&&t.then;if(t&&"object"==typeof t&&"function"==typeof e)return function(){e.apply(t,arguments)}}function c(t,e){function n(e){i||(i=!0,v.reject(t,e))}function r(e){i||(i=!0,v.resolve(t,e))}function o(){e(r,n)}var i=!1,s=u(o);"error"===s.status&&n(s.value)}function u(t,e){var n={};try{n.value=t(e),n.status="success"}catch(r){n.status="error",n.value=r}return n}function f(t){return t instanceof this?t:v.resolve(new this(r),t)}function l(t){var e=new this(r);return v.reject(e,t)}function h(t){function e(t,e){function r(t){s[e]=t,++a!==o||i||(i=!0,v.resolve(u,s))}n.resolve(t).then(r,function(t){i||(i=!0,v.reject(u,t))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var o=t.length,i=!1;if(!o)return this.resolve([]);for(var s=new Array(o),a=0,c=-1,u=new this(r);++c<o;)e(t[c],c);return u}function d(t){function e(t){n.resolve(t).then(function(t){i||(i=!0,v.resolve(a,t))},function(t){i||(i=!0,v.reject(a,t))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var o=t.length,i=!1;if(!o)return this.resolve([]);for(var s=-1,a=new this(r);++s<o;)e(t[s]);return a}var p=n(10),v={},y=["REJECTED"],g=["FULFILLED"],m=["PENDING"];t.exports=o,o.prototype["catch"]=function(t){return this.then(null,t)},o.prototype.then=function(t,e){if("function"!=typeof t&&this.state===g||"function"!=typeof e&&this.state===y)return this;var n=new this.constructor(r);if(this.state!==m){var o=this.state===g?t:e;s(n,o,this.outcome)}else this.queue.push(new i(n,t,e));return n},i.prototype.callFulfilled=function(t){v.resolve(this.promise,t)},i.prototype.otherCallFulfilled=function(t){s(this.promise,this.onFulfilled,t)},i.prototype.callRejected=function(t){v.reject(this.promise,t)},i.prototype.otherCallRejected=function(t){s(this.promise,this.onRejected,t)},v.resolve=function(t,e){var n=u(a,e);if("error"===n.status)return v.reject(t,n.value);var r=n.value;if(r)c(t,r);else{t.state=g,t.outcome=e;for(var o=-1,i=t.queue.length;++o<i;)t.queue[o].callFulfilled(e)}return t},v.reject=function(t,e){t.state=y,t.outcome=e;for(var n=-1,r=t.queue.length;++n<r;)t.queue[n].callRejected(e);return t},o.resolve=f,o.reject=l,o.all=h,o.race=d},function(t,e){(function(e){"use strict";function n(){f=!0;for(var t,e,n=l.length;n;){for(e=l,l=[],t=-1;++t<n;)e[t]();n=l.length}f=!1}function r(t){1!==l.push(t)||f||o()}var o,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var s=0,a=new i(n),c=e.document.createTextNode("");a.observe(c,{characterData:!0}),o=function(){c.data=s=++s%2}}else if(e.setImmediate||"undefined"==typeof e.MessageChannel)o="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};else{var u=new e.MessageChannel;u.port1.onmessage=n,o=function(){u.port2.postMessage(0)}}var f,l=[];t.exports=r}).call(e,function(){return this}())},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function o(t){return"number"==typeof t}function i(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!o(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,o,a,c,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var f=new Error('Uncaught, unspecified "error" event. ('+e+")");throw f.context=e,f}if(n=this._events[t],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(i(n))for(a=Array.prototype.slice.call(arguments,1),u=n.slice(),o=u.length,c=0;c<o;c++)u[c].apply(this,a);return!0},n.prototype.addListener=function(t,e){var o;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(o=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[t].length>o&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),o||(o=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var o=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,o,s,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],s=n.length,o=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(n)){for(a=s;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){o=a;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e){"use strict";function n(t){return function(){var e=arguments.length;if(e){for(var n=[],r=-1;++r<e;)n[r]=arguments[r];return t.call(this,n)}return t.call(this,[])}}t.exports=n},function(t,e){(function(){var e={}.hasOwnProperty,n=[].slice;t.exports=function(t,r){var o,i,s,a;i=[],a=[];for(o in r)e.call(r,o)&&(s=r[o],"this"!==o&&(i.push(o),a.push(s)));return Function.apply(null,n.call(i).concat([t])).apply(r["this"],a)}}).call(this)},function(t,e,n){!function(e){t.exports=e()}(function(t){"use strict";function e(t,e,n,r,o,i){return e=_(_(e,t),_(r,i)),_(e<<o|e>>>32-o,n)}function n(t,n,r,o,i,s,a){return e(n&r|~n&o,t,n,i,s,a)}function r(t,n,r,o,i,s,a){return e(n&o|r&~o,t,n,i,s,a)}function o(t,n,r,o,i,s,a){return e(n^r^o,t,n,i,s,a)}function i(t,n,r,o,i,s,a){return e(r^(n|~o),t,n,i,s,a)}function s(t,e){var s=t[0],a=t[1],c=t[2],u=t[3];s=n(s,a,c,u,e[0],7,-680876936),u=n(u,s,a,c,e[1],12,-389564586),c=n(c,u,s,a,e[2],17,606105819),a=n(a,c,u,s,e[3],22,-1044525330),s=n(s,a,c,u,e[4],7,-176418897),u=n(u,s,a,c,e[5],12,1200080426),c=n(c,u,s,a,e[6],17,-1473231341),a=n(a,c,u,s,e[7],22,-45705983),s=n(s,a,c,u,e[8],7,1770035416),u=n(u,s,a,c,e[9],12,-1958414417),c=n(c,u,s,a,e[10],17,-42063),a=n(a,c,u,s,e[11],22,-1990404162),s=n(s,a,c,u,e[12],7,1804603682),u=n(u,s,a,c,e[13],12,-40341101),c=n(c,u,s,a,e[14],17,-1502002290),a=n(a,c,u,s,e[15],22,1236535329),s=r(s,a,c,u,e[1],5,-165796510),u=r(u,s,a,c,e[6],9,-1069501632),c=r(c,u,s,a,e[11],14,643717713),a=r(a,c,u,s,e[0],20,-373897302),s=r(s,a,c,u,e[5],5,-701558691),u=r(u,s,a,c,e[10],9,38016083),c=r(c,u,s,a,e[15],14,-660478335),a=r(a,c,u,s,e[4],20,-405537848),s=r(s,a,c,u,e[9],5,568446438),u=r(u,s,a,c,e[14],9,-1019803690),c=r(c,u,s,a,e[3],14,-187363961),a=r(a,c,u,s,e[8],20,1163531501),s=r(s,a,c,u,e[13],5,-1444681467),u=r(u,s,a,c,e[2],9,-51403784),c=r(c,u,s,a,e[7],14,1735328473),a=r(a,c,u,s,e[12],20,-1926607734),s=o(s,a,c,u,e[5],4,-378558),u=o(u,s,a,c,e[8],11,-2022574463),c=o(c,u,s,a,e[11],16,1839030562),a=o(a,c,u,s,e[14],23,-35309556),s=o(s,a,c,u,e[1],4,-1530992060),u=o(u,s,a,c,e[4],11,1272893353),c=o(c,u,s,a,e[7],16,-155497632),a=o(a,c,u,s,e[10],23,-1094730640),s=o(s,a,c,u,e[13],4,681279174),u=o(u,s,a,c,e[0],11,-358537222),c=o(c,u,s,a,e[3],16,-722521979),a=o(a,c,u,s,e[6],23,76029189),s=o(s,a,c,u,e[9],4,-640364487),u=o(u,s,a,c,e[12],11,-421815835),c=o(c,u,s,a,e[15],16,530742520),a=o(a,c,u,s,e[2],23,-995338651),s=i(s,a,c,u,e[0],6,-198630844),u=i(u,s,a,c,e[7],10,1126891415),c=i(c,u,s,a,e[14],15,-1416354905),a=i(a,c,u,s,e[5],21,-57434055),s=i(s,a,c,u,e[12],6,1700485571),u=i(u,s,a,c,e[3],10,-1894986606),c=i(c,u,s,a,e[10],15,-1051523),a=i(a,c,u,s,e[1],21,-2054922799),s=i(s,a,c,u,e[8],6,1873313359),u=i(u,s,a,c,e[15],10,-30611744),c=i(c,u,s,a,e[6],15,-1560198380),a=i(a,c,u,s,e[13],21,1309151649),s=i(s,a,c,u,e[4],6,-145523070),u=i(u,s,a,c,e[11],10,-1120210379),c=i(c,u,s,a,e[2],15,718787259),a=i(a,c,u,s,e[9],21,-343485551),t[0]=_(s,t[0]),t[1]=_(a,t[1]),t[2]=_(c,t[2]),t[3]=_(u,t[3])}function a(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}function c(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return n}function u(t){var e,n,r,o,i,c,u=t.length,f=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=u;e+=64)s(f,a(t.substring(e-64,e)));for(t=t.substring(e-64),n=t.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)r[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(s(f,r),e=0;e<16;e+=1)r[e]=0;return o=8*u,o=o.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(o[2],16),c=parseInt(o[1],16)||0,r[14]=i,r[15]=c,s(f,r),f}function f(t){var e,n,r,o,i,a,u=t.length,f=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=u;e+=64)s(f,c(t.subarray(e-64,e)));for(t=e-64<u?t.subarray(e-64):new Uint8Array(0),n=t.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)r[e>>2]|=t[e]<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(s(f,r),e=0;e<16;e+=1)r[e]=0;return o=8*u,o=o.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(o[2],16),a=parseInt(o[1],16)||0,r[14]=i,r[15]=a,s(f,r),f}function l(t){var e,n="";for(e=0;e<4;e+=1)n+=b[t>>8*e+4&15]+b[t>>8*e&15];return n}function h(t){var e;for(e=0;e<t.length;e+=1)t[e]=l(t[e]);return t.join("")}function d(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function p(t,e){var n,r=t.length,o=new ArrayBuffer(r),i=new Uint8Array(o);for(n=0;n<r;n+=1)i[n]=t.charCodeAt(n);return e?i:o}function v(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function y(t,e,n){var r=new Uint8Array(t.byteLength+e.byteLength);return r.set(new Uint8Array(t)),r.set(new Uint8Array(e),t.byteLength),n?r:r.buffer}function g(t){var e,n=[],r=t.length;for(e=0;e<r-1;e+=2)n.push(parseInt(t.substr(e,2),16));return String.fromCharCode.apply(String,n)}function m(){this.reset()}var _=function(t,e){return t+e&4294967295},b=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==h(u("hello"))&&(_=function(t,e){var n=(65535&t)+(65535&e),r=(t>>16)+(e>>16)+(n>>16);return r<<16|65535&n}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function e(t,e){return t=0|t||0,t<0?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice=function(n,r){var o,i,s,a,c=this.byteLength,u=e(n,c),f=c;return r!==t&&(f=e(r,c)),u>f?new ArrayBuffer(0):(o=f-u,i=new ArrayBuffer(o),s=new Uint8Array(i),a=new Uint8Array(this,u,o),s.set(a),i)}}(),m.prototype.append=function(t){return this.appendBinary(d(t)),this},m.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var e,n=this._buff.length;for(e=64;e<=n;e+=64)s(this._hash,a(this._buff.substring(e-64,e)));return this._buff=this._buff.substring(e-64),this},m.prototype.end=function(t){var e,n,r=this._buff,o=r.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<o;e+=1)i[e>>2]|=r.charCodeAt(e)<<(e%4<<3);return this._finish(i,o),n=h(this._hash),t&&(n=g(n)),this.reset(),n},m.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},m.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},m.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},m.prototype._finish=function(t,e){var n,r,o,i=e;if(t[i>>2]|=128<<(i%4<<3),i>55)for(s(this._hash,t),i=0;i<16;i+=1)t[i]=0;n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(n[2],16),o=parseInt(n[1],16)||0,t[14]=r,t[15]=o,s(this._hash,t)},m.hash=function(t,e){return m.hashBinary(d(t),e)},m.hashBinary=function(t,e){var n=u(t),r=h(n);return e?g(r):r},m.ArrayBuffer=function(){this.reset()},m.ArrayBuffer.prototype.append=function(t){var e,n=y(this._buff.buffer,t,!0),r=n.length;for(this._length+=t.byteLength,e=64;e<=r;e+=64)s(this._hash,c(n.subarray(e-64,e)));return this._buff=e-64<r?new Uint8Array(n.buffer.slice(e-64)):new Uint8Array(0),this},m.ArrayBuffer.prototype.end=function(t){var e,n,r=this._buff,o=r.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<o;e+=1)i[e>>2]|=r[e]<<(e%4<<3);return this._finish(i,o),n=h(this._hash),t&&(n=g(n)),this.reset(),n},m.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.ArrayBuffer.prototype.getState=function(){var t=m.prototype.getState.call(this);return t.buff=v(t.buff),t},m.ArrayBuffer.prototype.setState=function(t){return t.buff=p(t.buff,!0),m.prototype.setState.call(this,t)},m.ArrayBuffer.prototype.destroy=m.prototype.destroy,m.ArrayBuffer.prototype._finish=m.prototype._finish,m.ArrayBuffer.hash=function(t,e){var n=f(new Uint8Array(t)),r=h(n);return e?g(r):r},m})},function(t,e){"use strict";function n(t,e,n){var r=n[n.length-1];t===r.element&&(n.pop(),r=n[n.length-1]);var o=r.element,i=r.index;if(Array.isArray(o))o.push(t);else if(i===e.length-2){var s=e.pop();o[s]=t}else e.push(t)}e.stringify=function(t){var e=[];e.push({obj:t});for(var n,r,o,i,s,a,c,u,f,l,h,d="";n=e.pop();)if(r=n.obj,o=n.prefix||"",i=n.val||"",d+=o,i)d+=i;else if("object"!=typeof r)d+="undefined"==typeof r?null:JSON.stringify(r);else if(null===r)d+="null";else if(Array.isArray(r)){for(e.push({val:"]"}),s=r.length-1;s>=0;s--)a=0===s?"":",",e.push({obj:r[s],prefix:a});e.push({val:"["})}else{c=[];for(u in r)r.hasOwnProperty(u)&&c.push(u);for(e.push({val:"}"}),s=c.length-1;s>=0;s--)f=c[s],l=r[f],h=s>0?",":"",h+=JSON.stringify(f)+":",e.push({obj:l,prefix:h});e.push({val:"{"})}return d},e.parse=function(t){for(var e,r,o,i,s,a,c,u,f,l=[],h=[],d=0;;)if(e=t[d++],"}"!==e&&"]"!==e&&"undefined"!=typeof e)switch(e){case" ":case"\t":case"\n":case":":case",":break;case"n":d+=3,n(null,l,h);break;case"t":d+=3,n(!0,l,h);break;case"f":d+=4,n(!1,l,h);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(r="",d--;;){if(o=t[d++],!/[\d\.\-e\+]/.test(o)){d--;break}r+=o}n(parseFloat(r),l,h);break;case'"':for(i="",s=void 0,a=0;;){if(c=t[d++],'"'===c&&("\\"!==s||a%2!==1))break;i+=c,s=c,"\\"===s?a++:a=0}n(JSON.parse('"'+i+'"'),l,h);break;case"[":u={element:[],index:l.length},l.push(u.element),h.push(u);break;case"{":f={element:{},index:l.length},l.push(f.element),h.push(f);break;default:throw new Error("unexpectedly reached end of input: "+e)}else{if(1===l.length)return l.pop();n(l.pop(),l,h)}}},function(t,e,n){var r,o,i;!function(n,s){o=[],r=s,i="function"==typeof r?r.apply(e,o):r,!(void 0!==i&&(t.exports=i))}(this,function(){"use strict";var t=function(){this._listeners={}};t.prototype.addEventListener=function(t,e){this._listeners[t]=this._listeners[t]||[],this._listeners[t].indexOf(e)<0&&this._listeners[t].push(e)},t.prototype.removeEventListener=function(t,e){if(this._listeners[t]){var n=this._listeners[t].indexOf(e);n>=0&&this._listeners[t].splice(n,1)}},t.prototype.dispatchEvent=function(t){if(this._listeners[t.type]&&this._listeners[t.type].length)for(var e=this._listeners[t.type].slice(),n=0,r=e.length;n<r;++n)e[n].call(this,t)};var e=function(t){return"function"==typeof t.constructor&&"GeneratorFunction"===t.constructor.name},n=function(t){return{next:function(){var e=t();return e?{value:e}:{done:!0}}}},r=function(t){var e=!1;return{next:function(){return e?{done:!0}:(e=!0,{value:t})}}},o=function(t,o){var i=typeof t;if("object"===i){if("function"==typeof t.next)return t;if("function"==typeof t.then)return r(t)}return"function"===i?e(t)?t():n(t):r(o.resolve(t))},i=function(t,e,n){this.target=t,this.type=e,this.data=n},s=function(e,n,r){if(t.call(this),"number"!=typeof n||Math.floor(n)!==n||n<1)throw new Error("Invalid concurrency");this._concurrency=n,this._options=r||{},this._options.promise=this._options.promise||Promise,this._iterator=o(e,this._options.promise),this._done=!1,this._size=0,this._promise=null,this._callbacks=null};return s.prototype=new t,s.prototype.constructor=s,s.prototype.concurrency=function(t){return"undefined"!=typeof t&&(this._concurrency=t,this.active()&&this._proceed()),this._concurrency},s.prototype.size=function(){return this._size},s.prototype.active=function(){return!!this._promise},s.prototype.promise=function(){return this._promise},s.prototype.start=function(){var t=this,e=this._options.promise;return this._promise=new e(function(e,n){t._callbacks={reject:n,resolve:e},t._proceed()}),this._promise},s.prototype._fireEvent=function(t,e){this.dispatchEvent(new i(this,t,e))},s.prototype._settle=function(t){t?this._callbacks.reject(t):this._callbacks.resolve(),this._promise=null,this._callbacks=null},s.prototype._onPooledPromiseFulfilled=function(t,e){this._size--,this.active()&&(this._fireEvent("fulfilled",{promise:t,result:e}),this._proceed())},s.prototype._onPooledPromiseRejected=function(t,e){this._size--,this.active()&&(this._fireEvent("rejected",{promise:t,error:e}),this._settle(e||new Error("Unknown error")))},s.prototype._trackPromise=function(t){var e=this;t.then(function(n){e._onPooledPromiseFulfilled(t,n)},function(n){e._onPooledPromiseRejected(t,n)})["catch"](function(t){e._settle(new Error("Promise processing failed: "+t))})},s.prototype._proceed=function(){if(!this._done){for(var t=null;this._size<this._concurrency&&!(t=this._iterator.next()).done;)this._size++,this._trackPromise(t.value);this._done=null===t||!!t.done}this._done&&0===this._size&&this._settle()},s.PromisePoolEvent=i,s.PromisePool=s,s})},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(18),i=r(o),s=n(23),a=r(s),c={apiEndpoint:null,apiKey:null,appId:null,UDID:null,authenticationToken:null,tokenUpdateCallback:function(t){}};c.call=function(t,e){var n=this,r=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2],o=arguments[3];this.apiEndpoint||r(new Error("No API endpoint set - run Telepat.configure or Telepat.connect first"),null);var s;s="get"===o?i["default"].get(this.apiEndpoint+t+"?"+e):"delete"===o?i["default"].del(this.apiEndpoint+t):i["default"].post(this.apiEndpoint+t),"get"!==o&&s.send(e),s.set("Content-Type","application/json").set("X-BLGREQ-SIGN",(0,a["default"])(this.apiKey)).set("X-BLGREQ-APPID",this.appId).set("X-BLGREQ-UDID",this.UDID||"TP_EMPTY_UDID"),this.authenticationToken&&s.set("Authorization","Bearer "+this.authenticationToken),s.end(function(i,s){n.needsTokenUpdate(s)?n.updateToken(function(i,s){i?r(i,null):n.call(t,e,r,o)}):r(i,s)})},c.needsTokenUpdate=function(t){return this.authenticationToken&&401===t.status},c.updateToken=function(t){var e=this;this.get("user/refresh_token","",function(n,r){n?t(n,null):(e.authenticationToken=r.body.content.token,e.tokenUpdateCallback(e.authenticationToken),t(null,r))})},c.get=function(t,e,n){return this.call(t,e,n,"get")},c.del=function(t,e,n){return this.call(t,e,n,"delete")},e["default"]=c,t.exports=e["default"]},function(t,e,n){function r(){}function o(t){if(!g(t))return t;var e=[];for(var n in t)i(e,n,t[n]);return e.join("&")}function i(t,e,n){if(null!=n)if(Array.isArray(n))n.forEach(function(n){i(t,e,n)});else if(g(n))for(var r in n)i(t,e+"["+r+"]",n[r]);else t.push(encodeURIComponent(e)+"="+encodeURIComponent(n));else null===n&&t.push(encodeURIComponent(e))}function s(t){for(var e,n,r={},o=t.split("&"),i=0,s=o.length;i<s;++i)e=o[i],n=e.indexOf("="),n==-1?r[decodeURIComponent(e)]="":r[decodeURIComponent(e.slice(0,n))]=decodeURIComponent(e.slice(n+1));return r}function a(t){var e,n,r,o,i=t.split(/\r?\n/),s={};i.pop();for(var a=0,c=i.length;a<c;++a)n=i[a],e=n.indexOf(":"),r=n.slice(0,e).toLowerCase(),o=_(n.slice(e+1)),s[r]=o;return s}function c(t){return/[\/+]json\b/.test(t)}function u(t){return t.split(/ *; */).shift()}function f(t){return t.split(/ *; */).reduce(function(t,e){var n=e.split(/ *= */),r=n.shift(),o=n.shift();return r&&o&&(t[r]=o),t},{})}function l(t,e){e=e||{},this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this._setStatusProperties(this.xhr.status),this.header=this.headers=a(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function h(t,e){var n=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",function(){var t=null,e=null;try{e=new l(n)}catch(r){return t=new Error("Parser is unable to parse the response"),t.parse=!0,t.original=r,t.rawResponse=n.xhr&&n.xhr.responseText?n.xhr.responseText:null,t.statusCode=n.xhr&&n.xhr.status?n.xhr.status:null,n.callback(t)}n.emit("response",e);var o;try{(e.status<200||e.status>=300)&&(o=new Error(e.statusText||"Unsuccessful HTTP response"),o.original=t,o.response=e,o.status=e.status)}catch(r){o=r}o?n.callback(o,e):n.callback(null,e)})}function d(t,e){var n=m("DELETE",t);return e&&n.end(e),n}var p;"undefined"!=typeof window?p=window:"undefined"!=typeof self?p=self:(console.warn("Using browser-only version of superagent in non-browser environment"),p=this);var v=n(19),y=n(20),g=n(21),m=t.exports=n(22).bind(null,h);m.getXHR=function(){if(!(!p.XMLHttpRequest||p.location&&"file:"==p.location.protocol&&p.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw Error("Browser-only verison of superagent could not find XHR")};var _="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};m.serializeObject=o,m.parseString=s,m.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},m.serialize={"application/x-www-form-urlencoded":o,"application/json":JSON.stringify},m.parse={"application/x-www-form-urlencoded":s,"application/json":JSON.parse},l.prototype.get=function(t){return this.header[t.toLowerCase()]},l.prototype._setHeaderProperties=function(t){var e=this.header["content-type"]||"";this.type=u(e);var n=f(e);for(var r in n)this[r]=n[r]},l.prototype._parseBody=function(t){var e=m.parse[this.type];return!e&&c(this.type)&&(e=m.parse["application/json"]),e&&t&&(t.length||t instanceof Object)?e(t):null},l.prototype._setStatusProperties=function(t){1223===t&&(t=204);var e=t/100|0;this.status=this.statusCode=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.clientError=4==e,this.serverError=5==e,this.error=(4==e||5==e)&&this.toError(),this.accepted=202==t,this.noContent=204==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.notFound=404==t,this.forbidden=403==t},l.prototype.toError=function(){var t=this.req,e=t.method,n=t.url,r="cannot "+e+" "+n+" ("+this.status+")",o=new Error(r);return o.status=this.status,o.method=e,o.url=n,o},m.Response=l,v(h.prototype);for(var b in y)h.prototype[b]=y[b];h.prototype.type=function(t){return this.set("Content-Type",m.types[t]||t),this},h.prototype.responseType=function(t){return this._responseType=t,this},h.prototype.accept=function(t){return this.set("Accept",m.types[t]||t),this},h.prototype.auth=function(t,e,n){switch(n||(n={type:"basic"}),n.type){case"basic":var r=btoa(t+":"+e);this.set("Authorization","Basic "+r);break;case"auto":this.username=t,this.password=e}return this},h.prototype.query=function(t){return"string"!=typeof t&&(t=o(t)),t&&this._query.push(t),this},h.prototype.attach=function(t,e,n){return this._getFormData().append(t,e,n||e.name),this},h.prototype._getFormData=function(){return this._formData||(this._formData=new p.FormData),this._formData},h.prototype.callback=function(t,e){var n=this._callback;this.clearTimeout(),n(t,e)},h.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},h.prototype._timeoutError=function(){var t=this._timeout,e=new Error("timeout of "+t+"ms exceeded");e.timeout=t,this.callback(e)},h.prototype._appendQueryString=function(){var t=this._query.join("&");t&&(this.url+=~this.url.indexOf("?")?"&"+t:"?"+t)},h.prototype.end=function(t){var e=this,n=this.xhr=m.getXHR(),o=this._timeout,i=this._formData||this._data;this._callback=t||r,n.onreadystatechange=function(){if(4==n.readyState){var t;try{t=n.status}catch(r){t=0}if(0==t){if(e.timedout)return e._timeoutError();if(e._aborted)return;return e.crossDomainError()}e.emit("end")}};var s=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),t.direction="download",e.emit("progress",t)};this.hasListeners("progress")&&(n.onprogress=s);try{n.upload&&this.hasListeners("progress")&&(n.upload.onprogress=s)}catch(a){}if(o&&!this._timer&&(this._timer=setTimeout(function(){e.timedout=!0,e.abort()},o)),this._appendQueryString(),this.username&&this.password?n.open(this.method,this.url,!0,this.username,this.password):n.open(this.method,this.url,!0),this._withCredentials&&(n.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof i&&!this._isHost(i)){var u=this._header["content-type"],f=this._serializer||m.serialize[u?u.split(";")[0]:""];!f&&c(u)&&(f=m.serialize["application/json"]),f&&(i=f(i))}for(var l in this.header)null!=this.header[l]&&n.setRequestHeader(l,this.header[l]);return this._responseType&&(n.responseType=this._responseType),this.emit("request",this),n.send("undefined"!=typeof i?i:null),this},m.Request=h,m.get=function(t,e,n){var r=m("GET",t);return"function"==typeof e&&(n=e,
e=null),e&&r.query(e),n&&r.end(n),r},m.head=function(t,e,n){var r=m("HEAD",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},m.options=function(t,e,n){var r=m("OPTIONS",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},m.del=d,m["delete"]=d,m.patch=function(t,e,n){var r=m("PATCH",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},m.post=function(t,e,n){var r=m("POST",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},m.put=function(t,e,n){var r=m("PUT",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r}},function(t,e,n){function r(t){if(t)return o(t)}function o(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r,o=0;o<n.length;o++)if(r=n[o],r===e||r.fn===e){n.splice(o,1);break}return this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n){n=n.slice(0);for(var r=0,o=n.length;r<o;++r)n[r].apply(this,e)}return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,n){var r=n(21);e.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},e.parse=function(t){return this._parser=t,this},e.serialize=function(t){return this._serializer=t,this},e.timeout=function(t){return this._timeout=t,this},e.then=function(t,e){if(!this._fullfilledPromise){var n=this;this._fullfilledPromise=new Promise(function(t,e){n.end(function(n,r){n?e(n):t(r)})})}return this._fullfilledPromise.then(t,e)},e.use=function(t){return t(this),this},e.get=function(t){return this._header[t.toLowerCase()]},e.getHeader=e.get,e.set=function(t,e){if(r(t)){for(var n in t)this.set(n,t[n]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},e.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},e.field=function(t,e){return this._getFormData().append(t,e),this},e.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},e.withCredentials=function(){return this._withCredentials=!0,this},e.redirects=function(t){return this._maxRedirects=t,this},e.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},e._isHost=function(t){var e={}.toString.call(t);switch(e){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}},e.send=function(t){var e=r(t),n=this._header["content-type"];if(e&&r(this._data))for(var o in t)this._data[o]=t[o];else"string"==typeof t?(n||this.type("form"),n=this._header["content-type"],"application/x-www-form-urlencoded"==n?this._data=this._data?this._data+"&"+t:t:this._data=(this._data||"")+t):this._data=t;return!e||this._isHost(t)?this:(n||this.type("json"),this)}},function(t,e){function n(t){return null!==t&&"object"==typeof t}t.exports=n},function(t,e){function n(t,e,n){return"function"==typeof n?new t("GET",e).end(n):2==arguments.length?new t("GET",e):new t(e,n)}t.exports=n},function(t,e,n){!function(r,o){t.exports=e=o(n(24))}(this,function(t){return function(e){var n=t,r=n.lib,o=r.WordArray,i=r.Hasher,s=n.algo,a=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(t){return 4294967296*(t-(0|t))|0}for(var r=2,o=0;o<64;)t(r)&&(o<8&&(a[o]=n(e.pow(r,.5))),c[o]=n(e.pow(r,1/3)),o++),r++}();var u=[],f=s.SHA256=i.extend({_doReset:function(){this._hash=new o.init(a.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],s=n[3],a=n[4],f=n[5],l=n[6],h=n[7],d=0;d<64;d++){if(d<16)u[d]=0|t[e+d];else{var p=u[d-15],v=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,y=u[d-2],g=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;u[d]=v+u[d-7]+g+u[d-16]}var m=a&f^~a&l,_=r&o^r&i^o&i,b=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),w=(a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25),k=h+w+m+c[d]+u[d],E=b+_;h=l,l=f,f=a,a=s+k|0,s=i,i=o,o=r,r=k+E|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+f|0,n[6]=n[6]+l|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[(o+64>>>9<<4)+14]=e.floor(r/4294967296),n[(o+64>>>9<<4)+15]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});n.SHA256=i._createHelper(f),n.HmacSHA256=i._createHmacHelper(f)}(Math),t.SHA256})},function(t,e,n){!function(n,r){t.exports=e=r()}(this,function(){var t=t||function(t,e){var n={},r=n.lib={},o=r.Base=function(){function t(){}return{extend:function(e){t.prototype=this;var n=new t;return e&&n.mixIn(e),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),i=r.WordArray=o.extend({init:function(t,n){t=this.words=t||[],n!=e?this.sigBytes=n:this.sigBytes=4*t.length},toString:function(t){return(t||a).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes,o=t.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var s=n[i>>>2]>>>24-i%4*8&255;e[r+i>>>2]|=s<<24-(r+i)%4*8}else for(var i=0;i<o;i+=4)e[r+i>>>2]=n[i>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=o.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n,r=[],o=function(e){var e=e,n=987654321,r=4294967295;return function(){n=36969*(65535&n)+(n>>16)&r,e=18e3*(65535&e)+(e>>16)&r;var o=(n<<16)+e&r;return o/=4294967296,o+=.5,o*(t.random()>.5?1:-1)}},s=0;s<e;s+=4){var a=o(4294967296*(n||t.random()));n=987654071*a(),r.push(4294967296*a()|0)}return new i.init(r,e)}}),s=n.enc={},a=s.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new i.init(n,e/2)}},c=s.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new i.init(n,e)}},u=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},f=r.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,r=n.words,o=n.sigBytes,s=this.blockSize,a=4*s,c=o/a;c=e?t.ceil(c):t.max((0|c)-this._minBufferSize,0);var u=c*s,f=t.min(4*u,o);if(u){for(var l=0;l<u;l+=s)this._doProcessBlock(r,l);var h=r.splice(0,u);n.sigBytes-=f}return new i.init(h,f)},clone:function(){var t=o.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),l=(r.Hasher=f.extend({cfg:o.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){t&&this._append(t);var e=this._doFinalize();return e},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new l.HMAC.init(t,n).finalize(e)}}}),n.algo={});return n}(Math);return t})},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(26),i=r(o),s=i["default"].methodFactory;i["default"].methodFactory=function(t,e){var n=s(t,e);return function(t){n("Telepat: "+t)}},i["default"].setLevel("warn"),e["default"]=i["default"],t.exports=e["default"]},function(t,e,n){var r,o;!function(i,s){"use strict";r=s,o="function"==typeof r?r.call(e,n,e,t):r,!(void 0!==o&&(t.exports=o))}(this,function(){"use strict";function t(t){return typeof console!==a&&(void 0!==console[t]?e(console,t):void 0!==console.log?e(console,"log"):s)}function e(t,e){var n=t[e];if("function"==typeof n.bind)return n.bind(t);try{return Function.prototype.bind.call(n,t)}catch(r){return function(){return Function.prototype.apply.apply(n,[t,arguments])}}}function n(t,e,n){return function(){typeof console!==a&&(r.call(this,e,n),this[t].apply(this,arguments))}}function r(t,e){for(var n=0;n<c.length;n++){var r=c[n];this[r]=n<t?s:this.methodFactory(r,t,e)}}function o(e,r,o){return t(e)||n.apply(this,arguments)}function i(t,e,n){function i(t){var e=(c[t]||"silent").toUpperCase();try{return void(window.localStorage[l]=e)}catch(n){}try{window.document.cookie=encodeURIComponent(l)+"="+e+";"}catch(n){}}function s(){var t;try{t=window.localStorage[l]}catch(e){}if(typeof t===a)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(l)+"=");r&&(t=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===f.levels[t]&&(t=void 0),t}var u,f=this,l="loglevel";t&&(l+=":"+t),f.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},f.methodFactory=n||o,f.getLevel=function(){return u},f.setLevel=function(e,n){if("string"==typeof e&&void 0!==f.levels[e.toUpperCase()]&&(e=f.levels[e.toUpperCase()]),!("number"==typeof e&&e>=0&&e<=f.levels.SILENT))throw"log.setLevel() called with invalid level: "+e;if(u=e,n!==!1&&i(e),r.call(f,e,t),typeof console===a&&e<f.levels.SILENT)return"No console available for logging"},f.setDefaultLevel=function(t){s()||f.setLevel(t,!1)},f.enableAll=function(t){f.setLevel(f.levels.TRACE,t)},f.disableAll=function(t){f.setLevel(f.levels.SILENT,t)};var h=s();null==h&&(h=null==e?"WARN":e),f.setLevel(h,!1)}var s=function(){},a="undefined",c=["trace","debug","info","warn","error"],u=new i,f={};u.getLogger=function(t){if("string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var e=f[t];return e||(e=f[t]=new i(t,u.getLevel(),u.methodFactory)),e};var l=typeof window!==a?window.log:void 0;return u.noConflict=function(){return typeof window!==a&&window.log===u&&(window.log=l),u},u})},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t){return s["default"].error(t),new Error(t)}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=o;var i=n(25),s=r(i);t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(25),c=r(a),u=function(){function t(){o(this,t),this.eventFunctions={}}return s(t,[{key:"on",value:function(t,e){"object"!==i(this.eventFunctions[t])&&(this.eventFunctions[t]={});var n=Date.now()+Object.keys(this.eventFunctions[t]).length;return this.eventFunctions[t][n]=e,n}},{key:"removeCallback",value:function(t,e){delete this.eventFunctions[t][e]}},{key:"emit",value:function(t){c["default"].debug("Emitting "+arguments[0]+" event");var e=Array.prototype.slice.call(arguments);if(e.shift(),"undefined"!=typeof this.eventFunctions[arguments[0]]){var n=this.eventFunctions[arguments[0]];for(var r in n)n[r].apply(this,e)}}}]),t}();e["default"]=u,t.exports=e["default"]},function(t,e,n){(function(r){"use strict";function o(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=n(28),u=o(c),f=n(17),l=o(f),h=n(25),d=o(h),p=n(27),v=o(p),y=n(34),g=o(y),m=g["default"].create({objectHash:function(t){return t.id?t.id:JSON.stringify(t)},textDiff:{minLength:1e4}}),_=function(){function t(){function e(t){function e(t){var e={};for(var n in t)"$$"!==n.slice(0,2)&&"function"!=typeof t[n]&&(e[n]=t[n]);return e}t.leftIsArray||"object"!==t.leftType||(t.left=e(t.left)),t.rightIsArray||"object"!==t.rightType||(t.right=e(t.right))}var n=arguments.length<=0||void 0===arguments[0]?150:arguments[0];i(this,t),m.processor.pipes.diff.before("objects",e),this._updateRunning=!1,this._processingPatch=!1,this._timer=null,this._lastObjects={},this._events={},this.objects={},this.options={},this.callbacks={},this.timerInterval=n}return a(t,[{key:"remove",value:function(e){var n=t.subscriptionKeyForOptions(e);delete this.objects[n],delete this._lastObjects[n],delete this.options[n],delete this.callbacks[n],delete this._events[n]}},{key:"add",value:function(e,n,r,o,i,a){var c=this,u=function h(t){if(Array.isArray(t)||"a"===t._t)return!0;for(var e in t)"object"===s(t[e])&&h(t[e])&&delete t[e];return 0===Object.keys(t).length},f=function(){if(!c._processingPatch&&!c._updateRunning){var t=m.diff(c._lastObjects,c.objects);if(void 0!==t){d["default"].debug("Found diff: "+JSON.stringify(t));for(var e in t)for(var n=c._lastObjects[e],r=t[e],o=c.options[e],i=c.callbacks[e],a=Object.keys(r),f=0;f<a.length;f++){var l=a[f];if("_t"!==l){var h=r[l];if(Array.isArray(h))1===h.length?(i.add(c.objects[e][l]),delete n[l],delete c.objects[e][l],d["default"].debug("Adding object to "+e+" channel")):3===h.length&&(i.remove(l),delete n[l],d["default"].debug("Removing object from "+e+" channel"));else{var p=Object.keys(h),v=[],y=l;Array.isArray(c.objects[e])&&c.objects[e][l].id&&(y=c.objects[e][l].id);for(var g=0;g<p.length;g++){var _=p[g],b=h[_];u(b)?(v.push({op:"replace",path:o.channel.model+"/"+y+"/"+_,value:c.objects[e][l][_]}),d["default"].debug("Modified "+_+" property on object "+l+", "+o.channel.model+" channel")):"object"===("undefined"==typeof b?"undefined":s(b))?(v.push({op:"replace",path:o.channel.model+"/"+y+"/"+_,value:c.objects[e][l][_]}),d["default"].debug("Modified "+_+" property on object "+l+", "+o.channel.model+" channel")):1===b.length?(v.push({op:"replace",path:o.channel.model+"/"+y+"/"+_,value:b[0]}),d["default"].debug("Added "+_+" property to object "+l+", "+o.channel.model+" channel")):2===b.length?(v.push({op:"replace",path:o.channel.model+"/"+y+"/"+_,value:b[1]}),d["default"].debug("Modified "+_+" property on object "+l+", "+o.channel.model+" channel")):3===b.length&&d["default"].info("Removing object properties is not supported in this version. Try setting to an empty value instead."),n[l][_]=JSON.parse(JSON.stringify(c.objects[e][l][_]))}v.length&&i.update(y,v),d["default"].debug("Sending patch to object "+l+" on "+o.channel.model+" channel: "+JSON.stringify(v))}}}}}},l=t.subscriptionKeyForOptions(e);this.objects[l]=n,this.options[l]=e,this.callbacks[l]={add:o,remove:i,update:a},this._events[l]=r,this._lastObjects[l]=JSON.parse(JSON.stringify(this.objects[l])),null===this._timer&&(this._timer=setInterval(f,this.timerInterval))}},{key:"processMessage",value:function(t){var e=this,n=function(t){for(var n=0;n<t.subscriptions.length;n++){var r=t.subscriptions[n],o=r.split(":");"context"===o[2]&&4===o.length&&(o.pop(),r=o.join(":"));var i=e.objects[r],s=e._lastObjects[r],a=e._events[r];if(i)if("new"===t.op)i.hasOwnProperty(t.object.id)?a.emit("error",(0,v["default"])("Object id already exists "+t.object.id),t.object.id,i[t.object.id]):(t.object.$$event=new u["default"](d["default"]),i[t.object.id]=t.object,s[t.object.id]=JSON.parse(JSON.stringify(t.object)),a.emit("update","add",t.object.id,t.object),d["default"].debug("Added object with id "+t.object.id));else if("update"===t.op){var c=t.patch.path.split("/"),f=c[1],l=c[2],h=t.patch.value;if(i.hasOwnProperty(f))if("undefined"!=typeof h){var p=i[f],y=void 0;"undefined"!=typeof p[l]&&(y=JSON.parse(JSON.stringify(p[l]))),p[l]=h,s[f][l]=JSON.parse(JSON.stringify(h)),a.emit("update","replace",f,p,{path:l,oldValue:y}),d["default"].debug("Replaced property "+l+" of object id "+f+" with  value "+h)}else a.emit("error",(0,v["default"])("Invalid operation "+JSON.stringify(t)));else a.emit("error",(0,v["default"])("Object id doesn't exist "+f),f,l,h)}else{var g=i[t.object.id];delete i[t.object.id],delete s[t.object.id],a.emit("update","delete",t.object.id,g),d["default"].debug("Removed object id "+t.object.id)}else d["default"].warn("Subscription not found "+r)}};this._processingPatch=!0,d["default"].debug("Received update: "+JSON.stringify(t));var r,o;for(r=0;r<t.data["new"].length;r++)o=t.data["new"][r],o.op="new",n(o);for(r=0;r<t.data.updated.length;r++)o=t.data.updated[r],o.op="update",n(o);for(r=0;r<t.data.deleted.length;r++)o=t.data.deleted[r],o.op="remove",n(o);this._processingPatch=!1}}],[{key:"subscriptionKeyForOptions",value:function(t){var e="blg:"+l["default"].appId;return!t.channel.id&&t.channel.context&&(e+=":context:"+t.channel.context),t.channel.parent&&(e+=":"+t.channel.parent.model+":"+t.channel.parent.id),t.channel.user&&(e+=":users:"+t.channel.user),e+=":"+t.channel.model,t.channel.id&&(e+=":"+t.channel.id),t.filters&&(e+=":filter:"+new r(JSON.stringify(t.filters)).toString("base64")),e}}]),t}();e["default"]=_,t.exports=e["default"]}).call(e,n(30).Buffer)},function(t,e,n){(function(t,r){/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
"use strict";function o(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(e){return!1}}function i(){return t.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,n){if(i()<n)throw new RangeError("Invalid typed array length");return t.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(n),e.__proto__=t.prototype):(null===e&&(e=new t(n)),e.length=n),e}function t(e,n,r){if(!(t.TYPED_ARRAY_SUPPORT||this instanceof t))return new t(e,n,r);if("number"==typeof e){if("string"==typeof n)throw new Error("If encoding is specified then the first argument must be a string");return f(this,e)}return a(this,e,n,r)}function a(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?d(t,e,n,r):"string"==typeof e?l(t,e,n):p(t,e)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function u(t,e,n,r){return c(e),e<=0?s(t,e):void 0!==n?"string"==typeof r?s(t,e).fill(n,r):s(t,e).fill(n):s(t,e)}function f(e,n){if(c(n),e=s(e,n<0?0:0|v(n)),!t.TYPED_ARRAY_SUPPORT)for(var r=0;r<n;++r)e[r]=0;return e}function l(e,n,r){if("string"==typeof r&&""!==r||(r="utf8"),!t.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var o=0|g(n,r);e=s(e,o);var i=e.write(n,r);return i!==o&&(e=e.slice(0,i)),e}function h(t,e){var n=e.length<0?0:0|v(e.length);t=s(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function d(e,n,r,o){if(n.byteLength,r<0||n.byteLength<r)throw new RangeError("'offset' is out of bounds");if(n.byteLength<r+(o||0))throw new RangeError("'length' is out of bounds");return n=void 0===r&&void 0===o?new Uint8Array(n):void 0===o?new Uint8Array(n,r):new Uint8Array(n,r,o),t.TYPED_ARRAY_SUPPORT?(e=n,e.__proto__=t.prototype):e=h(e,n),e}function p(e,n){if(t.isBuffer(n)){var r=0|v(n.length);return e=s(e,r),0===e.length?e:(n.copy(e,0,0,r),e)}if(n){if("undefined"!=typeof ArrayBuffer&&n.buffer instanceof ArrayBuffer||"length"in n)return"number"!=typeof n.length||$(n.length)?s(e,0):h(e,n);if("Buffer"===n.type&&Z(n.data))return h(e,n.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function v(t){if(t>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|t}function y(e){return+e!=e&&(e=0),t.alloc(+e)}function g(e,n){if(t.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var o=!1;;)switch(n){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return Y(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return K(e).length;default:if(o)return Y(e).length;n=(""+n).toLowerCase(),o=!0}}function m(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,e>>>=0,n<=e)return"";for(t||(t="utf8");;)switch(t){case"hex":return q(this,e,n);case"utf8":case"utf-8":return C(this,e,n);case"ascii":return R(this,e,n);case"latin1":case"binary":return D(this,e,n);case"base64":return T(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function _(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function b(e,n,r,o,i){if(0===e.length)return-1;if("string"==typeof r?(o=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof n&&(n=t.from(n,o)),t.isBuffer(n))return 0===n.length?-1:w(e,n,r,o,i);if("number"==typeof n)return n=255&n,t.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,n,r):Uint8Array.prototype.lastIndexOf.call(e,n,r):w(e,[n],r,o,i);throw new TypeError("val must be string, number or Buffer")}function w(t,e,n,r,o){function i(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}var s=1,a=t.length,c=e.length;if(void 0!==r&&(r=String(r).toLowerCase(),"ucs2"===r||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s=2,a/=2,c/=2,n/=2}var u;if(o){var f=-1;for(u=n;u<a;u++)if(i(t,u)===i(e,f===-1?0:u-f)){if(f===-1&&(f=u),u-f+1===c)return f*s}else f!==-1&&(u-=u-f),f=-1}else for(n+c>a&&(n=a-c),u=n;u>=0;u--){for(var l=!0,h=0;h<c;h++)if(i(t,u+h)!==i(e,h)){l=!1;break}if(l)return u}return-1}function k(t,e,n,r){n=Number(n)||0;var o=t.length-n;r?(r=Number(r),r>o&&(r=o)):r=o;var i=e.length;if(i%2!==0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var s=0;s<r;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[n+s]=a}return s}function E(t,e,n,r){return W(Y(e,t.length-n),t,n,r)}function x(t,e,n,r){return W(X(e),t,n,r)}function A(t,e,n,r){return x(t,e,n,r)}function S(t,e,n,r){return W(K(e),t,n,r)}function j(t,e,n,r){return W(V(e,t.length-n),t,n,r)}function T(t,e,n){return 0===e&&n===t.length?G.fromByteArray(t):G.fromByteArray(t.slice(e,n))}function C(t,e,n){n=Math.min(t.length,n);for(var r=[],o=e;o<n;){var i=t[o],s=null,a=i>239?4:i>223?3:i>191?2:1;if(o+a<=n){var c,u,f,l;switch(a){case 1:i<128&&(s=i);break;case 2:c=t[o+1],128===(192&c)&&(l=(31&i)<<6|63&c,l>127&&(s=l));break;case 3:c=t[o+1],u=t[o+2],128===(192&c)&&128===(192&u)&&(l=(15&i)<<12|(63&c)<<6|63&u,l>2047&&(l<55296||l>57343)&&(s=l));break;case 4:c=t[o+1],u=t[o+2],f=t[o+3],128===(192&c)&&128===(192&u)&&128===(192&f)&&(l=(15&i)<<18|(63&c)<<12|(63&u)<<6|63&f,l>65535&&l<1114112&&(s=l))}}null===s?(s=65533,a=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),o+=a}return O(r)}function O(t){var e=t.length;if(e<=tt)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=tt));return n}function R(t,e,n){var r="";n=Math.min(t.length,n);for(var o=e;o<n;++o)r+=String.fromCharCode(127&t[o]);return r}function D(t,e,n){var r="";n=Math.min(t.length,n);for(var o=e;o<n;++o)r+=String.fromCharCode(t[o]);return r}function q(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=e;i<n;++i)o+=J(t[i]);return o}function I(t,e,n){for(var r=t.slice(e,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function B(t,e,n){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function L(e,n,r,o,i,s){if(!t.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>i||n<s)throw new RangeError('"value" argument is out of bounds');if(r+o>e.length)throw new RangeError("Index out of range")}function P(t,e,n,r){e<0&&(e=65535+e+1);for(var o=0,i=Math.min(t.length-n,2);o<i;++o)t[n+o]=(e&255<<8*(r?o:1-o))>>>8*(r?o:1-o)}function N(t,e,n,r){e<0&&(e=4294967295+e+1);for(var o=0,i=Math.min(t.length-n,4);o<i;++o)t[n+o]=e>>>8*(r?o:3-o)&255}function U(t,e,n,r,o,i){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function M(t,e,n,r,o){return o||U(t,e,n,4,3.4028234663852886e38,-3.4028234663852886e38),Q.write(t,e,n,r,23,4),n+4}function F(t,e,n,r,o){return o||U(t,e,n,8,1.7976931348623157e308,-1.7976931348623157e308),Q.write(t,e,n,r,52,8),n+8}function H(t){if(t=z(t).replace(et,""),t.length<2)return"";for(;t.length%4!==0;)t+="=";return t}function z(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function J(t){return t<16?"0"+t.toString(16):t.toString(16)}function Y(t,e){e=e||1/0;for(var n,r=t.length,o=null,i=[],s=0;s<r;++s){if(n=t.charCodeAt(s),n>55295&&n<57344){if(!o){if(n>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(e-=3)>-1&&i.push(239,191,189),o=n;continue}n=(o-55296<<10|n-56320)+65536}else o&&(e-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((e-=1)<0)break;i.push(n)}else if(n<2048){if((e-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function X(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}function V(t,e){for(var n,r,o,i=[],s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),r=n>>8,o=n%256,i.push(o),i.push(r);return i}function K(t){return G.toByteArray(H(t))}function W(t,e,n,r){for(var o=0;o<r&&!(o+n>=e.length||o>=t.length);++o)e[o+n]=t[o];return o}function $(t){return t!==t}var G=n(31),Q=n(32),Z=n(33);e.Buffer=t,e.SlowBuffer=y,e.INSPECT_MAX_BYTES=50,t.TYPED_ARRAY_SUPPORT=void 0!==r.TYPED_ARRAY_SUPPORT?r.TYPED_ARRAY_SUPPORT:o(),e.kMaxLength=i(),t.poolSize=8192,t._augment=function(e){return e.__proto__=t.prototype,e},t.from=function(t,e,n){return a(null,t,e,n)},t.TYPED_ARRAY_SUPPORT&&(t.prototype.__proto__=Uint8Array.prototype,t.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&t[Symbol.species]===t&&Object.defineProperty(t,Symbol.species,{value:null,configurable:!0})),t.alloc=function(t,e,n){return u(null,t,e,n)},t.allocUnsafe=function(t){return f(null,t)},t.allocUnsafeSlow=function(t){return f(null,t)},t.isBuffer=function(t){return!(null==t||!t._isBuffer)},t.compare=function(e,n){if(!t.isBuffer(e)||!t.isBuffer(n))throw new TypeError("Arguments must be Buffers");if(e===n)return 0;for(var r=e.length,o=n.length,i=0,s=Math.min(r,o);i<s;++i)if(e[i]!==n[i]){r=e[i],o=n[i];break}return r<o?-1:o<r?1:0},t.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},t.concat=function(e,n){if(!Z(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return t.alloc(0);var r;if(void 0===n)for(n=0,r=0;r<e.length;++r)n+=e[r].length;var o=t.allocUnsafe(n),i=0;for(r=0;r<e.length;++r){var s=e[r];if(!t.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(o,i),i+=s.length}return o},t.byteLength=g,t.prototype._isBuffer=!0,t.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)_(this,e,e+1);return this},t.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)_(this,e,e+3),_(this,e+1,e+2);return this},t.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)_(this,e,e+7),_(this,e+1,e+6),_(this,e+2,e+5),_(this,e+3,e+4);return this},t.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?C(this,0,t):m.apply(this,arguments)},t.prototype.equals=function(e){if(!t.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===t.compare(this,e)},t.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},t.prototype.compare=function(e,n,r,o,i){if(!t.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===n&&(n=0),void 0===r&&(r=e?e.length:0),void 0===o&&(o=0),void 0===i&&(i=this.length),n<0||r>e.length||o<0||i>this.length)throw new RangeError("out of range index");if(o>=i&&n>=r)return 0;if(o>=i)return-1;if(n>=r)return 1;if(n>>>=0,r>>>=0,o>>>=0,i>>>=0,this===e)return 0;for(var s=i-o,a=r-n,c=Math.min(s,a),u=this.slice(o,i),f=e.slice(n,r),l=0;l<c;++l)if(u[l]!==f[l]){s=u[l],a=f[l];break}return s<a?-1:a<s?1:0},t.prototype.includes=function(t,e,n){return this.indexOf(t,e,n)!==-1},t.prototype.indexOf=function(t,e,n){return b(this,t,e,n,!0)},t.prototype.lastIndexOf=function(t,e,n){return b(this,t,e,n,!1)},t.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e=0|e,isFinite(n)?(n=0|n,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-e;if((void 0===n||n>o)&&(n=o),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return k(this,t,e,n);case"utf8":case"utf-8":return E(this,t,e,n);case"ascii":return x(this,t,e,n);case"latin1":case"binary":return A(this,t,e,n);case"base64":return S(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,t,e,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},t.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var tt=4096;t.prototype.slice=function(e,n){var r=this.length;e=~~e,n=void 0===n?r:~~n,e<0?(e+=r,e<0&&(e=0)):e>r&&(e=r),n<0?(n+=r,n<0&&(n=0)):n>r&&(n=r),n<e&&(n=e);var o;if(t.TYPED_ARRAY_SUPPORT)o=this.subarray(e,n),o.__proto__=t.prototype;else{var i=n-e;o=new t(i,(void 0));for(var s=0;s<i;++s)o[s]=this[s+e]}return o},t.prototype.readUIntLE=function(t,e,n){t=0|t,e=0|e,n||B(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r},t.prototype.readUIntBE=function(t,e,n){t=0|t,e=0|e,n||B(t,e,this.length);for(var r=this[t+--e],o=1;e>0&&(o*=256);)r+=this[t+--e]*o;return r},t.prototype.readUInt8=function(t,e){return e||B(t,1,this.length),this[t]},t.prototype.readUInt16LE=function(t,e){return e||B(t,2,this.length),this[t]|this[t+1]<<8},t.prototype.readUInt16BE=function(t,e){return e||B(t,2,this.length),this[t]<<8|this[t+1]},t.prototype.readUInt32LE=function(t,e){return e||B(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},t.prototype.readUInt32BE=function(t,e){return e||B(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},t.prototype.readIntLE=function(t,e,n){t=0|t,e=0|e,n||B(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return o*=128,r>=o&&(r-=Math.pow(2,8*e)),r},t.prototype.readIntBE=function(t,e,n){t=0|t,e=0|e,n||B(t,e,this.length);for(var r=e,o=1,i=this[t+--r];r>0&&(o*=256);)i+=this[t+--r]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*e)),i},t.prototype.readInt8=function(t,e){return e||B(t,1,this.length),128&this[t]?(255-this[t]+1)*-1:this[t]},t.prototype.readInt16LE=function(t,e){e||B(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},t.prototype.readInt16BE=function(t,e){e||B(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},t.prototype.readInt32LE=function(t,e){return e||B(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},t.prototype.readInt32BE=function(t,e){return e||B(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},t.prototype.readFloatLE=function(t,e){return e||B(t,4,this.length),Q.read(this,t,!0,23,4)},t.prototype.readFloatBE=function(t,e){return e||B(t,4,this.length),Q.read(this,t,!1,23,4)},t.prototype.readDoubleLE=function(t,e){return e||B(t,8,this.length),Q.read(this,t,!0,52,8)},t.prototype.readDoubleBE=function(t,e){return e||B(t,8,this.length),Q.read(this,t,!1,52,8)},t.prototype.writeUIntLE=function(t,e,n,r){if(t=+t,e=0|e,n=0|n,!r){var o=Math.pow(2,8*n)-1;L(this,t,e,n,o,0)}var i=1,s=0;for(this[e]=255&t;++s<n&&(i*=256);)this[e+s]=t/i&255;return e+n},t.prototype.writeUIntBE=function(t,e,n,r){if(t=+t,e=0|e,n=0|n,!r){var o=Math.pow(2,8*n)-1;L(this,t,e,n,o,0)}var i=n-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+n},t.prototype.writeUInt8=function(e,n,r){return e=+e,n=0|n,r||L(this,e,n,1,255,0),t.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[n]=255&e,n+1},t.prototype.writeUInt16LE=function(e,n,r){return e=+e,n=0|n,r||L(this,e,n,2,65535,0),t.TYPED_ARRAY_SUPPORT?(this[n]=255&e,this[n+1]=e>>>8):P(this,e,n,!0),n+2},t.prototype.writeUInt16BE=function(e,n,r){return e=+e,n=0|n,r||L(this,e,n,2,65535,0),t.TYPED_ARRAY_SUPPORT?(this[n]=e>>>8,this[n+1]=255&e):P(this,e,n,!1),n+2},t.prototype.writeUInt32LE=function(e,n,r){return e=+e,n=0|n,r||L(this,e,n,4,4294967295,0),t.TYPED_ARRAY_SUPPORT?(this[n+3]=e>>>24,this[n+2]=e>>>16,this[n+1]=e>>>8,this[n]=255&e):N(this,e,n,!0),n+4},t.prototype.writeUInt32BE=function(e,n,r){return e=+e,n=0|n,r||L(this,e,n,4,4294967295,0),t.TYPED_ARRAY_SUPPORT?(this[n]=e>>>24,this[n+1]=e>>>16,this[n+2]=e>>>8,this[n+3]=255&e):N(this,e,n,!1),n+4},t.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e=0|e,!r){var o=Math.pow(2,8*n-1);L(this,t,e,n,o-1,-o)}var i=0,s=1,a=0;for(this[e]=255&t;++i<n&&(s*=256);)t<0&&0===a&&0!==this[e+i-1]&&(a=1),this[e+i]=(t/s>>0)-a&255;return e+n},t.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e=0|e,!r){var o=Math.pow(2,8*n-1);L(this,t,e,n,o-1,-o)}var i=n-1,s=1,a=0;for(this[e+i]=255&t;--i>=0&&(s*=256);)t<0&&0===a&&0!==this[e+i+1]&&(a=1),this[e+i]=(t/s>>0)-a&255;return e+n},t.prototype.writeInt8=function(e,n,r){return e=+e,n=0|n,r||L(this,e,n,1,127,-128),t.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[n]=255&e,n+1},t.prototype.writeInt16LE=function(e,n,r){return e=+e,n=0|n,r||L(this,e,n,2,32767,-32768),t.TYPED_ARRAY_SUPPORT?(this[n]=255&e,this[n+1]=e>>>8):P(this,e,n,!0),n+2},t.prototype.writeInt16BE=function(e,n,r){return e=+e,n=0|n,r||L(this,e,n,2,32767,-32768),t.TYPED_ARRAY_SUPPORT?(this[n]=e>>>8,this[n+1]=255&e):P(this,e,n,!1),n+2},t.prototype.writeInt32LE=function(e,n,r){return e=+e,n=0|n,r||L(this,e,n,4,2147483647,-2147483648),t.TYPED_ARRAY_SUPPORT?(this[n]=255&e,this[n+1]=e>>>8,this[n+2]=e>>>16,this[n+3]=e>>>24):N(this,e,n,!0),n+4},t.prototype.writeInt32BE=function(e,n,r){return e=+e,n=0|n,r||L(this,e,n,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),t.TYPED_ARRAY_SUPPORT?(this[n]=e>>>24,this[n+1]=e>>>16,this[n+2]=e>>>8,this[n+3]=255&e):N(this,e,n,!1),n+4},t.prototype.writeFloatLE=function(t,e,n){return M(this,t,e,!0,n)},t.prototype.writeFloatBE=function(t,e,n){return M(this,t,e,!1,n)},t.prototype.writeDoubleLE=function(t,e,n){return F(this,t,e,!0,n)},t.prototype.writeDoubleBE=function(t,e,n){return F(this,t,e,!1,n)},t.prototype.copy=function(e,n,r,o){if(r||(r=0),o||0===o||(o=this.length),n>=e.length&&(n=e.length),n||(n=0),o>0&&o<r&&(o=r),o===r)return 0;if(0===e.length||0===this.length)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-n<o-r&&(o=e.length-n+r);var i,s=o-r;if(this===e&&r<n&&n<o)for(i=s-1;i>=0;--i)e[i+n]=this[i+r];else if(s<1e3||!t.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+n]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+s),n);return s},t.prototype.fill=function(e,n,r,o){if("string"==typeof e){if("string"==typeof n?(o=n,n=0,r=this.length):"string"==typeof r&&(o=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!t.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof e&&(e=255&e);if(n<0||this.length<n||this.length<r)throw new RangeError("Out of range index");if(r<=n)return this;n>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0);var s;if("number"==typeof e)for(s=n;s<r;++s)this[s]=e;else{var a=t.isBuffer(e)?e:Y(new t(e,o).toString()),c=a.length;for(s=0;s<r-n;++s)this[s+n]=a[s%c]}return this};var et=/[^+\/0-9A-Za-z-_]/g}).call(e,n(30).Buffer,function(){return this}())},function(t,e){"use strict";function n(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,n=t.length;e<n;++e)a[e]=t[e],c[t.charCodeAt(e)]=e;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63}function r(t){var e,n,r,o,i,s,a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");i="="===t[a-2]?2:"="===t[a-1]?1:0,s=new u(3*a/4-i),r=i>0?a-4:a;var f=0;for(e=0,n=0;e<r;e+=4,n+=3)o=c[t.charCodeAt(e)]<<18|c[t.charCodeAt(e+1)]<<12|c[t.charCodeAt(e+2)]<<6|c[t.charCodeAt(e+3)],s[f++]=o>>16&255,s[f++]=o>>8&255,s[f++]=255&o;return 2===i?(o=c[t.charCodeAt(e)]<<2|c[t.charCodeAt(e+1)]>>4,s[f++]=255&o):1===i&&(o=c[t.charCodeAt(e)]<<10|c[t.charCodeAt(e+1)]<<4|c[t.charCodeAt(e+2)]>>2,s[f++]=o>>8&255,s[f++]=255&o),s}function o(t){return a[t>>18&63]+a[t>>12&63]+a[t>>6&63]+a[63&t]}function i(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16)+(t[s+1]<<8)+t[s+2],i.push(o(r));return i.join("")}function s(t){for(var e,n=t.length,r=n%3,o="",s=[],c=16383,u=0,f=n-r;u<f;u+=c)s.push(i(t,u,u+c>f?f:u+c));return 1===r?(e=t[n-1],o+=a[e>>2],o+=a[e<<4&63],o+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],o+=a[e>>10],o+=a[e>>4&63],o+=a[e<<2&63],o+="="),s.push(o),s.join("")}e.toByteArray=r,e.fromByteArray=s;var a=[],c=[],u="undefined"!=typeof Uint8Array?Uint8Array:Array;n()},function(t,e){e.read=function(t,e,n,r,o){var i,s,a=8*o-r-1,c=(1<<a)-1,u=c>>1,f=-7,l=n?o-1:0,h=n?-1:1,d=t[e+l];for(l+=h,i=d&(1<<-f)-1,d>>=-f,f+=a;f>0;i=256*i+t[e+l],l+=h,f-=8);for(s=i&(1<<-f)-1,i>>=-f,f+=r;f>0;s=256*s+t[e+l],l+=h,f-=8);if(0===i)i=1-u;else{if(i===c)return s?NaN:(d?-1:1)*(1/0);s+=Math.pow(2,r),i-=u}return(d?-1:1)*s*Math.pow(2,i-r)},e.write=function(t,e,n,r,o,i){var s,a,c,u=8*i-o-1,f=(1<<u)-1,l=f>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:i-1,p=r?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=f):(s=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-s))<1&&(s--,c*=2),e+=s+l>=1?h/c:h*Math.pow(2,1-l),e*c>=2&&(s++,c/=2),s+l>=f?(a=0,s=f):s+l>=1?(a=(e*c-1)*Math.pow(2,o),s+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,o),s=0));o>=8;t[n+d]=255&a,d+=p,a/=256,o-=8);for(s=s<<o|a,u+=o;u>0;t[n+d]=255&s,d+=p,s/=256,u-=8);t[n+d-p]|=128*v}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){var r=n(35),o=n(36).DiffPatcher;e.DiffPatcher=o,e.create=function(t){return new o(t)},e.dateReviver=n(65);var i;if(e.diff=function(){return i||(i=new o),i.diff.apply(i,arguments)},e.patch=function(){return i||(i=new o),i.patch.apply(i,arguments)},e.unpatch=function(){return i||(i=new o),i.unpatch.apply(i,arguments)},e.reverse=function(){return i||(i=new o),i.reverse.apply(i,arguments)},e.clone=function(){return i||(i=new o),i.clone.apply(i,arguments)},r.isBrowser)e.homepage="{{package-homepage}}",e.version="{{package-version}}";else{var s="../package.json",a=n(50)(s);e.homepage=a.homepage,e.version=a.version;var c="./formatters",u=n(50)(c);e.formatters=u,e.console=u.console}},function(t,e){e.isBrowser="undefined"!=typeof window},function(t,e,n){var r=n(37).Processor,o=n(38).Pipe,i=n(39).DiffContext,s=n(42).PatchContext,a=n(43).ReverseContext,c=n(41),u=n(44),f=n(45),l=n(46),h=n(48),d=n(49),p=function(t){this.processor=new r(t),this.processor.pipe(new o("diff").append(f.collectChildrenDiffFilter,u.diffFilter,h.diffFilter,d.diffFilter,f.objectsDiffFilter,l.diffFilter).shouldHaveResult()),this.processor.pipe(new o("patch").append(f.collectChildrenPatchFilter,l.collectChildrenPatchFilter,u.patchFilter,d.patchFilter,f.patchFilter,l.patchFilter).shouldHaveResult()),this.processor.pipe(new o("reverse").append(f.collectChildrenReverseFilter,l.collectChildrenReverseFilter,u.reverseFilter,d.reverseFilter,f.reverseFilter,l.reverseFilter).shouldHaveResult())};p.prototype.options=function(){return this.processor.options.apply(this.processor,arguments)},p.prototype.diff=function(t,e){return this.processor.process(new i(t,e))},p.prototype.patch=function(t,e){return this.processor.process(new s(t,e))},p.prototype.reverse=function(t){return this.processor.process(new a(t))},p.prototype.unpatch=function(t,e){return this.patch(t,this.reverse(e))},p.prototype.clone=function(t){return c(t)},e.DiffPatcher=p},function(t,e){var n=function(t){this.selfOptions=t||{},this.pipes={}};n.prototype.options=function(t){return t&&(this.selfOptions=t),this.selfOptions},n.prototype.pipe=function(t,e){if("string"==typeof t){if("undefined"==typeof e)return this.pipes[t];this.pipes[t]=e}if(t&&t.name){if(e=t,e.processor===this)return e;this.pipes[e.name]=e}return e.processor=this,e},n.prototype.process=function(t,e){var n=t;n.options=this.options();for(var r,o,i=e||t.pipe||"default";i;)"undefined"!=typeof n.nextAfterChildren&&(n.next=n.nextAfterChildren,n.nextAfterChildren=null),"string"==typeof i&&(i=this.pipe(i)),i.process(n),o=n,r=i,i=null,n&&n.next&&(n=n.next,i=o.nextPipe||n.pipe||r);return n.hasResult?n.result:void 0},e.Processor=n},function(t,e){var n=function(t){this.name=t,this.filters=[]};n.prototype.process=function(t){if(!this.processor)throw new Error("add this pipe to a processor before using it");for(var e=this.debug,n=this.filters.length,r=t,o=0;o<n;o++){var i=this.filters[o];if(e&&this.log("filter: "+i.filterName),i(r),"object"==typeof r&&r.exiting){r.exiting=!1;break}}!r.next&&this.resultCheck&&this.resultCheck(r)},n.prototype.log=function(t){console.log("[jsondiffpatch] "+this.name+" pipe, "+t)},n.prototype.append=function(){return this.filters.push.apply(this.filters,arguments),this},n.prototype.prepend=function(){return this.filters.unshift.apply(this.filters,arguments),this},n.prototype.indexOf=function(t){if(!t)throw new Error("a filter name is required");for(var e=0;e<this.filters.length;e++){var n=this.filters[e];if(n.filterName===t)return e}throw new Error("filter not found: "+t)},n.prototype.list=function(){for(var t=[],e=0;e<this.filters.length;e++){var n=this.filters[e];t.push(n.filterName)}return t},n.prototype.after=function(t){var e=this.indexOf(t),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(e+1,0),Array.prototype.splice.apply(this.filters,n),this},n.prototype.before=function(t){var e=this.indexOf(t),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(e,0),Array.prototype.splice.apply(this.filters,n),this},n.prototype.clear=function(){return this.filters.length=0,this},n.prototype.shouldHaveResult=function(t){if(t===!1)return void(this.resultCheck=null);if(!this.resultCheck){var e=this;return this.resultCheck=function(t){if(!t.hasResult){console.log(t);var n=new Error(e.name+" failed");throw n.noResult=!0,n}},this}},e.Pipe=n},function(t,e,n){var r=n(40).Context,o=n(41),i=function(t,e){this.left=t,this.right=e,this.pipe="diff"};i.prototype=new r,i.prototype.setResult=function(t){if(this.options.cloneDiffValues&&"object"==typeof t){var e="function"==typeof this.options.cloneDiffValues?this.options.cloneDiffValues:o;"object"==typeof t[0]&&(t[0]=e(t[0])),"object"==typeof t[1]&&(t[1]=e(t[1]))}return r.prototype.setResult.apply(this,arguments)},e.DiffContext=i},function(t,e,n){var r=n(38).Pipe,o=function(){};o.prototype.setResult=function(t){return this.result=t,this.hasResult=!0,this},o.prototype.exit=function(){return this.exiting=!0,this},o.prototype.switchTo=function(t,e){return"string"==typeof t||t instanceof r?this.nextPipe=t:(this.next=t,e&&(this.nextPipe=e)),this},o.prototype.push=function(t,e){return t.parent=this,"undefined"!=typeof e&&(t.childName=e),t.root=this.root||this,t.options=t.options||this.options,this.children?(this.children[this.children.length-1].next=t,this.children.push(t)):(this.children=[t],this.nextAfterChildren=this.next||null,this.next=t),t.next=this,this},e.Context=o},function(t,e){function n(t){var e=/^\/(.*)\/([gimyu]*)$/.exec(t.toString());return new RegExp(e[1],e[2])}function r(t){if("object"!=typeof t)return t;if(null===t)return null;if(o(t))return t.map(r);if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return n(t);var e={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=r(t[i]));return e}var o="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array};t.exports=r},function(t,e,n){var r=n(40).Context,o=function(t,e){this.left=t,this.delta=e,this.pipe="patch"};o.prototype=new r,e.PatchContext=o},function(t,e,n){var r=n(40).Context,o=function(t){this.delta=t,this.pipe="reverse"};o.prototype=new r,e.ReverseContext=o},function(t,e){var n="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},r=function(t){if(t.left===t.right)return void t.setResult(void 0).exit();if("undefined"==typeof t.left){if("function"==typeof t.right)throw new Error("functions are not supported");return void t.setResult([t.right]).exit()}if("undefined"==typeof t.right)return void t.setResult([t.left,0,0]).exit();if("function"==typeof t.left||"function"==typeof t.right)throw new Error("functions are not supported");if(t.leftType=null===t.left?"null":typeof t.left,t.rightType=null===t.right?"null":typeof t.right,t.leftType!==t.rightType)return void t.setResult([t.left,t.right]).exit();if("boolean"===t.leftType||"number"===t.leftType)return void t.setResult([t.left,t.right]).exit();if("object"===t.leftType&&(t.leftIsArray=n(t.left)),"object"===t.rightType&&(t.rightIsArray=n(t.right)),t.leftIsArray!==t.rightIsArray)return void t.setResult([t.left,t.right]).exit();if(t.left instanceof RegExp){if(!(t.right instanceof RegExp))return void t.setResult([t.left,t.right]).exit();t.setResult([t.left.toString(),t.right.toString()]).exit()}};r.filterName="trivial";var o=function(t){if("undefined"==typeof t.delta)return void t.setResult(t.left).exit();if(t.nested=!n(t.delta),!t.nested){if(1===t.delta.length)return void t.setResult(t.delta[0]).exit();if(2===t.delta.length){if(t.left instanceof RegExp){var e=/^\/(.*)\/([gimyu]+)$/.exec(t.delta[1]);if(e)return void t.setResult(new RegExp(e[1],e[2])).exit()}return void t.setResult(t.delta[1]).exit()}return 3===t.delta.length&&0===t.delta[2]?void t.setResult(void 0).exit():void 0}};o.filterName="trivial";var i=function(t){return"undefined"==typeof t.delta?void t.setResult(t.delta).exit():(t.nested=!n(t.delta),t.nested?void 0:1===t.delta.length?void t.setResult([t.delta[0],0,0]).exit():2===t.delta.length?void t.setResult([t.delta[1],t.delta[0]]).exit():3===t.delta.length&&0===t.delta[2]?void t.setResult([t.delta[0]]).exit():void 0)};i.filterName="trivial",e.diffFilter=r,e.patchFilter=o,e.reverseFilter=i},function(t,e,n){var r=n(39).DiffContext,o=n(42).PatchContext,i=n(43).ReverseContext,s=function(t){if(t&&t.children){for(var e,n=t.children.length,r=t.result,o=0;o<n;o++)e=t.children[o],"undefined"!=typeof e.result&&(r=r||{},r[e.childName]=e.result);r&&t.leftIsArray&&(r._t="a"),t.setResult(r).exit()}};s.filterName="collectChildren";var a=function(t){if(!t.leftIsArray&&"object"===t.leftType){var e,n,o=t.options.propertyFilter;for(e in t.left)Object.prototype.hasOwnProperty.call(t.left,e)&&(o&&!o(e,t)||(n=new r(t.left[e],t.right[e]),t.push(n,e)));for(e in t.right)Object.prototype.hasOwnProperty.call(t.right,e)&&(o&&!o(e,t)||"undefined"==typeof t.left[e]&&(n=new r((void 0),t.right[e]),t.push(n,e)));return t.children&&0!==t.children.length?void t.exit():void t.setResult(void 0).exit()}};a.filterName="objects";var c=function(t){if(t.nested&&!t.delta._t){var e,n;for(e in t.delta)n=new o(t.left[e],t.delta[e]),t.push(n,e);t.exit()}};c.filterName="objects";var u=function(t){if(t&&t.children&&!t.delta._t){for(var e,n=t.children.length,r=0;r<n;r++)e=t.children[r],Object.prototype.hasOwnProperty.call(t.left,e.childName)&&void 0===e.result?delete t.left[e.childName]:t.left[e.childName]!==e.result&&(t.left[e.childName]=e.result);t.setResult(t.left).exit()}};u.filterName="collectChildren";var f=function(t){if(t.nested&&!t.delta._t){var e,n;for(e in t.delta)n=new i(t.delta[e]),t.push(n,e);t.exit()}};f.filterName="objects";var l=function(t){if(t&&t.children&&!t.delta._t){
for(var e,n=t.children.length,r={},o=0;o<n;o++)e=t.children[o],r[e.childName]!==e.result&&(r[e.childName]=e.result);t.setResult(r).exit()}};l.filterName="collectChildren",e.collectChildrenDiffFilter=s,e.objectsDiffFilter=a,e.patchFilter=c,e.collectChildrenPatchFilter=u,e.reverseFilter=f,e.collectChildrenReverseFilter=l},function(t,e,n){function r(t,e,n,r){for(var o=0;o<n;o++)for(var i=t[o],s=0;s<r;s++){var a=e[s];if(o!==s&&i===a)return!0}}function o(t,e,n,r,o){var i=t[n],s=e[r];if(i===s)return!0;if("object"!=typeof i||"object"!=typeof s)return!1;var a=o.objectHash;if(!a)return o.matchByPosition&&n===r;var c,u;return"number"==typeof n?(o.hashCache1=o.hashCache1||[],c=o.hashCache1[n],"undefined"==typeof c&&(o.hashCache1[n]=c=a(i,n))):c=a(i),"undefined"!=typeof c&&("number"==typeof r?(o.hashCache2=o.hashCache2||[],u=o.hashCache2[r],"undefined"==typeof u&&(o.hashCache2[r]=u=a(s,r))):u=a(s),"undefined"!=typeof u&&c===u)}var i=n(39).DiffContext,s=n(42).PatchContext,a=n(43).ReverseContext,c=n(47),u=3,f="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},l="function"==typeof Array.prototype.indexOf?function(t,e){return t.indexOf(e)}:function(t,e){for(var n=t.length,r=0;r<n;r++)if(t[r]===e)return r;return-1},h=function(t){if(t.leftIsArray){var e,n,s,a,f={objectHash:t.options&&t.options.objectHash,matchByPosition:t.options&&t.options.matchByPosition},h=0,d=0,p=t.left,v=t.right,y=p.length,g=v.length;for(y>0&&g>0&&!f.objectHash&&"boolean"!=typeof f.matchByPosition&&(f.matchByPosition=!r(p,v,y,g));h<y&&h<g&&o(p,v,h,h,f);)e=h,a=new i(t.left[e],t.right[e]),t.push(a,e),h++;for(;d+h<y&&d+h<g&&o(p,v,y-1-d,g-1-d,f);)n=y-1-d,s=g-1-d,a=new i(t.left[n],t.right[s]),t.push(a,s),d++;var m;if(h+d===y){if(y===g)return void t.setResult(void 0).exit();for(m=m||{_t:"a"},e=h;e<g-d;e++)m[e]=[v[e]];return void t.setResult(m).exit()}if(h+d===g){for(m=m||{_t:"a"},e=h;e<y-d;e++)m["_"+e]=[p[e],0,0];return void t.setResult(m).exit()}delete f.hashCache1,delete f.hashCache2;var _=p.slice(h,y-d),b=v.slice(h,g-d),w=c.get(_,b,o,f),k=[];for(m=m||{_t:"a"},e=h;e<y-d;e++)l(w.indices1,e-h)<0&&(m["_"+e]=[p[e],0,0],k.push(e));var E=!0;t.options&&t.options.arrays&&t.options.arrays.detectMove===!1&&(E=!1);var x=!1;t.options&&t.options.arrays&&t.options.arrays.includeValueOnMove&&(x=!0);var A=k.length;for(e=h;e<g-d;e++){var S=l(w.indices2,e-h);if(S<0){var j=!1;if(E&&A>0)for(var T=0;T<A;T++)if(n=k[T],o(_,b,n-h,e-h,f)){m["_"+n].splice(1,2,e,u),x||(m["_"+n][0]=""),s=e,a=new i(t.left[n],t.right[s]),t.push(a,s),k.splice(T,1),j=!0;break}j||(m[e]=[v[e]])}else n=w.indices1[S]+h,s=w.indices2[S]+h,a=new i(t.left[n],t.right[s]),t.push(a,s)}t.setResult(m).exit()}};h.filterName="arrays";var d={numerically:function(t,e){return t-e},numericallyBy:function(t){return function(e,n){return e[t]-n[t]}}},p=function(t){if(t.nested&&"a"===t.delta._t){var e,n,r=t.delta,o=t.left,i=[],a=[],c=[];for(e in r)if("_t"!==e)if("_"===e[0]){if(0!==r[e][2]&&r[e][2]!==u)throw new Error("only removal or move can be applied at original array indices, invalid diff type: "+r[e][2]);i.push(parseInt(e.slice(1),10))}else 1===r[e].length?a.push({index:parseInt(e,10),value:r[e][0]}):c.push({index:parseInt(e,10),delta:r[e]});for(i=i.sort(d.numerically),e=i.length-1;e>=0;e--){n=i[e];var f=r["_"+n],l=o.splice(n,1)[0];f[2]===u&&a.push({index:f[1],value:l})}a=a.sort(d.numericallyBy("index"));var h=a.length;for(e=0;e<h;e++){var p=a[e];o.splice(p.index,0,p.value)}var v,y=c.length;if(y>0)for(e=0;e<y;e++){var g=c[e];v=new s(t.left[g.index],g.delta),t.push(v,g.index)}return t.children?void t.exit():void t.setResult(t.left).exit()}};p.filterName="arrays";var v=function(t){if(t&&t.children&&"a"===t.delta._t){for(var e,n=t.children.length,r=0;r<n;r++)e=t.children[r],t.left[e.childName]=e.result;t.setResult(t.left).exit()}};v.filterName="arraysCollectChildren";var y=function(t){if(!t.nested)return void(t.delta[2]===u&&(t.newName="_"+t.delta[1],t.setResult([t.delta[0],parseInt(t.childName.substr(1),10),u]).exit()));if("a"===t.delta._t){var e,n;for(e in t.delta)"_t"!==e&&(n=new a(t.delta[e]),t.push(n,e));t.exit()}};y.filterName="arrays";var g=function(t,e,n){if("string"==typeof e&&"_"===e[0])return parseInt(e.substr(1),10);if(f(n)&&0===n[2])return"_"+e;var r=+e;for(var o in t){var i=t[o];if(f(i))if(i[2]===u){var s=parseInt(o.substr(1),10),a=i[1];if(a===+e)return s;s<=r&&a>r?r++:s>=r&&a<r&&r--}else if(0===i[2]){var c=parseInt(o.substr(1),10);c<=r&&r++}else 1===i.length&&o<=r&&r--}return r},m=function(t){if(t&&t.children&&"a"===t.delta._t){for(var e,n=t.children.length,r={_t:"a"},o=0;o<n;o++){e=t.children[o];var i=e.newName;"undefined"==typeof i&&(i=g(t.delta,e.childName,e.result)),r[i]!==e.result&&(r[i]=e.result)}t.setResult(r).exit()}};m.filterName="arraysCollectChildren",e.diffFilter=h,e.patchFilter=p,e.collectChildrenPatchFilter=v,e.reverseFilter=y,e.collectChildrenReverseFilter=m},function(t,e){var n=function(t,e,n,r){return t[n]===e[r]},r=function(t,e,n,r){var o,i,s=t.length,a=e.length,c=[s+1];for(o=0;o<s+1;o++)for(c[o]=[a+1],i=0;i<a+1;i++)c[o][i]=0;for(c.match=n,o=1;o<s+1;o++)for(i=1;i<a+1;i++)n(t,e,o-1,i-1,r)?c[o][i]=c[o-1][i-1]+1:c[o][i]=Math.max(c[o-1][i],c[o][i-1]);return c},o=function(t,e,n,r,i,s){if(0===r||0===i)return{sequence:[],indices1:[],indices2:[]};if(t.match(e,n,r-1,i-1,s)){var a=o(t,e,n,r-1,i-1,s);return a.sequence.push(e[r-1]),a.indices1.push(r-1),a.indices2.push(i-1),a}return t[r][i-1]>t[r-1][i]?o(t,e,n,r,i-1,s):o(t,e,n,r-1,i,s)},i=function(t,e,i,s){s=s||{};var a=r(t,e,i||n,s),c=o(a,t,e,t.length,e.length,s);return"string"==typeof t&&"string"==typeof e&&(c.sequence=c.sequence.join("")),c};e.get=i},function(t,e){var n=function(t){t.left instanceof Date?(t.right instanceof Date?t.left.getTime()!==t.right.getTime()?t.setResult([t.left,t.right]):t.setResult(void 0):t.setResult([t.left,t.right]),t.exit()):t.right instanceof Date&&t.setResult([t.left,t.right]).exit()};n.filterName="dates",e.diffFilter=n},function(t,e,n){var r=2,o=60,i=null,s=function(t){if(!i){var e;if("undefined"!=typeof diff_match_patch)e="function"==typeof diff_match_patch?new diff_match_patch:new diff_match_patch.diff_match_patch;else try{var r="diff_match_patch_uncompressed",o=n(50)("./"+r);e=new o.diff_match_patch}catch(s){e=null}if(!e){if(!t)return null;var a=new Error("text diff_match_patch library not found");throw a.diff_match_patch_not_found=!0,a}i={diff:function(t,n){return e.patch_toText(e.patch_make(t,n))},patch:function(t,n){for(var r=e.patch_apply(e.patch_fromText(n),t),o=0;o<r[1].length;o++)if(!r[1][o]){var i=new Error("text patch failed");i.textPatchFailed=!0}return r[0]}}}return i},a=function(t){if("string"===t.leftType){var e=t.options&&t.options.textDiff&&t.options.textDiff.minLength||o;if(t.left.length<e||t.right.length<e)return void t.setResult([t.left,t.right]).exit();var n=s();if(!n)return void t.setResult([t.left,t.right]).exit();var i=n.diff;t.setResult([i(t.left,t.right),0,r]).exit()}};a.filterName="texts";var c=function(t){if(!t.nested&&t.delta[2]===r){var e=s(!0).patch;t.setResult(e(t.left,t.delta[0])).exit()}};c.filterName="texts";var u=function(t){var e,n,r,o,i,s,a,c,u=null,f=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/;for(r=t.split("\n"),e=0,n=r.length;e<n;e++){o=r[e];var l=o.slice(0,1);"@"===l?(u=f.exec(o),s=e,a=null,c=null,r[s]="@@ -"+u[3]+","+u[4]+" +"+u[1]+","+u[2]+" @@"):"+"===l?(a=e,r[e]="-"+r[e].slice(1),"+"===r[e-1].slice(0,1)&&(i=r[e],r[e]=r[e-1],r[e-1]=i)):"-"===l&&(c=e,r[e]="+"+r[e].slice(1))}return r.join("\n")},f=function(t){t.nested||t.delta[2]===r&&t.setResult([u(t.delta[0]),0,r]).exit()};f.filterName="texts",e.diffFilter=a,e.patchFilter=c,e.reverseFilter=f},function(t,e,n){function r(t){return n(o(t))}function o(t){return i[t]||function(){throw new Error("Cannot find module '"+t+"'.")}()}var i={"../package.json":51,"./console":52,"./formatters":61};r.keys=function(){return Object.keys(i)},r.resolve=o,t.exports=r,r.id=50},function(t,e){t.exports={_args:[[{raw:"jsondiffpatch@^0.2.4",scope:null,escapedName:"jsondiffpatch",name:"jsondiffpatch",rawSpec:"^0.2.4",spec:">=0.2.4 <0.3.0",type:"range"},"/projects/Telepat/telepat-js"]],_from:"jsondiffpatch@>=0.2.4 <0.3.0",_id:"jsondiffpatch@0.2.4",_inCache:!0,_installable:!0,_location:"/jsondiffpatch",_nodeVersion:"4.4.7",_npmOperationalInternal:{host:"packages-16-east.internal.npmjs.com",tmp:"tmp/jsondiffpatch-0.2.4.tgz_1473717043617_0.832546383375302"},_npmUser:{name:"beneidel",email:"beneidel@gmail.com"},_npmVersion:"2.15.8",_phantomChildren:{},_requested:{raw:"jsondiffpatch@^0.2.4",scope:null,escapedName:"jsondiffpatch",name:"jsondiffpatch",rawSpec:"^0.2.4",spec:">=0.2.4 <0.3.0",type:"range"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/jsondiffpatch/-/jsondiffpatch-0.2.4.tgz",_shasum:"d4b6c53b3fc7da1b4b91c1c2aec8b932b7511d5c",_shrinkwrap:null,_spec:"jsondiffpatch@^0.2.4",_where:"/projects/Telepat/telepat-js",author:{name:"Benjamin Eidelman",email:"beneidel@gmail.com"},bin:{jsondiffpatch:"./bin/jsondiffpatch"},bugs:{url:"https://github.com/benjamine/jsondiffpatch/issues"},bundleDependencies:[],contributors:[{name:"Benjamin Eidelman",email:"beneidel@gmail.com"}],dependencies:{chalk:"^0.5.1"},description:"Diff & Patch for Javascript objects",devDependencies:{"bulk-require":"^0.2.1","codeclimate-test-reporter":"0.0.3","expect.js":"~0.3.1",fiberglass:"0.0.22",gulp:"^3.8.8",istanbul:"^0.3.2",mocha:"^1.21.4"},directories:{},dist:{shasum:"d4b6c53b3fc7da1b4b91c1c2aec8b932b7511d5c",tarball:"https://registry.npmjs.org/jsondiffpatch/-/jsondiffpatch-0.2.4.tgz"},engine:{node:">=0.10"},engines:{node:"*"},gitHead:"0fe51f884695b02179e7a836a82b4241243d78cb",homepage:"https://github.com/benjamine/jsondiffpatch",keywords:["json","diff","patch"],license:"MIT",main:"./src/main",maintainers:[{name:"beneidel",email:"beneidel@gmail.com"}],name:"jsondiffpatch",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+https://github.com/benjamine/jsondiffpatch.git"},scripts:{bump:"gulp bump",cover:"istanbul cover --root src gulp test","cover-publish":"istanbul cover _mocha --report lcovonly && codeclimate < coverage/lcov.info","cover-report":"open coverage/lcov-report/index.html",test:"gulp test && gulp test-browser"},testling:{harness:"mocha",files:"test/index.js",scripts:["build/jsondiffpatch.js","external/diff_match_patch_uncompressed.js"],browsers:["ie/8..latest","chrome/27..latest","firefox/22..latest","safari/5.1..latest","opera/12..latest","iphone/6..latest","ipad/6..latest","android-browser/4.2..latest"]},version:"0.2.4"}},function(t,e,n){var r=n(53),o=n(60),i=o.BaseFormatter,s={added:r.green,deleted:r.red,movedestination:r.gray,moved:r.yellow,unchanged:r.gray,error:r.white.bgRed,textDiffLine:r.gray},a=function(){this.includeMoveDestinations=!1};a.prototype=new i,a.prototype.prepareContext=function(t){i.prototype.prepareContext.call(this,t),t.indent=function(t){this.indentLevel=(this.indentLevel||0)+("undefined"==typeof t?1:t),this.indentPad=new Array(this.indentLevel+1).join("  "),this.outLine()},t.outLine=function(){this.buffer.push("\n"+(this.indentPad||""))},t.out=function(){for(var t=0,e=arguments.length;t<e;t++){var n=arguments[t].split("\n"),r=n.join("\n"+(this.indentPad||""));this.color&&this.color[0]&&(r=this.color[0](r)),this.buffer.push(r)}},t.pushColor=function(t){this.color=this.color||[],this.color.unshift(t)},t.popColor=function(){this.color=this.color||[],this.color.shift()}},a.prototype.typeFormattterErrorFormatter=function(t,e){t.pushColor(s.error),t.out("[ERROR]"+e),t.popColor()},a.prototype.formatValue=function(t,e){t.out(JSON.stringify(e,null,2))},a.prototype.formatTextDiffString=function(t,e){var n=this.parseTextDiff(e);t.indent();for(var r=0,o=n.length;r<o;r++){var i=n[r];t.pushColor(s.textDiffLine),t.out(i.location.line+","+i.location.chr+" "),t.popColor();for(var a=i.pieces,c=0,u=a.length;c<u;c++){var f=a[c];t.pushColor(s[f.type]),t.out(f.text),t.popColor()}r<o-1&&t.outLine()}t.indent(-1)},a.prototype.rootBegin=function(t,e,n){t.pushColor(s[e]),"node"===e&&(t.out("array"===n?"[":"{"),t.indent())},a.prototype.rootEnd=function(t,e,n){"node"===e&&(t.indent(-1),t.out("array"===n?"]":"}")),t.popColor()},a.prototype.nodeBegin=function(t,e,n,r,o){t.pushColor(s[r]),t.out(n+": "),"node"===r&&(t.out("array"===o?"[":"{"),t.indent())},a.prototype.nodeEnd=function(t,e,n,r,o,i){"node"===r&&(t.indent(-1),t.out("array"===o?"]":"}"+(i?"":","))),i||t.outLine(),t.popColor()},a.prototype.format_unchanged=function(t,e,n){"undefined"!=typeof n&&this.formatValue(t,n)},a.prototype.format_movedestination=function(t,e,n){"undefined"!=typeof n&&this.formatValue(t,n)},a.prototype.format_node=function(t,e,n){this.formatDeltaChildren(t,e,n)},a.prototype.format_added=function(t,e){this.formatValue(t,e[0])},a.prototype.format_modified=function(t,e){t.pushColor(s.deleted),this.formatValue(t,e[0]),t.popColor(),t.out(" => "),t.pushColor(s.added),this.formatValue(t,e[1]),t.popColor()},a.prototype.format_deleted=function(t,e){this.formatValue(t,e[0])},a.prototype.format_moved=function(t,e){t.out("==> "+e[1])},a.prototype.format_textdiff=function(t,e){this.formatTextDiffString(t,e[0])},e.ConsoleFormatter=a;var c,u=function(t,e){return c||(c=new a),c.format(t,e)};e.log=function(t,e){console.log(u(t,e))},e.format=u},function(t,e,n){"use strict";function r(t){var e=function n(){return o.apply(n,arguments)};return e._styles=t,e.__proto__=p,e}function o(){var t=arguments,e=t.length,n=0!==e&&String(arguments[0]);if(e>1)for(var r=1;r<e;r++)n+=" "+t[r];if(!h.enabled||!n)return n;for(var o=this._styles,i=0;i<o.length;i++){var s=a[o[i]];n=s.open+n.replace(s.closeRe,s.open)+s.close}return n}function i(){var t={};return Object.keys(d).forEach(function(e){t[e]={get:function(){return r([e])}}}),t}var s=n(54),a=n(55),c=n(56),u=n(58),f=n(59),l=Object.defineProperties,h=t.exports,d=function(){var t={};return a.grey=a.gray,Object.keys(a).forEach(function(e){a[e].closeRe=new RegExp(s(a[e].close),"g"),t[e]={get:function(){return r(this._styles.concat(e))}}}),t}(),p=l(function(){},d);l(h,i()),h.styles=a,h.hasColor=u,h.stripColor=c,h.supportsColor=f,void 0===h.enabled&&(h.enabled=h.supportsColor)},function(t,e){"use strict";var n=/[|\\{}()[\]^$+*?.]/g;t.exports=function(t){if("string"!=typeof t)throw new TypeError("Expected a string");return t.replace(n,"\\$&")}},function(t,e){"use strict";var n=t.exports,r={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49]};Object.keys(r).forEach(function(t){var e=r[t],o=n[t]={};o.open="["+e[0]+"m",o.close="["+e[1]+"m"})},function(t,e,n){"use strict";var r=n(57)();t.exports=function(t){return"string"==typeof t?t.replace(r,""):t}},function(t,e){"use strict";t.exports=function(){return/\u001b\[(?:[0-9]{1,3}(?:;[0-9]{1,3})*)?[m|K]/g}},function(t,e,n){"use strict";var r=n(57),o=new RegExp(r().source);t.exports=o.test.bind(o)},function(t,e,n){(function(e){"use strict";t.exports=function(){return e.argv.indexOf("--no-color")===-1&&(e.argv.indexOf("--color")!==-1||!(e.stdout&&!e.stdout.isTTY)&&("win32"===e.platform||("COLORTERM"in e.env||"dumb"!==e.env.TERM&&!!/^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(e.env.TERM))))}()}).call(e,n(1))},function(t,e){var n="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},r="function"==typeof Object.keys?function(t){return Object.keys(t)}:function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e},o=function(t){return"_"===t.substr(0,1)?t.slice(1):t},i=function(t){return"_t"===t?-1:"_"===t.substr(0,1)?parseInt(t.slice(1),10):parseInt(t,10)+.1},s=function(t,e){return i(t)-i(e)},a=function(){};a.prototype.format=function(t,e){var n={};return this.prepareContext(n),this.recurse(n,t,e),this.finalize(n)},a.prototype.prepareContext=function(t){t.buffer=[],t.out=function(){this.buffer.push.apply(this.buffer,arguments)}},a.prototype.typeFormattterNotFound=function(t,e){throw new Error("cannot format delta type: "+e)},a.prototype.typeFormattterErrorFormatter=function(t,e){return e.toString()},a.prototype.finalize=function(t){if(n(t.buffer))return t.buffer.join("")},a.prototype.recurse=function(t,e,n,r,o,i,s){var a=e&&i,c=a?i.value:n;if("undefined"!=typeof e||"undefined"!=typeof r){var u=this.getDeltaType(e,i),f="node"===u?"a"===e._t?"array":"object":"";"undefined"!=typeof r?this.nodeBegin(t,r,o,u,f,s):this.rootBegin(t,u,f);var l;try{l=this["format_"+u]||this.typeFormattterNotFound(t,u),l.call(this,t,e,c,r,o,i)}catch(h){this.typeFormattterErrorFormatter(t,h,e,c,r,o,i),"undefined"!=typeof console&&console.error&&console.error(h.stack)}"undefined"!=typeof r?this.nodeEnd(t,r,o,u,f,s):this.rootEnd(t,u,f)}},a.prototype.formatDeltaChildren=function(t,e,n){var r=this;this.forEachDeltaKey(e,n,function(o,i,s,a){r.recurse(t,e[o],n?n[i]:void 0,o,i,s,a)})},a.prototype.forEachDeltaKey=function(t,e,i){var a,c=r(t),u="a"===t._t,f={};if("undefined"!=typeof e)for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&("undefined"!=typeof t[a]||u&&"undefined"!=typeof t["_"+a]||c.push(a));for(a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var l=t[a];n(l)&&3===l[2]&&(f[l[1].toString()]={key:a,value:e&&e[parseInt(a.substr(1))]},this.includeMoveDestinations!==!1&&"undefined"==typeof e&&"undefined"==typeof t[l[1]]&&c.push(l[1].toString()))}u?c.sort(s):c.sort();for(var h=0,d=c.length;h<d;h++){var p=c[h];if(!u||"_t"!==p){var v=u?"number"==typeof p?p:parseInt(o(p),10):p,y=h===d-1;i(p,v,f[v],y)}}},a.prototype.getDeltaType=function(t,e){if("undefined"==typeof t)return"undefined"!=typeof e?"movedestination":"unchanged";if(n(t)){if(1===t.length)return"added";if(2===t.length)return"modified";if(3===t.length&&0===t[2])return"deleted";if(3===t.length&&2===t[2])return"textdiff";if(3===t.length&&3===t[2])return"moved"}else if("object"==typeof t)return"node";return"unknown"},a.prototype.parseTextDiff=function(t){for(var e=[],n=t.split("\n@@ "),r=0,o=n.length;r<o;r++){var i=n[r],s={pieces:[]},a=/^(?:@@ )?[-+]?(\d+),(\d+)/.exec(i).slice(1);s.location={line:a[0],chr:a[1]};for(var c=i.split("\n").slice(1),u=0,f=c.length;u<f;u++){var l=c[u];if(l.length){var h={type:"context"};"+"===l.substr(0,1)?h.type="added":"-"===l.substr(0,1)&&(h.type="deleted"),h.text=l.slice(1),s.pieces.push(h)}}e.push(s)}return e},e.BaseFormatter=a},function(t,e,n){var r=n(35);if(e.base=n(60),e.html=n(62),e.annotated=n(63),e.jsonpatch=n(64),!r.isBrowser){var o="./console";e.console=n(50)(o)}},function(t,e,n){function r(t){for(var e=t,n=[[/&/g,"&amp;"],[/</g,"&lt;"],[/>/g,"&gt;"],[/'/g,"&apos;"],[/"/g,"&quot;"]],r=0;r<n.length;r++)e=e.replace(n[r][0],n[r][1]);return e}var o=n(60),i=o.BaseFormatter,s=function(){};s.prototype=new i,s.prototype.typeFormattterErrorFormatter=function(t,e){t.out('<pre class="jsondiffpatch-error">'+e+"</pre>")},s.prototype.formatValue=function(t,e){t.out("<pre>"+r(JSON.stringify(e,null,2))+"</pre>")},s.prototype.formatTextDiffString=function(t,e){var n=this.parseTextDiff(e);t.out('<ul class="jsondiffpatch-textdiff">');for(var o=0,i=n.length;o<i;o++){var s=n[o];t.out('<li><div class="jsondiffpatch-textdiff-location"><span class="jsondiffpatch-textdiff-line-number">'+s.location.line+'</span><span class="jsondiffpatch-textdiff-char">'+s.location.chr+'</span></div><div class="jsondiffpatch-textdiff-line">');for(var a=s.pieces,c=0,u=a.length;c<u;c++){var f=a[c];t.out('<span class="jsondiffpatch-textdiff-'+f.type+'">'+r(unescape(f.text))+"</span>")}t.out("</div></li>")}t.out("</ul>")};var a=function(t){t=t||document;var e=function(t){return t.textContent||t.innerText},n=function(t,e,n){for(var r=t.querySelectorAll(e),o=0,i=r.length;o<i;o++)n(r[o])},r=function(t,e){for(var n=0,r=t.children.length;n<r;n++)e(t.children[n],n)};n(t,".jsondiffpatch-arrow",function(t){var n=t.parentNode,o=t.children[0],i=o.children[1];o.style.display="none";var s,a=e(n.querySelector(".jsondiffpatch-moved-destination")),c=n.parentNode;if(r(c,function(t){t.getAttribute("data-key")===a&&(s=t)}),s)try{var u=s.offsetTop-n.offsetTop;o.setAttribute("height",Math.abs(u)+6),t.style.top=-8+(u>0?0:u)+"px";var f=u>0?"M30,0 Q-10,"+Math.round(u/2)+" 26,"+(u-4):"M30,"+-u+" Q-10,"+Math.round(-u/2)+" 26,4";i.setAttribute("d",f),o.style.display=""}catch(l){return}})};s.prototype.rootBegin=function(t,e,n){var r="jsondiffpatch-"+e+(n?" jsondiffpatch-child-node-type-"+n:"");t.out('<div class="jsondiffpatch-delta '+r+'">')},s.prototype.rootEnd=function(t){t.out("</div>"+(t.hasArrows?'<script type="text/javascript">setTimeout('+a.toString()+",10);</script>":""))},s.prototype.nodeBegin=function(t,e,n,r,o){var i="jsondiffpatch-"+r+(o?" jsondiffpatch-child-node-type-"+o:"");t.out('<li class="'+i+'" data-key="'+n+'"><div class="jsondiffpatch-property-name">'+n+"</div>")},s.prototype.nodeEnd=function(t){t.out("</li>")},s.prototype.format_unchanged=function(t,e,n){"undefined"!=typeof n&&(t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,n),t.out("</div>"))},s.prototype.format_movedestination=function(t,e,n){"undefined"!=typeof n&&(t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,n),t.out("</div>"))},s.prototype.format_node=function(t,e,n){var r="a"===e._t?"array":"object";t.out('<ul class="jsondiffpatch-node jsondiffpatch-node-type-'+r+'">'),this.formatDeltaChildren(t,e,n),t.out("</ul>")},s.prototype.format_added=function(t,e){t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,e[0]),t.out("</div>")},s.prototype.format_modified=function(t,e){t.out('<div class="jsondiffpatch-value jsondiffpatch-left-value">'),this.formatValue(t,e[0]),t.out('</div><div class="jsondiffpatch-value jsondiffpatch-right-value">'),this.formatValue(t,e[1]),t.out("</div>")},s.prototype.format_deleted=function(t,e){t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,e[0]),t.out("</div>")},s.prototype.format_moved=function(t,e){t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,e[0]),t.out('</div><div class="jsondiffpatch-moved-destination">'+e[1]+"</div>"),t.out('<div class="jsondiffpatch-arrow" style="position: relative; left: -34px;">\t        <svg width="30" height="60" style="position: absolute; display: none;">\t        <defs>\t            <marker id="markerArrow" markerWidth="8" markerHeight="8" refx="2" refy="4"\t                   orient="auto" markerUnits="userSpaceOnUse">\t                <path d="M1,1 L1,7 L7,4 L1,1" style="fill: #339;" />\t            </marker>\t        </defs>\t        <path d="M30,0 Q-10,25 26,50" style="stroke: #88f; stroke-width: 2px; fill: none;\t        stroke-opacity: 0.5; marker-end: url(#markerArrow);"></path>\t        </svg>\t        </div>'),t.hasArrows=!0},s.prototype.format_textdiff=function(t,e){t.out('<div class="jsondiffpatch-value">'),this.formatTextDiffString(t,e[0]),t.out("</div>")};var c=function(t,e,n){var r=e||document.body,o="jsondiffpatch-unchanged-",i={showing:o+"showing",hiding:o+"hiding",visible:o+"visible",hidden:o+"hidden"},s=r.classList;if(s){if(!n)return s.remove(i.showing),s.remove(i.hiding),s.remove(i.visible),s.remove(i.hidden),void(t===!1&&s.add(i.hidden));t===!1?(s.remove(i.showing),s.add(i.visible),setTimeout(function(){s.add(i.hiding)},10)):(s.remove(i.hiding),s.add(i.showing),s.remove(i.hidden));var c=setInterval(function(){a(r)},100);setTimeout(function(){s.remove(i.showing),s.remove(i.hiding),t===!1?(s.add(i.hidden),s.remove(i.visible)):(s.add(i.visible),s.remove(i.hidden)),setTimeout(function(){s.remove(i.visible),clearInterval(c)},n+400)},n)}},u=function(t,e){return c(!1,t,e)};e.HtmlFormatter=s,e.showUnchanged=c,e.hideUnchanged=u;var f;e.format=function(t,e){return f||(f=new s),f.format(t,e)}},function(t,e,n){var r=n(60),o=r.BaseFormatter,i=function(){this.includeMoveDestinations=!1};i.prototype=new o,i.prototype.prepareContext=function(t){o.prototype.prepareContext.call(this,t),t.indent=function(t){this.indentLevel=(this.indentLevel||0)+("undefined"==typeof t?1:t),this.indentPad=new Array(this.indentLevel+1).join("&nbsp;&nbsp;")},t.row=function(e,n){t.out('<tr><td style="white-space: nowrap;"><pre class="jsondiffpatch-annotated-indent" style="display: inline-block">'),t.out(t.indentPad),t.out('</pre><pre style="display: inline-block">'),t.out(e),t.out('</pre></td><td class="jsondiffpatch-delta-note"><div>'),t.out(n),t.out("</div></td></tr>")}},i.prototype.typeFormattterErrorFormatter=function(t,e){t.row("",'<pre class="jsondiffpatch-error">'+e+"</pre>")},i.prototype.formatTextDiffString=function(t,e){var n=this.parseTextDiff(e);t.out('<ul class="jsondiffpatch-textdiff">');for(var r=0,o=n.length;r<o;r++){var i=n[r];t.out('<li><div class="jsondiffpatch-textdiff-location"><span class="jsondiffpatch-textdiff-line-number">'+i.location.line+'</span><span class="jsondiffpatch-textdiff-char">'+i.location.chr+'</span></div><div class="jsondiffpatch-textdiff-line">');for(var s=i.pieces,a=0,c=s.length;a<c;a++){var u=s[a];t.out('<span class="jsondiffpatch-textdiff-'+u.type+'">'+u.text+"</span>")}t.out("</div></li>")}t.out("</ul>")},i.prototype.rootBegin=function(t,e,n){t.out('<table class="jsondiffpatch-annotated-delta">'),"node"===e&&(t.row("{"),t.indent()),"array"===n&&t.row('"_t": "a",',"Array delta (member names indicate array indices)")},i.prototype.rootEnd=function(t,e){"node"===e&&(t.indent(-1),t.row("}")),t.out("</table>")},i.prototype.nodeBegin=function(t,e,n,r,o){t.row("&quot;"+e+"&quot;: {"),"node"===r&&t.indent(),"array"===o&&t.row('"_t": "a",',"Array delta (member names indicate array indices)")},i.prototype.nodeEnd=function(t,e,n,r,o,i){"node"===r&&t.indent(-1),t.row("}"+(i?"":","))},i.prototype.format_unchanged=function(){},i.prototype.format_movedestination=function(){},i.prototype.format_node=function(t,e,n){this.formatDeltaChildren(t,e,n)};var s=function(t){return'<pre style="display:inline-block">&quot;'+t+"&quot;</pre>"},a={added:function(t,e,n,r){var o=" <pre>([newValue])</pre>";return"undefined"==typeof r?"new value"+o:"number"==typeof r?"insert at index "+r+o:"add property "+s(r)+o},modified:function(t,e,n,r){var o=" <pre>([previousValue, newValue])</pre>";return"undefined"==typeof r?"modify value"+o:"number"==typeof r?"modify at index "+r+o:"modify property "+s(r)+o},deleted:function(t,e,n,r){var o=" <pre>([previousValue, 0, 0])</pre>";return"undefined"==typeof r?"delete value"+o:"number"==typeof r?"remove index "+r+o:"delete property "+s(r)+o},moved:function(t,e,n,r){return'move from <span title="(position to remove at original state)">index '+r+'</span> to <span title="(position to insert at final state)">index '+t[1]+"</span>"},textdiff:function(t,e,n,r){var o="undefined"==typeof r?"":"number"==typeof r?" at index "+r:" at property "+s(r);return"text diff"+o+', format is <a href="https://code.google.com/p/google-diff-match-patch/wiki/Unidiff">a variation of Unidiff</a>'}},c=function(t,e){var n=this.getDeltaType(e),r=a[n],o=r&&r.apply(r,Array.prototype.slice.call(arguments,1)),i=JSON.stringify(e,null,2);"textdiff"===n&&(i=i.split("\\n").join('\\n"+\n   "')),t.indent(),t.row(i,o),t.indent(-1)};i.prototype.format_added=c,i.prototype.format_modified=c,i.prototype.format_deleted=c,i.prototype.format_moved=c,i.prototype.format_textdiff=c,e.AnnotatedFormatter=i;var u;e.format=function(t,e){return u||(u=new i),u.format(t,e)}},function(t,e,n){!function(){function t(){this.includeMoveDestinations=!1}function r(t){return t[t.length-1]}function o(t,e){return t.sort(e),t}function i(t){return o(t,function(t,e){var n=t.path.split("/"),o=e.path.split("/");return n.length!==o.length?n.length-o.length:h(r(n),r(o))})}function s(t,e){var n=[],r=[];return t.forEach(function(t){var o=e(t)?n:r;o.push(t)}),[n,r]}function a(t){var e=s(t,function(t){return"remove"===t.op}),n=e[0],r=e[1],o=i(n);return o.concat(r)}var c=n(60),u=c.BaseFormatter,f={added:"add",deleted:"remove",modified:"replace",moved:"moved",movedestination:"movedestination",unchanged:"unchanged",error:"error",textDiffLine:"textDiffLine"};t.prototype=new u,t.prototype.prepareContext=function(t){u.prototype.prepareContext.call(this,t),t.result=[],t.path=[],t.pushCurrentOp=function(t,e){var n={op:t,path:this.currentPath()};"undefined"!=typeof e&&(n.value=e),this.result.push(n)},t.currentPath=function(){return"/"+this.path.join("/")}},t.prototype.typeFormattterErrorFormatter=function(t,e){t.out("[ERROR]"+e)},t.prototype.rootBegin=function(){},t.prototype.rootEnd=function(){},t.prototype.nodeBegin=function(t,e,n){t.path.push(n)},t.prototype.nodeEnd=function(t){t.path.pop()},t.prototype.format_unchanged=function(t,e,n){"undefined"!=typeof n&&t.pushCurrentOp(f.unchanged,n)},t.prototype.format_movedestination=function(t,e,n){"undefined"!=typeof n&&t.pushCurrentOp(f.movedestination,n)},t.prototype.format_node=function(t,e,n){this.formatDeltaChildren(t,e,n)},t.prototype.format_added=function(t,e){t.pushCurrentOp(f.added,e[0])},t.prototype.format_modified=function(t,e){t.pushCurrentOp(f.modified,e[1])},t.prototype.format_deleted=function(t){t.pushCurrentOp(f.deleted)},t.prototype.format_moved=function(t,e){t.pushCurrentOp(f.moved,e[1])},t.prototype.format_textdiff=function(){throw"not implimented"},t.prototype.format=function(t,e){var n={};return this.prepareContext(n),this.recurse(n,t,e),n.result},e.JSONFormatter=t;var l,h=function(t,e){var n=parseInt(t,10),r=parseInt(e,10);return isNaN(n)||isNaN(r)?0:r-n},d=function(e,n){return l||(l=new t),a(l.format(e,n))};e.log=function(t,e){console.log(d(t,e))},e.format=d}()},function(t,e){t.exports=function(t,e){var n;return"string"==typeof e&&(n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d*))?(Z|([+\-])(\d{2}):(\d{2}))$/.exec(e))?new Date(Date.UTC(+n[1],+n[2]-1,+n[3],+n[4],+n[5],+n[6],+(n[7]||0))):e}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(28),a=r(s),c=n(17),u=r(c),f=n(25),l=r(f),h=n(27),d=r(h),p=function(){function t(e,n){var r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],i=this,s=arguments.length<=3||void 0===arguments[3]?null:arguments[3],c=arguments.length<=4||void 0===arguments[4]?null:arguments[4];o(this,t),this._event=new a["default"](l["default"]),this._monitor=e,this._options=n,this._addCallback=r,this._updateCallback=s,this._removeCallback=c,this._subscribed=!1,this.objects={},this.objectsArray=[],this.objectsCount=null,this._event.on("update",function(t,e,n,r){"add"===t?(i.objectsArray.push(n),i._sortObjectArray(),i.objectsCount&&i.objectsCount++):"delete"===t&&(i.objectsArray=i.objectsArray.filter(function(t){return t.id!==e}),i._sortObjectArray(),i.objectsCount&&i.objectsCount--)})}return i(t,[{key:"_sortObjectArray",value:function(){var t=this;this._options.sort&&this.objectsArray.sort(function(e,n){var r=null;return Object.keys(t._options.sort).map(function(o){var i=t._options.sort[o],s="asc"===i?1:-1;e[o]&&!n[o]&&(r=s),!e[o]&&n[o]&&(r=-s),e[o]&&n[o]&&(e[o]<n[o]&&(r=-s),e[o]>n[o]&&(r=s))}),r?r:0})}},{key:"subscribe",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];u["default"].call("object/subscribe",this._options,function(n,r){if(n)t._event.emit("error",(0,d["default"])("Subscribe failed with error: "+n)),e(n,null);else{var o=void 0;for(t.objects={},t.objectsArray=[],t.objectsCount=0,o=0;o<r.body.content.length;o++)t.objects[r.body.content[o].id]=r.body.content[o];t.objectsArray=r.body.content,t._sortObjectArray();var i=Object.keys(t.objects);
for(o=0;o<i.length;o++)t.objects[i[o]].$$event=new a["default"](l["default"]);t._monitor.add(t._options,t.objects,t._event,t._addCallback||t.add.bind(t),t._removeCallback||t.remove.bind(t),t._updateCallback||t.update.bind(t)),t._subscribed?t._event.emit("update","resync"):t._event.emit("subscribe"),t._subscribed=!0,e(null,t)}})}},{key:"unsubscribe",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];u["default"].call("object/unsubscribe",this._options,function(n){n?(t._event.emit("error",(0,d["default"])("Unsubscribe failed with error: "+n)),e(n,null)):(t.objects={},t.objectsArray=[],t.objectsCount=null,t._monitor.remove(t._options),t._event.emit("unsubscribe"),t._event.emit("_unsubscribe"),t._subscribed=!1,e(null,t))})}},{key:"getCount",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];u["default"].call("object/count",this._options,function(n,r){n?(t._event.emit("error",(0,d["default"])("Get object count failed with error: "+n)),e(n,null)):(t.objectsCount=r.body.content.count,e(null,t.objectsCount))})}},{key:"add",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];u["default"].call("object/create",{model:this._options.channel.model,context:this._options.channel.context||t.context_id,content:t},function(r){r?(e._event.emit("error",(0,d["default"])("Adding object failed with error: "+r)),n(r,null)):n(null,t)})}},{key:"remove",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];u["default"].del("object/delete",{model:this._options.channel.model,context:this._options.channel.context||this.objects[t].context_id,id:t},function(r){r?(e._event.emit("error",(0,d["default"])("Removing object failed with error: "+r)),n(r,null)):n(null,t)})}},{key:"update",value:function(t,e){var n=this;arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2];u["default"].call("object/update",{model:this._options.channel.model,context:this._options.channel.context||this.objects[t].context_id,id:t,patches:e},function(t){t&&n._event.emit("error",(0,d["default"])("Updating object failed with error: "+t))})}},{key:"on",value:function(t,e){return this._event.on(t,e)}},{key:"removeCallback",value:function(t,e){return this._event.removeCallback(t,e)}}]),t}();e["default"]=p,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(17),a=r(s),c=n(25),u=r(c),f=n(27),l=r(f),h=n(68),d=r(h),p=function(){function t(e,n,r,i){var s=this,c=arguments.length<=4||void 0===arguments[4]?function(){}:arguments[4];o(this,t),this._event=n,this._monitor=r,this._setAdmin=i,this._db=e,this._customProperties=[],this._userChannel=null,this.isAdmin=!1,this.canReauth=null,this.data={},this.isLoggedIn=!1,a["default"].tokenUpdateCallback=function(t){s._saveToken(t)},this._db.get(":userToken").then(function(t){s.canReauth=!0,c()})["catch"](function(){s.canReauth=!1,c()})}return i(t,[{key:"_saveToken",value:function(t){var e=this,n={_id:":userToken",value:{token:t,admin:this.isAdmin}};this._db.get(":userToken").then(function(t){n._rev=t._rev,u["default"].info("Replacing existing authentication token"),e._db.put(n).then(function(t){e.canReauth=!0})["catch"](function(t){e.canReauth=!1,u["default"].warn("Could not persist authentication token. Error: "+t)})})["catch"](function(){e._db.put(n).then(function(t){e.canReauth=!0})["catch"](function(t){e.canReauth=!1,u["default"].warn("Could not persist authentication token. Error: "+t)})})}},{key:"_login",value:function(t,e,n){var r=this,o=arguments.length<=3||void 0===arguments[3]?function(){}:arguments[3],i=function(t){var e={};r.isLoggedIn=!0;for(var i in t.body.content.user)r.data[i]=t.body.content.user[i],r._customProperties.push(i);n&&(r.isAdmin=!0,r._setAdmin(new d["default"](r))),e[r.data.id]=r.data,r._monitor.add({channel:{model:r.isAdmin?"admin":"user"}},e,null,function(){},function(){},r.update.bind(r)),a["default"].authenticationToken=t.body.content.token,r._saveToken(a["default"].authenticationToken),r._event.emit("login"),o(null,r)};a["default"].call(t,e,function(n,s){n?404===n.status&&e.hasOwnProperty("access_token")?(u["default"].info("Got 404 on Facebook login, registering user first"),a["default"].call("user/register-facebook",e,function(n,o){n?(u["default"].error("Failed to login with Facebook. Could not register or login user."),r._event.emit("login_error",(0,l["default"])("Login failed with error: "+n))):a["default"].call(t,e,function(t,e){t?(u["default"].error("Failed to login with Facebook. User registration was successful, but login failed."),this._event.emit("login_error",(0,l["default"])("Login failed with error: "+t))):i(e)})})):(r._event.emit("login_error",(0,l["default"])("Login failed with error: "+n)),o(n,null)):i(s)})}},{key:"reauth",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];this._db.get(":userToken").then(function(n){u["default"].info("Retrieved saved authentication token"),a["default"].authenticationToken=n.value.token,a["default"].get(n.value.admin?"admin/me":"user/me","",function(t,r){if(t)a["default"].authenticationToken=null,this._setAdmin(null),this._db.remove(n._id,n._rev),this.canReauth=!1,e((0,l["default"])("Saved authentication token expired"),null),this._customProperties=[],this.data={},this.isLoggedIn=!1,this._event.emit("logout");else{var o={};this.isLoggedIn=!0;for(var i in r.body.content)this.data[i]=r.body.content[i],this._customProperties.push(i);"admin"===r.body.content.type&&(this.isAdmin=!0,this._saveToken(a["default"].authenticationToken),this._setAdmin(new d["default"](this))),o[this.data.id]=this.data,this._monitor.add({channel:{model:this.isAdmin?"admin":"user"}},o,null,function(){},function(){},this.update.bind(this)),e(null,r),this._event.emit("login")}}.bind(t))})["catch"](function(t){e((0,l["default"])("Error retrieving authentication token: "+t),null)})}},{key:"update",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2];a["default"].call(this.isAdmin?"admin/update":"user/update",{patches:e},function(t,e){t?n((0,l["default"])("Failed updating user: "+e.body.message)):n()})}},{key:"requestPasswordReset",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2];if(!t){if(!this.email)return void n((0,l["default"])("You must provide a valid email address for the account that needs the password reset"),null);t=this.email}a["default"].call("user/request_password_reset",{callbackUrl:e,username:t},function(t,e){t?n((0,l["default"])("Password reset request failed with error: "+t),null):n(null,e.body.content)})}},{key:"resetPassword",value:function(t,e,n){var r=arguments.length<=3||void 0===arguments[3]?function(){}:arguments[3];return t&&e&&n?void a["default"].call("user/password_reset",{token:e,user_id:t,password:n},function(t,e){t?r((0,l["default"])("Password reset request failed with error: "+t),null):r(null,e.body.content)}):void r((0,l["default"])("You must provide a valid user-id, pass reset token and new password for the account that needs the password reset"),null)}},{key:"register",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];a["default"].call("user/register-username",t,e)}},{key:"registerAdmin",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];a["default"].call("admin/add",t,function(t,n){t?e((0,l["default"])("Register failed with error: "+n.body.message||""),null):e(null,n.body.content)})}},{key:"loginWithFacebook",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];return this._login("user/login-facebook",{access_token:t},!1,e)}},{key:"login",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2];return this._login("user/login_password",{username:t,password:e},!1,n)}},{key:"loginAdmin",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2];return this._login("admin/login",{email:t,password:e},!0,n)}},{key:"get",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];a["default"].get("user/get","user_id="+encodeURIComponent(t),function(t,n){t?e((0,l["default"])("Retrieving user failed with error: "+t),null):e(null,n.body.content)})}},{key:"me",value:function(){var t=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];a["default"].get(this.isAdmin?"admin/me":"user/me","",function(e,n){e?t(console.error("Request failed with error: "+e),null):t(null,JSON.parse(n.text).content)})}},{key:"logout",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];this._db.get(":userToken").then(function(e){t._db.remove(e._id,e._rev)})["catch"](function(){}),this._setAdmin(null),this.isAdmin=!1,this.isLoggedIn=!1,this.canReauth=!1,this._customProperties=[],this.data={},a["default"].get("user/logout","",function(n){a["default"].authenticationToken=null,n?(t._event.emit("logout_error",(0,l["default"])("Logout failed with error: "+n)),e(n)):(t._event.emit("logout"),e())})}}]),t}();e["default"]=p,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(17),a=r(s),c=n(27),u=r(c),f=n(28),l=r(f),h=n(25),d=r(h),p=function(){function t(e){o(this,t),this._user=e,this._monitor=e._monitor,this._event=e._event,this.userChannel=null,this.apps=null,this.app=null,this.users=null}return i(t,[{key:"getApps",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];a["default"].call("admin/apps","",function(n,r){if(n)e((0,u["default"])("Retrieving apps failed with error: "+n),null);else{t.apps={};for(var o in r.body.content){var i=r.body.content[o];t.apps[i.id]=i}t.app=t.apps[a["default"].appId],t._monitor.add({channel:{model:"application"}},t.apps,new l["default"](d["default"]),function(){},function(){},t.updateApp),e(null,r.body.content)}},"get")}},{key:"addApp",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];a["default"].call("admin/app/add",t,function(t,r){t?n((0,u["default"])("Adding application failed with error: "+t),null):(e._monitor.processMessage({data:{"new":[{op:"create",object:r.body.content,subscriptions:["blg:null:application"]}],updated:[],deleted:[]}}),n(null,r.body.content))})}},{key:"updateApp",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2];t!==a["default"].appId&&n((0,u["default"])("Cannot update an app that is not active. Please reconnect to that specific app id to make updates.")),a["default"].call("admin/app/update",{id:t,patches:e},function(t,e){t?n((0,u["default"])("Updating application failed with error: "+t)):n()})}},{key:"deleteApp",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];a["default"].del("admin/app/remove",{id:t},function(r,o){r?n((0,u["default"])("Removing application failed with error: "+r),null):(e._monitor.processMessage({data:{deleted:[{op:"delete",object:{id:t},subscriptions:["blg:null:application"]}],updated:[],"new":[]}}),n())})}},{key:"addCollection",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];a["default"].call("admin/context/add",t,function(t,n){t?e((0,u["default"])("Creating collection failed with error: "+t)):e(null,n)})}},{key:"updateCollection",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2];a["default"].call("admin/context/update",{id:t,patches:e},function(t,e){t?n((0,u["default"])("Updating collection failed with error: "+t)):n()})}},{key:"deleteCollection",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];a["default"].del("admin/context/remove",{id:t},function(t,n){t?e((0,u["default"])("Deleting collection failed with error: "+t)):e()})}},{key:"deleteModel",value:function(t,e){a["default"].del("admin/schema/remove_model",{model_name:t},function(t,n){t?e((0,u["default"])("Deleting model failed with error: "+t)):e()})}},{key:"getAppUsers",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];a["default"].call("admin/users",{},function(n,r){if(n)e((0,u["default"])("Retrieving users failed with error: "+n),null);else{t.users={};for(var o in r.body.content)t.users[r.body.content[o].id]=r.body.content[o];t.userChannel=new l["default"](d["default"]),t._monitor.add({channel:{model:"user"}},t.users,t.userChannel,t.addUser.bind(t),t.deleteUser,t.updateUser),e(null,t.users)}})}},{key:"addUser",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];this._user.register(t,e)}},{key:"deleteUser",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];a["default"].del("admin/user/delete",{id:t},function(t,n){t?e((0,u["default"])("Removing user failed with error: "+t),null):e()})}},{key:"updateUser",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2];a["default"].call("admin/user/update",{patches:e},function(t,e){t?n((0,u["default"])("Updating user failed with error: "+t),null):n()})}},{key:"authorize",value:function(t,e){a["default"].call("/admin/app/authorize",{email:t},function(t,n){t?e((0,u["default"])("Authorizing admin failed with error: "+t),null):e()})}},{key:"deauthorize",value:function(t,e){a["default"].call("/admin/app/deauthorize",{email:t},function(t,n){t?e((0,u["default"])("Deauthorizing admin failed with error: "+t),null):e()})}},{key:"unhook",value:function(){this._monitor.remove({channel:{model:"application"}}),this._monitor.remove({channel:{model:"user"}})}}]),t}();e["default"]=p,t.exports=e["default"]},function(t,e,n){function r(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,r=o(t),i=r.source,u=r.id,f=r.path,l=c[u]&&f in c[u].nsps,h=e.forceNew||e["force new connection"]||!1===e.multiplex||l;return h?(a("ignoring socket cache for %s",i),n=s(i,e)):(c[u]||(a("new io instance for %s",i),c[u]=s(i,e)),n=c[u]),n.socket(r.path)}var o=n(70),i=n(75),s=n(83),a=n(72)("socket.io-client");t.exports=e=r;var c=e.managers={};e.protocol=i.protocol,e.connect=r,e.Manager=n(83),e.Socket=n(111)},function(t,e,n){(function(e){function r(t,n){var r=t,n=n||e.location;null==t&&(t=n.protocol+"//"+n.host),"string"==typeof t&&("/"==t.charAt(0)&&(t="/"==t.charAt(1)?n.protocol+t:n.host+t),/^(https?|wss?):\/\//.test(t)||(i("protocol-less url %s",t),t="undefined"!=typeof n?n.protocol+"//"+t:"https://"+t),i("parse %s",t),r=o(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var s=r.host.indexOf(":")!==-1,a=s?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+a+":"+r.port,r.href=r.protocol+"://"+a+(n&&n.port==r.port?"":":"+r.port),r}var o=n(71),i=n(72)("socket.io-client:url");t.exports=r}).call(e,function(){return this}())},function(t,e){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var e=t,o=t.indexOf("["),i=t.indexOf("]");o!=-1&&i!=-1&&(t=t.substring(0,o)+t.substring(o,i).replace(/:/g,";")+t.substring(i,t.length));for(var s=n.exec(t||""),a={},c=14;c--;)a[r[c]]=s[c]||"";return o!=-1&&i!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(t,e,n){function r(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function o(){var t=arguments,n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return t;var r="color: "+this.color;t=[t[0],r,"color: inherit"].concat(Array.prototype.slice.call(t,1));var o=0,i=0;return t[0].replace(/%[a-z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(i=o))}),t.splice(i,0,r),t}function i(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(n){}}function a(){var t;try{t=e.storage.debug}catch(n){}return t}function c(){try{return window.localStorage}catch(t){}}e=t.exports=n(73),e.log=i,e.formatArgs=o,e.save=s,e.load=a,e.useColors=r,e.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){return JSON.stringify(t)},e.enable(a())},function(t,e,n){function r(){return e.colors[f++%e.colors.length]}function o(t){function n(){}function o(){var t=o,n=+new Date,i=n-(u||n);t.diff=i,t.prev=u,t.curr=n,u=n,null==t.useColors&&(t.useColors=e.useColors()),null==t.color&&t.useColors&&(t.color=r());var s=Array.prototype.slice.call(arguments);s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var a=0;s[0]=s[0].replace(/%([a-z%])/g,function(n,r){if("%%"===n)return n;a++;var o=e.formatters[r];if("function"==typeof o){var i=s[a];n=o.call(t,i),s.splice(a,1),a--}return n}),"function"==typeof e.formatArgs&&(s=e.formatArgs.apply(t,s));var c=o.log||e.log||console.log.bind(console);c.apply(t,s)}n.enabled=!1,o.enabled=!0;var i=e.enabled(t)?o:n;return i.namespace=t,i}function i(t){e.save(t);for(var n=(t||"").split(/[\s,]+/),r=n.length,o=0;o<r;o++)n[o]&&(t=n[o].replace(/\*/g,".*?"),"-"===t[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function s(){e.enable("")}function a(t){var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1}function c(t){return t instanceof Error?t.stack||t.message:t}e=t.exports=o,e.coerce=c,e.disable=s,e.enable=i,e.enabled=a,e.humanize=n(74),e.names=[],e.skips=[],e.formatters={};var u,f=0},function(t,e){function n(t){if(t=""+t,!(t.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*f;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}function r(t){return t>=u?Math.round(t/u)+"d":t>=c?Math.round(t/c)+"h":t>=a?Math.round(t/a)+"m":t>=s?Math.round(t/s)+"s":t+"ms"}function o(t){return i(t,u,"day")||i(t,c,"hour")||i(t,a,"minute")||i(t,s,"second")||t+" ms"}function i(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var s=1e3,a=60*s,c=60*a,u=24*c,f=365.25*u;t.exports=function(t,e){return e=e||{},"string"==typeof t?n(t):e["long"]?o(t):r(t)}},function(t,e,n){function r(){}function o(t){var n="",r=!1;return n+=t.type,e.BINARY_EVENT!=t.type&&e.BINARY_ACK!=t.type||(n+=t.attachments,n+="-"),t.nsp&&"/"!=t.nsp&&(r=!0,n+=t.nsp),null!=t.id&&(r&&(n+=",",r=!1),n+=t.id),null!=t.data&&(r&&(n+=","),n+=l.stringify(t.data)),f("encoded %j as %s",t,n),n}function i(t,e){function n(t){var n=d.deconstructPacket(t),r=o(n.packet),i=n.buffers;i.unshift(r),e(i)}d.removeBlobs(t,n)}function s(){this.reconstructor=null}function a(t){var n={},r=0;if(n.type=Number(t.charAt(0)),null==e.types[n.type])return u();if(e.BINARY_EVENT==n.type||e.BINARY_ACK==n.type){for(var o="";"-"!=t.charAt(++r)&&(o+=t.charAt(r),r!=t.length););if(o!=Number(o)||"-"!=t.charAt(r))throw new Error("Illegal attachments");n.attachments=Number(o)}if("/"==t.charAt(r+1))for(n.nsp="";++r;){var i=t.charAt(r);if(","==i)break;if(n.nsp+=i,r==t.length)break}else n.nsp="/";var s=t.charAt(r+1);if(""!==s&&Number(s)==s){for(n.id="";++r;){var i=t.charAt(r);if(null==i||Number(i)!=i){--r;break}if(n.id+=t.charAt(r),r==t.length)break}n.id=Number(n.id)}if(t.charAt(++r))try{n.data=l.parse(t.substr(r))}catch(a){return u()}return f("decoded %s as %j",t,n),n}function c(t){this.reconPack=t,this.buffers=[]}function u(t){return{type:e.ERROR,data:"parser error"}}var f=n(72)("socket.io-parser"),l=n(76),h=(n(79),n(80)),d=n(81),p=n(82);e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=r,e.Decoder=s,r.prototype.encode=function(t,n){if(f("encoding packet %j",t),e.BINARY_EVENT==t.type||e.BINARY_ACK==t.type)i(t,n);else{var r=o(t);n([r])}},h(s.prototype),s.prototype.add=function(t){var n;if("string"==typeof t)n=a(t),e.BINARY_EVENT==n.type||e.BINARY_ACK==n.type?(this.reconstructor=new c(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!p(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,this.emit("decoded",n))}},s.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},c.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length==this.reconPack.attachments){var e=d.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},c.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(t,e,n){var r;(function(t,o){(function(){function i(t,e){function n(t){if(n[t]!==y)return n[t];var i;if("bug-string-char-index"==t)i="a"!="a"[0];else if("json"==t)i=n("json-stringify")&&n("json-parse");else{var s,a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==t){var u=e.stringify,f="function"==typeof u&&_;if(f){(s=function(){return 1}).toJSON=s;try{f="0"===u(0)&&"0"===u(new r)&&'""'==u(new o)&&u(m)===y&&u(y)===y&&u()===y&&"1"===u(s)&&"[1]"==u([s])&&"[null]"==u([y])&&"null"==u(null)&&"[null,null,null]"==u([y,m,null])&&u({a:[s,!0,!1,null,"\0\b\n\f\r\t"]})==a&&"1"===u(null,s)&&"[\n 1,\n 2\n]"==u([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==u(new c((-864e13)))&&'"+275760-09-13T00:00:00.000Z"'==u(new c(864e13))&&'"-000001-01-01T00:00:00.000Z"'==u(new c((-621987552e5)))&&'"1969-12-31T23:59:59.999Z"'==u(new c((-1)))}catch(l){f=!1}}i=f}if("json-parse"==t){var h=e.parse;if("function"==typeof h)try{if(0===h("0")&&!h(!1)){s=h(a);var d=5==s.a.length&&1===s.a[0];if(d){try{d=!h('"\t"')}catch(l){}if(d)try{d=1!==h("01")}catch(l){}if(d)try{d=1!==h("1.")}catch(l){}}}}catch(l){d=!1}i=d}}return n[t]=!!i}t||(t=u.Object()),e||(e=u.Object());var r=t.Number||u.Number,o=t.String||u.String,s=t.Object||u.Object,c=t.Date||u.Date,f=t.SyntaxError||u.SyntaxError,l=t.TypeError||u.TypeError,h=t.Math||u.Math,d=t.JSON||u.JSON;"object"==typeof d&&d&&(e.stringify=d.stringify,e.parse=d.parse);var p,v,y,g=s.prototype,m=g.toString,_=new c((-0xc782b5b800cec));try{_=_.getUTCFullYear()==-109252&&0===_.getUTCMonth()&&1===_.getUTCDate()&&10==_.getUTCHours()&&37==_.getUTCMinutes()&&6==_.getUTCSeconds()&&708==_.getUTCMilliseconds()}catch(b){}if(!n("json")){var w="[object Function]",k="[object Date]",E="[object Number]",x="[object String]",A="[object Array]",S="[object Boolean]",j=n("bug-string-char-index");if(!_)var T=h.floor,C=[0,31,59,90,120,151,181,212,243,273,304,334],O=function(t,e){return C[e]+365*(t-1970)+T((t-1969+(e=+(e>1)))/4)-T((t-1901+e)/100)+T((t-1601+e)/400)};if((p=g.hasOwnProperty)||(p=function(t){var e,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=m?p=function(t){var e=this.__proto__,n=t in(this.__proto__=null,this);return this.__proto__=e,n}:(e=n.constructor,p=function(t){var n=(this.constructor||e).prototype;return t in this&&!(t in n&&this[t]===n[t])}),n=null,p.call(this,t)}),v=function(t,e){var n,r,o,i=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,r=new n;for(o in r)p.call(r,o)&&i++;return n=r=null,i?v=2==i?function(t,e){var n,r={},o=m.call(t)==w;for(n in t)o&&"prototype"==n||p.call(r,n)||!(r[n]=1)||!p.call(t,n)||e(n)}:function(t,e){var n,r,o=m.call(t)==w;for(n in t)o&&"prototype"==n||!p.call(t,n)||(r="constructor"===n)||e(n);(r||p.call(t,n="constructor"))&&e(n)}:(r=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],v=function(t,e){var n,o,i=m.call(t)==w,s=!i&&"function"!=typeof t.constructor&&a[typeof t.hasOwnProperty]&&t.hasOwnProperty||p;for(n in t)i&&"prototype"==n||!s.call(t,n)||e(n);for(o=r.length;n=r[--o];s.call(t,n)&&e(n));}),v(t,e)},!n("json-stringify")){var R={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},D="000000",q=function(t,e){return(D+(e||0)).slice(-t)},I="\\u00",B=function(t){for(var e='"',n=0,r=t.length,o=!j||r>10,i=o&&(j?t.split(""):t);n<r;n++){var s=t.charCodeAt(n);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=R[s];break;default:if(s<32){e+=I+q(2,s.toString(16));break}e+=o?i[n]:t.charAt(n)}}return e+'"'},L=function(t,e,n,r,o,i,s){var a,c,u,f,h,d,g,_,b,w,j,C,R,D,I,P;try{a=e[t]}catch(N){}if("object"==typeof a&&a)if(c=m.call(a),c!=k||p.call(a,"toJSON"))"function"==typeof a.toJSON&&(c!=E&&c!=x&&c!=A||p.call(a,"toJSON"))&&(a=a.toJSON(t));else if(a>-1/0&&a<1/0){if(O){for(h=T(a/864e5),u=T(h/365.2425)+1970-1;O(u+1,0)<=h;u++);for(f=T((h-O(u,0))/30.42);O(u,f+1)<=h;f++);h=1+h-O(u,f),d=(a%864e5+864e5)%864e5,g=T(d/36e5)%24,_=T(d/6e4)%60,b=T(d/1e3)%60,w=d%1e3}else u=a.getUTCFullYear(),f=a.getUTCMonth(),h=a.getUTCDate(),g=a.getUTCHours(),_=a.getUTCMinutes(),b=a.getUTCSeconds(),w=a.getUTCMilliseconds();a=(u<=0||u>=1e4?(u<0?"-":"+")+q(6,u<0?-u:u):q(4,u))+"-"+q(2,f+1)+"-"+q(2,h)+"T"+q(2,g)+":"+q(2,_)+":"+q(2,b)+"."+q(3,w)+"Z"}else a=null;if(n&&(a=n.call(e,t,a)),null===a)return"null";if(c=m.call(a),c==S)return""+a;if(c==E)return a>-1/0&&a<1/0?""+a:"null";if(c==x)return B(""+a);if("object"==typeof a){for(D=s.length;D--;)if(s[D]===a)throw l();if(s.push(a),j=[],I=i,i+=o,c==A){for(R=0,D=a.length;R<D;R++)C=L(R,a,n,r,o,i,s),j.push(C===y?"null":C);P=j.length?o?"[\n"+i+j.join(",\n"+i)+"\n"+I+"]":"["+j.join(",")+"]":"[]"}else v(r||a,function(t){var e=L(t,a,n,r,o,i,s);e!==y&&j.push(B(t)+":"+(o?" ":"")+e)}),P=j.length?o?"{\n"+i+j.join(",\n"+i)+"\n"+I+"}":"{"+j.join(",")+"}":"{}";return s.pop(),P}};e.stringify=function(t,e,n){var r,o,i,s;if(a[typeof e]&&e)if((s=m.call(e))==w)o=e;else if(s==A){i={};for(var c,u=0,f=e.length;u<f;c=e[u++],s=m.call(c),(s==x||s==E)&&(i[c]=1));}if(n)if((s=m.call(n))==E){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else s==x&&(r=n.length<=10?n:n.slice(0,10));return L("",(c={},c[""]=t,c),o,i,r,"",[])}}if(!n("json-parse")){var P,N,U=o.fromCharCode,M={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},F=function(){throw P=N=null,f()},H=function(){for(var t,e,n,r,o,i=N,s=i.length;P<s;)switch(o=i.charCodeAt(P)){case 9:case 10:case 13:case 32:P++;break;case 123:case 125:case 91:case 93:case 58:case 44:return t=j?i.charAt(P):i[P],P++,t;case 34:for(t="@",P++;P<s;)if(o=i.charCodeAt(P),o<32)F();else if(92==o)switch(o=i.charCodeAt(++P)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:t+=M[o],P++;break;case 117:for(e=++P,n=P+4;P<n;P++)o=i.charCodeAt(P),o>=48&&o<=57||o>=97&&o<=102||o>=65&&o<=70||F();t+=U("0x"+i.slice(e,P));break;default:F()}else{if(34==o)break;for(o=i.charCodeAt(P),e=P;o>=32&&92!=o&&34!=o;)o=i.charCodeAt(++P);t+=i.slice(e,P)}if(34==i.charCodeAt(P))return P++,t;F();default:if(e=P,45==o&&(r=!0,o=i.charCodeAt(++P)),o>=48&&o<=57){for(48==o&&(o=i.charCodeAt(P+1),o>=48&&o<=57)&&F(),r=!1;P<s&&(o=i.charCodeAt(P),o>=48&&o<=57);P++);if(46==i.charCodeAt(P)){for(n=++P;n<s&&(o=i.charCodeAt(n),o>=48&&o<=57);n++);n==P&&F(),P=n}if(o=i.charCodeAt(P),101==o||69==o){for(o=i.charCodeAt(++P),43!=o&&45!=o||P++,n=P;n<s&&(o=i.charCodeAt(n),o>=48&&o<=57);n++);n==P&&F(),P=n}return+i.slice(e,P)}if(r&&F(),"true"==i.slice(P,P+4))return P+=4,!0;if("false"==i.slice(P,P+5))return P+=5,!1;if("null"==i.slice(P,P+4))return P+=4,null;F()}return"$"},z=function(t){var e,n;if("$"==t&&F(),"string"==typeof t){if("@"==(j?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(e=[];t=H(),"]"!=t;n||(n=!0))n&&(","==t?(t=H(),"]"==t&&F()):F()),","==t&&F(),e.push(z(t));return e}if("{"==t){for(e={};t=H(),"}"!=t;n||(n=!0))n&&(","==t?(t=H(),"}"==t&&F()):F()),","!=t&&"string"==typeof t&&"@"==(j?t.charAt(0):t[0])&&":"==H()||F(),e[t.slice(1)]=z(H());return e}F()}return t},J=function(t,e,n){var r=Y(t,e,n);r===y?delete t[e]:t[e]=r},Y=function(t,e,n){var r,o=t[e];if("object"==typeof o&&o)if(m.call(o)==A)for(r=o.length;r--;)J(o,r,n);else v(o,function(t){J(o,t,n)});return n.call(t,e,o)};e.parse=function(t,e){var n,r;return P=0,N=""+t,n=z(H()),"$"!=H()&&F(),P=N=null,e&&m.call(e)==w?Y((r={},r[""]=n,r),"",e):n}}}return e.runInContext=i,e}var s=n(78),a={"function":!0,object:!0},c=a[typeof e]&&e&&!e.nodeType&&e,u=a[typeof window]&&window||this,f=c&&a[typeof t]&&t&&!t.nodeType&&"object"==typeof o&&o;if(!f||f.global!==f&&f.window!==f&&f.self!==f||(u=f),c&&!s)i(u,c);else{var l=u.JSON,h=u.JSON3,d=!1,p=i(u,u.JSON3={noConflict:function(){return d||(d=!0,u.JSON=l,u.JSON3=h,l=h=null),p}});u.JSON={parse:p.parse,stringify:p.stringify}}s&&(r=function(){return p}.call(e,n,e,t),!(void 0!==r&&(t.exports=r)))}).call(this)}).call(e,n(77)(t),function(){return this}())},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e){(function(e){t.exports=e}).call(e,{})},function(t,e){t.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}},function(t,e){function n(t){if(t)return r(t)}function r(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this},n.prototype.once=function(t,e){function n(){r.off(t,n),e.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},n.fn=e,this.on(t,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[t];if(!n)return this;if(1==arguments.length)return delete this._callbacks[t],this;for(var r,o=0;o<n.length;o++)if(r=n[o],r===e||r.fn===e){n.splice(o,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks[t];
if(n){n=n.slice(0);for(var r=0,o=n.length;r<o;++r)n[r].apply(this,e)}return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,n){(function(t){var r=n(79),o=n(82);e.deconstructPacket=function(t){function e(t){if(!t)return t;if(o(t)){var i={_placeholder:!0,num:n.length};return n.push(t),i}if(r(t)){for(var s=new Array(t.length),a=0;a<t.length;a++)s[a]=e(t[a]);return s}if("object"==typeof t&&!(t instanceof Date)){var s={};for(var c in t)s[c]=e(t[c]);return s}return t}var n=[],i=t.data,s=t;return s.data=e(i),s.attachments=n.length,{packet:s,buffers:n}},e.reconstructPacket=function(t,e){function n(t){if(t&&t._placeholder){var o=e[t.num];return o}if(r(t)){for(var i=0;i<t.length;i++)t[i]=n(t[i]);return t}if(t&&"object"==typeof t){for(var s in t)t[s]=n(t[s]);return t}return t}return t.data=n(t.data),t.attachments=void 0,t},e.removeBlobs=function(e,n){function i(e,c,u){if(!e)return e;if(t.Blob&&e instanceof Blob||t.File&&e instanceof File){s++;var f=new FileReader;f.onload=function(){u?u[c]=this.result:a=this.result,--s||n(a)},f.readAsArrayBuffer(e)}else if(r(e))for(var l=0;l<e.length;l++)i(e[l],l,e);else if(e&&"object"==typeof e&&!o(e))for(var h in e)i(e[h],h,e)}var s=0,a=e;i(a),s||n(a)}}).call(e,function(){return this}())},function(t,e){(function(e){function n(t){return e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer}t.exports=n}).call(e,function(){return this}())},function(t,e,n){function r(t,e){return this instanceof r?(t&&"object"==typeof t&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new a.Encoder,this.decoder=new a.Decoder,this.autoConnect=e.autoConnect!==!1,void(this.autoConnect&&this.open())):new r(t,e)}var o=n(84),i=n(111),s=n(112),a=n(75),c=n(114),u=n(115),f=n(72)("socket.io-client:manager"),l=n(109),h=n(118),d=Object.prototype.hasOwnProperty;t.exports=r,r.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var t in this.nsps)d.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},r.prototype.updateSocketIds=function(){for(var t in this.nsps)d.call(this.nsps,t)&&(this.nsps[t].id=this.engine.id)},s(r.prototype),r.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},r.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},r.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},r.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},r.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},r.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},r.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},r.prototype.open=r.prototype.connect=function(t){if(f("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;f("opening %s",this.uri),this.engine=o(this.uri,this.opts);var e=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var r=c(e,"open",function(){n.onopen(),t&&t()}),i=c(e,"error",function(e){if(f("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",e),t){var r=new Error("Connection error");r.data=e,t(r)}else n.maybeReconnectOnOpen()});if(!1!==this._timeout){var s=this._timeout;f("connect attempt will timeout after %d",s);var a=setTimeout(function(){f("connect attempt timed out after %d",s),r.destroy(),e.close(),e.emit("error","timeout"),n.emitAll("connect_timeout",s)},s);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(r),this.subs.push(i),this},r.prototype.onopen=function(){f("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(c(t,"data",u(this,"ondata"))),this.subs.push(c(t,"ping",u(this,"onping"))),this.subs.push(c(t,"pong",u(this,"onpong"))),this.subs.push(c(t,"error",u(this,"onerror"))),this.subs.push(c(t,"close",u(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",u(this,"ondecoded")))},r.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},r.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},r.prototype.ondata=function(t){this.decoder.add(t)},r.prototype.ondecoded=function(t){this.emit("packet",t)},r.prototype.onerror=function(t){f("error",t),this.emitAll("error",t)},r.prototype.socket=function(t){function e(){~l(r.connecting,n)||r.connecting.push(n)}var n=this.nsps[t];if(!n){n=new i(this,t),this.nsps[t]=n;var r=this;n.on("connecting",e),n.on("connect",function(){n.id=r.engine.id}),this.autoConnect&&e()}return n},r.prototype.destroy=function(t){var e=l(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},r.prototype.packet=function(t){f("writing packet %j",t);var e=this;e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,function(n){for(var r=0;r<n.length;r++)e.engine.write(n[r],t.options);e.encoding=!1,e.processPacketQueue()}))},r.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},r.prototype.cleanup=function(){f("cleanup");for(var t;t=this.subs.shift();)t.destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},r.prototype.close=r.prototype.disconnect=function(){f("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"==this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},r.prototype.onclose=function(t){f("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},r.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)f("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();f("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout(function(){t.skipReconnect||(f("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(f("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(f("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(n)}})}},r.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}},function(t,e,n){t.exports=n(85)},function(t,e,n){t.exports=n(86),t.exports.parser=n(93)},function(t,e,n){(function(e){function r(t,n){if(!(this instanceof r))return new r(t,n);n=n||{},t&&"object"==typeof t&&(n=t,t=null),t?(t=f(t),n.hostname=t.host,n.secure="https"==t.protocol||"wss"==t.protocol,n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=f(n.host).host),this.secure=null!=n.secure?n.secure:e.location&&"https:"==location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.agent=n.agent||!1,this.hostname=n.hostname||(e.location?location.hostname:"localhost"),this.port=n.port||(e.location&&location.port?location.port:this.secure?443:80),this.query=n.query||{},"string"==typeof this.query&&(this.query=h.decode(this.query)),this.upgrade=!1!==n.upgrade,this.path=(n.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!n.forceJSONP,this.jsonp=!1!==n.jsonp,this.forceBase64=!!n.forceBase64,this.enablesXDR=!!n.enablesXDR,this.timestampParam=n.timestampParam||"t",this.timestampRequests=n.timestampRequests,this.transports=n.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.policyPort=n.policyPort||843,this.rememberUpgrade=n.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=n.onlyBinaryUpgrades,this.perMessageDeflate=!1!==n.perMessageDeflate&&(n.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=n.pfx||null,this.key=n.key||null,this.passphrase=n.passphrase||null,this.cert=n.cert||null,this.ca=n.ca||null,this.ciphers=n.ciphers||null,this.rejectUnauthorized=void 0===n.rejectUnauthorized||n.rejectUnauthorized;var o="object"==typeof e&&e;o.global===o&&n.extraHeaders&&Object.keys(n.extraHeaders).length>0&&(this.extraHeaders=n.extraHeaders),this.open()}function o(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}var i=n(87),s=n(102),a=n(72)("engine.io-client:socket"),c=n(109),u=n(93),f=n(71),l=n(110),h=n(103);t.exports=r,r.priorWebsocketSuccess=!1,s(r.prototype),r.protocol=u.protocol,r.Socket=r,r.Transport=n(92),r.transports=n(87),r.parser=n(93),r.prototype.createTransport=function(t){a('creating transport "%s"',t);var e=o(this.query);e.EIO=u.protocol,e.transport=t,this.id&&(e.sid=this.id);var n=new i[t]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:e,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return n},r.prototype.open=function(){var t;if(this.rememberUpgrade&&r.priorWebsocketSuccess&&this.transports.indexOf("websocket")!=-1)t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout(function(){e.emit("error","No transports available")},0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(n){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},r.prototype.setTransport=function(t){a("setting transport %s",t.name);var e=this;this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},r.prototype.probe=function(t){function e(){if(h.onlyBinaryUpgrades){var e=!this.supportsBinary&&h.transport.supportsBinary;l=l||e}l||(a('probe transport "%s" opened',t),f.send([{type:"ping",data:"probe"}]),f.once("packet",function(e){if(!l)if("pong"==e.type&&"probe"==e.data){if(a('probe transport "%s" pong',t),h.upgrading=!0,h.emit("upgrading",f),!f)return;r.priorWebsocketSuccess="websocket"==f.name,a('pausing current transport "%s"',h.transport.name),h.transport.pause(function(){l||"closed"!=h.readyState&&(a("changing transport and sending upgrade packet"),u(),h.setTransport(f),f.send([{type:"upgrade"}]),h.emit("upgrade",f),f=null,h.upgrading=!1,h.flush())})}else{a('probe transport "%s" failed',t);var n=new Error("probe error");n.transport=f.name,h.emit("upgradeError",n)}}))}function n(){l||(l=!0,u(),f.close(),f=null)}function o(e){var r=new Error("probe error: "+e);r.transport=f.name,n(),a('probe transport "%s" failed because of error: %s',t,e),h.emit("upgradeError",r)}function i(){o("transport closed")}function s(){o("socket closed")}function c(t){f&&t.name!=f.name&&(a('"%s" works - aborting "%s"',t.name,f.name),n())}function u(){f.removeListener("open",e),f.removeListener("error",o),f.removeListener("close",i),h.removeListener("close",s),h.removeListener("upgrading",c)}a('probing transport "%s"',t);var f=this.createTransport(t,{probe:1}),l=!1,h=this;r.priorWebsocketSuccess=!1,f.once("open",e),f.once("error",o),f.once("close",i),this.once("close",s),this.once("upgrading",c),f.open()},r.prototype.onOpen=function(){if(a("socket open"),this.readyState="open",r.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){a("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},r.prototype.onPacket=function(t){if("opening"==this.readyState||"open"==this.readyState)switch(a('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(l(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else a('packet received with socket readyState "%s"',this.readyState)},r.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},r.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){"closed"!=e.readyState&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},r.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){a("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},r.prototype.ping=function(){var t=this;this.sendPacket("ping",function(){t.emit("ping")})},r.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},r.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},r.prototype.write=r.prototype.send=function(t,e,n){return this.sendPacket("message",t,e,n),this},r.prototype.sendPacket=function(t,e,n,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof n&&(r=n,n=null),"closing"!=this.readyState&&"closed"!=this.readyState){n=n||{},n.compress=!1!==n.compress;var o={type:t,data:e,options:n};this.emit("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}},r.prototype.close=function(){function t(){r.onClose("forced close"),a("socket closing - telling transport to close"),r.transport.close()}function e(){r.removeListener("upgrade",e),r.removeListener("upgradeError",e),t()}function n(){r.once("upgrade",e),r.once("upgradeError",e)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var r=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():t()}):this.upgrading?n():t()}return this},r.prototype.onError=function(t){a("socket error %j",t),r.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},r.prototype.onClose=function(t,e){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){a('socket close with reason: "%s"',t);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),n.writeBuffer=[],n.prevBufferLen=0}},r.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;n<r;n++)~c(this.transports,t[n])&&e.push(t[n]);return e}}).call(e,function(){return this}())},function(t,e,n){(function(t){function r(e){var n,r=!1,a=!1,c=!1!==e.jsonp;if(t.location){var u="https:"==location.protocol,f=location.port;f||(f=u?443:80),r=e.hostname!=location.hostname||f!=e.port,a=e.secure!=u}if(e.xdomain=r,e.xscheme=a,n=new o(e),"open"in n&&!e.forceJSONP)return new i(e);if(!c)throw new Error("JSONP disabled");return new s(e)}var o=n(88),i=n(90),s=n(106),a=n(107);e.polling=r,e.websocket=a}).call(e,function(){return this}())},function(t,e,n){var r=n(89);t.exports=function(t){var e=t.xdomain,n=t.xscheme,o=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||r))return new XMLHttpRequest}catch(i){}try{if("undefined"!=typeof XDomainRequest&&!n&&o)return new XDomainRequest}catch(i){}if(!e)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(i){}}},function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(n){t.exports=!1}},function(t,e,n){(function(e){function r(){}function o(t){if(c.call(this,t),e.location){var n="https:"==location.protocol,r=location.port;r||(r=n?443:80),this.xd=t.hostname!=e.location.hostname||r!=t.port,this.xs=t.secure!=n}else this.extraHeaders=t.extraHeaders}function i(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!=t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}function s(){for(var t in i.requests)i.requests.hasOwnProperty(t)&&i.requests[t].abort()}var a=n(88),c=n(91),u=n(102),f=n(104),l=n(72)("engine.io-client:polling-xhr");t.exports=o,t.exports.Request=i,f(o,c),o.prototype.supportsBinary=!0,o.prototype.request=function(t){return t=t||{},t.uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.extraHeaders=this.extraHeaders,new i(t)},o.prototype.doWrite=function(t,e){var n="string"!=typeof t&&void 0!==t,r=this.request({method:"POST",data:t,isBinary:n}),o=this;r.on("success",e),r.on("error",function(t){o.onError("xhr post error",t)}),this.sendXhr=r},o.prototype.doPoll=function(){l("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},u(i.prototype),i.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var n=this.xhr=new a(t),r=this;try{l("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,this.async);try{if(this.extraHeaders){n.setDisableHeaderCheck(!0);for(var o in this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&n.setRequestHeader(o,this.extraHeaders[o])}}catch(s){}if(this.supportsBinary&&(n.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}"withCredentials"in n&&(n.withCredentials=!0),this.hasXDR()?(n.onload=function(){r.onLoad()},n.onerror=function(){r.onError(n.responseText)}):n.onreadystatechange=function(){4==n.readyState&&(200==n.status||1223==n.status?r.onLoad():setTimeout(function(){r.onError(n.status)},0))},l("xhr data %s",this.data),n.send(this.data)}catch(s){return void setTimeout(function(){r.onError(s)},0)}e.document&&(this.index=i.requestsCount++,i.requests[this.index]=this)},i.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},i.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},i.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},i.prototype.cleanup=function(t){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=r:this.xhr.onreadystatechange=r,t)try{this.xhr.abort()}catch(n){}e.document&&delete i.requests[this.index],this.xhr=null}},i.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(n){}if("application/octet-stream"===e)t=this.xhr.response;else if(this.supportsBinary)try{t=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(n){for(var r=new Uint8Array(this.xhr.response),o=[],i=0,s=r.length;i<s;i++)o.push(r[i]);t=String.fromCharCode.apply(null,o)}else t=this.xhr.responseText}catch(n){this.onError(n)}null!=t&&this.onData(t)},i.prototype.hasXDR=function(){return"undefined"!=typeof e.XDomainRequest&&!this.xs&&this.enablesXDR},i.prototype.abort=function(){this.cleanup()},e.document&&(i.requestsCount=0,i.requests={},e.attachEvent?e.attachEvent("onunload",s):e.addEventListener&&e.addEventListener("beforeunload",s,!1))}).call(e,function(){return this}())},function(t,e,n){function r(t){var e=t&&t.forceBase64;f&&!e||(this.supportsBinary=!1),o.call(this,t)}var o=n(92),i=n(103),s=n(93),a=n(104),c=n(105),u=n(72)("engine.io-client:polling");t.exports=r;var f=function(){var t=n(88),e=new t({xdomain:!1});return null!=e.responseType}();a(r,o),r.prototype.name="polling",r.prototype.doOpen=function(){this.poll()},r.prototype.pause=function(t){function e(){u("paused"),n.readyState="paused",t()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(u("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){u("pre-pause polling complete"),--r||e()})),this.writable||(u("we are currently writing - waiting to pause"),r++,this.once("drain",function(){u("pre-pause writing complete"),--r||e()}))}else e()},r.prototype.poll=function(){u("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},r.prototype.onData=function(t){var e=this;u("polling got data %s",t);var n=function(t,n,r){return"opening"==e.readyState&&e.onOpen(),"close"==t.type?(e.onClose(),!1):void e.onPacket(t)};s.decodePayload(t,this.socket.binaryType,n),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():u('ignoring poll - transport state "%s"',this.readyState))},r.prototype.doClose=function(){function t(){u("writing close packet"),e.write([{type:"close"}])}var e=this;"open"==this.readyState?(u("transport open - closing"),t()):(u("transport not open - deferring close"),this.once("open",t))},r.prototype.write=function(t){var e=this;this.writable=!1;var n=function(){e.writable=!0,e.emit("drain")},e=this;s.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,n)})},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";!1!==this.timestampRequests&&(t[this.timestampParam]=c()),this.supportsBinary||t.sid||(t.b64=1),t=i.encode(t),this.port&&("https"==e&&443!=this.port||"http"==e&&80!=this.port)&&(n=":"+this.port),t.length&&(t="?"+t);var r=this.hostname.indexOf(":")!==-1;return e+"://"+(r?"["+this.hostname+"]":this.hostname)+n+this.path+t}},function(t,e,n){function r(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders}var o=n(93),i=n(102);t.exports=r,i(r.prototype),r.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},r.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},r.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},r.prototype.send=function(t){if("open"!=this.readyState)throw new Error("Transport not open");this.write(t)},r.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},r.prototype.onData=function(t){var e=o.decodePacket(t,this.socket.binaryType);this.onPacket(e)},r.prototype.onPacket=function(t){this.emit("packet",t)},r.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(t,e,n){(function(t){function r(t,n){var r="b"+e.packets[t.type]+t.data.data;return n(r)}function o(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var o=t.data,i=new Uint8Array(o),s=new Uint8Array(1+o.byteLength);s[0]=g[t.type];for(var a=0;a<i.length;a++)s[a+1]=i[a];return r(s.buffer)}function i(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var o=new FileReader;return o.onload=function(){t.data=o.result,e.encodePacket(t,n,!0,r)},o.readAsArrayBuffer(t.data)}function s(t,n,r){if(!n)return e.encodeBase64Packet(t,r);if(y)return i(t,n,r);var o=new Uint8Array(1);o[0]=g[t.type];var s=new b([o.buffer,t.data]);return r(s)}function a(t,e,n){for(var r=new Array(t.length),o=h(t.length,n),i=function(t,n,o){e(n,function(e,n){r[t]=n,o(e,r)})},s=0;s<t.length;s++)i(s,t[s],o)}var c=n(94),u=n(95),f=n(97),l=n(98),h=n(99),d=n(100),p=navigator.userAgent.match(/Android/i),v=/PhantomJS/i.test(navigator.userAgent),y=p||v;e.protocol=3;var g=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},m=c(g),_={type:"error",data:"parser error"},b=n(101);e.encodePacket=function(e,n,i,a){"function"==typeof n&&(a=n,n=!1),"function"==typeof i&&(a=i,i=null);var c=void 0===e.data?void 0:e.data.buffer||e.data;if(t.ArrayBuffer&&c instanceof ArrayBuffer)return o(e,n,a);if(b&&c instanceof t.Blob)return s(e,n,a);if(c&&c.base64)return r(e,a);var u=g[e.type];return void 0!==e.data&&(u+=i?d.encode(String(e.data)):String(e.data)),a(""+u)},e.encodeBase64Packet=function(n,r){var o="b"+e.packets[n.type];if(b&&n.data instanceof t.Blob){var i=new FileReader;return i.onload=function(){var t=i.result.split(",")[1];r(o+t)},i.readAsDataURL(n.data)}var s;try{s=String.fromCharCode.apply(null,new Uint8Array(n.data))}catch(a){for(var c=new Uint8Array(n.data),u=new Array(c.length),f=0;f<c.length;f++)u[f]=c[f];s=String.fromCharCode.apply(null,u)}return o+=t.btoa(s),r(o)},e.decodePacket=function(t,n,r){if("string"==typeof t||void 0===t){if("b"==t.charAt(0))return e.decodeBase64Packet(t.substr(1),n);if(r)try{t=d.decode(t)}catch(o){return _}var i=t.charAt(0);return Number(i)==i&&m[i]?t.length>1?{type:m[i],data:t.substring(1)}:{type:m[i]}:_}var s=new Uint8Array(t),i=s[0],a=f(t,1);return b&&"blob"===n&&(a=new b([a])),{type:m[i],data:a}},e.decodeBase64Packet=function(e,n){var r=m[e.charAt(0)];if(!t.ArrayBuffer)return{type:r,data:{base64:!0,data:e.substr(1)}};var o=l.decode(e.substr(1));return"blob"===n&&b&&(o=new b([o])),{type:r,data:o}},e.encodePayload=function(t,n,r){function o(t){return t.length+":"+t}function i(t,r){e.encodePacket(t,!!s&&n,!0,function(t){r(null,o(t))})}"function"==typeof n&&(r=n,n=null);var s=u(t);return n&&s?b&&!y?e.encodePayloadAsBlob(t,r):e.encodePayloadAsArrayBuffer(t,r):t.length?void a(t,i,function(t,e){return r(e.join(""))}):r("0:")},e.decodePayload=function(t,n,r){if("string"!=typeof t)return e.decodePayloadAsBinary(t,n,r);"function"==typeof n&&(r=n,n=null);var o;if(""==t)return r(_,0,1);for(var i,s,a="",c=0,u=t.length;c<u;c++){var f=t.charAt(c);if(":"!=f)a+=f;else{if(""==a||a!=(i=Number(a)))return r(_,0,1);if(s=t.substr(c+1,i),a!=s.length)return r(_,0,1);if(s.length){if(o=e.decodePacket(s,n,!0),_.type==o.type&&_.data==o.data)return r(_,0,1);var l=r(o,c+i,u);if(!1===l)return}c+=i,a=""}}return""!=a?r(_,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,n){function r(t,n){e.encodePacket(t,!0,!0,function(t){return n(null,t)})}return t.length?void a(t,r,function(t,e){var r=e.reduce(function(t,e){var n;return n="string"==typeof e?e.length:e.byteLength,t+n.toString().length+n+2},0),o=new Uint8Array(r),i=0;return e.forEach(function(t){var e="string"==typeof t,n=t;if(e){for(var r=new Uint8Array(t.length),s=0;s<t.length;s++)r[s]=t.charCodeAt(s);n=r.buffer}e?o[i++]=0:o[i++]=1;for(var a=n.byteLength.toString(),s=0;s<a.length;s++)o[i++]=parseInt(a[s]);o[i++]=255;for(var r=new Uint8Array(n),s=0;s<r.length;s++)o[i++]=r[s]}),n(o.buffer)}):n(new ArrayBuffer(0))},e.encodePayloadAsBlob=function(t,n){function r(t,n){e.encodePacket(t,!0,!0,function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var r=new Uint8Array(t.length),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);t=r.buffer,e[0]=0}for(var i=t instanceof ArrayBuffer?t.byteLength:t.size,s=i.toString(),a=new Uint8Array(s.length+1),o=0;o<s.length;o++)a[o]=parseInt(s[o]);if(a[s.length]=255,b){var c=new b([e.buffer,a.buffer,t]);n(null,c)}})}a(t,r,function(t,e){return n(new b(e))})},e.decodePayloadAsBinary=function(t,n,r){"function"==typeof n&&(r=n,n=null);for(var o=t,i=[],s=!1;o.byteLength>0;){for(var a=new Uint8Array(o),c=0===a[0],u="",l=1;255!=a[l];l++){if(u.length>310){s=!0;break}u+=a[l]}if(s)return r(_,0,1);o=f(o,2+u.length),u=parseInt(u);var h=f(o,0,u);if(c)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(d){var p=new Uint8Array(h);h="";for(var l=0;l<p.length;l++)h+=String.fromCharCode(p[l])}i.push(h),o=f(o,u)}var v=i.length;i.forEach(function(t,o){r(e.decodePacket(t,n,!0),o,v)})}}).call(e,function(){return this}())},function(t,e){t.exports=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e}},function(t,e,n){(function(e){function r(t){function n(t){if(!t)return!1;if(e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer||e.Blob&&t instanceof Blob||e.File&&t instanceof File)return!0;if(o(t)){for(var r=0;r<t.length;r++)if(n(t[r]))return!0}else if(t&&"object"==typeof t){t.toJSON&&(t=t.toJSON());for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&n(t[i]))return!0}return!1}return n(t)}var o=n(96);t.exports=r}).call(e,function(){return this}())},function(t,e){t.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}},function(t,e){t.exports=function(t,e,n){var r=t.byteLength;if(e=e||0,n=n||r,t.slice)return t.slice(e,n);if(e<0&&(e+=r),n<0&&(n+=r),n>r&&(n=r),e>=r||e>=n||0===r)return new ArrayBuffer(0);for(var o=new Uint8Array(t),i=new Uint8Array(n-e),s=e,a=0;s<n;s++,a++)i[a]=o[s];return i.buffer}},function(t,e){!function(t){"use strict";e.encode=function(e){var n,r=new Uint8Array(e),o=r.length,i="";for(n=0;n<o;n+=3)i+=t[r[n]>>2],i+=t[(3&r[n])<<4|r[n+1]>>4],i+=t[(15&r[n+1])<<2|r[n+2]>>6],i+=t[63&r[n+2]];return o%3===2?i=i.substring(0,i.length-1)+"=":o%3===1&&(i=i.substring(0,i.length-2)+"=="),i},e.decode=function(e){var n,r,o,i,s,a=.75*e.length,c=e.length,u=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var f=new ArrayBuffer(a),l=new Uint8Array(f);for(n=0;n<c;n+=4)r=t.indexOf(e[n]),o=t.indexOf(e[n+1]),i=t.indexOf(e[n+2]),s=t.indexOf(e[n+3]),l[u++]=r<<2|o>>4,l[u++]=(15&o)<<4|i>>2,l[u++]=(3&i)<<6|63&s;return f}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");
},function(t,e){function n(t,e,n){function o(t,r){if(o.count<=0)throw new Error("after called too many times");--o.count,t?(i=!0,e(t),e=n):0!==o.count||i||e(null,r)}var i=!1;return n=n||r,o.count=t,0===t?e():o}function r(){}t.exports=n},function(t,e,n){var r;(function(t,o){!function(i){function s(t){for(var e,n,r=[],o=0,i=t.length;o<i;)e=t.charCodeAt(o++),e>=55296&&e<=56319&&o<i?(n=t.charCodeAt(o++),56320==(64512&n)?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),o--)):r.push(e);return r}function a(t){for(var e,n=t.length,r=-1,o="";++r<n;)e=t[r],e>65535&&(e-=65536,o+=b(e>>>10&1023|55296),e=56320|1023&e),o+=b(e);return o}function c(t){if(t>=55296&&t<=57343)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value")}function u(t,e){return b(t>>e&63|128)}function f(t){if(0==(4294967168&t))return b(t);var e="";return 0==(4294965248&t)?e=b(t>>6&31|192):0==(4294901760&t)?(c(t),e=b(t>>12&15|224),e+=u(t,6)):0==(4292870144&t)&&(e=b(t>>18&7|240),e+=u(t,12),e+=u(t,6)),e+=b(63&t|128)}function l(t){for(var e,n=s(t),r=n.length,o=-1,i="";++o<r;)e=n[o],i+=f(e);return i}function h(){if(_>=m)throw Error("Invalid byte index");var t=255&g[_];if(_++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function d(){var t,e,n,r,o;if(_>m)throw Error("Invalid byte index");if(_==m)return!1;if(t=255&g[_],_++,0==(128&t))return t;if(192==(224&t)){var e=h();if(o=(31&t)<<6|e,o>=128)return o;throw Error("Invalid continuation byte")}if(224==(240&t)){if(e=h(),n=h(),o=(15&t)<<12|e<<6|n,o>=2048)return c(o),o;throw Error("Invalid continuation byte")}if(240==(248&t)&&(e=h(),n=h(),r=h(),o=(15&t)<<18|e<<12|n<<6|r,o>=65536&&o<=1114111))return o;throw Error("Invalid UTF-8 detected")}function p(t){g=s(t),m=g.length,_=0;for(var e,n=[];(e=d())!==!1;)n.push(e);return a(n)}var v="object"==typeof e&&e,y=("object"==typeof t&&t&&t.exports==v&&t,"object"==typeof o&&o);y.global!==y&&y.window!==y||(i=y);var g,m,_,b=String.fromCharCode,w={version:"2.0.0",encode:l,decode:p};r=function(){return w}.call(e,n,e,t),!(void 0!==r&&(t.exports=r))}(this)}).call(e,n(77)(t),function(){return this}())},function(t,e){(function(e){function n(t){for(var e=0;e<t.length;e++){var n=t[e];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var o=new Uint8Array(n.byteLength);o.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=o.buffer}t[e]=r}}}function r(t,e){e=e||{};var r=new i;n(t);for(var o=0;o<t.length;o++)r.append(t[o]);return e.type?r.getBlob(e.type):r.getBlob()}function o(t,e){return n(t),new Blob(t,e||{})}var i=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,s=function(){try{var t=new Blob(["hi"]);return 2===t.size}catch(e){return!1}}(),a=s&&function(){try{var t=new Blob([new Uint8Array([1,2])]);return 2===t.size}catch(e){return!1}}(),c=i&&i.prototype.append&&i.prototype.getBlob;t.exports=function(){return s?a?e.Blob:o:c?r:void 0}()}).call(e,function(){return this}())},function(t,e){function n(t){if(t)return r(t)}function r(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this},n.prototype.once=function(t,e){function n(){r.off(t,n),e.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},n.fn=e,this.on(t,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[t];if(!n)return this;if(1==arguments.length)return delete this._callbacks[t],this;for(var r,o=0;o<n.length;o++)if(r=n[o],r===e||r.fn===e){n.splice(o,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks[t];if(n){n=n.slice(0);for(var r=0,o=n.length;r<o;++r)n[r].apply(this,e)}return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e){e.encode=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},e.decode=function(t){for(var e={},n=t.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}},function(t,e){t.exports=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e){"use strict";function n(t){var e="";do e=s[t%a]+e,t=Math.floor(t/a);while(t>0);return e}function r(t){var e=0;for(f=0;f<t.length;f++)e=e*a+c[t.charAt(f)];return e}function o(){var t=n(+new Date);return t!==i?(u=0,i=t):t+"."+n(u++)}for(var i,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),a=64,c={},u=0,f=0;f<a;f++)c[s[f]]=f;o.encode=n,o.decode=r,t.exports=o},function(t,e,n){(function(e){function r(){}function o(t){i.call(this,t),this.query=this.query||{},a||(e.___eio||(e.___eio=[]),a=e.___eio),this.index=a.length;var n=this;a.push(function(t){n.onData(t)}),this.query.j=this.index,e.document&&e.addEventListener&&e.addEventListener("beforeunload",function(){n.script&&(n.script.onerror=r)},!1)}var i=n(91),s=n(104);t.exports=o;var a,c=/\n/g,u=/\\n/g;s(o,i),o.prototype.supportsBinary=!1,o.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),i.prototype.doClose.call(this)},o.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e;var r="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);r&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},o.prototype.doWrite=function(t,e){function n(){r(),e()}function r(){if(o.iframe)try{o.form.removeChild(o.iframe)}catch(t){o.onError("jsonp polling iframe removal error",t)}try{var e='<iframe src="javascript:0" name="'+o.iframeId+'">';i=document.createElement(e)}catch(t){i=document.createElement("iframe"),i.name=o.iframeId,i.src="javascript:0"}i.id=o.iframeId,o.form.appendChild(i),o.iframe=i}var o=this;if(!this.form){var i,s=document.createElement("form"),a=document.createElement("textarea"),f=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=f,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),r(),t=t.replace(u,"\\\n"),this.area.value=t.replace(c,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==o.iframe.readyState&&n()}:this.iframe.onload=n}}).call(e,function(){return this}())},function(t,e,n){(function(e){function r(t){var e=t&&t.forceBase64;e&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,o.call(this,t)}var o=n(92),i=n(93),s=n(103),a=n(104),c=n(105),u=n(72)("engine.io-client:websocket"),f=e.WebSocket||e.MozWebSocket,l=f;if(!l&&"undefined"==typeof window)try{l=n(108)}catch(h){}t.exports=r,a(r,o),r.prototype.name="websocket",r.prototype.supportsBinary=!0,r.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=void 0,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.ws=f?new l(t):new l(t,e,n),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="buffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},r.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(r.prototype.onData=function(t){var e=this;setTimeout(function(){o.prototype.onData.call(e,t)},0)}),r.prototype.write=function(t){function n(){r.emit("flush"),setTimeout(function(){r.writable=!0,r.emit("drain")},0)}var r=this;this.writable=!1;for(var o=t.length,s=0,a=o;s<a;s++)!function(t){i.encodePacket(t,r.supportsBinary,function(i){if(!f){var s={};if(t.options&&(s.compress=t.options.compress),r.perMessageDeflate){var a="string"==typeof i?e.Buffer.byteLength(i):i.length;a<r.perMessageDeflate.threshold&&(s.compress=!1)}}try{f?r.ws.send(i):r.ws.send(i,s)}catch(c){u("websocket closed before onclose event")}--o||n()})}(t[s])},r.prototype.onClose=function(){o.prototype.onClose.call(this)},r.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";this.port&&("wss"==e&&443!=this.port||"ws"==e&&80!=this.port)&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=c()),this.supportsBinary||(t.b64=1),t=s.encode(t),t.length&&(t="?"+t);var r=this.hostname.indexOf(":")!==-1;return e+"://"+(r?"["+this.hostname+"]":this.hostname)+n+this.path+t},r.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===r.prototype.name)}}).call(e,function(){return this}())},function(t,e){},function(t,e){var n=[].indexOf;t.exports=function(t,e){if(n)return t.indexOf(e);for(var r=0;r<t.length;++r)if(t[r]===e)return r;return-1}},function(t,e){(function(e){var n=/^[\],:{}\s]*$/,r=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,o=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,i=/(?:^|:|,)(?:\s*\[)+/g,s=/^\s+/,a=/\s+$/;t.exports=function(t){return"string"==typeof t&&t?(t=t.replace(s,"").replace(a,""),e.JSON&&JSON.parse?JSON.parse(t):n.test(t.replace(r,"@").replace(o,"]").replace(i,""))?new Function("return "+t)():void 0):null}}).call(e,function(){return this}())},function(t,e,n){function r(t,e){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.io.autoConnect&&this.open()}var o=n(75),i=n(112),s=n(113),a=n(114),c=n(115),u=n(72)("socket.io-client:socket"),f=n(116);t.exports=e=r;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},h=i.prototype.emit;i(r.prototype),r.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[a(t,"open",c(this,"onopen")),a(t,"packet",c(this,"onpacket")),a(t,"close",c(this,"onclose"))]}},r.prototype.open=r.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this.emit("connecting"),this)},r.prototype.send=function(){var t=s(arguments);return t.unshift("message"),this.emit.apply(this,t),this},r.prototype.emit=function(t){if(l.hasOwnProperty(t))return h.apply(this,arguments),this;var e=s(arguments),n=o.EVENT;f(e)&&(n=o.BINARY_EVENT);var r={type:n,data:e};return r.options={},r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(u("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),delete this.flags,this},r.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},r.prototype.onopen=function(){u("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:o.CONNECT})},r.prototype.onclose=function(t){u("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},r.prototype.onpacket=function(t){if(t.nsp==this.nsp)switch(t.type){case o.CONNECT:this.onconnect();break;case o.EVENT:this.onevent(t);break;case o.BINARY_EVENT:this.onevent(t);break;case o.ACK:this.onack(t);break;case o.BINARY_ACK:this.onack(t);break;case o.DISCONNECT:this.ondisconnect();break;case o.ERROR:this.emit("error",t.data)}},r.prototype.onevent=function(t){var e=t.data||[];u("emitting event %j",e),null!=t.id&&(u("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?h.apply(this,e):this.receiveBuffer.push(e)},r.prototype.ack=function(t){var e=this,n=!1;return function(){if(!n){n=!0;var r=s(arguments);u("sending ack %j",r);var i=f(r)?o.BINARY_ACK:o.ACK;e.packet({type:i,id:t,data:r})}}},r.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(u("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):u("bad ack %s",t.id)},r.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},r.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)h.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},r.prototype.ondisconnect=function(){u("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},r.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},r.prototype.close=r.prototype.disconnect=function(){return this.connected&&(u("performing disconnect (%s)",this.nsp),this.packet({type:o.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},r.prototype.compress=function(t){return this.flags=this.flags||{},this.flags.compress=t,this}},function(t,e){function n(t){if(t)return r(t)}function r(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},n.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r,o=0;o<n.length;o++)if(r=n[o],r===e||r.fn===e){n.splice(o,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n){n=n.slice(0);for(var r=0,o=n.length;r<o;++r)n[r].apply(this,e)}return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e){function n(t,e){var n=[];e=e||0;for(var r=e||0;r<t.length;r++)n[r-e]=t[r];return n}t.exports=n},function(t,e){function n(t,e,n){return t.on(e,n),{destroy:function(){t.removeListener(e,n)}}}t.exports=n},function(t,e){var n=[].slice;t.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return e.apply(t,r.concat(n.call(arguments)))}}},function(t,e,n){(function(e){function r(t){function n(t){if(!t)return!1;if(e.Buffer&&e.Buffer.isBuffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer||e.Blob&&t instanceof Blob||e.File&&t instanceof File)return!0;if(o(t)){for(var r=0;r<t.length;r++)if(n(t[r]))return!0}else if(t&&"object"==typeof t){t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON());for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&n(t[i]))return!0}return!1}return n(t)}var o=n(117);t.exports=r}).call(e,function(){return this}())},function(t,e){t.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}},function(t,e){function n(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=n,n.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(t){this.ms=t},n.prototype.setMax=function(t){this.max=t},n.prototype.setJitter=function(t){this.jitter=t}}])});
//# sourceMappingURL=telepat.client.min.js.map